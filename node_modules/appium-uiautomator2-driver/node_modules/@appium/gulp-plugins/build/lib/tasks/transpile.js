'use strict';

require("source-map-support/register");

const Transpiler = require('../../index').Transpiler;

const debug = require('gulp-debug');

const gulpIf = require('gulp-if');

const merge = require('merge-stream');

const {
  isVerbose
} = require('../utils');

const JSON_SOURCES = ['lib/**/*.json', 'test/**/*.json'];

const configure = function configure(gulp, opts, env) {
  const tasks = [function transpileSources() {
    const firstPath = gulp.src(JSON_SOURCES, {
      base: './'
    }).pipe(gulp.dest(opts.transpileOut));
    const secondPath = gulp.src(opts.files, {
      base: './'
    }).pipe(gulpIf(isVerbose(), debug())).pipe(new Transpiler(opts).stream()).on('error', env.spawnWatcher.handleError.bind(env.spawnWatcher)).pipe(gulp.dest(opts.transpileOut));
    return merge(firstPath, secondPath);
  }];

  if (opts.postTranspile && opts.postTranspile.length) {
    gulp.task('post-transpile', gulp.parallel(opts.postTranspile));
    tasks.push('post-transpile');
  }

  gulp.task('transpile', gulp.series(tasks));
};

module.exports = {
  configure
};require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL3Rhc2tzL3RyYW5zcGlsZS5qcyIsIm5hbWVzIjpbIlRyYW5zcGlsZXIiLCJyZXF1aXJlIiwiZGVidWciLCJndWxwSWYiLCJtZXJnZSIsImlzVmVyYm9zZSIsIkpTT05fU09VUkNFUyIsImNvbmZpZ3VyZSIsImd1bHAiLCJvcHRzIiwiZW52IiwidGFza3MiLCJ0cmFuc3BpbGVTb3VyY2VzIiwiZmlyc3RQYXRoIiwic3JjIiwiYmFzZSIsInBpcGUiLCJkZXN0IiwidHJhbnNwaWxlT3V0Iiwic2Vjb25kUGF0aCIsImZpbGVzIiwic3RyZWFtIiwib24iLCJzcGF3bldhdGNoZXIiLCJoYW5kbGVFcnJvciIsImJpbmQiLCJwb3N0VHJhbnNwaWxlIiwibGVuZ3RoIiwidGFzayIsInBhcmFsbGVsIiwicHVzaCIsInNlcmllcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIiwic291cmNlcyI6WyJsaWIvdGFza3MvdHJhbnNwaWxlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgVHJhbnNwaWxlciA9IHJlcXVpcmUoJy4uLy4uL2luZGV4JykuVHJhbnNwaWxlcjtcbmNvbnN0IGRlYnVnID0gcmVxdWlyZSgnZ3VscC1kZWJ1ZycpO1xuY29uc3QgZ3VscElmID0gcmVxdWlyZSgnZ3VscC1pZicpO1xuY29uc3QgbWVyZ2UgPSByZXF1aXJlKCdtZXJnZS1zdHJlYW0nKTtcbmNvbnN0IHsgaXNWZXJib3NlIH0gPSByZXF1aXJlKCcuLi91dGlscycpO1xuXG5jb25zdCBKU09OX1NPVVJDRVMgPSBbXG4gICdsaWIvKiovKi5qc29uJyxcbiAgJ3Rlc3QvKiovKi5qc29uJyxcbl07XG5cbi8qKlxuICogQHBhcmFtIHtpbXBvcnQoJ2d1bHAnKS5HdWxwfSBndWxwIC0gVGhlIGd1bHAgaW5zdGFuY2UuXG4gKi9cbmNvbnN0IGNvbmZpZ3VyZSA9IGZ1bmN0aW9uIGNvbmZpZ3VyZSAoZ3VscCwgb3B0cywgZW52KSB7XG4gIGNvbnN0IHRhc2tzID0gW1xuICAgIGZ1bmN0aW9uIHRyYW5zcGlsZVNvdXJjZXMgKCkge1xuICAgICAgLy8ganNvbiBmaWxlcyBjYW4gYmUgY29waWVkIGFzIGlzLCB0aGV5IGRvbid0IG5lZWQgdG8gYmUgdHJhbnNwaWxlZFxuICAgICAgY29uc3QgZmlyc3RQYXRoID0gZ3VscC5zcmMoSlNPTl9TT1VSQ0VTLCB7YmFzZTogJy4vJ30pXG4gICAgICAgIC5waXBlKGd1bHAuZGVzdChvcHRzLnRyYW5zcGlsZU91dCkpO1xuICAgICAgY29uc3Qgc2Vjb25kUGF0aCA9IGd1bHAuc3JjKG9wdHMuZmlsZXMsIHtiYXNlOiAnLi8nfSlcbiAgICAgICAgLnBpcGUoZ3VscElmKGlzVmVyYm9zZSgpLCBkZWJ1ZygpKSlcbiAgICAgICAgLnBpcGUobmV3IFRyYW5zcGlsZXIob3B0cykuc3RyZWFtKCkpXG4gICAgICAgIC5vbignZXJyb3InLCBlbnYuc3Bhd25XYXRjaGVyLmhhbmRsZUVycm9yLmJpbmQoZW52LnNwYXduV2F0Y2hlcikpXG4gICAgICAgIC5waXBlKGd1bHAuZGVzdChvcHRzLnRyYW5zcGlsZU91dCkpO1xuICAgICAgcmV0dXJuIG1lcmdlKGZpcnN0UGF0aCwgc2Vjb25kUGF0aCk7XG4gICAgfVxuICBdO1xuXG4gIGlmIChvcHRzLnBvc3RUcmFuc3BpbGUgJiYgb3B0cy5wb3N0VHJhbnNwaWxlLmxlbmd0aCkge1xuICAgIGd1bHAudGFzaygncG9zdC10cmFuc3BpbGUnLCBndWxwLnBhcmFsbGVsKG9wdHMucG9zdFRyYW5zcGlsZSkpO1xuICAgIHRhc2tzLnB1c2goJ3Bvc3QtdHJhbnNwaWxlJyk7XG4gIH1cblxuICBndWxwLnRhc2soJ3RyYW5zcGlsZScsIGd1bHAuc2VyaWVzKHRhc2tzKSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgY29uZmlndXJlLFxufTtcbiJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFFQSxNQUFNQSxVQUFVLEdBQUdDLE9BQU8sQ0FBQyxhQUFELENBQVAsQ0FBdUJELFVBQTFDOztBQUNBLE1BQU1FLEtBQUssR0FBR0QsT0FBTyxDQUFDLFlBQUQsQ0FBckI7O0FBQ0EsTUFBTUUsTUFBTSxHQUFHRixPQUFPLENBQUMsU0FBRCxDQUF0Qjs7QUFDQSxNQUFNRyxLQUFLLEdBQUdILE9BQU8sQ0FBQyxjQUFELENBQXJCOztBQUNBLE1BQU07RUFBRUk7QUFBRixJQUFnQkosT0FBTyxDQUFDLFVBQUQsQ0FBN0I7O0FBRUEsTUFBTUssWUFBWSxHQUFHLENBQ25CLGVBRG1CLEVBRW5CLGdCQUZtQixDQUFyQjs7QUFRQSxNQUFNQyxTQUFTLEdBQUcsU0FBU0EsU0FBVCxDQUFvQkMsSUFBcEIsRUFBMEJDLElBQTFCLEVBQWdDQyxHQUFoQyxFQUFxQztFQUNyRCxNQUFNQyxLQUFLLEdBQUcsQ0FDWixTQUFTQyxnQkFBVCxHQUE2QjtJQUUzQixNQUFNQyxTQUFTLEdBQUdMLElBQUksQ0FBQ00sR0FBTCxDQUFTUixZQUFULEVBQXVCO01BQUNTLElBQUksRUFBRTtJQUFQLENBQXZCLEVBQ2ZDLElBRGUsQ0FDVlIsSUFBSSxDQUFDUyxJQUFMLENBQVVSLElBQUksQ0FBQ1MsWUFBZixDQURVLENBQWxCO0lBRUEsTUFBTUMsVUFBVSxHQUFHWCxJQUFJLENBQUNNLEdBQUwsQ0FBU0wsSUFBSSxDQUFDVyxLQUFkLEVBQXFCO01BQUNMLElBQUksRUFBRTtJQUFQLENBQXJCLEVBQ2hCQyxJQURnQixDQUNYYixNQUFNLENBQUNFLFNBQVMsRUFBVixFQUFjSCxLQUFLLEVBQW5CLENBREssRUFFaEJjLElBRmdCLENBRVgsSUFBSWhCLFVBQUosQ0FBZVMsSUFBZixFQUFxQlksTUFBckIsRUFGVyxFQUdoQkMsRUFIZ0IsQ0FHYixPQUhhLEVBR0paLEdBQUcsQ0FBQ2EsWUFBSixDQUFpQkMsV0FBakIsQ0FBNkJDLElBQTdCLENBQWtDZixHQUFHLENBQUNhLFlBQXRDLENBSEksRUFJaEJQLElBSmdCLENBSVhSLElBQUksQ0FBQ1MsSUFBTCxDQUFVUixJQUFJLENBQUNTLFlBQWYsQ0FKVyxDQUFuQjtJQUtBLE9BQU9kLEtBQUssQ0FBQ1MsU0FBRCxFQUFZTSxVQUFaLENBQVo7RUFDRCxDQVhXLENBQWQ7O0VBY0EsSUFBSVYsSUFBSSxDQUFDaUIsYUFBTCxJQUFzQmpCLElBQUksQ0FBQ2lCLGFBQUwsQ0FBbUJDLE1BQTdDLEVBQXFEO0lBQ25EbkIsSUFBSSxDQUFDb0IsSUFBTCxDQUFVLGdCQUFWLEVBQTRCcEIsSUFBSSxDQUFDcUIsUUFBTCxDQUFjcEIsSUFBSSxDQUFDaUIsYUFBbkIsQ0FBNUI7SUFDQWYsS0FBSyxDQUFDbUIsSUFBTixDQUFXLGdCQUFYO0VBQ0Q7O0VBRUR0QixJQUFJLENBQUNvQixJQUFMLENBQVUsV0FBVixFQUF1QnBCLElBQUksQ0FBQ3VCLE1BQUwsQ0FBWXBCLEtBQVosQ0FBdkI7QUFDRCxDQXJCRDs7QUF1QkFxQixNQUFNLENBQUNDLE9BQVAsR0FBaUI7RUFDZjFCO0FBRGUsQ0FBakIifQ==
