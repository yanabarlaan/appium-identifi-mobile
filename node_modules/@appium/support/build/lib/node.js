"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.deepFreeze = deepFreeze;
exports.getObjectId = getObjectId;
exports.getObjectSize = getObjectSize;
exports.requirePackage = requirePackage;

require("source-map-support/register");

var _system = require("./system");

var _logger = _interopRequireDefault(require("./logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _teen_process = require("teen_process");

var _path = _interopRequireDefault(require("path"));

var _uuid = require("uuid");

const ECMA_SIZES = Object.freeze({
  STRING: 2,
  BOOLEAN: 4,
  NUMBER: 8
});

async function linkGlobalPackage(packageName) {
  try {
    _logger.default.debug(`Linking package '${packageName}'`);

    const cmd = (0, _system.isWindows)() ? 'npm.cmd' : 'npm';
    await (0, _teen_process.exec)(cmd, ['link', packageName], {
      timeout: 20000
    });
  } catch (err) {
    const msg = `Unable to load package '${packageName}', linking failed: ${err.message}`;

    _logger.default.debug(msg);

    if (err.stderr) {
      _logger.default.debug(err.stderr);
    }

    throw new Error(msg);
  }
}

async function requirePackage(packageName) {
  try {
    _logger.default.debug(`Loading local package '${packageName}'`);

    return require(packageName);
  } catch (err) {
    _logger.default.debug(`Failed to load local package '${packageName}': ${err.message}`);
  }

  try {
    var _process$env$npm_conf;

    const globalPackageName = _path.default.resolve((_process$env$npm_conf = process.env.npm_config_prefix) !== null && _process$env$npm_conf !== void 0 ? _process$env$npm_conf : '', 'lib', 'node_modules', packageName);

    _logger.default.debug(`Loading global package '${globalPackageName}'`);

    return require(globalPackageName);
  } catch (err) {
    _logger.default.debug(`Failed to load global package '${packageName}': ${err.message}`);
  }

  try {
    await linkGlobalPackage(packageName);

    _logger.default.debug(`Retrying load of linked package '${packageName}'`);

    return require(packageName);
  } catch (err) {
    _logger.default.errorAndThrow(`Unable to load package '${packageName}': ${err.message}`);
  }
}

function extractAllProperties(obj) {
  const stringProperties = [];

  for (const prop in obj) {
    stringProperties.push(prop);
  }

  if (_lodash.default.isFunction(Object.getOwnPropertySymbols)) {
    stringProperties.push(...Object.getOwnPropertySymbols(obj));
  }

  return stringProperties;
}

function _getSizeOfObject(seen, object) {
  if (_lodash.default.isNil(object)) {
    return 0;
  }

  let bytes = 0;
  const properties = extractAllProperties(object);

  for (const key of properties) {
    if (typeof object[key] === 'object' && !_lodash.default.isNil(object[key])) {
      if (seen.has(object[key])) {
        continue;
      }

      seen.add(object[key]);
    }

    bytes += getCalculator(seen)(key);

    try {
      bytes += getCalculator(seen)(object[key]);
    } catch (ex) {
      if (ex instanceof RangeError) {
        bytes = 0;
      }
    }
  }

  return bytes;
}

function getCalculator(seen) {
  return function calculator(obj) {
    if (_lodash.default.isBuffer(obj)) {
      return obj.length;
    }

    switch (typeof obj) {
      case 'string':
        return obj.length * ECMA_SIZES.STRING;

      case 'boolean':
        return ECMA_SIZES.BOOLEAN;

      case 'number':
        return ECMA_SIZES.NUMBER;

      case 'symbol':
        return _lodash.default.isFunction(Symbol.keyFor) && Symbol.keyFor(obj) ? Symbol.keyFor(obj).length * ECMA_SIZES.STRING : (obj.toString().length - 8) * ECMA_SIZES.STRING;

      case 'object':
        return _lodash.default.isArray(obj) ? obj.map(getCalculator(seen)).reduce((acc, curr) => acc + curr, 0) : _getSizeOfObject(seen, obj);

      default:
        return 0;
    }
  };
}

function getObjectSize(obj) {
  return getCalculator(new WeakSet())(obj);
}

const OBJECTS_MAPPING = new WeakMap();

function getObjectId(object) {
  if (!OBJECTS_MAPPING.has(object)) {
    OBJECTS_MAPPING.set(object, (0, _uuid.v4)());
  }

  return OBJECTS_MAPPING.get(object);
}

function deepFreeze(object) {
  let propNames;

  try {
    propNames = Object.getOwnPropertyNames(object);
  } catch (ign) {
    return object;
  }

  for (const name of propNames) {
    const value = object[name];

    if (value && typeof value === 'object') {
      deepFreeze(value);
    }
  }

  return Object.freeze(object);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJFQ01BX1NJWkVTIiwiT2JqZWN0IiwiZnJlZXplIiwiU1RSSU5HIiwiQk9PTEVBTiIsIk5VTUJFUiIsImxpbmtHbG9iYWxQYWNrYWdlIiwicGFja2FnZU5hbWUiLCJsb2ciLCJkZWJ1ZyIsImNtZCIsInRpbWVvdXQiLCJlcnIiLCJtc2ciLCJtZXNzYWdlIiwic3RkZXJyIiwiRXJyb3IiLCJyZXF1aXJlUGFja2FnZSIsInJlcXVpcmUiLCJnbG9iYWxQYWNrYWdlTmFtZSIsInBhdGgiLCJyZXNvbHZlIiwicHJvY2VzcyIsImVudiIsIm5wbV9jb25maWdfcHJlZml4IiwiZXJyb3JBbmRUaHJvdyIsImV4dHJhY3RBbGxQcm9wZXJ0aWVzIiwib2JqIiwic3RyaW5nUHJvcGVydGllcyIsInByb3AiLCJwdXNoIiwiXyIsImlzRnVuY3Rpb24iLCJnZXRPd25Qcm9wZXJ0eVN5bWJvbHMiLCJfZ2V0U2l6ZU9mT2JqZWN0Iiwic2VlbiIsIm9iamVjdCIsImlzTmlsIiwiYnl0ZXMiLCJwcm9wZXJ0aWVzIiwia2V5IiwiaGFzIiwiYWRkIiwiZ2V0Q2FsY3VsYXRvciIsImV4IiwiUmFuZ2VFcnJvciIsImNhbGN1bGF0b3IiLCJpc0J1ZmZlciIsImxlbmd0aCIsIlN5bWJvbCIsImtleUZvciIsInRvU3RyaW5nIiwiaXNBcnJheSIsIm1hcCIsInJlZHVjZSIsImFjYyIsImN1cnIiLCJnZXRPYmplY3RTaXplIiwiV2Vha1NldCIsIk9CSkVDVFNfTUFQUElORyIsIldlYWtNYXAiLCJnZXRPYmplY3RJZCIsInNldCIsImdldCIsImRlZXBGcmVlemUiLCJwcm9wTmFtZXMiLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIiwiaWduIiwibmFtZSIsInZhbHVlIl0sInNvdXJjZXMiOlsiLi4vLi4vbGliL25vZGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaXNXaW5kb3dzIH0gZnJvbSAnLi9zeXN0ZW0nO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IHY0IGFzIHV1aWRWNCB9IGZyb20gJ3V1aWQnO1xuXG5jb25zdCBFQ01BX1NJWkVTID0gT2JqZWN0LmZyZWV6ZSh7XG4gIFNUUklORzogMixcbiAgQk9PTEVBTjogNCxcbiAgTlVNQkVSOiA4LFxufSk7XG5cbi8qKlxuICogSW50ZXJuYWwgdXRpbGl0eSB0byBsaW5rIGdsb2JhbCBwYWNrYWdlIHRvIGxvY2FsIGNvbnRleHRcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGFja2FnZU5hbWUgLSBuYW1lIG9mIHRoZSBwYWNrYWdlIHRvIGxpbmtcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgY29tbWFuZCBmYWlsc1xuICovXG5hc3luYyBmdW5jdGlvbiBsaW5rR2xvYmFsUGFja2FnZSAocGFja2FnZU5hbWUpIHtcbiAgdHJ5IHtcbiAgICBsb2cuZGVidWcoYExpbmtpbmcgcGFja2FnZSAnJHtwYWNrYWdlTmFtZX0nYCk7XG4gICAgY29uc3QgY21kID0gaXNXaW5kb3dzKCkgPyAnbnBtLmNtZCcgOiAnbnBtJztcbiAgICBhd2FpdCBleGVjKGNtZCwgWydsaW5rJywgcGFja2FnZU5hbWVdLCB7dGltZW91dDogMjAwMDB9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgY29uc3QgbXNnID0gYFVuYWJsZSB0byBsb2FkIHBhY2thZ2UgJyR7cGFja2FnZU5hbWV9JywgbGlua2luZyBmYWlsZWQ6ICR7ZXJyLm1lc3NhZ2V9YDtcbiAgICBsb2cuZGVidWcobXNnKTtcbiAgICBpZiAoZXJyLnN0ZGVycikge1xuICAgICAgLy8gbG9nIHRoZSBzdGRlcnIgaWYgdGhlcmUsIGJ1dCBkbyBub3QgYWRkIHRvIHRocm93biBlcnJvciBhcyBpdCBpc1xuICAgICAgLy8gX3ZlcnlfIHZlcmJvc2VcbiAgICAgIGxvZy5kZWJ1ZyhlcnIuc3RkZXJyKTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gIH1cbn1cblxuLyoqXG4gKiBVdGlsaXR5IGZ1bmN0aW9uIHRvIGV4dGVuZCBub2RlIGZ1bmN0aW9uYWxpdHksIGFsbG93aW5nIHVzIHRvIHJlcXVpcmVcbiAqIG1vZHVsZXMgdGhhdCBhcmUgaW5zdGFsbGVkIGdsb2JhbGx5LiBJZiB0aGUgcGFja2FnZSBjYW5ub3QgYmUgcmVxdWlyZWQsXG4gKiB0aGlzIHdpbGwgYXR0ZW1wdCB0byBsaW5rIHRoZSBwYWNrYWdlIGFuZCB0aGVuIHJlLXJlcXVpcmUgaXRcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGFja2FnZU5hbWUgLSB0aGUgbmFtZSBvZiB0aGUgcGFja2FnZSB0byBiZSByZXF1aXJlZFxuICogQHJldHVybnMge1Byb21pc2U8dW5rbm93bj59IC0gdGhlIHBhY2thZ2Ugb2JqZWN0XG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHBhY2thZ2UgaXMgbm90IGZvdW5kIGxvY2FsbHkgb3IgZ2xvYmFsbHlcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVxdWlyZVBhY2thZ2UgKHBhY2thZ2VOYW1lKSB7XG4gIC8vIGZpcnN0LCBnZXQgaXQgaW4gdGhlIG5vcm1hbCB3YXkgKHNlZSBodHRwczovL25vZGVqcy5vcmcvYXBpL21vZHVsZXMuaHRtbCNtb2R1bGVzX2FsbF90b2dldGhlcilcbiAgdHJ5IHtcbiAgICBsb2cuZGVidWcoYExvYWRpbmcgbG9jYWwgcGFja2FnZSAnJHtwYWNrYWdlTmFtZX0nYCk7XG4gICAgcmV0dXJuIHJlcXVpcmUocGFja2FnZU5hbWUpO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cuZGVidWcoYEZhaWxlZCB0byBsb2FkIGxvY2FsIHBhY2thZ2UgJyR7cGFja2FnZU5hbWV9JzogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxuXG4gIC8vIHNlY29uZCwgZ2V0IGl0IGZyb20gd2hlcmUgaXQgb3VnaHQgdG8gYmUgaW4gdGhlIGdsb2JhbCBub2RlX21vZHVsZXNcbiAgdHJ5IHtcbiAgICBjb25zdCBnbG9iYWxQYWNrYWdlTmFtZSA9IHBhdGgucmVzb2x2ZShwcm9jZXNzLmVudi5ucG1fY29uZmlnX3ByZWZpeCA/PyAnJywgJ2xpYicsICdub2RlX21vZHVsZXMnLCBwYWNrYWdlTmFtZSk7XG4gICAgbG9nLmRlYnVnKGBMb2FkaW5nIGdsb2JhbCBwYWNrYWdlICcke2dsb2JhbFBhY2thZ2VOYW1lfSdgKTtcbiAgICByZXR1cm4gcmVxdWlyZShnbG9iYWxQYWNrYWdlTmFtZSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5kZWJ1ZyhgRmFpbGVkIHRvIGxvYWQgZ2xvYmFsIHBhY2thZ2UgJyR7cGFja2FnZU5hbWV9JzogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxuXG4gIC8vIHRoaXJkLCBsaW5rIHRoZSBmaWxlIGFuZCBnZXQgbG9jYWxseVxuICB0cnkge1xuICAgIGF3YWl0IGxpbmtHbG9iYWxQYWNrYWdlKHBhY2thZ2VOYW1lKTtcbiAgICBsb2cuZGVidWcoYFJldHJ5aW5nIGxvYWQgb2YgbGlua2VkIHBhY2thZ2UgJyR7cGFja2FnZU5hbWV9J2ApO1xuICAgIHJldHVybiByZXF1aXJlKHBhY2thZ2VOYW1lKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYFVuYWJsZSB0byBsb2FkIHBhY2thZ2UgJyR7cGFja2FnZU5hbWV9JzogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBleHRyYWN0QWxsUHJvcGVydGllcyAob2JqKSB7XG4gIGNvbnN0IHN0cmluZ1Byb3BlcnRpZXMgPSBbXTtcbiAgZm9yIChjb25zdCBwcm9wIGluIG9iaikge1xuICAgIHN0cmluZ1Byb3BlcnRpZXMucHVzaChwcm9wKTtcbiAgfVxuICBpZiAoXy5pc0Z1bmN0aW9uKE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpKSB7XG4gICAgc3RyaW5nUHJvcGVydGllcy5wdXNoKC4uLihPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKG9iaikpKTtcbiAgfVxuICByZXR1cm4gc3RyaW5nUHJvcGVydGllcztcbn1cblxuZnVuY3Rpb24gX2dldFNpemVPZk9iamVjdCAoc2Vlbiwgb2JqZWN0KSB7XG4gIGlmIChfLmlzTmlsKG9iamVjdCkpIHtcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIGxldCBieXRlcyA9IDA7XG4gIGNvbnN0IHByb3BlcnRpZXMgPSBleHRyYWN0QWxsUHJvcGVydGllcyhvYmplY3QpO1xuICBmb3IgKGNvbnN0IGtleSBvZiBwcm9wZXJ0aWVzKSB7XG4gICAgLy8gRG8gbm90IHJlY2FsY3VsYXRlIGNpcmN1bGFyIHJlZmVyZW5jZXNcbiAgICBpZiAodHlwZW9mIG9iamVjdFtrZXldID09PSAnb2JqZWN0JyAmJiAhXy5pc05pbChvYmplY3Rba2V5XSkpIHtcbiAgICAgIGlmIChzZWVuLmhhcyhvYmplY3Rba2V5XSkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBzZWVuLmFkZChvYmplY3Rba2V5XSk7XG4gICAgfVxuXG4gICAgYnl0ZXMgKz0gZ2V0Q2FsY3VsYXRvcihzZWVuKShrZXkpO1xuICAgIHRyeSB7XG4gICAgICBieXRlcyArPSBnZXRDYWxjdWxhdG9yKHNlZW4pKG9iamVjdFtrZXldKTtcbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgaWYgKGV4IGluc3RhbmNlb2YgUmFuZ2VFcnJvcikge1xuICAgICAgICAvLyBjaXJjdWxhciByZWZlcmVuY2UgZGV0ZWN0ZWQsIGZpbmFsIHJlc3VsdCBtaWdodCBiZSBpbmNvcnJlY3RcbiAgICAgICAgLy8gbGV0J3MgYmUgbmljZSBhbmQgbm90IHRocm93IGFuIGV4Y2VwdGlvblxuICAgICAgICBieXRlcyA9IDA7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGJ5dGVzO1xufVxuXG5mdW5jdGlvbiBnZXRDYWxjdWxhdG9yIChzZWVuKSB7XG4gIHJldHVybiBmdW5jdGlvbiBjYWxjdWxhdG9yIChvYmopIHtcbiAgICBpZiAoXy5pc0J1ZmZlcihvYmopKSB7XG4gICAgICByZXR1cm4gb2JqLmxlbmd0aDtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHR5cGVvZiAob2JqKSkge1xuICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgcmV0dXJuIG9iai5sZW5ndGggKiBFQ01BX1NJWkVTLlNUUklORztcbiAgICAgIGNhc2UgJ2Jvb2xlYW4nOlxuICAgICAgICByZXR1cm4gRUNNQV9TSVpFUy5CT09MRUFOO1xuICAgICAgY2FzZSAnbnVtYmVyJzpcbiAgICAgICAgcmV0dXJuIEVDTUFfU0laRVMuTlVNQkVSO1xuICAgICAgY2FzZSAnc3ltYm9sJzpcbiAgICAgICAgcmV0dXJuIF8uaXNGdW5jdGlvbihTeW1ib2wua2V5Rm9yKSAmJiBTeW1ib2wua2V5Rm9yKG9iailcbiAgICAgICAgICA/IC8qKiBAdHlwZSB7c3RyaW5nfSAqLyhTeW1ib2wua2V5Rm9yKG9iaikpLmxlbmd0aCAqIEVDTUFfU0laRVMuU1RSSU5HXG4gICAgICAgICAgOiAob2JqLnRvU3RyaW5nKCkubGVuZ3RoIC0gOCkgKiBFQ01BX1NJWkVTLlNUUklORztcbiAgICAgIGNhc2UgJ29iamVjdCc6XG4gICAgICAgIHJldHVybiBfLmlzQXJyYXkob2JqKVxuICAgICAgICAgID8gb2JqLm1hcChnZXRDYWxjdWxhdG9yKHNlZW4pKS5yZWR1Y2UoKGFjYywgY3VycikgPT4gYWNjICsgY3VyciwgMClcbiAgICAgICAgICA6IF9nZXRTaXplT2ZPYmplY3Qoc2Vlbiwgb2JqKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgdGhlIGluLWRlcHRoIHNpemUgaW4gbWVtb3J5IG9mIHRoZSBwcm92aWRlZCBvYmplY3QuXG4gKiBUaGUgb3JpZ2luYWwgaW1wbGVtZW50YXRpb24gaXMgYm9ycm93ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vbWlrdGFtL3NpemVvZi5cbiAqXG4gKiBAcGFyYW0geyp9IG9iaiBBbiBvYmplY3Qgd2hvc2Ugc2l6ZSBzaG91bGQgYmUgY2FsY3VsYXRlZFxuICogQHJldHVybnMge251bWJlcn0gT2JqZWN0IHNpemUgaW4gYnl0ZXMuXG4gKi9cbmZ1bmN0aW9uIGdldE9iamVjdFNpemUgKG9iaikge1xuICByZXR1cm4gZ2V0Q2FsY3VsYXRvcihuZXcgV2Vha1NldCgpKShvYmopO1xufVxuXG5jb25zdCBPQkpFQ1RTX01BUFBJTkcgPSBuZXcgV2Vha01hcCgpO1xuXG4vKipcbiAqIENhbGN1bGF0ZXMgYSB1bmlxdWUgb2JqZWN0IGlkZW50aWZpZXJcbiAqXG4gKiBAcGFyYW0ge29iamVjdH0gb2JqZWN0IEFueSB2YWxpZCBFQ01BIG9iamVjdFxuICogQHJldHVybnMge3N0cmluZ30gQSB1dWlkVjQgc3RyaW5nIHRoYXQgdW5pcXVlbHkgaWRlbnRpZmllcyBnaXZlbiBvYmplY3RcbiAqL1xuZnVuY3Rpb24gZ2V0T2JqZWN0SWQgKG9iamVjdCkge1xuICBpZiAoIU9CSkVDVFNfTUFQUElORy5oYXMob2JqZWN0KSkge1xuICAgIE9CSkVDVFNfTUFQUElORy5zZXQob2JqZWN0LCB1dWlkVjQoKSk7XG4gIH1cbiAgcmV0dXJuIE9CSkVDVFNfTUFQUElORy5nZXQob2JqZWN0KTtcbn1cblxuLyoqXG4gKiBQZXJmb3JtIGRlZXAgZnJlZXplIG9mIHRoZSBnaXZlbiBvYmplY3QgKGUuIGcuXG4gKiBhbGwgbmVzdGVkIG9iamVjdHMgYWxzbyBiZWNvbWUgaW1tdXRhYmxlKS5cbiAqIElmIHRoZSBwYXNzZWQgb2JqZWN0IGlzIG9mIGEgcGxhaW4gdHlwZVxuICogdGhlbiBubyBjaGFuZ2UgaXMgZG9uZSBhbmQgdGhlIHNhbWUgb2JqZWN0XG4gKiBpcyByZXR1cm5lZC5cbiAqICEgVGhpcyBmdW5jdGlvbiBjaGFuZ2VzIHRoZSBnaXZlbiBvYmplY3QsXG4gKiBzbyBpdCBiZWNvbWVzIGltbXV0YWJsZS5cbiAqXG4gKiBAcGFyYW0geyp9IG9iamVjdCBBbnkgdmFsaWQgRUNNQSBvYmplY3RcbiAqIEByZXR1cm5zIHsqfSBUaGUgc2FtZSBvYmplY3QgdGhhdCB3YXMgcGFzc2VkIHRvIHRoZVxuICogZnVuY3Rpb24gYWZ0ZXIgaXQgd2FzIG1hZGUgaW1tdXRhYmxlLlxuICovXG5mdW5jdGlvbiBkZWVwRnJlZXplIChvYmplY3QpIHtcbiAgbGV0IHByb3BOYW1lcztcbiAgdHJ5IHtcbiAgICBwcm9wTmFtZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhvYmplY3QpO1xuICB9IGNhdGNoIChpZ24pIHtcbiAgICByZXR1cm4gb2JqZWN0O1xuICB9XG4gIGZvciAoY29uc3QgbmFtZSBvZiBwcm9wTmFtZXMpIHtcbiAgICBjb25zdCB2YWx1ZSA9IG9iamVjdFtuYW1lXTtcbiAgICBpZiAodmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgZGVlcEZyZWV6ZSh2YWx1ZSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBPYmplY3QuZnJlZXplKG9iamVjdCk7XG59XG5cbmV4cG9ydCB7IHJlcXVpcmVQYWNrYWdlLCBnZXRPYmplY3RTaXplLCBnZXRPYmplY3RJZCwgZGVlcEZyZWV6ZSB9O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLFVBQVUsR0FBR0MsTUFBTSxDQUFDQyxNQUFQLENBQWM7RUFDL0JDLE1BQU0sRUFBRSxDQUR1QjtFQUUvQkMsT0FBTyxFQUFFLENBRnNCO0VBRy9CQyxNQUFNLEVBQUU7QUFIdUIsQ0FBZCxDQUFuQjs7QUFZQSxlQUFlQyxpQkFBZixDQUFrQ0MsV0FBbEMsRUFBK0M7RUFDN0MsSUFBSTtJQUNGQyxnQkFBSUMsS0FBSixDQUFXLG9CQUFtQkYsV0FBWSxHQUExQzs7SUFDQSxNQUFNRyxHQUFHLEdBQUcsMkJBQWMsU0FBZCxHQUEwQixLQUF0QztJQUNBLE1BQU0sd0JBQUtBLEdBQUwsRUFBVSxDQUFDLE1BQUQsRUFBU0gsV0FBVCxDQUFWLEVBQWlDO01BQUNJLE9BQU8sRUFBRTtJQUFW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