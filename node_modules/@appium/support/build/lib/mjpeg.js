"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.MJpegStream = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _imageUtil = require("./image-util");

var _stream = require("stream");

var _node = require("./node");

var _axios = _interopRequireDefault(require("axios"));

let MJpegConsumer = null;

async function initMJpegConsumer() {
  if (!MJpegConsumer) {
    try {
      MJpegConsumer = await (0, _node.requirePackage)('mjpeg-consumer');
    } catch (ign) {}
  }

  if (!MJpegConsumer) {
    throw new Error('mjpeg-consumer module is required to use MJPEG-over-HTTP features. ' + 'Please install it first (npm i -g mjpeg-consumer) and restart Appium.');
  }
}

const MJPEG_SERVER_TIMEOUT_MS = 10000;

class MJpegStream extends _stream.Writable {
  updateCount = 0;

  constructor(mJpegUrl, errorHandler = _lodash.default.noop, options = {}) {
    super(options);
    this.errorHandler = errorHandler;
    this.url = mJpegUrl;
    this.clear();
  }

  get lastChunkBase64() {
    const lastChunk = this.lastChunk;
    return !_lodash.default.isEmpty(this.lastChunk) && _lodash.default.isBuffer(this.lastChunk) ? lastChunk.toString('base64') : null;
  }

  async lastChunkPNG() {
    const lastChunk = this.lastChunk;

    if (_lodash.default.isEmpty(lastChunk) || !_lodash.default.isBuffer(lastChunk)) {
      return null;
    }

    try {
      const jpg = await (0, _imageUtil.getJimpImage)(lastChunk);
      return await jpg.getBuffer(_imageUtil.MIME_PNG);
    } catch (e) {
      return null;
    }
  }

  async lastChunkPNGBase64() {
    const png = await this.lastChunkPNG();
    return png ? png.toString('base64') : null;
  }

  clear() {
    this.registerStartSuccess = null;
    this.registerStartFailure = null;
    this.responseStream = null;
    this.consumer = null;
    this.lastChunk = null;
    this.updateCount = 0;
  }

  async start(serverTimeout = MJPEG_SERVER_TIMEOUT_MS) {
    this.stop();
    await initMJpegConsumer();
    this.consumer = new MJpegConsumer();
    const startPromise = new _bluebird.default((res, rej) => {
      this.registerStartSuccess = res;
      this.registerStartFailure = rej;
    }).timeout(serverTimeout, `Waited ${serverTimeout}ms but the MJPEG server never sent any images`);
    const url = this.url;

    const onErr = err => {
      this.lastChunk = null;

      _logger.default.error(`Error getting MJpeg screenshot chunk: ${err.message}`);

      this.errorHandler(err);

      if (this.registerStartFailure) {
        this.registerStartFailure(err);
      }
    };

    const onClose = () => {
      _logger.default.debug(`The connection to MJPEG server at ${url} has been closed`);

      this.lastChunk = null;
    };

    try {
      this.responseStream = (await (0, _axios.default)({
        url,
        responseType: 'stream',
        timeout: serverTimeout
      })).data;
    } catch (e) {
      return onErr(e);
    }

    this.responseStream.once('close', onClose).on('error', onErr).pipe(this.consumer).pipe(this);
    await startPromise;
  }

  stop() {
    if (!this.consumer) {
      return;
    }

    this.responseStream.unpipe(this.consumer);
    this.consumer.unpipe(this);
    this.responseStream.destroy();
    this.clear();
  }

  write(data) {
    this.lastChunk = data;
    this.updateCount++;

    if (this.registerStartSuccess) {
      this.registerStartSuccess();
      this.registerStartSuccess = null;
    }

    return true;
  }

}

exports.MJpegStream = MJpegStream;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNSnBlZ0NvbnN1bWVyIiwiaW5pdE1KcGVnQ29uc3VtZXIiLCJpZ24iLCJFcnJvciIsIk1KUEVHX1NFUlZFUl9USU1FT1VUX01TIiwiTUpwZWdTdHJlYW0iLCJXcml0YWJsZSIsInVwZGF0ZUNvdW50IiwiY29uc3RydWN0b3IiLCJtSnBlZ1VybCIsImVycm9ySGFuZGxlciIsIl8iLCJub29wIiwib3B0aW9ucyIsInVybCIsImNsZWFyIiwibGFzdENodW5rQmFzZTY0IiwibGFzdENodW5rIiwiaXNFbXB0eSIsImlzQnVmZmVyIiwidG9TdHJpbmciLCJsYXN0Q2h1bmtQTkciLCJqcGciLCJnZXRCdWZmZXIiLCJNSU1FX1BORyIsImUiLCJsYXN0Q2h1bmtQTkdCYXNlNjQiLCJwbmciLCJyZWdpc3RlclN0YXJ0U3VjY2VzcyIsInJlZ2lzdGVyU3RhcnRGYWlsdXJlIiwicmVzcG9uc2VTdHJlYW0iLCJjb25zdW1lciIsInN0YXJ0Iiwic2VydmVyVGltZW91dCIsInN0b3AiLCJzdGFydFByb21pc2UiLCJCIiwicmVzIiwicmVqIiwidGltZW91dCIsIm9uRXJyIiwiZXJyIiwibG9nIiwiZXJyb3IiLCJtZXNzYWdlIiwib25DbG9zZSIsImRlYnVnIiwicmVzcG9uc2VUeXBlIiwiZGF0YSIsIm9uY2UiLCJvbiIsInBpcGUiLCJ1bnBpcGUiLCJkZXN0cm95Iiwid3JpdGUiXSwic291cmNlcyI6WyIuLi8uLi9saWIvbWpwZWcuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBsb2cgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgZ2V0SmltcEltYWdlLCBNSU1FX1BORyB9IGZyb20gJy4vaW1hZ2UtdXRpbCc7XG5pbXBvcnQgeyBXcml0YWJsZSB9IGZyb20gJ3N0cmVhbSc7XG5pbXBvcnQgeyByZXF1aXJlUGFja2FnZSB9IGZyb20gJy4vbm9kZSc7XG5pbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnO1xuXG4vLyBsYXp5IGxvYWQgdGhpcywgYXMgaXQgbWlnaHQgbm90IGJlIGF2YWlsYWJsZVxubGV0IE1KcGVnQ29uc3VtZXIgPSBudWxsO1xuXG4vKipcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBgbWpwZWctY29uc3VtZXJgIG1vZHVsZSBpcyBub3QgaW5zdGFsbGVkIG9yIGNhbm5vdCBiZSBsb2FkZWRcbiAqL1xuYXN5bmMgZnVuY3Rpb24gaW5pdE1KcGVnQ29uc3VtZXIgKCkge1xuICBpZiAoIU1KcGVnQ29uc3VtZXIpIHtcbiAgICB0cnkge1xuICAgICAgTUpwZWdDb25zdW1lciA9IGF3YWl0IHJlcXVpcmVQYWNrYWdlKCdtanBlZy1jb25zdW1lcicpO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgfVxuICBpZiAoIU1KcGVnQ29uc3VtZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ21qcGVnLWNvbnN1bWVyIG1vZHVsZSBpcyByZXF1aXJlZCB0byB1c2UgTUpQRUctb3Zlci1IVFRQIGZlYXR1cmVzLiAnICtcbiAgICAgICAgICAgICAgICAgICAgJ1BsZWFzZSBpbnN0YWxsIGl0IGZpcnN0IChucG0gaSAtZyBtanBlZy1jb25zdW1lcikgYW5kIHJlc3RhcnQgQXBwaXVtLicpO1xuICB9XG59XG5cbi8vIGFtb3VudCBvZiB0aW1lIHRvIHdhaXQgZm9yIHRoZSBmaXJzdCBpbWFnZSBpbiB0aGUgc3RyZWFtXG5jb25zdCBNSlBFR19TRVJWRVJfVElNRU9VVF9NUyA9IDEwMDAwO1xuXG4vKiogQ2xhc3Mgd2hpY2ggc3RvcmVzIHRoZSBsYXN0IGJpdCBvZiBkYXRhIHN0cmVhbWVkIGludG8gaXQgKi9cbmNsYXNzIE1KcGVnU3RyZWFtIGV4dGVuZHMgV3JpdGFibGUge1xuXG4gIC8qKlxuICAgKiBAdHlwZSB7bnVtYmVyfVxuICAgKi9cbiAgdXBkYXRlQ291bnQgPSAwO1xuXG4gIC8qKlxuICAgKiBDcmVhdGUgYW4gTUpwZWdTdHJlYW1cbiAgICogQHBhcmFtIHtzdHJpbmd9IG1KcGVnVXJsIC0gVVJMIG9mIE1KUEVHLW92ZXItSFRUUCBzdHJlYW1cbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gW2Vycm9ySGFuZGxlcj1ub29wXSAtIGFkZGl0aW9uYWwgZnVuY3Rpb24gdGhhdCB3aWxsIGJlXG4gICAqIGNhbGxlZCBpbiB0aGUgY2FzZSBvZiBhbnkgZXJyb3JzLlxuICAgKiBAcGFyYW0ge29iamVjdH0gW29wdGlvbnM9e31dIC0gT3B0aW9ucyB0byBwYXNzIHRvIHRoZSBXcml0YWJsZSBjb25zdHJ1Y3RvclxuICAgKi9cbiAgY29uc3RydWN0b3IgKG1KcGVnVXJsLCBlcnJvckhhbmRsZXIgPSBfLm5vb3AsIG9wdGlvbnMgPSB7fSkge1xuICAgIHN1cGVyKG9wdGlvbnMpO1xuXG4gICAgdGhpcy5lcnJvckhhbmRsZXIgPSBlcnJvckhhbmRsZXI7XG4gICAgdGhpcy51cmwgPSBtSnBlZ1VybDtcbiAgICB0aGlzLmNsZWFyKCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBiYXNlNjQtZW5jb2RlZCB2ZXJzaW9uIG9mIHRoZSBKUEVHXG4gICAqXG4gICAqIEByZXR1cm5zIHs/c3RyaW5nfSBiYXNlNjQtZW5jb2RlZCBKUEVHIGltYWdlIGRhdGFcbiAgICogb3IgYG51bGxgIGlmIG5vIGltYWdlIGNhbiBiZSBwYXJzZWRcbiAgICovXG4gIGdldCBsYXN0Q2h1bmtCYXNlNjQgKCkge1xuICAgIGNvbnN0IGxhc3RDaHVuayA9IC8qKiBAdHlwZSB7QnVmZmVyfSAqLyh0aGlzLmxhc3RDaHVuayk7XG4gICAgcmV0dXJuICFfLmlzRW1wdHkodGhpcy5sYXN0Q2h1bmspICYmIF8uaXNCdWZmZXIodGhpcy5sYXN0Q2h1bmspXG4gICAgICA/IGxhc3RDaHVuay50b1N0cmluZygnYmFzZTY0JylcbiAgICAgIDogbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIFBORyB2ZXJzaW9uIG9mIHRoZSBKUEVHIGJ1ZmZlclxuICAgKlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxCdWZmZXI/Pn0gUE5HIGltYWdlIGRhdGEgb3IgYG51bGxgIGlmIG5vIFBOR1xuICAgKiBpbWFnZSBjYW4gYmUgcGFyc2VkXG4gICAqL1xuICBhc3luYyBsYXN0Q2h1bmtQTkcgKCkge1xuICAgIGNvbnN0IGxhc3RDaHVuayA9IC8qKiBAdHlwZSB7QnVmZmVyfSAqLyh0aGlzLmxhc3RDaHVuayk7XG4gICAgaWYgKF8uaXNFbXB0eShsYXN0Q2h1bmspIHx8ICFfLmlzQnVmZmVyKGxhc3RDaHVuaykpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBqcGcgPSBhd2FpdCBnZXRKaW1wSW1hZ2UobGFzdENodW5rKTtcbiAgICAgIHJldHVybiBhd2FpdCBqcGcuZ2V0QnVmZmVyKE1JTUVfUE5HKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBiYXNlNjQtZW5jb2RlZCB2ZXJzaW9uIG9mIHRoZSBQTkdcbiAgICpcbiAgICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nPz59IGJhc2U2NC1lbmNvZGVkIFBORyBpbWFnZSBkYXRhXG4gICAqIG9yIGBudWxsYCBpZiBubyBpbWFnZSBjYW4gYmUgcGFyc2VkXG4gICAqL1xuICBhc3luYyBsYXN0Q2h1bmtQTkdCYXNlNjQgKCkge1xuICAgIGNvbnN0IHBuZyA9IGF3YWl0IHRoaXMubGFzdENodW5rUE5HKCk7XG4gICAgcmV0dXJuIHBuZyA/IHBuZy50b1N0cmluZygnYmFzZTY0JykgOiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IGludGVybmFsIHN0YXRlXG4gICAqL1xuICBjbGVhciAoKSB7XG4gICAgdGhpcy5yZWdpc3RlclN0YXJ0U3VjY2VzcyA9IG51bGw7XG4gICAgdGhpcy5yZWdpc3RlclN0YXJ0RmFpbHVyZSA9IG51bGw7XG4gICAgdGhpcy5yZXNwb25zZVN0cmVhbSA9IG51bGw7XG4gICAgdGhpcy5jb25zdW1lciA9IG51bGw7XG4gICAgdGhpcy5sYXN0Q2h1bmsgPSBudWxsO1xuICAgIHRoaXMudXBkYXRlQ291bnQgPSAwO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHJlYWRpbmcgdGhlIE1KcGVnIHN0cmVhbSBhbmQgc3RvcmluZyB0aGUgbGFzdCBpbWFnZVxuICAgKi9cbiAgYXN5bmMgc3RhcnQgKHNlcnZlclRpbWVvdXQgPSBNSlBFR19TRVJWRVJfVElNRU9VVF9NUykge1xuICAgIC8vIGVuc3VyZSB3ZSdyZSBub3Qgc3RhcnRlZCBhbHJlYWR5XG4gICAgdGhpcy5zdG9wKCk7XG5cbiAgICBhd2FpdCBpbml0TUpwZWdDb25zdW1lcigpO1xuXG4gICAgdGhpcy5jb25zdW1lciA9IG5ldyBNSnBlZ0NvbnN1bWVyKCk7XG5cbiAgICAvLyB1c2UgdGhlIGRlZmVycmVkIHBhdHRlcm4gc28gd2UgY2FuIHdhaXQgZm9yIHRoZSBzdGFydCBvZiB0aGUgc3RyZWFtXG4gICAgLy8gYmFzZWQgb24gd2hhdCBjb21lcyBpbiBmcm9tIGFuIGV4dGVybmFsIHBpcGVcbiAgICBjb25zdCBzdGFydFByb21pc2UgPSBuZXcgQigocmVzLCByZWopID0+IHtcbiAgICAgIHRoaXMucmVnaXN0ZXJTdGFydFN1Y2Nlc3MgPSByZXM7XG4gICAgICB0aGlzLnJlZ2lzdGVyU3RhcnRGYWlsdXJlID0gcmVqO1xuICAgIH0pXG4gICAgLy8gc3RhcnQgYSB0aW1lb3V0IHNvIHRoYXQgaWYgdGhlIHNlcnZlciBkb2VzIG5vdCByZXR1cm4gZGF0YSwgd2UgZG9uJ3RcbiAgICAvLyBibG9jayBmb3JldmVyLlxuICAgICAgLnRpbWVvdXQoc2VydmVyVGltZW91dCxcbiAgICAgICAgYFdhaXRlZCAke3NlcnZlclRpbWVvdXR9bXMgYnV0IHRoZSBNSlBFRyBzZXJ2ZXIgbmV2ZXIgc2VudCBhbnkgaW1hZ2VzYCk7XG5cbiAgICBjb25zdCB1cmwgPSB0aGlzLnVybDtcbiAgICBjb25zdCBvbkVyciA9IChlcnIpID0+IHtcbiAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBkb24ndCBnZXQgYW4gb3V0ZGF0ZWQgc2NyZWVuc2hvdCBpZiB0aGVyZSB3YXMgYW4gZXJyb3JcbiAgICAgIHRoaXMubGFzdENodW5rID0gbnVsbDtcblxuICAgICAgbG9nLmVycm9yKGBFcnJvciBnZXR0aW5nIE1KcGVnIHNjcmVlbnNob3QgY2h1bms6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICB0aGlzLmVycm9ySGFuZGxlcihlcnIpO1xuICAgICAgaWYgKHRoaXMucmVnaXN0ZXJTdGFydEZhaWx1cmUpIHtcbiAgICAgICAgdGhpcy5yZWdpc3RlclN0YXJ0RmFpbHVyZShlcnIpO1xuICAgICAgfVxuICAgIH07XG4gICAgY29uc3Qgb25DbG9zZSA9ICgpID0+IHtcbiAgICAgIGxvZy5kZWJ1ZyhgVGhlIGNvbm5lY3Rpb24gdG8gTUpQRUcgc2VydmVyIGF0ICR7dXJsfSBoYXMgYmVlbiBjbG9zZWRgKTtcbiAgICAgIHRoaXMubGFzdENodW5rID0gbnVsbDtcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIHRoaXMucmVzcG9uc2VTdHJlYW0gPSAoYXdhaXQgYXhpb3Moe1xuICAgICAgICB1cmwsXG4gICAgICAgIHJlc3BvbnNlVHlwZTogJ3N0cmVhbScsXG4gICAgICAgIHRpbWVvdXQ6IHNlcnZlclRpbWVvdXQsXG4gICAgICB9KSkuZGF0YTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gb25FcnIoZSk7XG4gICAgfVxuXG4gICAgdGhpcy5yZXNwb25zZVN0cmVhbVxuICAgICAgLm9uY2UoJ2Nsb3NlJywgb25DbG9zZSlcbiAgICAgIC5vbignZXJyb3InLCBvbkVycikgLy8gZW5zdXJlIHdlIGRvIHNvbWV0aGluZyB3aXRoIGVycm9yc1xuICAgICAgLnBpcGUodGhpcy5jb25zdW1lcikgLy8gYWxsb3cgY2h1bmtpbmcgYW5kIHRyYW5zZm9ybWluZyBvZiBqcGVnIGRhdGFcbiAgICAgIC5waXBlKHRoaXMpOyAvLyBzZW5kIHRoZSBhY3R1YWwganBlZ3MgdG8gb3Vyc2VsZlxuXG4gICAgYXdhaXQgc3RhcnRQcm9taXNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgcmVhZGluZyB0aGUgTUpwZWcgc3RyZWFtLiBFbnN1cmUgd2UgZGlzY29ubmVjdCBhbGwgdGhlIHBpcGVzIGFuZCBzdG9wXG4gICAqIHRoZSBIVFRQIHJlcXVlc3QgaXRzZWxmLiBUaGVuIHJlc2V0IHRoZSBzdGF0ZS5cbiAgICovXG4gIHN0b3AgKCkge1xuICAgIGlmICghdGhpcy5jb25zdW1lcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMucmVzcG9uc2VTdHJlYW0udW5waXBlKHRoaXMuY29uc3VtZXIpO1xuICAgIHRoaXMuY29uc3VtZXIudW5waXBlKHRoaXMpO1xuICAgIHRoaXMucmVzcG9uc2VTdHJlYW0uZGVzdHJveSgpO1xuICAgIHRoaXMuY2xlYXIoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPdmVycmlkZSB0aGUgV3JpdGFibGUgd3JpdGUoKSBtZXRob2QgaW4gb3JkZXIgdG8gc2F2ZSB0aGUgbGFzdCBpbWFnZSBhbmRcbiAgICogbG9nIHRoZSBudW1iZXIgb2YgaW1hZ2VzIHdlIGhhdmUgcmVjZWl2ZWRcbiAgICogQG92ZXJyaWRlXG4gICAqIEBwYXJhbSB7QnVmZmVyfSBkYXRhIC0gYmluYXJ5IGRhdGEgc3RyZWFtZWQgZnJvbSB0aGUgTUpwZWcgY29uc3VtZXJcbiAgICovXG4gIHdyaXRlIChkYXRhKSB7XG4gICAgdGhpcy5sYXN0Q2h1bmsgPSBkYXRhO1xuICAgIHRoaXMudXBkYXRlQ291bnQrKztcblxuICAgIGlmICh0aGlzLnJlZ2lzdGVyU3RhcnRTdWNjZXNzKSB7XG4gICAgICB0aGlzLnJlZ2lzdGVyU3RhcnRTdWNjZXNzKCk7XG4gICAgICB0aGlzLnJlZ2lzdGVyU3RhcnRTdWNjZXNzID0gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG5leHBvcnQgeyBNSnBlZ1N0cmVhbSB9O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFB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