"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

require("source-map-support/register");

var _support = require("@appium/support");

var _sinon = _interopRequireDefault(require("sinon"));

var _deviceSettings = require("../../../lib/basedriver/device-settings");

var _errors = require("../../../lib/protocol/errors");

const {
  expect
} = chai;
describe('DeviceSettings', function () {
  let sandbox;
  beforeEach(function () {
    sandbox = _sinon.default.createSandbox();
  });
  afterEach(function () {
    sandbox.restore();
  });
  describe('constructor', function () {
    describe('when no parameteres are provided to the constructor', function () {
      it('should not throw', function () {
        expect(() => new _deviceSettings.DeviceSettings()).not.to.throw();
      });
    });
  });
  describe('instance method', function () {
    describe('getSettings()', function () {
      it('should return a clone of the internal settings object', function () {
        const settings = {
          foo: 'bar',
          bar: 'foo'
        };
        const deviceSettings = new _deviceSettings.DeviceSettings(settings);
        expect(deviceSettings.getSettings()).to.eql(settings);
      });
    });
    describe('update()', function () {
      describe('when no parameters are provided', function () {
        it('should reject with an InvalidArgumentError', async function () {
          const deviceSettings = new _deviceSettings.DeviceSettings();
          await expect(deviceSettings.update()).to.be.rejectedWith(_errors.InvalidArgumentError, /with valid JSON/i);
        });
      });
      describe('when a non-plain-object `newSettings` param is provided', function () {
        it('should reject with an InvalidArgumentError', async function () {
          const deviceSettings = new _deviceSettings.DeviceSettings();
          await expect(deviceSettings.update(null)).to.be.rejectedWith(_errors.InvalidArgumentError, /with valid JSON/i);
        });
      });
      describe('when the size of the `newSettings` param exceeds `MAX_SETTINGS_SIZE`', function () {
        beforeEach(function () {
          sandbox.stub(_support.node, 'getObjectSize').returns(_deviceSettings.MAX_SETTINGS_SIZE + 1);
        });
        it('should reject with an InvalidArgumentError', async function () {
          const deviceSettings = new _deviceSettings.DeviceSettings();
          await expect(deviceSettings.update({
            stuff: 'things'
          })).to.be.rejectedWith(_errors.InvalidArgumentError, /object size exceeds/i);
        });
      });
      describe('when the `newSettings` param is valid', function () {
        let onSettingsUpdate;
        beforeEach(function () {
          onSettingsUpdate = sandbox.stub();
        });
        describe('when the new settings do not differ', function () {
          it('should not call the `_onSettingsUpdate` listener', async function () {
            const deviceSettings = new _deviceSettings.DeviceSettings({
              stuff: 'things'
            }, onSettingsUpdate);
            await deviceSettings.update({
              stuff: 'things'
            });
            expect(onSettingsUpdate).not.to.have.been.called;
          });
        });
        describe('when the new settings differ', function () {
          it('should call the `_onSettingsUpdate` listener', async function () {
            const deviceSettings = new _deviceSettings.DeviceSettings({}, onSettingsUpdate);
            await deviceSettings.update({
              stuff: 'things'
            });
            expect(onSettingsUpdate).to.have.been.calledOnceWithExactly('stuff', 'things', undefined);
          });
        });
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJleHBlY3QiLCJjaGFpIiwiZGVzY3JpYmUiLCJzYW5kYm94IiwiYmVmb3JlRWFjaCIsInNpbm9uIiwiY3JlYXRlU2FuZGJveCIsImFmdGVyRWFjaCIsInJlc3RvcmUiLCJpdCIsIkRldmljZVNldHRpbmdzIiwibm90IiwidG8iLCJ0aHJvdyIsInNldHRpbmdzIiwiZm9vIiwiYmFyIiwiZGV2aWNlU2V0dGluZ3MiLCJnZXRTZXR0aW5ncyIsImVxbCIsInVwZGF0ZSIsImJlIiwicmVqZWN0ZWRXaXRoIiwiSW52YWxpZEFyZ3VtZW50RXJyb3IiLCJzdHViIiwibm9kZSIsInJldHVybnMiLCJNQVhfU0VUVElOR1NfU0laRSIsInN0dWZmIiwib25TZXR0aW5nc1VwZGF0ZSIsImhhdmUiLCJiZWVuIiwiY2FsbGVkIiwiY2FsbGVkT25jZVdpdGhFeGFjdGx5IiwidW5kZWZpbmVkIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdGVzdC91bml0L2Jhc2Vkcml2ZXIvZGV2aWNlLXNldHRpbmdzLnNwZWMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbm9kZSB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgc2lub24gZnJvbSAnc2lub24nO1xuaW1wb3J0IHsgRGV2aWNlU2V0dGluZ3MsIE1BWF9TRVRUSU5HU19TSVpFIH0gZnJvbSAnLi4vLi4vLi4vbGliL2Jhc2Vkcml2ZXIvZGV2aWNlLXNldHRpbmdzJztcbmltcG9ydCB7IEludmFsaWRBcmd1bWVudEVycm9yIH0gZnJvbSAnLi4vLi4vLi4vbGliL3Byb3RvY29sL2Vycm9ycyc7XG5cbmNvbnN0IHtleHBlY3R9ID0gY2hhaTtcblxuZGVzY3JpYmUoJ0RldmljZVNldHRpbmdzJywgZnVuY3Rpb24gKCkge1xuICBsZXQgc2FuZGJveDtcblxuICBiZWZvcmVFYWNoKGZ1bmN0aW9uICgpIHtcbiAgICBzYW5kYm94ID0gc2lub24uY3JlYXRlU2FuZGJveCgpO1xuICB9KTtcblxuICBhZnRlckVhY2goZnVuY3Rpb24gKCkge1xuICAgIHNhbmRib3gucmVzdG9yZSgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29uc3RydWN0b3InLCBmdW5jdGlvbiAoKSB7XG4gICAgZGVzY3JpYmUoJ3doZW4gbm8gcGFyYW1ldGVyZXMgYXJlIHByb3ZpZGVkIHRvIHRoZSBjb25zdHJ1Y3RvcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGl0KCdzaG91bGQgbm90IHRocm93JywgZnVuY3Rpb24gKCkge1xuICAgICAgICBleHBlY3QoKCkgPT4gbmV3IERldmljZVNldHRpbmdzKCkpLm5vdC50by50aHJvdygpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdpbnN0YW5jZSBtZXRob2QnLCBmdW5jdGlvbiAoKSB7XG4gICAgZGVzY3JpYmUoJ2dldFNldHRpbmdzKCknLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpdCgnc2hvdWxkIHJldHVybiBhIGNsb25lIG9mIHRoZSBpbnRlcm5hbCBzZXR0aW5ncyBvYmplY3QnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IHNldHRpbmdzID0ge1xuICAgICAgICAgIGZvbzogJ2JhcicsXG4gICAgICAgICAgYmFyOiAnZm9vJyxcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZGV2aWNlU2V0dGluZ3MgPSBuZXcgRGV2aWNlU2V0dGluZ3Moc2V0dGluZ3MpO1xuICAgICAgICBleHBlY3QoZGV2aWNlU2V0dGluZ3MuZ2V0U2V0dGluZ3MoKSkudG8uZXFsKHNldHRpbmdzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3VwZGF0ZSgpJywgZnVuY3Rpb24gKCkge1xuICAgICAgZGVzY3JpYmUoJ3doZW4gbm8gcGFyYW1ldGVycyBhcmUgcHJvdmlkZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGl0KCdzaG91bGQgcmVqZWN0IHdpdGggYW4gSW52YWxpZEFyZ3VtZW50RXJyb3InLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY29uc3QgZGV2aWNlU2V0dGluZ3MgPSBuZXcgRGV2aWNlU2V0dGluZ3MoKTtcbiAgICAgICAgICBhd2FpdCBleHBlY3QoZGV2aWNlU2V0dGluZ3MudXBkYXRlKCkpLnRvLmJlLnJlamVjdGVkV2l0aChcbiAgICAgICAgICAgIEludmFsaWRBcmd1bWVudEVycm9yLCAvd2l0aCB2YWxpZCBKU09OL2lcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgnd2hlbiBhIG5vbi1wbGFpbi1vYmplY3QgYG5ld1NldHRpbmdzYCBwYXJhbSBpcyBwcm92aWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaXQoJ3Nob3VsZCByZWplY3Qgd2l0aCBhbiBJbnZhbGlkQXJndW1lbnRFcnJvcicsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjb25zdCBkZXZpY2VTZXR0aW5ncyA9IG5ldyBEZXZpY2VTZXR0aW5ncygpO1xuICAgICAgICAgIGF3YWl0IGV4cGVjdChkZXZpY2VTZXR0aW5ncy51cGRhdGUobnVsbCkpLnRvLmJlLnJlamVjdGVkV2l0aChcbiAgICAgICAgICAgIEludmFsaWRBcmd1bWVudEVycm9yLCAvd2l0aCB2YWxpZCBKU09OL2lcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuXG4gICAgICBkZXNjcmliZSgnd2hlbiB0aGUgc2l6ZSBvZiB0aGUgYG5ld1NldHRpbmdzYCBwYXJhbSBleGNlZWRzIGBNQVhfU0VUVElOR1NfU0laRWAnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgIC8vIHRoaXMgaXMgZWFzaWVyIHRoYW4gc2VuZGluZyBhIDIxTUIgb2JqZWN0XG4gICAgICAgICAgc2FuZGJveC5zdHViKG5vZGUsICdnZXRPYmplY3RTaXplJykucmV0dXJucyhNQVhfU0VUVElOR1NfU0laRSArIDEpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnc2hvdWxkIHJlamVjdCB3aXRoIGFuIEludmFsaWRBcmd1bWVudEVycm9yJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNvbnN0IGRldmljZVNldHRpbmdzID0gbmV3IERldmljZVNldHRpbmdzKCk7XG4gICAgICAgICAgYXdhaXQgZXhwZWN0KGRldmljZVNldHRpbmdzLnVwZGF0ZSh7c3R1ZmY6ICd0aGluZ3MnfSkpLnRvLmJlLnJlamVjdGVkV2l0aChcbiAgICAgICAgICAgIEludmFsaWRBcmd1bWVudEVycm9yLCAvb2JqZWN0IHNpemUgZXhjZWVkcy9pXG4gICAgICAgICAgKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgZGVzY3JpYmUoJ3doZW4gdGhlIGBuZXdTZXR0aW5nc2AgcGFyYW0gaXMgdmFsaWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBvblNldHRpbmdzVXBkYXRlO1xuXG4gICAgICAgIGJlZm9yZUVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgIG9uU2V0dGluZ3NVcGRhdGUgPSBzYW5kYm94LnN0dWIoKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZGVzY3JpYmUoJ3doZW4gdGhlIG5ldyBzZXR0aW5ncyBkbyBub3QgZGlmZmVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGl0KCdzaG91bGQgbm90IGNhbGwgdGhlIGBfb25TZXR0aW5nc1VwZGF0ZWAgbGlzdGVuZXInLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCBkZXZpY2VTZXR0aW5ncyA9IG5ldyBEZXZpY2VTZXR0aW5ncyh7c3R1ZmY6ICd0aGluZ3MnfSwgb25TZXR0aW5nc1VwZGF0ZSk7XG4gICAgICAgICAgICBhd2FpdCBkZXZpY2VTZXR0aW5ncy51cGRhdGUoe3N0dWZmOiAndGhpbmdzJ30pO1xuICAgICAgICAgICAgZXhwZWN0KG9uU2V0dGluZ3NVcGRhdGUpLm5vdC50by5oYXZlLmJlZW4uY2FsbGVkO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICBkZXNjcmliZSgnd2hlbiB0aGUgbmV3IHNldHRpbmdzIGRpZmZlcicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpdCgnc2hvdWxkIGNhbGwgdGhlIGBfb25TZXR0aW5nc1VwZGF0ZWAgbGlzdGVuZXInLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCBkZXZpY2VTZXR0aW5ncyA9IG5ldyBEZXZpY2VTZXR0aW5ncyh7fSwgb25TZXR0aW5nc1VwZGF0ZSk7XG4gICAgICAgICAgICBhd2FpdCBkZXZpY2VTZXR0aW5ncy51cGRhdGUoe3N0dWZmOiAndGhpbmdzJ30pO1xuICAgICAgICAgICAgZXhwZWN0KG9uU2V0dGluZ3NVcGRhdGUpLnRvLmhhdmUuYmVlbi5jYWxsZWRPbmNlV2l0aEV4YWN0bHkoJ3N0dWZmJywgJ3RoaW5ncycsIHVuZGVmaW5lZCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU07RUFBQ0E7QUFBRCxJQUFXQyxJQUFqQjtBQUVBQyxRQUFRLENBQUMsZ0JBQUQsRUFBbUIsWUFBWTtFQUNyQyxJQUFJQyxPQUFKO0VBRUFDLFVBQVUsQ0FBQyxZQUFZO0lBQ3JCRCxPQUFPLEdBQUdFLGVBQU1DLGFBQU4sRUFBVjtFQUNELENBRlMsQ0FBVjtFQUlBQyxTQUFTLENBQUMsWUFBWTtJQUNwQkosT0FBTyxDQUFDSyxPQUFSO0VBQ0QsQ0FGUSxDQUFUO0VBSUFOLFFBQVEsQ0FBQyxhQUFELEVBQWdCLFlBQVk7SUFDbENBLFFBQVEsQ0FBQyxxREFBRCxFQUF3RCxZQUFZO01BQzFFTyxFQUFFLENBQUMsa0JBQUQsRUFBcUIsWUFBWTtRQUNqQ1QsTUFBTSxDQUFDLE1BQU0sSUFBSVUsOEJBQUosRUFBUCxDQUFOLENBQW1DQyxHQUFuQyxDQUF1Q0MsRUFBdkMsQ0FBMENDLEtBQTFDO01B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