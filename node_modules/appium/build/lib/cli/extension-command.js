"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.ExtensionCommand = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _support = require("@appium/support");

var _utils = require("./utils");

var _teen_process = require("teen_process");

var _extensionConfig = require("../extension/extension-config");

var _packageChanged = require("../extension/package-changed");

const UPDATE_ALL = 'installed';

class NotUpdatableError extends Error {}

class NoUpdatesAvailableError extends Error {}

class ExtensionCommand {
  config;
  knownExtensions;
  isJsonOutput;

  constructor({
    config,
    json
  }) {
    this.config = config;
    this.isJsonOutput = json;
  }

  get type() {
    return this.config.extensionType;
  }

  async execute(args) {
    const cmd = args[`${this.type}Command`];

    if (!_lodash.default.isFunction(this[cmd])) {
      throw new Error(`Cannot handle ${this.type} command ${cmd}`);
    }

    const executeCmd = this[cmd].bind(this);
    return await executeCmd(args);
  }

  async list({
    showInstalled,
    showUpdates
  }) {
    const lsMsg = `Listing ${showInstalled ? 'installed' : 'available'} ${this.type}s`;
    const installedNames = Object.keys(this.config.installedExtensions);
    const knownNames = Object.keys(this.knownExtensions);
    const exts = [...installedNames, ...knownNames].reduce((acc, name) => {
      if (!acc[name]) {
        if (installedNames.includes(name)) {
          acc[name] = { ...this.config.installedExtensions[name],
            installed: true
          };
        } else if (!showInstalled) {
          acc[name] = {
            pkgName: this.knownExtensions[name],
            installed: false
          };
        }
      }

      return acc;
    }, {});
    await (0, _utils.spinWith)(this.isJsonOutput, lsMsg, async () => {
      if (!showUpdates) {
        return;
      }

      for (const [ext, data] of _lodash.default.toPairs(exts)) {
        if (!data.installed || data.installType !== _extensionConfig.INSTALL_TYPE_NPM) {
          continue;
        }

        const updates = await this.checkForExtensionUpdate(ext);
        data.updateVersion = updates.safeUpdate;
        data.unsafeUpdateVersion = updates.unsafeUpdate;
        data.upToDate = updates.safeUpdate === null && updates.unsafeUpdate === null;
      }
    });
    const listData = exts;

    if (this.isJsonOutput) {
      return listData;
    }

    for (const [name, data] of _lodash.default.toPairs(listData)) {
      let installTxt = ' [not installed]'.grey;
      let updateTxt = '';
      let upToDateTxt = '';
      let unsafeUpdateTxt = '';

      if (data.installed) {
        const {
          installType,
          installSpec,
          updateVersion,
          unsafeUpdateVersion,
          version,
          upToDate
        } = data;
        let typeTxt;

        switch (installType) {
          case _extensionConfig.INSTALL_TYPE_GIT:
          case _extensionConfig.INSTALL_TYPE_GITHUB:
            typeTxt = `(cloned from ${installSpec})`.yellow;
            break;

          case _extensionConfig.INSTALL_TYPE_LOCAL:
            typeTxt = `(linked from ${installSpec})`.magenta;
            break;

          default:
            typeTxt = '(NPM)';
        }

        installTxt = `@${version.yellow} ${('[installed ' + typeTxt + ']').green}`;

        if (showUpdates) {
          if (updateVersion) {
            updateTxt = ` [${updateVersion} available]`.magenta;
          }

          if (upToDate) {
            upToDateTxt = ` [Up to date]`.green;
          }

          if (unsafeUpdateVersion) {
            unsafeUpdateTxt = ` [${unsafeUpdateVersion} available (potentially unsafe)]`.cyan;
          }
        }
      }

      console.log(`- ${name.yellow}${installTxt}${updateTxt}${upToDateTxt}${unsafeUpdateTxt}`);
    }

    return listData;
  }

  async _install({
    installSpec,
    installType,
    packageName
  }) {
    let extData;

    if (packageName && [_extensionConfig.INSTALL_TYPE_LOCAL, _extensionConfig.INSTALL_TYPE_NPM].includes(installType)) {
      throw new Error(`When using --source=${installType}, cannot also use --package`);
    }

    if (!packageName && [_extensionConfig.INSTALL_TYPE_GIT, _extensionConfig.INSTALL_TYPE_GITHUB].includes(installType)) {
      throw new Error(`When using --source=${installType}, must also use --package`);
    }

    if (installType === _extensionConfig.INSTALL_TYPE_GITHUB) {
      if (installSpec.split('/').length !== 2) {
        throw new Error(`Github ${this.type} spec ${installSpec} appeared to be invalid; ` + 'it should be of the form <org>/<repo>');
      }

      extData = await this.installViaNpm({
        installSpec,
        pkgName: packageName
      });
    } else if (installType === _extensionConfig.INSTALL_TYPE_GIT) {
      installSpec = installSpec.replace(/\.git$/, '');
      extData = await this.installViaNpm({
        installSpec,
        pkgName: packageName
      });
    } else {
      let pkgName, pkgVer;

      if (installType === _extensionConfig.INSTALL_TYPE_LOCAL) {
        pkgName = _path.default.isAbsolute(installSpec) ? installSpec : _path.default.resolve(installSpec);
      } else {
        let name;
        const splits = installSpec.split('@');

        if (installSpec[0] === '@') {
          [name, pkgVer] = [`@${splits[1]}`, splits[2]];
        } else {
          [name, pkgVer] = splits;
        }

        if (installType === _extensionConfig.INSTALL_TYPE_NPM) {
          pkgName = name;
        } else {
          const knownNames = Object.keys(this.knownExtensions);

          if (!_lodash.default.includes(knownNames, name)) {
            const msg = `Could not resolve ${this.type}; are you sure it's in the list ` + `of supported ${this.type}s? ${JSON.stringify(knownNames)}`;
            throw new Error(msg);
          }

          pkgName = this.knownExtensions[name];
          installType = _extensionConfig.INSTALL_TYPE_NPM;
        }
      }

      extData = await this.installViaNpm({
        installSpec,
        pkgName,
        pkgVer
      });
    }

    const extName = extData[`${this.type}Name`];
    delete extData[`${this.type}Name`];

    if (this.config.isInstalled(extName)) {
      throw new Error(`A ${this.type} named '${extName}' is already installed. ` + `Did you mean to update? 'appium ${this.type} update'. See ` + `installed ${this.type}s with 'appium ${this.type} list --installed'.`);
    }

    const extManifest = { ...extData,
      installType,
      installSpec
    };
    await this.config.addExtension(extName, extManifest);

    if (await _support.env.hasAppiumDependency(this.config.appiumHome)) {
      await (0, _packageChanged.packageDidChange)(this.config.appiumHome);
    }

    (0, _utils.log)(this.isJsonOutput, this.getPostInstallText({
      extName,
      extData
    }));
    return this.config.installedExtensions;
  }

  async installViaNpm({
    installSpec,
    pkgName,
    pkgVer
  }) {
    const npmSpec = `${pkgName}${pkgVer ? '@' + pkgVer : ''}`;
    const specMsg = npmSpec === installSpec ? '' : ` using NPM install spec '${npmSpec}'`;
    const msg = `Installing '${installSpec}'${specMsg}`;

    try {
      const pkgJsonData = await (0, _utils.spinWith)(this.isJsonOutput, msg, async () => await _support.npm.installPackage(this.config.appiumHome, pkgName, {
        pkgVer
      }));
      return this.getExtensionFields(pkgJsonData, installSpec);
    } catch (err) {
      throw new Error(`Encountered an error when installing package: ${err.message}`);
    }
  }

  getPostInstallText(args) {
    throw new Error('Must be implemented in final class');
  }

  getExtensionFields(pkgJsonData, installSpec) {
    if (!pkgJsonData.appium) {
      throw new Error(`Installed driver did not have an 'appium' section in its ` + `package.json file as expected`);
    }

    const {
      appium,
      name,
      version
    } = pkgJsonData;
    this.validateExtensionFields(appium, installSpec);
    const result = { ...appium,
      pkgName: name,
      version
    };
    return result;
  }

  validateExtensionFields(extMetadata, installSpec) {
    throw new Error('Must be implemented in final class');
  }

  async _uninstall({
    installSpec
  }) {
    if (!this.config.isInstalled(installSpec)) {
      throw new Error(`Can't uninstall ${this.type} '${installSpec}'; it is not installed`);
    }

    const installPath = this.config.getInstallPath(installSpec);

    try {
      await _support.fs.rimraf(installPath);
    } finally {
      await this.config.removeExtension(installSpec);
    }

    (0, _utils.log)(this.isJsonOutput, `Successfully uninstalled ${this.type} '${installSpec}'`.green);
    return this.config.installedExtensions;
  }

  async _update({
    installSpec,
    unsafe
  }) {
    const shouldUpdateAll = installSpec === UPDATE_ALL;

    if (!shouldUpdateAll && !this.config.isInstalled(installSpec)) {
      throw new Error(`The ${this.type} '${installSpec}' was not installed, so can't be updated`);
    }

    const extsToUpdate = shouldUpdateAll ? Object.keys(this.config.installedExtensions) : [installSpec];
    const errors = {};
    const updates = {};

    for (const e of extsToUpdate) {
      try {
        await (0, _utils.spinWith)(this.isJsonOutput, `Checking if ${this.type} '${e}' is updatable`, () => {
          if (this.config.installedExtensions[e].installType !== _extensionConfig.INSTALL_TYPE_NPM) {
            throw new NotUpdatableError();
          }
        });
        const update = await (0, _utils.spinWith)(this.isJsonOutput, `Checking if ${this.type} '${e}' needs an update`, async () => {
          const update = await this.checkForExtensionUpdate(e);

          if (!(update.safeUpdate || update.unsafeUpdate)) {
            throw new NoUpdatesAvailableError();
          }

          return update;
        });

        if (!unsafe && !update.safeUpdate) {
          throw new Error(`The ${this.type} '${e}' has a major revision update ` + `(${update.current} => ${update.unsafeUpdate}), which could include ` + `breaking changes. If you want to apply this update, re-run with --unsafe`);
        }

        const updateVer = unsafe && update.unsafeUpdate ? update.unsafeUpdate : update.safeUpdate;
        await (0, _utils.spinWith)(this.isJsonOutput, `Updating driver '${e}' from ${update.current} to ${updateVer}`, async () => await this.updateExtension(e, updateVer));
        updates[e] = {
          from: update.current,
          to: updateVer
        };
      } catch (err) {
        errors[e] = err;
      }
    }

    (0, _utils.log)(this.isJsonOutput, 'Update report:');

    for (const [e, update] of _lodash.default.toPairs(updates)) {
      (0, _utils.log)(this.isJsonOutput, `- ${this.type} ${e} updated: ${update.from} => ${update.to}`.green);
    }

    for (const [e, err] of _lodash.default.toPairs(errors)) {
      if (err instanceof NotUpdatableError) {
        (0, _utils.log)(this.isJsonOutput, `- '${e}' was not installed via npm, so we could not check ` + `for updates`.yellow);
      } else if (err instanceof NoUpdatesAvailableError) {
        (0, _utils.log)(this.isJsonOutput, `- '${e}' had no updates available`.yellow);
      } else {
        (0, _utils.log)(this.isJsonOutput, `- '${e}' failed to update: ${err}`.red);
      }
    }

    return {
      updates,
      errors
    };
  }

  async checkForExtensionUpdate(ext) {
    const {
      version,
      pkgName
    } = this.config.installedExtensions[ext];
    let unsafeUpdate = await _support.npm.getLatestVersion(this.config.appiumHome, pkgName);
    let safeUpdate = await _support.npm.getLatestSafeUpgradeVersion(this.config.appiumHome, pkgName, version);

    if (!_support.util.compareVersions(unsafeUpdate, '>', version)) {
      unsafeUpdate = null;
      safeUpdate = null;
    }

    if (unsafeUpdate && unsafeUpdate === safeUpdate) {
      unsafeUpdate = null;
    }

    if (safeUpdate && !_support.util.compareVersions(safeUpdate, '>', version)) {
      safeUpdate = null;
    }

    return {
      current: version,
      safeUpdate,
      unsafeUpdate
    };
  }

  async updateExtension(installSpec, version) {
    const {
      pkgName
    } = this.config.installedExtensions[installSpec];
    await _support.fs.rimraf(this.config.getInstallPath(installSpec));
    const extData = await this.installViaNpm({
      installSpec,
      pkgName,
      pkgVer: version
    });
    delete extData[`${this.type}Name`];
    await this.config.updateExtension(installSpec, extData);
  }

  async _run({
    installSpec,
    scriptName
  }) {
    if (!_lodash.default.has(this.config.installedExtensions, installSpec)) {
      throw new Error(`please install the ${this.type} first`);
    }

    const extConfig = this.config.installedExtensions[installSpec];

    if (!extConfig.scripts) {
      throw new Error(`The ${this.type} named '${installSpec}' does not contain the ` + `"scripts" field underneath the "appium" field in its package.json`);
    }

    const extScripts = extConfig.scripts;

    if (!_lodash.default.isPlainObject(extScripts)) {
      throw new Error(`The ${this.type} named '${installSpec}' "scripts" field must be a plain object`);
    }

    if (!_lodash.default.has(extScripts, scriptName)) {
      throw new Error(`The ${this.type} named '${installSpec}' does not support the script: '${scriptName}'`);
    }

    const runner = new _teen_process.SubProcess(process.execPath, [extScripts[scriptName]], {
      cwd: this.config.getInstallPath(installSpec)
    });
    const output = new _utils.RingBuffer(50);
    runner.on('stream-line', line => {
      output.enqueue(line);
      (0, _utils.log)(this.isJsonOutput, line);
    });
    await runner.start(0);

    try {
      await runner.join();
      (0, _utils.log)(this.isJsonOutput, `${scriptName} successfully ran`.green);
      return {
        output: output.getBuff()
      };
    } catch (err) {
      (0, _utils.log)(this.isJsonOutput, `Encountered an error when running '${scriptName}': ${err.message}`.red);
      return {
        error: err.message,
        output: output.getBuff()
      };
    }
  }

}

exports.ExtensionCommand = ExtensionCommand;
var _default = ExtensionCommand;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVUERBVEVfQUxMIiwiTm90VXBkYXRhYmxlRXJyb3IiLCJFcnJvciIsIk5vVXBkYXRlc0F2YWlsYWJsZUVycm9yIiwiRXh0ZW5zaW9uQ29tbWFuZCIsImNvbmZpZyIsImtub3duRXh0ZW5zaW9ucyIsImlzSnNvbk91dHB1dCIsImNvbnN0cnVjdG9yIiwianNvbiIsInR5cGUiLCJleHRlbnNpb25UeXBlIiwiZXhlY3V0ZSIsImFyZ3MiLCJjbWQiLCJfIiwiaXNGdW5jdGlvbiIsImV4ZWN1dGVDbWQiLCJiaW5kIiwibGlzdCIsInNob3dJbnN0YWxsZWQiLCJzaG93VXBkYXRlcyIsImxzTXNnIiwiaW5zdGFsbGVkTmFtZXMiLCJPYmplY3QiLCJrZXlzIiwiaW5zdGFsbGVkRXh0ZW5zaW9ucyIsImtub3duTmFtZXMiLCJleHRzIiwicmVkdWNlIiwiYWNjIiwibmFtZSIsImluY2x1ZGVzIiwiaW5zdGFsbGVkIiwicGtnTmFtZSIsImV4dCIsImRhdGEiLCJ0b1BhaXJzIiwiaW5zdGFsbFR5cGUiLCJJTlNUQUxMX1RZUEVfTlBNIiwidXBkYXRlcyIsImNoZWNrRm9yRXh0ZW5zaW9uVXBkYXRlIiwidXBkYXRlVmVyc2lvbiIsInNhZmVVcGRhdGUiLCJ1bnNhZmVVcGRhdGVWZXJzaW9uIiwidW5zYWZlVXBkYXRlIiwidXBUb0RhdGUiLCJsaXN0RGF0YSIsImluc3RhbGxUeHQiLCJncmV5IiwidXBkYXRlVHh0IiwidXBUb0RhdGVUeHQiLCJ1bnNhZmVVcGRhdGVUeHQiLCJpbnN0YWxsU3BlYyIsInZlcnNpb24iLCJ0eXBlVHh0IiwiSU5TVEFMTF9UWVBFX0dJVCIsIklOU1RBTExfVFlQRV9HSVRIVUIiLCJ5ZWxsb3ciLCJJTlNUQUxMX1RZUEVfTE9DQUwiLCJtYWdlbnRhIiwiZ3JlZW4iLCJjeWFuIiwiY29uc29sZSIsImxvZyIsIl9pbnN0YWxsIiwicGFja2FnZU5hbWUiLCJleHREYXRhIiwic3BsaXQiLCJsZW5ndGgiLCJpbnN0YWxsVmlhTnBtIiwicmVwbGFjZSIsInBrZ1ZlciIsInBhdGgiLCJpc0Fic29sdXRlIiwicmVzb2x2ZSIsInNwbGl0cyIsIm1zZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJleHROYW1lIiwiaXNJbnN0YWxsZWQiLCJleHRNYW5pZmVzdCIsImFkZEV4dGVuc2lvbiIsImVudiIsImhhc0FwcGl1bURlcGVuZGVuY3kiLCJhcHBpdW1Ib21lIiwiZ2V0UG9zdEluc3RhbGxUZXh0IiwibnBtU3BlYyIsInNwZWNNc2ciLCJwa2dKc29uRGF0YSIsIm5wbSIsImluc3RhbGxQYWNrYWdlIiwiZ2V0RXh0ZW5zaW9uRmllbGRzIiwiZXJyIiwibWVzc2FnZSIsImFwcGl1bSIsInZhbGlkYXRlRXh0ZW5zaW9uRmllbGRzIiwicmVzdWx0IiwiZXh0TWV0YWRhdGEiLCJfdW5pbnN0YWxsIiwiaW5zdGFsbFBhdGgiLCJnZXRJbnN0YWxsUGF0aCIsImZzIiwicmltcmFmIiwicmVtb3ZlRXh0ZW5zaW9uIiwiX3VwZGF0ZSIsInVuc2FmZSIsInNob3VsZFVwZGF0ZUFsbCIsImV4dHNUb1VwZGF0ZSIsImVycm9ycyIsImUiLCJ1cGRhdGUiLCJjdXJyZW50IiwidXBkYXRlVmVyIiwidXBkYXRlRXh0ZW5zaW9uIiwiZnJvbSIsInRvIiwicmVkIiwiZ2V0TGF0ZXN0VmVyc2lvbiIsImdldExhdGVzdFNhZmVVcGdyYWRlVmVyc2lvbiIsInV0aWwiLCJjb21wYXJlVmVyc2lvbnMiLCJfcnVuIiwic2NyaXB0TmFtZSIsImhhcyIsImV4dENvbmZpZyIsInNjcmlwdHMiLCJleHRTY3JpcHRzIiwiaXNQbGFpbk9iamVjdCIsInJ1bm5lciIsIlN1YlByb2Nlc3MiLCJwcm9jZXNzIiwiZXhlY1BhdGgiLCJjd2QiLCJvdXRwdXQiLCJSaW5nQnVmZmVyIiwib24iLCJsaW5lIiwiZW5xdWV1ZSIsInN0YXJ0Iiwiam9pbiIsImdldEJ1ZmYiLCJlcnJvciJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9jbGkvZXh0ZW5zaW9uLWNvbW1hbmQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgbm8tY29uc29sZSAqL1xuXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQge25wbSwgZnMsIHV0aWwsIGVudn0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCB7bG9nLCBzcGluV2l0aCwgUmluZ0J1ZmZlcn0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQge1N1YlByb2Nlc3N9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQge1xuICBJTlNUQUxMX1RZUEVfTlBNLFxuICBJTlNUQUxMX1RZUEVfR0lULFxuICBJTlNUQUxMX1RZUEVfR0lUSFVCLFxuICBJTlNUQUxMX1RZUEVfTE9DQUwsXG59IGZyb20gJy4uL2V4dGVuc2lvbi9leHRlbnNpb24tY29uZmlnJztcbmltcG9ydCB7cGFja2FnZURpZENoYW5nZX0gZnJvbSAnLi4vZXh0ZW5zaW9uL3BhY2thZ2UtY2hhbmdlZCc7XG5cbmNvbnN0IFVQREFURV9BTEwgPSAnaW5zdGFsbGVkJztcblxuY2xhc3MgTm90VXBkYXRhYmxlRXJyb3IgZXh0ZW5kcyBFcnJvciB7fVxuY2xhc3MgTm9VcGRhdGVzQXZhaWxhYmxlRXJyb3IgZXh0ZW5kcyBFcnJvciB7fVxuXG4vKipcbiAqIEB0ZW1wbGF0ZSB7RXh0ZW5zaW9uVHlwZX0gRXh0VHlwZVxuICovXG5jbGFzcyBFeHRlbnNpb25Db21tYW5kIHtcbiAgLyoqXG4gICAqIFRoaXMgaXMgdGhlIGBEcml2ZXJDb25maWdgIG9yIGBQbHVnaW5Db25maWdgLCBkZXBlbmRpbmcgb24gYEV4dFR5cGVgLlxuICAgKiBAdHlwZSB7RXh0ZW5zaW9uQ29uZmlnPEV4dFR5cGU+fVxuICAgKi9cbiAgY29uZmlnO1xuXG4gIC8qKlxuICAgKiB7QGxpbmtjb2RlIFJlY29yZH0gb2Ygb2ZmaWNpYWwgcGx1Z2lucyBvciBkcml2ZXJzLlxuICAgKiBAdHlwZSB7S25vd25FeHRlbnNpb25zPEV4dFR5cGU+fVxuICAgKi9cbiAga25vd25FeHRlbnNpb25zO1xuXG4gIC8qKlxuICAgKiBJZiBgdHJ1ZWAsIGNvbW1hbmQgb3V0cHV0IGhhcyBiZWVuIHJlcXVlc3RlZCBhcyBKU09OLlxuICAgKiBAdHlwZSB7Ym9vbGVhbn1cbiAgICovXG4gIGlzSnNvbk91dHB1dDtcblxuICAvKipcbiAgICogQnVpbGQgYW4gRXh0ZW5zaW9uQ29tbWFuZFxuICAgKiBAcGFyYW0ge0V4dGVuc2lvbkNvbW1hbmRPcHRpb25zPEV4dFR5cGU+fSBvcHRzXG4gICAqL1xuICBjb25zdHJ1Y3RvciAoe2NvbmZpZywganNvbn0pIHtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLmlzSnNvbk91dHB1dCA9IGpzb247XG4gIH1cblxuICAvKipcbiAgICogYGRyaXZlcmAgb3IgYHBsdWdpbmAsIGRlcGVuZGluZyBvbiB0aGUgYEV4dGVuc2lvbkNvbmZpZ2AuXG4gICAqL1xuICBnZXQgdHlwZSAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmV4dGVuc2lvblR5cGU7XG4gIH1cblxuICAvKipcbiAgICogVGFrZSBhIENMSSBwYXJzZSBhbmQgcnVuIGFuIGV4dGVuc2lvbiBjb21tYW5kIGJhc2VkIG9uIGl0cyB0eXBlXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBhcmdzIC0gYSBrZXkvdmFsdWUgb2JqZWN0IHdpdGggQ0xJIGZsYWdzIGFuZCB2YWx1ZXNcbiAgICogQHJldHVybiB7UHJvbWlzZTxvYmplY3Q+fSB0aGUgcmVzdWx0IG9mIHRoZSBzcGVjaWZpYyBjb21tYW5kIHdoaWNoIGlzIGV4ZWN1dGVkXG4gICAqL1xuICBhc3luYyBleGVjdXRlIChhcmdzKSB7XG4gICAgY29uc3QgY21kID0gYXJnc1tgJHt0aGlzLnR5cGV9Q29tbWFuZGBdO1xuICAgIGlmICghXy5pc0Z1bmN0aW9uKHRoaXNbY21kXSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGhhbmRsZSAke3RoaXMudHlwZX0gY29tbWFuZCAke2NtZH1gKTtcbiAgICB9XG4gICAgY29uc3QgZXhlY3V0ZUNtZCA9IHRoaXNbY21kXS5iaW5kKHRoaXMpO1xuICAgIHJldHVybiBhd2FpdCBleGVjdXRlQ21kKGFyZ3MpO1xuICB9XG5cbiAgLyoqXG4gICAqIEB0eXBlZGVmIExpc3RPcHRpb25zXG4gICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gc2hvd0luc3RhbGxlZCAtIHdoZXRoZXIgc2hvdWxkIHNob3cgb25seSBpbnN0YWxsZWQgZXh0ZW5zaW9uc1xuICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IHNob3dVcGRhdGVzIC0gd2hldGhlciBzaG91bGQgc2hvdyBhdmFpbGFibGUgdXBkYXRlc1xuICAgKi9cblxuICAvKipcbiAgICogTGlzdCBleHRlbnNpb25zXG4gICAqXG4gICAqIEBwYXJhbSB7TGlzdE9wdGlvbnN9IG9wdHNcbiAgICogQHJldHVybiB7UHJvbWlzZTxFeHRlbnNpb25MaXN0RGF0YT59IG1hcCBvZiBleHRlbnNpb24gbmFtZXMgdG8gZXh0ZW5zaW9uIGRhdGFcbiAgICovXG4gIGFzeW5jIGxpc3QgKHtzaG93SW5zdGFsbGVkLCBzaG93VXBkYXRlc30pIHtcbiAgICBjb25zdCBsc01zZyA9IGBMaXN0aW5nICR7c2hvd0luc3RhbGxlZCA/ICdpbnN0YWxsZWQnIDogJ2F2YWlsYWJsZSd9ICR7XG4gICAgICB0aGlzLnR5cGVcbiAgICB9c2A7XG4gICAgY29uc3QgaW5zdGFsbGVkTmFtZXMgPSBPYmplY3Qua2V5cyh0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zKTtcbiAgICBjb25zdCBrbm93bk5hbWVzID0gT2JqZWN0LmtleXModGhpcy5rbm93bkV4dGVuc2lvbnMpO1xuICAgIGNvbnN0IGV4dHMgPSBbLi4uaW5zdGFsbGVkTmFtZXMsIC4uLmtub3duTmFtZXNdLnJlZHVjZShcbiAgICAgIChhY2MsIG5hbWUpID0+IHtcbiAgICAgICAgaWYgKCFhY2NbbmFtZV0pIHtcbiAgICAgICAgICBpZiAoaW5zdGFsbGVkTmFtZXMuaW5jbHVkZXMobmFtZSkpIHtcbiAgICAgICAgICAgIGFjY1tuYW1lXSA9IHtcbiAgICAgICAgICAgICAgLi4udGhpcy5jb25maWcuaW5zdGFsbGVkRXh0ZW5zaW9uc1tuYW1lXSxcbiAgICAgICAgICAgICAgaW5zdGFsbGVkOiB0cnVlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9IGVsc2UgaWYgKCFzaG93SW5zdGFsbGVkKSB7XG4gICAgICAgICAgICBhY2NbbmFtZV0gPSB7cGtnTmFtZTogdGhpcy5rbm93bkV4dGVuc2lvbnNbbmFtZV0sIGluc3RhbGxlZDogZmFsc2V9O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgfSxcbiAgICAgIC8qKlxuICAgICAgICogVGhpcyBhY2N1bXVsYXRvciBjb250YWlucyBlaXRoZXIge0BsaW5rY29kZSBVbmluc3RhbGxlZEV4dGVuc2lvbkxJc3REYXRhfSBfb3JfXG4gICAgICAgKiB7QGxpbmtjb2RlIEluc3RhbGxlZEV4dGVuc2lvbkxpc3REYXRhfSB3aXRob3V0IHVwZ3JhZGUgaW5mb3JtYXRpb24gKHdoaWNoIGlzIGFkZGVkIGJ5IHRoZSBiZWxvdyBjb2RlIGJsb2NrKVxuICAgICAgICogQHR5cGUge1JlY29yZDxzdHJpbmcsUGFydGlhbDxJbnN0YWxsZWRFeHRlbnNpb25MaXN0RGF0YT58VW5pbnN0YWxsZWRFeHRlbnNpb25MaXN0RGF0YT59XG4gICAgICAgKi8gKHt9KVxuICAgICk7XG5cbiAgICAvLyBpZiB3ZSB3YW50IHRvIHNob3cgd2hldGhlciB1cGRhdGVzIGFyZSBhdmFpbGFibGUsIHB1dCB0aGF0IGJlaGluZCBhIHNwaW5uZXJcbiAgICBhd2FpdCBzcGluV2l0aCh0aGlzLmlzSnNvbk91dHB1dCwgbHNNc2csIGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghc2hvd1VwZGF0ZXMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBbZXh0LCBkYXRhXSBvZiBfLnRvUGFpcnMoZXh0cykpIHtcbiAgICAgICAgaWYgKCFkYXRhLmluc3RhbGxlZCB8fCBkYXRhLmluc3RhbGxUeXBlICE9PSBJTlNUQUxMX1RZUEVfTlBNKSB7XG4gICAgICAgICAgLy8gZG9uJ3QgbmVlZCB0byBjaGVjayBmb3IgdXBkYXRlcyBvbiBleHRzIHRoYXQgYXJlbid0IGluc3RhbGxlZFxuICAgICAgICAgIC8vIGFsc28gZG9uJ3QgbmVlZCB0byBjaGVjayBmb3IgdXBkYXRlcyBvbiBub24tbnBtIGV4dHNcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1cGRhdGVzID0gYXdhaXQgdGhpcy5jaGVja0ZvckV4dGVuc2lvblVwZGF0ZShleHQpO1xuICAgICAgICBkYXRhLnVwZGF0ZVZlcnNpb24gPSB1cGRhdGVzLnNhZmVVcGRhdGU7XG4gICAgICAgIGRhdGEudW5zYWZlVXBkYXRlVmVyc2lvbiA9IHVwZGF0ZXMudW5zYWZlVXBkYXRlO1xuICAgICAgICBkYXRhLnVwVG9EYXRlID1cbiAgICAgICAgICB1cGRhdGVzLnNhZmVVcGRhdGUgPT09IG51bGwgJiYgdXBkYXRlcy51bnNhZmVVcGRhdGUgPT09IG51bGw7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBsaXN0RGF0YSA9IC8qKiBAdHlwZSB7RXh0ZW5zaW9uTGlzdERhdGF9ICovIChleHRzKTtcblxuICAgIC8vIGlmIHdlJ3JlIGp1c3QgZ2V0dGluZyB0aGUgZGF0YSwgc2hvcnQgY2lyY3VpdCByZXR1cm4gaGVyZSBzaW5jZSB3ZSBkb24ndCBuZWVkIHRvIGRvIGFueVxuICAgIC8vIGZvcm1hdHRpbmcgbG9naWNcbiAgICBpZiAodGhpcy5pc0pzb25PdXRwdXQpIHtcbiAgICAgIHJldHVybiBsaXN0RGF0YTtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IFtuYW1lLCBkYXRhXSBvZiBfLnRvUGFpcnMobGlzdERhdGEpKSB7XG4gICAgICBsZXQgaW5zdGFsbFR4dCA9ICcgW25vdCBpbnN0YWxsZWRdJy5ncmV5O1xuICAgICAgbGV0IHVwZGF0ZVR4dCA9ICcnO1xuICAgICAgbGV0IHVwVG9EYXRlVHh0ID0gJyc7XG4gICAgICBsZXQgdW5zYWZlVXBkYXRlVHh0ID0gJyc7XG4gICAgICBpZiAoZGF0YS5pbnN0YWxsZWQpIHtcbiAgICAgICAgY29uc3Qge1xuICAgICAgICAgIGluc3RhbGxUeXBlLFxuICAgICAgICAgIGluc3RhbGxTcGVjLFxuICAgICAgICAgIHVwZGF0ZVZlcnNpb24sXG4gICAgICAgICAgdW5zYWZlVXBkYXRlVmVyc2lvbixcbiAgICAgICAgICB2ZXJzaW9uLFxuICAgICAgICAgIHVwVG9EYXRlLFxuICAgICAgICB9ID0gZGF0YTtcbiAgICAgICAgbGV0IHR5cGVUeHQ7XG4gICAgICAgIHN3aXRjaCAoaW5zdGFsbFR5cGUpIHtcbiAgICAgICAgICBjYXNlIElOU1RBTExfVFlQRV9HSVQ6XG4gICAgICAgICAgY2FzZSBJTlNUQUxMX1RZUEVfR0lUSFVCOlxuICAgICAgICAgICAgdHlwZVR4dCA9IGAoY2xvbmVkIGZyb20gJHtpbnN0YWxsU3BlY30pYC55ZWxsb3c7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIElOU1RBTExfVFlQRV9MT0NBTDpcbiAgICAgICAgICAgIHR5cGVUeHQgPSBgKGxpbmtlZCBmcm9tICR7aW5zdGFsbFNwZWN9KWAubWFnZW50YTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0eXBlVHh0ID0gJyhOUE0pJztcbiAgICAgICAgfVxuICAgICAgICBpbnN0YWxsVHh0ID0gYEAke3ZlcnNpb24ueWVsbG93fSAke1xuICAgICAgICAgICgnW2luc3RhbGxlZCAnICsgdHlwZVR4dCArICddJykuZ3JlZW5cbiAgICAgICAgfWA7XG5cbiAgICAgICAgaWYgKHNob3dVcGRhdGVzKSB7XG4gICAgICAgICAgaWYgKHVwZGF0ZVZlcnNpb24pIHtcbiAgICAgICAgICAgIHVwZGF0ZVR4dCA9IGAgWyR7dXBkYXRlVmVyc2lvbn0gYXZhaWxhYmxlXWAubWFnZW50YTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHVwVG9EYXRlKSB7XG4gICAgICAgICAgICB1cFRvRGF0ZVR4dCA9IGAgW1VwIHRvIGRhdGVdYC5ncmVlbjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHVuc2FmZVVwZGF0ZVZlcnNpb24pIHtcbiAgICAgICAgICAgIHVuc2FmZVVwZGF0ZVR4dCA9XG4gICAgICAgICAgICAgIGAgWyR7dW5zYWZlVXBkYXRlVmVyc2lvbn0gYXZhaWxhYmxlIChwb3RlbnRpYWxseSB1bnNhZmUpXWAuY3lhbjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGAtICR7bmFtZS55ZWxsb3d9JHtpbnN0YWxsVHh0fSR7dXBkYXRlVHh0fSR7dXBUb0RhdGVUeHR9JHt1bnNhZmVVcGRhdGVUeHR9YFxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbGlzdERhdGE7XG4gIH1cblxuICAvKipcbiAgICogSW5zdGFsbCBhbiBleHRlbnNpb25cbiAgICpcbiAgICogQHBhcmFtIHtJbnN0YWxsQXJnc30gYXJnc1xuICAgKiBAcmV0dXJuIHtQcm9taXNlPEV4dFJlY29yZDxFeHRUeXBlPj59IG1hcCBvZiBhbGwgaW5zdGFsbGVkIGV4dGVuc2lvbiBuYW1lcyB0byBleHRlbnNpb24gZGF0YVxuICAgKi9cbiAgYXN5bmMgX2luc3RhbGwgKHtpbnN0YWxsU3BlYywgaW5zdGFsbFR5cGUsIHBhY2thZ2VOYW1lfSkge1xuICAgIC8qKiBAdHlwZSB7RXh0ZW5zaW9uRmllbGRzPHR5cGVvZiB0aGlzLnR5cGU+fSAqL1xuICAgIGxldCBleHREYXRhO1xuXG4gICAgaWYgKFxuICAgICAgcGFja2FnZU5hbWUgJiZcbiAgICAgIFtJTlNUQUxMX1RZUEVfTE9DQUwsIElOU1RBTExfVFlQRV9OUE1dLmluY2x1ZGVzKGluc3RhbGxUeXBlKVxuICAgICkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgV2hlbiB1c2luZyAtLXNvdXJjZT0ke2luc3RhbGxUeXBlfSwgY2Fubm90IGFsc28gdXNlIC0tcGFja2FnZWBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKFxuICAgICAgIXBhY2thZ2VOYW1lICYmXG4gICAgICBbSU5TVEFMTF9UWVBFX0dJVCwgSU5TVEFMTF9UWVBFX0dJVEhVQl0uaW5jbHVkZXMoaW5zdGFsbFR5cGUpXG4gICAgKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBXaGVuIHVzaW5nIC0tc291cmNlPSR7aW5zdGFsbFR5cGV9LCBtdXN0IGFsc28gdXNlIC0tcGFja2FnZWBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGluc3RhbGxUeXBlID09PSBJTlNUQUxMX1RZUEVfR0lUSFVCKSB7XG4gICAgICBpZiAoaW5zdGFsbFNwZWMuc3BsaXQoJy8nKS5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBHaXRodWIgJHt0aGlzLnR5cGV9IHNwZWMgJHtpbnN0YWxsU3BlY30gYXBwZWFyZWQgdG8gYmUgaW52YWxpZDsgYCArXG4gICAgICAgICAgICAnaXQgc2hvdWxkIGJlIG9mIHRoZSBmb3JtIDxvcmc+LzxyZXBvPidcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICAgIGV4dERhdGEgPSBhd2FpdCB0aGlzLmluc3RhbGxWaWFOcG0oe1xuICAgICAgICBpbnN0YWxsU3BlYyxcbiAgICAgICAgcGtnTmFtZTogLyoqIEB0eXBlIHtzdHJpbmd9ICovIChwYWNrYWdlTmFtZSksXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGluc3RhbGxUeXBlID09PSBJTlNUQUxMX1RZUEVfR0lUKSB7XG4gICAgICAvLyBnaXQgdXJscyBjYW4gaGF2ZSAnLmdpdCcgYXQgdGhlIGVuZCwgYnV0IHRoaXMgaXMgbm90IG5lY2Vzc2FyeSBhbmQgd291bGQgY29tcGxpY2F0ZSB0aGVcbiAgICAgIC8vIHdheSB3ZSBkb3dubG9hZCBhbmQgbmFtZSBkaXJlY3Rvcmllcywgc28gd2UgY2FuIGp1c3QgcmVtb3ZlIGl0XG4gICAgICBpbnN0YWxsU3BlYyA9IGluc3RhbGxTcGVjLnJlcGxhY2UoL1xcLmdpdCQvLCAnJyk7XG4gICAgICBleHREYXRhID0gYXdhaXQgdGhpcy5pbnN0YWxsVmlhTnBtKHtcbiAgICAgICAgaW5zdGFsbFNwZWMsXG4gICAgICAgIHBrZ05hbWU6IC8qKiBAdHlwZSB7c3RyaW5nfSAqLyAocGFja2FnZU5hbWUpLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBwa2dOYW1lLCBwa2dWZXI7XG4gICAgICBpZiAoaW5zdGFsbFR5cGUgPT09IElOU1RBTExfVFlQRV9MT0NBTCkge1xuICAgICAgICBwa2dOYW1lID0gcGF0aC5pc0Fic29sdXRlKGluc3RhbGxTcGVjKVxuICAgICAgICAgID8gaW5zdGFsbFNwZWNcbiAgICAgICAgICA6IHBhdGgucmVzb2x2ZShpbnN0YWxsU3BlYyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBhdCB0aGlzIHBvaW50IHdlIGhhdmUgZWl0aGVyIGFuIG5wbSBwYWNrYWdlIG9yIGFuIGFwcGl1bSB2ZXJpZmllZCBleHRlbnNpb25cbiAgICAgICAgLy8gbmFtZSBvciBhIGxvY2FsIHBhdGguIGJvdGggb2Ygd2hpY2ggd2lsbCBiZSBpbnN0YWxsZWQgdmlhIG5wbS5cbiAgICAgICAgLy8gZXh0ZW5zaW9ucyBpbnN0YWxsZWQgdmlhIG5wbSBjYW4gaW5jbHVkZSB2ZXJzaW9ucyBvciB0YWdzIGFmdGVyIHRoZSAnQCdcbiAgICAgICAgLy8gc2lnbiwgc28gY2hlY2sgZm9yIHRoYXQuIFdlIGFsc28gbmVlZCB0byBiZSBjYXJlZnVsIHRoYXQgcGFja2FnZSBuYW1lcyB0aGVtc2VsdmVzIGNhblxuICAgICAgICAvLyBjb250YWluIHRoZSAnQCcgc3ltYm9sLCBhcyBpbiBgbnBtIGluc3RhbGwgQGFwcGl1bS9mYWtlLWRyaXZlckAxLjIuMGBcbiAgICAgICAgbGV0IG5hbWU7XG4gICAgICAgIGNvbnN0IHNwbGl0cyA9IGluc3RhbGxTcGVjLnNwbGl0KCdAJyk7XG4gICAgICAgIGlmIChpbnN0YWxsU3BlY1swXSA9PT0gJ0AnKSB7XG4gICAgICAgICAgLy8gdGhpcyBpcyB0aGUgY2FzZSB3aGVyZSB3ZSBoYXZlIGFuIG5wbSBvcmcgaW5jbHVkZWQgaW4gdGhlIHBhY2thZ2UgbmFtZVxuICAgICAgICAgIFtuYW1lLCBwa2dWZXJdID0gW2BAJHtzcGxpdHNbMV19YCwgc3BsaXRzWzJdXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyB0aGlzIGlzIHRoZSBjYXNlIHdpdGhvdXQgYW4gbnBtIG9yZ1xuICAgICAgICAgIFtuYW1lLCBwa2dWZXJdID0gc3BsaXRzO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluc3RhbGxUeXBlID09PSBJTlNUQUxMX1RZUEVfTlBNKSB7XG4gICAgICAgICAgLy8gaWYgd2UncmUgaW5zdGFsbGluZyBhIG5hbWVkIHBhY2thZ2UgZnJvbSBucG0sIHdlIGRvbid0IG5lZWQgdG8gY2hlY2tcbiAgICAgICAgICAvLyBhZ2FpbnN0IHRoZSBhcHBpdW0gZXh0ZW5zaW9uIGxpc3Q7IGp1c3QgdXNlIHRoZSBpbnN0YWxsU3BlYyBhcyBpc1xuICAgICAgICAgIHBrZ05hbWUgPSBuYW1lO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGlmIHdlJ3JlIGluc3RhbGxpbmcgYSBuYW1lZCBhcHBpdW0gZHJpdmVyIChsaWtlICd4Y3VpdGVzdCcpIHdlIG5lZWQgdG9cbiAgICAgICAgICAvLyBkZXJlZmVyZW5jZSB0aGUgYWN0dWFsIG5wbSBwYWNrYWdlICgnYXBwaXVwbS14Y3VpdGVzdC1kcml2ZXInKSwgc29cbiAgICAgICAgICAvLyBjaGVjayBpdCBleGlzdHMgYW5kIGdldCB0aGUgY29ycmVjdCBwYWNrYWdlXG4gICAgICAgICAgY29uc3Qga25vd25OYW1lcyA9IE9iamVjdC5rZXlzKHRoaXMua25vd25FeHRlbnNpb25zKTtcbiAgICAgICAgICBpZiAoIV8uaW5jbHVkZXMoa25vd25OYW1lcywgbmFtZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IG1zZyA9XG4gICAgICAgICAgICAgIGBDb3VsZCBub3QgcmVzb2x2ZSAke3RoaXMudHlwZX07IGFyZSB5b3Ugc3VyZSBpdCdzIGluIHRoZSBsaXN0IGAgK1xuICAgICAgICAgICAgICBgb2Ygc3VwcG9ydGVkICR7dGhpcy50eXBlfXM/ICR7SlNPTi5zdHJpbmdpZnkoa25vd25OYW1lcyl9YDtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBwa2dOYW1lID0gdGhpcy5rbm93bkV4dGVuc2lvbnNbbmFtZV07XG4gICAgICAgICAgLy8gZ2l2ZW4gdGhhdCB3ZSdsbCB1c2UgdGhlIGluc3RhbGwgdHlwZSBpbiB0aGUgZHJpdmVyIGpzb24sIHN0b3JlIGl0IGFzXG4gICAgICAgICAgLy8gJ25wbScgbm93XG4gICAgICAgICAgaW5zdGFsbFR5cGUgPSBJTlNUQUxMX1RZUEVfTlBNO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGV4dERhdGEgPSBhd2FpdCB0aGlzLmluc3RhbGxWaWFOcG0oe2luc3RhbGxTcGVjLCBwa2dOYW1lLCBwa2dWZXJ9KTtcbiAgICB9XG5cbiAgICBjb25zdCBleHROYW1lID0gZXh0RGF0YVsvKiogQHR5cGUge3N0cmluZ30gKi8gKGAke3RoaXMudHlwZX1OYW1lYCldO1xuICAgIGRlbGV0ZSBleHREYXRhWy8qKiBAdHlwZSB7c3RyaW5nfSAqLyAoYCR7dGhpcy50eXBlfU5hbWVgKV07XG5cbiAgICBpZiAodGhpcy5jb25maWcuaXNJbnN0YWxsZWQoZXh0TmFtZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEEgJHt0aGlzLnR5cGV9IG5hbWVkICcke2V4dE5hbWV9JyBpcyBhbHJlYWR5IGluc3RhbGxlZC4gYCArXG4gICAgICAgICAgYERpZCB5b3UgbWVhbiB0byB1cGRhdGU/ICdhcHBpdW0gJHt0aGlzLnR5cGV9IHVwZGF0ZScuIFNlZSBgICtcbiAgICAgICAgICBgaW5zdGFsbGVkICR7dGhpcy50eXBlfXMgd2l0aCAnYXBwaXVtICR7dGhpcy50eXBlfSBsaXN0IC0taW5zdGFsbGVkJy5gXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGV4dE1hbmlmZXN0ID0gey4uLmV4dERhdGEsIGluc3RhbGxUeXBlLCBpbnN0YWxsU3BlY307XG4gICAgYXdhaXQgdGhpcy5jb25maWcuYWRkRXh0ZW5zaW9uKGV4dE5hbWUsIGV4dE1hbmlmZXN0KTtcblxuICAgIC8vIHVwZGF0ZSB0aGUgaWYgd2UndmUgY2hhbmdlZCB0aGUgbG9jYWwgYHBhY2thZ2UuanNvbmBcbiAgICBpZiAoYXdhaXQgZW52Lmhhc0FwcGl1bURlcGVuZGVuY3kodGhpcy5jb25maWcuYXBwaXVtSG9tZSkpIHtcbiAgICAgIGF3YWl0IHBhY2thZ2VEaWRDaGFuZ2UodGhpcy5jb25maWcuYXBwaXVtSG9tZSk7XG4gICAgfVxuXG4gICAgLy8gbG9nIGluZm8gZm9yIHRoZSB1c2VyXG4gICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCB0aGlzLmdldFBvc3RJbnN0YWxsVGV4dCh7ZXh0TmFtZSwgZXh0RGF0YX0pKTtcblxuICAgIHJldHVybiB0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIEluc3RhbGwgYW4gZXh0ZW5zaW9uIHZpYSBOUE1cbiAgICpcbiAgICogQHBhcmFtIHtJbnN0YWxsVmlhTnBtQXJnc30gYXJnc1xuICAgKi9cbiAgYXN5bmMgaW5zdGFsbFZpYU5wbSAoe2luc3RhbGxTcGVjLCBwa2dOYW1lLCBwa2dWZXJ9KSB7XG4gICAgY29uc3QgbnBtU3BlYyA9IGAke3BrZ05hbWV9JHtwa2dWZXIgPyAnQCcgKyBwa2dWZXIgOiAnJ31gO1xuICAgIGNvbnN0IHNwZWNNc2cgPVxuICAgICAgbnBtU3BlYyA9PT0gaW5zdGFsbFNwZWMgPyAnJyA6IGAgdXNpbmcgTlBNIGluc3RhbGwgc3BlYyAnJHtucG1TcGVjfSdgO1xuICAgIGNvbnN0IG1zZyA9IGBJbnN0YWxsaW5nICcke2luc3RhbGxTcGVjfScke3NwZWNNc2d9YDtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGtnSnNvbkRhdGEgPSBhd2FpdCBzcGluV2l0aChcbiAgICAgICAgdGhpcy5pc0pzb25PdXRwdXQsXG4gICAgICAgIG1zZyxcbiAgICAgICAgYXN5bmMgKCkgPT5cbiAgICAgICAgICBhd2FpdCBucG0uaW5zdGFsbFBhY2thZ2UodGhpcy5jb25maWcuYXBwaXVtSG9tZSwgcGtnTmFtZSwge1xuICAgICAgICAgICAgcGtnVmVyLFxuICAgICAgICAgIH0pXG4gICAgICApO1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0RXh0ZW5zaW9uRmllbGRzKHBrZ0pzb25EYXRhLCBpbnN0YWxsU3BlYyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBFbmNvdW50ZXJlZCBhbiBlcnJvciB3aGVuIGluc3RhbGxpbmcgcGFja2FnZTogJHtlcnIubWVzc2FnZX1gXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHRleHQgd2hpY2ggc2hvdWxkIGJlIGRpc3BsYXllZCB0byB0aGUgdXNlciBhZnRlciBhbiBleHRlbnNpb24gaGFzIGJlZW4gaW5zdGFsbGVkLiBUaGlzXG4gICAqIGlzIGRlc2lnbmVkIHRvIGJlIG92ZXJyaWRkZW4gYnkgZHJpdmVycy9wbHVnaW5zIHdpdGggdGhlaXIgb3duIHBhcnRpY3VsYXIgdGV4dC5cbiAgICpcbiAgICogQHBhcmFtIHtFeHRlbnNpb25BcmdzfSBhcmdzXG4gICAqIEByZXR1cm5zIHtzdHJpbmd9XG4gICAqL1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgZ2V0UG9zdEluc3RhbGxUZXh0IChhcmdzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdNdXN0IGJlIGltcGxlbWVudGVkIGluIGZpbmFsIGNsYXNzJyk7XG4gIH1cblxuICAvKipcbiAgICogVGFrZSBhbiBOUE0gbW9kdWxlJ3MgcGFja2FnZS5qc29uIGFuZCBleHRyYWN0IEFwcGl1bSBkcml2ZXIgaW5mb3JtYXRpb24gZnJvbSBhIHNwZWNpYWxcbiAgICogJ2FwcGl1bScgZmllbGQgaW4gdGhlIEpTT04gZGF0YS4gV2UgbmVlZCB0aGlzIGluZm9ybWF0aW9uIHRvIGUuZy4gZGV0ZXJtaW5lIHdoaWNoIGNsYXNzIHRvXG4gICAqIGxvYWQgYXMgdGhlIG1haW4gZHJpdmVyIGNsYXNzLCBvciB0byBiZSBhYmxlIHRvIGRldGVjdCBpbmNvbXBhdGliaWxpdGllcyBiZXR3ZWVuIGRyaXZlciBhbmRcbiAgICogYXBwaXVtIHZlcnNpb25zLlxuICAgKlxuICAgKiBAcGFyYW0ge0V4dFBhY2thZ2VKc29uPEV4dFR5cGU+fSBwa2dKc29uRGF0YSAtIHRoZSBwYWNrYWdlLmpzb24gZGF0YSBmb3IgYSBkcml2ZXIgbW9kdWxlLCBhcyBpZiBpdCBoYWQgYmVlbiBzdHJhaWdodGZvcndhcmRseSAncmVxdWlyZSdkXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBpbnN0YWxsU3BlY1xuICAgKiBAcmV0dXJucyB7RXh0ZW5zaW9uRmllbGRzPEV4dFR5cGU+fVxuICAgKi9cbiAgZ2V0RXh0ZW5zaW9uRmllbGRzIChwa2dKc29uRGF0YSwgaW5zdGFsbFNwZWMpIHtcbiAgICBpZiAoIXBrZ0pzb25EYXRhLmFwcGl1bSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgSW5zdGFsbGVkIGRyaXZlciBkaWQgbm90IGhhdmUgYW4gJ2FwcGl1bScgc2VjdGlvbiBpbiBpdHMgYCArXG4gICAgICAgICAgYHBhY2thZ2UuanNvbiBmaWxlIGFzIGV4cGVjdGVkYFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3Qge2FwcGl1bSwgbmFtZSwgdmVyc2lvbn0gPSBwa2dKc29uRGF0YTtcbiAgICB0aGlzLnZhbGlkYXRlRXh0ZW5zaW9uRmllbGRzKGFwcGl1bSwgaW5zdGFsbFNwZWMpO1xuICAgIC8qKiBAdHlwZSB7dW5rbm93bn0gKi9cbiAgICBjb25zdCByZXN1bHQgPSB7Li4uYXBwaXVtLCBwa2dOYW1lOiBuYW1lLCB2ZXJzaW9ufTtcbiAgICByZXR1cm4gLyoqIEB0eXBlIHtFeHRlbnNpb25GaWVsZHM8RXh0VHlwZT59ICovIChyZXN1bHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZvciBhbnkgcGFja2FnZS5qc29uIGZpZWxkcyB3aGljaCBhIHBhcnRpY3VsYXIgdHlwZSBvZiBleHRlbnNpb24gcmVxdWlyZXMsIHZhbGlkYXRlIHRoZVxuICAgKiBwcmVzZW5jZSBhbmQgZm9ybSBvZiB0aG9zZSBmaWVsZHMgb24gdGhlIHBhY2thZ2UuanNvbiBkYXRhLCB0aHJvd2luZyBhbiBlcnJvciBpZiBhbnl0aGluZyBpc1xuXG4gIC8qKlxuICAgKiBGb3IgYW55IGBwYWNrYWdlLmpzb25gIGZpZWxkcyB3aGljaCBhIHBhcnRpY3VsYXIgdHlwZSBvZiBleHRlbnNpb24gcmVxdWlyZXMsIHZhbGlkYXRlIHRoZVxuICAgKiBwcmVzZW5jZSBhbmQgZm9ybSBvZiB0aG9zZSBmaWVsZHMgb24gdGhlIGBwYWNrYWdlLmpzb25gIGRhdGEsIHRocm93aW5nIGFuIGVycm9yIGlmIGFueXRoaW5nIGlzXG4gICAqIGFtaXNzLlxuICAgKlxuICAgKiBAcGFyYW0ge0V4dE1ldGFkYXRhPEV4dFR5cGU+fSBleHRNZXRhZGF0YSAtIHRoZSBkYXRhIGluIHRoZSBcImFwcGl1bVwiIGZpZWxkIG9mIGBwYWNrYWdlLmpzb25gIGZvciBhbiBleHRlbnNpb25cbiAgICogQHBhcmFtIHtzdHJpbmd9IGluc3RhbGxTcGVjIC0gRXh0ZW5zaW9uIG5hbWUvc3BlY1xuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gIHZhbGlkYXRlRXh0ZW5zaW9uRmllbGRzIChleHRNZXRhZGF0YSwgaW5zdGFsbFNwZWMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ011c3QgYmUgaW1wbGVtZW50ZWQgaW4gZmluYWwgY2xhc3MnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVbmluc3RhbGwgYW4gZXh0ZW5zaW9uXG4gICAqXG4gICAqIEBwYXJhbSB7VW5pbnN0YWxsT3B0c30gb3B0c1xuICAgKiBAcmV0dXJuIHtQcm9taXNlPEV4dFJlY29yZDxFeHRUeXBlPj59IG1hcCBvZiBhbGwgaW5zdGFsbGVkIGV4dGVuc2lvbiBuYW1lcyB0byBleHRlbnNpb24gZGF0YVxuICAgKi9cbiAgYXN5bmMgX3VuaW5zdGFsbCAoe2luc3RhbGxTcGVjfSkge1xuICAgIGlmICghdGhpcy5jb25maWcuaXNJbnN0YWxsZWQoaW5zdGFsbFNwZWMpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBDYW4ndCB1bmluc3RhbGwgJHt0aGlzLnR5cGV9ICcke2luc3RhbGxTcGVjfSc7IGl0IGlzIG5vdCBpbnN0YWxsZWRgXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBpbnN0YWxsUGF0aCA9IHRoaXMuY29uZmlnLmdldEluc3RhbGxQYXRoKGluc3RhbGxTcGVjKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMucmltcmFmKGluc3RhbGxQYXRoKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgYXdhaXQgdGhpcy5jb25maWcucmVtb3ZlRXh0ZW5zaW9uKGluc3RhbGxTcGVjKTtcbiAgICB9XG4gICAgbG9nKFxuICAgICAgdGhpcy5pc0pzb25PdXRwdXQsXG4gICAgICBgU3VjY2Vzc2Z1bGx5IHVuaW5zdGFsbGVkICR7dGhpcy50eXBlfSAnJHtpbnN0YWxsU3BlY30nYC5ncmVlblxuICAgICk7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmluc3RhbGxlZEV4dGVuc2lvbnM7XG4gIH1cblxuICAvKipcbiAgICogQXR0ZW1wdCB0byB1cGRhdGUgb25lIG9yIG1vcmUgZHJpdmVycyB1c2luZyBOUE1cbiAgICpcbiAgICogQHBhcmFtIHtFeHRlbnNpb25VcGRhdGVPcHRzfSB1cGRhdGVTcGVjXG4gICAqIEByZXR1cm4ge1Byb21pc2U8RXh0ZW5zaW9uVXBkYXRlUmVzdWx0Pn1cbiAgICovXG4gIGFzeW5jIF91cGRhdGUgKHtpbnN0YWxsU3BlYywgdW5zYWZlfSkge1xuICAgIGNvbnN0IHNob3VsZFVwZGF0ZUFsbCA9IGluc3RhbGxTcGVjID09PSBVUERBVEVfQUxMO1xuICAgIC8vIGlmIHdlJ3JlIHNwZWNpZmljYWxseSByZXF1ZXN0aW5nIGFuIHVwZGF0ZSBmb3IgYW4gZXh0ZW5zaW9uLCBtYWtlIHN1cmUgaXQncyBpbnN0YWxsZWRcbiAgICBpZiAoIXNob3VsZFVwZGF0ZUFsbCAmJiAhdGhpcy5jb25maWcuaXNJbnN0YWxsZWQoaW5zdGFsbFNwZWMpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBUaGUgJHt0aGlzLnR5cGV9ICcke2luc3RhbGxTcGVjfScgd2FzIG5vdCBpbnN0YWxsZWQsIHNvIGNhbid0IGJlIHVwZGF0ZWRgXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCBleHRzVG9VcGRhdGUgPSBzaG91bGRVcGRhdGVBbGxcbiAgICAgID8gT2JqZWN0LmtleXModGhpcy5jb25maWcuaW5zdGFsbGVkRXh0ZW5zaW9ucylcbiAgICAgIDogW2luc3RhbGxTcGVjXTtcblxuICAgIC8vICdlcnJvcnMnIHdpbGwgaGF2ZSBleHQgbmFtZXMgYXMga2V5cyBhbmQgZXJyb3Igb2JqZWN0cyBhcyB2YWx1ZXNcbiAgICAvKiogQHR5cGUge1JlY29yZDxzdHJpbmcsRXJyb3I+fSAqL1xuICAgIGNvbnN0IGVycm9ycyA9IHt9O1xuXG4gICAgLy8gJ3VwZGF0ZXMnIHdpbGwgaGF2ZSBleHQgbmFtZXMgYXMga2V5cyBhbmQgdXBkYXRlIG9iamVjdHMgYXMgdmFsdWVzLCB3aGVyZSBhbiB1cGRhdGVcbiAgICAvLyBvYmplY3QgaXMgb2YgdGhlIGZvcm0ge2Zyb206IHZlcnNpb25TdHJpbmcsIHRvOiB2ZXJzaW9uU3RyaW5nfVxuICAgIC8qKiBAdHlwZSB7UmVjb3JkPHN0cmluZyxVcGRhdGVSZXBvcnQ+fSAqL1xuICAgIGNvbnN0IHVwZGF0ZXMgPSB7fTtcblxuICAgIGZvciAoY29uc3QgZSBvZiBleHRzVG9VcGRhdGUpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHNwaW5XaXRoKFxuICAgICAgICAgIHRoaXMuaXNKc29uT3V0cHV0LFxuICAgICAgICAgIGBDaGVja2luZyBpZiAke3RoaXMudHlwZX0gJyR7ZX0nIGlzIHVwZGF0YWJsZWAsXG4gICAgICAgICAgKCkgPT4ge1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zW2VdLmluc3RhbGxUeXBlICE9PVxuICAgICAgICAgICAgICBJTlNUQUxMX1RZUEVfTlBNXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vdFVwZGF0YWJsZUVycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICBjb25zdCB1cGRhdGUgPSBhd2FpdCBzcGluV2l0aChcbiAgICAgICAgICB0aGlzLmlzSnNvbk91dHB1dCxcbiAgICAgICAgICBgQ2hlY2tpbmcgaWYgJHt0aGlzLnR5cGV9ICcke2V9JyBuZWVkcyBhbiB1cGRhdGVgLFxuICAgICAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHVwZGF0ZSA9IGF3YWl0IHRoaXMuY2hlY2tGb3JFeHRlbnNpb25VcGRhdGUoZSk7XG4gICAgICAgICAgICBpZiAoISh1cGRhdGUuc2FmZVVwZGF0ZSB8fCB1cGRhdGUudW5zYWZlVXBkYXRlKSkge1xuICAgICAgICAgICAgICB0aHJvdyBuZXcgTm9VcGRhdGVzQXZhaWxhYmxlRXJyb3IoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1cGRhdGU7XG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgICBpZiAoIXVuc2FmZSAmJiAhdXBkYXRlLnNhZmVVcGRhdGUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgVGhlICR7dGhpcy50eXBlfSAnJHtlfScgaGFzIGEgbWFqb3IgcmV2aXNpb24gdXBkYXRlIGAgK1xuICAgICAgICAgICAgICBgKCR7dXBkYXRlLmN1cnJlbnR9ID0+ICR7dXBkYXRlLnVuc2FmZVVwZGF0ZX0pLCB3aGljaCBjb3VsZCBpbmNsdWRlIGAgK1xuICAgICAgICAgICAgICBgYnJlYWtpbmcgY2hhbmdlcy4gSWYgeW91IHdhbnQgdG8gYXBwbHkgdGhpcyB1cGRhdGUsIHJlLXJ1biB3aXRoIC0tdW5zYWZlYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdXBkYXRlVmVyID1cbiAgICAgICAgICB1bnNhZmUgJiYgdXBkYXRlLnVuc2FmZVVwZGF0ZVxuICAgICAgICAgICAgPyB1cGRhdGUudW5zYWZlVXBkYXRlXG4gICAgICAgICAgICA6IHVwZGF0ZS5zYWZlVXBkYXRlO1xuICAgICAgICBhd2FpdCBzcGluV2l0aChcbiAgICAgICAgICB0aGlzLmlzSnNvbk91dHB1dCxcbiAgICAgICAgICBgVXBkYXRpbmcgZHJpdmVyICcke2V9JyBmcm9tICR7dXBkYXRlLmN1cnJlbnR9IHRvICR7dXBkYXRlVmVyfWAsXG4gICAgICAgICAgYXN5bmMgKCkgPT4gYXdhaXQgdGhpcy51cGRhdGVFeHRlbnNpb24oZSwgdXBkYXRlVmVyKVxuICAgICAgICApO1xuICAgICAgICB1cGRhdGVzW2VdID0ge2Zyb206IHVwZGF0ZS5jdXJyZW50LCB0bzogdXBkYXRlVmVyfTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBlcnJvcnNbZV0gPSBlcnI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCAnVXBkYXRlIHJlcG9ydDonKTtcbiAgICBmb3IgKGNvbnN0IFtlLCB1cGRhdGVdIG9mIF8udG9QYWlycyh1cGRhdGVzKSkge1xuICAgICAgbG9nKFxuICAgICAgICB0aGlzLmlzSnNvbk91dHB1dCxcbiAgICAgICAgYC0gJHt0aGlzLnR5cGV9ICR7ZX0gdXBkYXRlZDogJHt1cGRhdGUuZnJvbX0gPT4gJHt1cGRhdGUudG99YC5ncmVlblxuICAgICAgKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBbZSwgZXJyXSBvZiBfLnRvUGFpcnMoZXJyb3JzKSkge1xuICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIE5vdFVwZGF0YWJsZUVycm9yKSB7XG4gICAgICAgIGxvZyhcbiAgICAgICAgICB0aGlzLmlzSnNvbk91dHB1dCxcbiAgICAgICAgICBgLSAnJHtlfScgd2FzIG5vdCBpbnN0YWxsZWQgdmlhIG5wbSwgc28gd2UgY291bGQgbm90IGNoZWNrIGAgK1xuICAgICAgICAgICAgYGZvciB1cGRhdGVzYC55ZWxsb3dcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSBpZiAoZXJyIGluc3RhbmNlb2YgTm9VcGRhdGVzQXZhaWxhYmxlRXJyb3IpIHtcbiAgICAgICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCBgLSAnJHtlfScgaGFkIG5vIHVwZGF0ZXMgYXZhaWxhYmxlYC55ZWxsb3cpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gb3RoZXJ3aXNlLCBtYWtlIGl0IHBvcCB3aXRoIHJlZCFcbiAgICAgICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCBgLSAnJHtlfScgZmFpbGVkIHRvIHVwZGF0ZTogJHtlcnJ9YC5yZWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7dXBkYXRlcywgZXJyb3JzfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHaXZlbiBhbiBleHRlbnNpb24gbmFtZSwgZmlndXJlIG91dCB3aGF0IGl0cyBoaWdoZXN0IHBvc3NpYmxlIHZlcnNpb24gdXBncmFkZSBpcywgYW5kIGFsc28gdGhlXG4gICAqIGhpZ2hlc3QgcG9zc2libGUgc2FmZSB1cGdyYWRlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXh0IC0gbmFtZSBvZiBleHRlbnNpb25cbiAgICogQHJldHVybiB7UHJvbWlzZTxQb3NzaWJsZVVwZGF0ZXM+fVxuICAgKi9cbiAgYXN5bmMgY2hlY2tGb3JFeHRlbnNpb25VcGRhdGUgKGV4dCkge1xuICAgIC8vIFRPRE8gZGVjaWRlIGhvdyB3ZSB3YW50IHRvIGhhbmRsZSBiZXRhIHZlcnNpb25zP1xuICAgIC8vIHRoaXMgaXMgYSBoZWxwZXIgbWV0aG9kLCAnZXh0JyBpcyBhc3N1bWVkIHRvIGFscmVhZHkgYmUgaW5zdGFsbGVkIGhlcmUsIGFuZCBvZiB0aGUgbnBtXG4gICAgLy8gaW5zdGFsbCB0eXBlXG4gICAgY29uc3Qge3ZlcnNpb24sIHBrZ05hbWV9ID0gdGhpcy5jb25maWcuaW5zdGFsbGVkRXh0ZW5zaW9uc1tleHRdO1xuICAgIGxldCB1bnNhZmVVcGRhdGUgPSBhd2FpdCBucG0uZ2V0TGF0ZXN0VmVyc2lvbihcbiAgICAgIHRoaXMuY29uZmlnLmFwcGl1bUhvbWUsXG4gICAgICBwa2dOYW1lXG4gICAgKTtcbiAgICBsZXQgc2FmZVVwZGF0ZSA9IGF3YWl0IG5wbS5nZXRMYXRlc3RTYWZlVXBncmFkZVZlcnNpb24oXG4gICAgICB0aGlzLmNvbmZpZy5hcHBpdW1Ib21lLFxuICAgICAgcGtnTmFtZSxcbiAgICAgIHZlcnNpb25cbiAgICApO1xuICAgIGlmICghdXRpbC5jb21wYXJlVmVyc2lvbnModW5zYWZlVXBkYXRlLCAnPicsIHZlcnNpb24pKSB7XG4gICAgICAvLyB0aGUgbGF0ZXN0IHZlcnNpb24gaXMgbm90IGdyZWF0ZXIgdGhhbiB0aGUgY3VycmVudCB2ZXJzaW9uLCBzbyB0aGVyZSdzIG5vIHBvc3NpYmxlIHVwZGF0ZVxuICAgICAgdW5zYWZlVXBkYXRlID0gbnVsbDtcbiAgICAgIHNhZmVVcGRhdGUgPSBudWxsO1xuICAgIH1cbiAgICBpZiAodW5zYWZlVXBkYXRlICYmIHVuc2FmZVVwZGF0ZSA9PT0gc2FmZVVwZGF0ZSkge1xuICAgICAgLy8gdGhlIGxhdGVzdCB1cGRhdGUgaXMgdGhlIHNhbWUgYXMgdGhlIHNhZmUgdXBkYXRlLCB3aGljaCBtZWFucyBpdCdzIG5vdCBhY3R1YWxseSB1bnNhZmVcbiAgICAgIHVuc2FmZVVwZGF0ZSA9IG51bGw7XG4gICAgfVxuICAgIGlmIChzYWZlVXBkYXRlICYmICF1dGlsLmNvbXBhcmVWZXJzaW9ucyhzYWZlVXBkYXRlLCAnPicsIHZlcnNpb24pKSB7XG4gICAgICAvLyBldmVuIHRoZSBzYWZlIHVwZGF0ZSBpcyBub3QgbGF0ZXIgdGhhbiB0aGUgY3VycmVudCwgc28gaXQgaXMgbm90IGFjdHVhbGx5IGFuIHVwZGF0ZVxuICAgICAgc2FmZVVwZGF0ZSA9IG51bGw7XG4gICAgfVxuICAgIHJldHVybiB7Y3VycmVudDogdmVyc2lvbiwgc2FmZVVwZGF0ZSwgdW5zYWZlVXBkYXRlfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBY3R1YWxseSB1cGRhdGUgYW4gZXh0ZW5zaW9uIGluc3RhbGxlZCBieSBOUE0sIHVzaW5nIHRoZSBOUE0gY2xpLiBBbmQgdXBkYXRlIHRoZSBpbnN0YWxsYXRpb25cbiAgICogbWFuaWZlc3QuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBpbnN0YWxsU3BlYyAtIG5hbWUgb2YgZXh0ZW5zaW9uIHRvIHVwZGF0ZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gdmVyc2lvbiAtIHZlcnNpb24gc3RyaW5nIGlkZW50aWZpZXIgdG8gdXBkYXRlIGV4dGVuc2lvbiB0b1xuICAgKiBAcmV0dXJucyB7UHJvbWlzZTx2b2lkPn1cbiAgICovXG4gIGFzeW5jIHVwZGF0ZUV4dGVuc2lvbiAoaW5zdGFsbFNwZWMsIHZlcnNpb24pIHtcbiAgICBjb25zdCB7cGtnTmFtZX0gPSB0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zW2luc3RhbGxTcGVjXTtcbiAgICBhd2FpdCBmcy5yaW1yYWYodGhpcy5jb25maWcuZ2V0SW5zdGFsbFBhdGgoaW5zdGFsbFNwZWMpKTtcbiAgICBjb25zdCBleHREYXRhID0gYXdhaXQgdGhpcy5pbnN0YWxsVmlhTnBtKHtcbiAgICAgIGluc3RhbGxTcGVjLFxuICAgICAgcGtnTmFtZSxcbiAgICAgIHBrZ1ZlcjogdmVyc2lvbixcbiAgICB9KTtcbiAgICBkZWxldGUgZXh0RGF0YVsvKiogQHR5cGUge3N0cmluZ30gKi8gKGAke3RoaXMudHlwZX1OYW1lYCldO1xuICAgIGF3YWl0IHRoaXMuY29uZmlnLnVwZGF0ZUV4dGVuc2lvbihpbnN0YWxsU3BlYywgZXh0RGF0YSk7XG4gIH1cblxuICAvKipcbiAgICogUnVucyBhIHNjcmlwdCBjYWNoZWQgaW5zaWRlIHRoZSBcInNjcmlwdHNcIiBmaWVsZCB1bmRlciBcImFwcGl1bVwiXG4gICAqIGluc2lkZSBvZiB0aGUgZHJpdmVyL3BsdWdpbnMgXCJwYWNrYWdlLmpzb25cIiBmaWxlLiBXaWxsIHRocm93XG4gICAqIGFuIGVycm9yIGlmIHRoZSBkcml2ZXIvcGx1Z2luIGRvZXMgbm90IGNvbnRhaW4gYSBcInNjcmlwdHNcIiBmaWVsZFxuICAgKiB1bmRlcm5lYXRoIHRoZSBcImFwcGl1bVwiIGZpZWxkIGluIGl0cyBwYWNrYWdlLmpzb24sIGlmIHRoZVxuICAgKiBcInNjcmlwdHNcIiBmaWVsZCBpcyBub3QgYSBwbGFpbiBvYmplY3QsIG9yIGlmIHRoZSBzY3JpcHROYW1lIGlzXG4gICAqIG5vdCBmb3VuZCB3aXRoaW4gXCJzY3JpcHRzXCIgb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0ge1J1bk9wdGlvbnN9IG9wdHNcbiAgICogQHJldHVybiB7UHJvbWlzZTxSdW5PdXRwdXQ+fVxuICAgKi9cbiAgYXN5bmMgX3J1biAoe2luc3RhbGxTcGVjLCBzY3JpcHROYW1lfSkge1xuICAgIGlmICghXy5oYXModGhpcy5jb25maWcuaW5zdGFsbGVkRXh0ZW5zaW9ucywgaW5zdGFsbFNwZWMpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYHBsZWFzZSBpbnN0YWxsIHRoZSAke3RoaXMudHlwZX0gZmlyc3RgKTtcbiAgICB9XG5cbiAgICBjb25zdCBleHRDb25maWcgPSB0aGlzLmNvbmZpZy5pbnN0YWxsZWRFeHRlbnNpb25zW2luc3RhbGxTcGVjXTtcblxuICAgIC8vIG5vdGU6IFRTIGNhbm5vdCB1bmRlcnN0YW5kIHRoYXQgXy5oYXMoKSBpcyBhIHR5cGUgZ3VhcmRcbiAgICBpZiAoIWV4dENvbmZpZy5zY3JpcHRzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBUaGUgJHt0aGlzLnR5cGV9IG5hbWVkICcke2luc3RhbGxTcGVjfScgZG9lcyBub3QgY29udGFpbiB0aGUgYCArXG4gICAgICAgICAgYFwic2NyaXB0c1wiIGZpZWxkIHVuZGVybmVhdGggdGhlIFwiYXBwaXVtXCIgZmllbGQgaW4gaXRzIHBhY2thZ2UuanNvbmBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgZXh0U2NyaXB0cyA9IGV4dENvbmZpZy5zY3JpcHRzO1xuXG4gICAgaWYgKCFfLmlzUGxhaW5PYmplY3QoZXh0U2NyaXB0cykpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYFRoZSAke3RoaXMudHlwZX0gbmFtZWQgJyR7aW5zdGFsbFNwZWN9JyBcInNjcmlwdHNcIiBmaWVsZCBtdXN0IGJlIGEgcGxhaW4gb2JqZWN0YFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoIV8uaGFzKGV4dFNjcmlwdHMsIHNjcmlwdE5hbWUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBUaGUgJHt0aGlzLnR5cGV9IG5hbWVkICcke2luc3RhbGxTcGVjfScgZG9lcyBub3Qgc3VwcG9ydCB0aGUgc2NyaXB0OiAnJHtzY3JpcHROYW1lfSdgXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHJ1bm5lciA9IG5ldyBTdWJQcm9jZXNzKHByb2Nlc3MuZXhlY1BhdGgsIFtleHRTY3JpcHRzW3NjcmlwdE5hbWVdXSwge1xuICAgICAgY3dkOiB0aGlzLmNvbmZpZy5nZXRJbnN0YWxsUGF0aChpbnN0YWxsU3BlYyksXG4gICAgfSk7XG5cbiAgICBjb25zdCBvdXRwdXQgPSBuZXcgUmluZ0J1ZmZlcig1MCk7XG5cbiAgICBydW5uZXIub24oJ3N0cmVhbS1saW5lJywgKGxpbmUpID0+IHtcbiAgICAgIG91dHB1dC5lbnF1ZXVlKGxpbmUpO1xuICAgICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCBsaW5lKTtcbiAgICB9KTtcblxuICAgIGF3YWl0IHJ1bm5lci5zdGFydCgwKTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBydW5uZXIuam9pbigpO1xuICAgICAgbG9nKHRoaXMuaXNKc29uT3V0cHV0LCBgJHtzY3JpcHROYW1lfSBzdWNjZXNzZnVsbHkgcmFuYC5ncmVlbik7XG4gICAgICByZXR1cm4ge291dHB1dDogb3V0cHV0LmdldEJ1ZmYoKX07XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2coXG4gICAgICAgIHRoaXMuaXNKc29uT3V0cHV0LFxuICAgICAgICBgRW5jb3VudGVyZWQgYW4gZXJyb3Igd2hlbiBydW5uaW5nICcke3NjcmlwdE5hbWV9JzogJHtlcnIubWVzc2FnZX1gLnJlZFxuICAgICAgKTtcbiAgICAgIHJldHVybiB7ZXJyb3I6IGVyci5tZXNzYWdlLCBvdXRwdXQ6IG91dHB1dC5nZXRCdWZmKCl9O1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBFeHRlbnNpb25Db21tYW5kO1xuZXhwb3J0IHtFeHRlbnNpb25Db21tYW5kfTtcblxuLyoqXG4gKiBPcHRpb25zIGZvciB0aGUge0BsaW5rY29kZSBFeHRlbnNpb25Db21tYW5kfSBjb25zdHJ1Y3RvclxuICogQHRlbXBsYXRlIHtFeHRlbnNpb25UeXBlfSBFeHRUeXBlXG4gKiBAdHlwZWRlZiBFeHRlbnNpb25Db21tYW5kT3B0aW9uc1xuICogQHByb3BlcnR5IHtFeHRlbnNpb25Db25maWc8RXh0VHlwZT59IGNvbmZpZyAtIHRoZSBgRHJpdmVyQ29uZmlnYCBvciBgUGx1Z2luQ29uZmlnYCBpbnN0YW5jZSB1c2VkIGZvciB0aGlzIGNvbW1hbmRcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0ganNvbiAtIHdoZXRoZXIgdGhlIG91dHB1dCBvZiB0aGlzIGNvbW1hbmQgc2hvdWxkIGJlIEpTT04gb3IgdGV4dFxuICovXG5cbi8qKlxuICogRXh0cmEgc3R1ZmYgYWJvdXQgZXh0ZW5zaW9uczsgdXNlZCBpbmRpcmVjdGx5IGJ5IHtAbGlua2NvZGUgRXh0ZW5zaW9uQ29tbWFuZC5saXN0fS5cbiAqXG4gKiBAdHlwZWRlZiBFeHRlbnNpb25NZXRhZGF0YVxuICogQHByb3BlcnR5IHtib29sZWFufSBpbnN0YWxsZWQgLSBJZiBgdHJ1ZWAsIHRoZSBleHRlbnNpb24gaXMgaW5zdGFsbGVkXG4gKiBAcHJvcGVydHkge3N0cmluZz99IHVwZGF0ZVZlcnNpb24gLSBJZiB0aGUgZXh0ZW5zaW9uIGlzIGluc3RhbGxlZCwgdGhlIHZlcnNpb24gaXQgY2FuIGJlIHVwZGF0ZWQgdG9cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nP30gdW5zYWZlVXBkYXRlVmVyc2lvbiAtIFNhbWUgYXMgYWJvdmUsIGJ1dCBhIG1ham9yIHZlcnNpb24gYnVtcFxuICogQHByb3BlcnR5IHtib29sZWFufSB1cFRvRGF0ZSAtIElmIHRoZSBleHRlbnNpb24gaXMgaW5zdGFsbGVkIGFuZCB0aGUgbGF0ZXN0XG4gKi9cblxuLyoqXG4gKiBAdHlwZWRlZiB7aW1wb3J0KCcuLi8uLi90eXBlcycpLkV4dGVuc2lvblR5cGV9IEV4dGVuc2lvblR5cGVcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uL3R5cGVzJykuRHJpdmVyVHlwZX0gRHJpdmVyVHlwZVxuICogQHR5cGVkZWYge2ltcG9ydCgnLi4vLi4vdHlwZXMnKS5QbHVnaW5UeXBlfSBQbHVnaW5UeXBlXG4gKi9cblxuLyoqXG4gKiBAdGVtcGxhdGUge0V4dGVuc2lvblR5cGV9IEV4dFR5cGVcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uL3R5cGVzL2FwcGl1bS1tYW5pZmVzdCcpLkV4dFJlY29yZDxFeHRUeXBlPn0gRXh0UmVjb3JkXG4gKi9cblxuLyoqXG4gKiBAdGVtcGxhdGUge0V4dGVuc2lvblR5cGV9IEV4dFR5cGVcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJy4uL2V4dGVuc2lvbi9leHRlbnNpb24tY29uZmlnJykuRXh0ZW5zaW9uQ29uZmlnPEV4dFR5cGU+fSBFeHRlbnNpb25Db25maWdcbiAqL1xuXG4vKipcbiAqIEB0ZW1wbGF0ZSB7RXh0ZW5zaW9uVHlwZX0gRXh0VHlwZVxuICogQHR5cGVkZWYge2ltcG9ydCgnLi4vLi4vdHlwZXMvZXh0ZXJuYWwtbWFuaWZlc3QnKS5FeHRNZXRhZGF0YTxFeHRUeXBlPn0gRXh0TWV0YWRhdGFcbiAqL1xuXG4vKipcbiAqIEB0ZW1wbGF0ZSB7RXh0ZW5zaW9uVHlwZX0gRXh0VHlwZVxuICogQHR5cGVkZWYge2ltcG9ydCgnLi4vLi4vdHlwZXMvYXBwaXVtLW1hbmlmZXN0JykuRXh0TWFuaWZlc3Q8RXh0VHlwZT59IEV4dE1hbmlmZXN0XG4gKi9cblxuLyoqXG4gKiBAdGVtcGxhdGUge0V4dGVuc2lvblR5cGV9IEV4dFR5cGVcbiAqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uL3R5cGVzL2V4dGVybmFsLW1hbmlmZXN0JykuRXh0UGFja2FnZUpzb248RXh0VHlwZT59IEV4dFBhY2thZ2VKc29uXG4gKi9cblxuLyoqXG4gKiBQb3NzaWJsZSByZXR1cm4gdmFsdWUgZm9yIHtAbGlua2NvZGUgRXh0ZW5zaW9uQ29tbWFuZC5saXN0fVxuICogQHR5cGVkZWYgVW5pbnN0YWxsZWRFeHRlbnNpb25MaXN0RGF0YVxuICogQHByb3BlcnR5IHtzdHJpbmd9IHBrZ05hbWVcbiAqIEBwcm9wZXJ0eSB7ZmFsc2V9IGluc3RhbGxlZFxuICovXG5cbi8qKlxuICogUG9zc2libGUgcmV0dXJuIHZhbHVlIGZvciB7QGxpbmtjb2RlIEV4dGVuc2lvbkNvbW1hbmQubGlzdH1cbiAqIEB0eXBlZGVmIHtpbXBvcnQoJy4uLy4uL3R5cGVzL2FwcGl1bS1tYW5pZmVzdCcpLkludGVybmFsTWV0YWRhdGEgJiBFeHRlbnNpb25NZXRhZGF0YX0gSW5zdGFsbGVkRXh0ZW5zaW9uTGlzdERhdGFcbiAqL1xuXG4vKipcbiAqIFJldHVybiB2YWx1ZSBvZiB7QGxpbmtjb2RlIEV4dGVuc2lvbkNvbW1hbmQubGlzdH0uXG4gKiBAdHlwZWRlZiB7UmVjb3JkPHN0cmluZyxJbnN0YWxsZWRFeHRlbnNpb25MaXN0RGF0YXxVbmluc3RhbGxlZEV4dGVuc2lvbkxpc3REYXRhPn0gRXh0ZW5zaW9uTGlzdERhdGFcbiAqL1xuXG4vKipcbiAqIE9wdGlvbnMgZm9yIHtAbGlua2NvZGUgRXh0ZW5zaW9uQ29tbWFuZC5fcnVufS5cbiAqIEB0eXBlZGVmIFJ1bk9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBpbnN0YWxsU3BlYyAtIG5hbWUgb2YgdGhlIGV4dGVuc2lvbiB0byBydW4gYSBzY3JpcHQgZnJvbVxuICogQHByb3BlcnR5IHtzdHJpbmd9IHNjcmlwdE5hbWUgLSBuYW1lIG9mIHRoZSBzY3JpcHQgdG8gcnVuXG4gKi9cblxuLyoqXG4gKiBSZXR1cm4gdmFsdWUgb2Yge0BsaW5rY29kZSBFeHRlbnNpb25Db21tYW5kLl9ydW59XG4gKlxuICogQHR5cGVkZWYgUnVuT3V0cHV0XG4gKiBAcHJvcGVydHkge3N0cmluZ30gW2Vycm9yXSAtIGVycm9yIG1lc3NhZ2UgaWYgc2NyaXB0IHJhbiB1bnN1Y2Nlc3NmdWxseSwgb3RoZXJ3aXNlIHVuZGVmaW5lZFxuICogQHByb3BlcnR5IHtzdHJpbmdbXX0gb3V0cHV0IC0gc2NyaXB0IG91dHB1dFxuICovXG5cbi8qKlxuICogT3B0aW9ucyBmb3Ige0BsaW5rY29kZSBFeHRlbnNpb25Db21tYW5kLl91cGRhdGV9LlxuICogQHR5cGVkZWYgRXh0ZW5zaW9uVXBkYXRlT3B0c1xuICogQHByb3BlcnR5IHtzdHJpbmd9IGluc3RhbGxTcGVjIC0gdGhlIG5hbWUgb2YgdGhlIGV4dGVuc2lvbiB0byB1cGRhdGVcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gdW5zYWZlIC0gaWYgdHJ1ZSwgd2lsbCBwZXJmb3JtIHVuc2FmZSB1cGRhdGVzIHBhc3QgbWFqb3IgcmV2aXNpb24gYm91bmRhcmllc1xuICovXG5cbi8qKlxuICogUmV0dXJuIHZhbHVlIG9mIHtAbGlua2NvZGUgRXh0ZW5zaW9uQ29tbWFuZC5fdXBkYXRlfS5cbiAqIEB0eXBlZGVmIEV4dGVuc2lvblVwZGF0ZVJlc3VsdFxuICogQHByb3BlcnR5IHtSZWNvcmQ8c3RyaW5nLEVycm9yPn0gZXJyb3JzIC0gbWFwIG9mIGV4dCBuYW1lcyB0byBlcnJvciBvYmplY3RzXG4gKiBAcHJvcGVydHkge1JlY29yZDxzdHJpbmcsVXBkYXRlUmVwb3J0Pn0gdXBkYXRlcyAtIG1hcCBvZiBleHQgbmFtZXMgdG8ge0BsaW5rY29kZSBVcGRhdGVSZXBvcnR9c1xuICovXG5cbi8qKlxuICogUGFydCBvZiByZXN1bHQgb2Yge0BsaW5rY29kZSBFeHRlbnNpb25Db21tYW5kLl91cGRhdGV9LlxuICogQHR5cGVkZWYgVXBkYXRlUmVwb3J0XG4gKiBAcHJvcGVydHkge3N0cmluZ30gZnJvbSAtIHZlcnNpb24gdGhlIGV4dGVuc2lvbiB3YXMgdXBkYXRlZCBmcm9tXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdG8gLSB2ZXJzaW9uIHRoZSBleHRlbnNpb24gd2FzIHVwZGF0ZWQgdG9cbiAqL1xuXG4vKipcbiAqIE9wdGlvbnMgZm9yIHtAbGlua2NvZGUgRXh0ZW5zaW9uQ29tbWFuZC5fdW5pbnN0YWxsfS5cbiAqIEB0eXBlZGVmIFVuaW5zdGFsbE9wdHNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBpbnN0YWxsU3BlYyAtIHRoZSBuYW1lIG9yIHNwZWMgb2YgYW4gZXh0ZW5zaW9uIHRvIHVuaW5zdGFsbFxuICovXG5cbi8qKlxuICogVXNlZCBieSB7QGxpbmtjb2RlIEV4dGVuc2lvbkNvbW1hbmQuZ2V0UG9zdEluc3RhbGxUZXh0fVxuICogQHR5cGVkZWYgRXh0ZW5zaW9uQXJnc1xuICogQHByb3BlcnR5IHtzdHJpbmd9IGV4dE5hbWUgLSB0aGUgbmFtZSBvZiBhbiBleHRlbnNpb25cbiAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBleHREYXRhIC0gdGhlIGRhdGEgZm9yIGFuIGluc3RhbGxlZCBleHRlbnNpb25cbiAqL1xuXG4vKipcbiAqIE9wdGlvbnMgZm9yIHtAbGlua2NvZGUgRXh0ZW5zaW9uQ29tbWFuZC5pbnN0YWxsVmlhTnBtfVxuICogQHR5cGVkZWYgSW5zdGFsbFZpYU5wbUFyZ3NcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBpbnN0YWxsU3BlYyAtIHRoZSBuYW1lIG9yIHNwZWMgb2YgYW4gZXh0ZW5zaW9uIHRvIGluc3RhbGxcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwa2dOYW1lIC0gdGhlIE5QTSBwYWNrYWdlIG5hbWUgb2YgdGhlIGV4dGVuc2lvblxuICogQHByb3BlcnR5IHtzdHJpbmd9IFtwa2dWZXJdIC0gdGhlIHNwZWNpZmljIHZlcnNpb24gb2YgdGhlIE5QTSBwYWNrYWdlXG4gKi9cblxuLyoqXG4gKiBPYmplY3QgcmV0dXJuZWQgYnkge0BsaW5rY29kZSBFeHRlbnNpb25Db21tYW5kLmNoZWNrRm9yRXh0ZW5zaW9uVXBkYXRlfVxuICogQHR5cGVkZWYgUG9zc2libGVVcGRhdGVzXG4gKiBAcHJvcGVydHkge3N0cmluZ30gY3VycmVudCAtIGN1cnJlbnQgdmVyc2lvblxuICogQHByb3BlcnR5IHtzdHJpbmc/fSBzYWZlVXBkYXRlIC0gdmVyc2lvbiB3ZSBjYW4gc2FmZWx5IHVwZGF0ZSB0byBpZiBpdCBleGlzdHMsIG9yIG51bGxcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nP30gdW5zYWZlVXBkYXRlIC0gdmVyc2lvbiB3ZSBjYW4gdW5zYWZlbHkgdXBkYXRlIHRvIGlmIGl0IGV4aXN0cywgb3IgbnVsbFxuICovXG5cbi8qKlxuICogT3B0aW9ucyBmb3Ige0BsaW5rY29kZSBFeHRlbnNpb25Db21tYW5kLl9pbnN0YWxsfVxuICogQHR5cGVkZWYgSW5zdGFsbEFyZ3NcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBpbnN0YWxsU3BlYyAtIHRoZSBuYW1lIG9yIHNwZWMgb2YgYW4gZXh0ZW5zaW9uIHRvIGluc3RhbGxcbiAqIEBwcm9wZXJ0eSB7aW1wb3J0KCcuLi8uLi90eXBlcy9hcHBpdW0tbWFuaWZlc3QnKS5JbnN0YWxsVHlwZX0gaW5zdGFsbFR5cGUgLSBob3cgdG8gaW5zdGFsbCB0aGlzIGV4dGVuc2lvbi4gT25lIG9mIHRoZSBJTlNUQUxMX1RZUEVTXG4gKiBAcHJvcGVydHkge3N0cmluZ30gW3BhY2thZ2VOYW1lXSAtIGZvciBnaXQvZ2l0aHViIGluc3RhbGxzLCB0aGUgZXh0ZW5zaW9uIG5vZGUgcGFja2FnZSBuYW1lXG4gKi9cblxuLyoqXG4gKiBSZXR1cm5lZCBieSB7QGxpbmtjb2RlIEV4dGVuc2lvbkNvbW1hbmQuZ2V0RXh0ZW5zaW9uRmllbGRzfVxuICogQHRlbXBsYXRlIHtFeHRlbnNpb25UeXBlfSBFeHRUeXBlXG4gKiBAdHlwZWRlZiB7RXh0TWV0YWRhdGE8RXh0VHlwZT4gJiB7IHBrZ05hbWU6IHN0cmluZywgdmVyc2lvbjogc3RyaW5nIH0gJiBpbXBvcnQoJy4uLy4uL3R5cGVzL2V4dGVybmFsLW1hbmlmZXN0JykuQ29tbW9uTWV0YWRhdGF9IEV4dGVuc2lvbkZpZWxkc1xuICovXG5cbi8qKlxuICogQHRlbXBsYXRlIHtFeHRlbnNpb25UeXBlfSBFeHRUeXBlXG4gKiBAdHlwZWRlZiB7RXh0VHlwZSBleHRlbmRzIERyaXZlclR5cGUgPyB0eXBlb2YgaW1wb3J0KCcuLi9jb25zdGFudHMnKS5LTk9XTl9EUklWRVJTIDogRXh0VHlwZSBleHRlbmRzIFBsdWdpblR5cGUgPyB0eXBlb2YgaW1wb3J0KCcuLi9jb25zdGFudHMnKS5LTk9XTl9QTFVHSU5TIDogbmV2ZXJ9IEtub3duRXh0ZW5zaW9uc1xuICovXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBTUE7O0FBRUEsTUFBTUEsVUFBVSxHQUFHLFdBQW5COztBQUVBLE1BQU1DLGlCQUFOLFNBQWdDQyxLQUFoQyxDQUFzQzs7QUFDdEMsTUFBTUMsdUJBQU4sU0FBc0NELEtBQXRDLENBQTRDOztB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