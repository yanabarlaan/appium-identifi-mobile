"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.read = read;
exports.readSettings = readSettings;
exports.setReduceMotion = setReduceMotion;
exports.stub = stub;
exports.update = update;
exports.updateLocale = updateLocale;
exports.updateLocationSettings = updateLocationSettings;
exports.updateSafariGlobalSettings = updateSafariGlobalSettings;
exports.updateSafariUserSettings = updateSafariUserSettings;
exports.updateSettings = updateSettings;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _support = require("@appium/support");

var _path = _interopRequireDefault(require("path"));

var _logger = _interopRequireDefault(require("./logger"));

var _semver = _interopRequireDefault(require("semver"));

var _bluebird = _interopRequireDefault(require("bluebird"));

async function plistPaths(sim, identifier) {
  let paths = [];
  let simDirectory = sim.getDir();

  switch (identifier) {
    case 'webInspector':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.webInspector.plist'));
      break;

    case 'mobileSafari':
      paths.push(_path.default.resolve(await sim.getAppDir('com.apple.mobilesafari'), 'Library', 'Preferences', 'com.apple.mobilesafari.plist'));
      break;

    case 'globalMobileSafari':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.mobilesafari.plist'));
      break;

    case 'webUI':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.WebUI.plist'));
      break;

    case 'webFoundation':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.WebFoundation.plist'));
      break;

    case 'preferences':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.Preferences.plist'));
      break;

    case 'locationServices':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.locationd.plist'));
      break;

    case 'locationClients':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Caches', 'locationd', 'clients.plist'));
      break;

    case 'locationCache':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Caches', 'locationd', 'cache.plist'));
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.locationd.plist'));
      break;

    case 'userSettings':
      if (_semver.default.lt(_semver.default.coerce(sim.xcodeVersion.versionString), _semver.default.coerce('7.3'))) {
        paths.push(_path.default.resolve(simDirectory, 'Library', 'ConfigurationProfiles', 'UserSettings.plist'));
        paths.push(_path.default.resolve(simDirectory, 'Library', 'ConfigurationProfiles', 'EffectiveUserSettings.plist'));
        paths.push(_path.default.resolve(simDirectory, 'Library', 'ConfigurationProfiles', 'PublicInfo', 'PublicEffectiveUserSettings.plist'));
      } else {
        paths.push(_path.default.resolve(simDirectory, 'Library', 'UserConfigurationProfiles', 'UserSettings.plist'));
        paths.push(_path.default.resolve(simDirectory, 'Library', 'UserConfigurationProfiles', 'EffectiveUserSettings.plist'));
        paths.push(_path.default.resolve(simDirectory, 'Library', 'UserConfigurationProfiles', 'PublicInfo', 'PublicEffectiveUserSettings.plist'));
      }

      break;

    case 'effectiveUserSettings':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'ConfigurationProfiles', 'EffectiveUserSettings.plist'));
      paths.push(_path.default.resolve(simDirectory, 'Library', 'ConfigurationProfiles', 'PublicInfo', 'PublicEffectiveUserSettings.plist'));
      break;

    case 'accessibilitySettings':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.Accessibility.plist'));
      break;

    case 'uiStyleSettings':
      paths.push(_path.default.resolve(simDirectory, 'Library', 'Preferences', 'com.apple.uikitservices.userInterfaceStyleMode.plist'));
      break;
  }

  return paths;
}

async function updateSettings(sim, plist, updates) {
  return await _bluebird.default.reduce(await plistPaths(sim, plist), async function reducer(updated, path) {
    return (await update(path, updates)) || updated;
  }, false);
}

async function update(pathToPlist, updates) {
  const currentSettings = await read(pathToPlist);
  const newSettings = Object.assign({}, currentSettings, updates);

  if (_lodash.default.isEqual(currentSettings, newSettings)) {
    return false;
  }

  await _support.plist.updatePlistFile(pathToPlist, newSettings, true, false);
  return true;
}

async function readSettings(sim, plist) {
  let settings = {};

  for (let path of await plistPaths(sim, plist)) {
    settings[path] = await read(path);
  }

  return settings;
}

async function read(pathToPlist) {
  return await _support.plist.parsePlistFile(pathToPlist, false);
}

async function updateLocationSettings(sim, bundleId, authorized) {
  const newCachePrefs = {
    LastFenceActivityTimestamp: 412122103.232983,
    CleanShutdown: true
  };
  let updated = await updateSettings(sim, 'locationCache', {
    [bundleId]: newCachePrefs
  });
  const newClientPrefs = {
    BundleId: bundleId,
    Authorized: !!authorized,
    Whitelisted: false
  };

  for (const file of await plistPaths(sim, 'locationClients')) {
    _logger.default.debug(`Updating location client file: ${file}`);

    let updates = {};
    const plist = await read(file);
    const weirdLocKey = 'com.apple.locationd.bundle-/System/Library/' + 'PrivateFrameworks/AOSNotification.framework';

    if (!_lodash.default.has(plist, weirdLocKey)) {
      updates[weirdLocKey] = {
        BundlePath: '/System/Library/PrivateFrameworks/AOSNotification.framework',
        Whitelisted: false,
        Executable: '',
        Registered: ''
      };
    }

    const baseSetting = _lodash.default.has(plist, bundleId) ? plist[bundleId] : {};
    updates[bundleId] = _lodash.default.defaults(newClientPrefs, baseSetting);
    updates[bundleId].Executable = updates[bundleId].Executable || '';
    updates[bundleId].Registered = updates[bundleId].Registered || '';
    updated = (await update(file, updates)) || updated;
  }

  return updated;
}

async function setReduceMotion(sim, reduceMotion = true) {
  _logger.default.debug(`Updating reduce motion. Setting to ${reduceMotion}.`);

  const paths = await plistPaths(sim, 'accessibilitySettings');

  for (const file of paths) {
    await update(file, {
      ReduceMotionEnabled: reduceMotion ? 1 : 0
    });
  }
}

async function updateSafariGlobalSettings(sim, settingSet) {
  _logger.default.debug('Updating Safari global settings');

  let updated = false;

  for (const [file, safariSettingSet] of _lodash.default.toPairs(await readSettings(sim, 'globalMobileSafari'))) {
    let newSettings = {};

    for (const [key, value] of _lodash.default.toPairs(settingSet)) {
      if (safariSettingSet[key] !== value) {
        newSettings[key] = value;
      }
    }

    if (_lodash.default.isEmpty(newSettings)) {
      continue;
    }

    updated = (await update(file, newSettings)) || updated;
  }

  return updated;
}

async function updateSafariUserSettings(sim, settingSet) {
  _logger.default.debug('Updating Safari user settings');

  let newUserSettings = {};

  if (_lodash.default.has(settingSet, 'WebKitJavaScriptEnabled')) {
    newUserSettings.safariAllowJavaScript = settingSet.WebKitJavaScriptEnabled;
  }

  if (_lodash.default.has(settingSet, 'WebKitJavaScriptCanOpenWindowsAutomatically')) {
    newUserSettings.safariAllowPopups = settingSet.WebKitJavaScriptCanOpenWindowsAutomatically;
  }

  if (_lodash.default.has(settingSet, 'WarnAboutFraudulentWebsites')) {
    newUserSettings.safariForceFraudWarning = !settingSet.WarnAboutFraudulentWebsites;
  }

  if (_lodash.default.isEmpty(newUserSettings)) {
    return false;
  }

  let updated = false;

  for (const [file, userSettingSet] of _lodash.default.toPairs(await readSettings(sim, 'userSettings'))) {
    if (!_lodash.default.has(userSettingSet, 'restrictedBool')) {
      userSettingSet.restrictedBool = {};
    }

    for (let [key, value] of _lodash.default.toPairs(newUserSettings)) {
      userSettingSet.restrictedBool[key] = {
        value
      };
    }

    updated = (await update(file, userSettingSet)) || updated;
  }

  return updated;
}

async function updateLocale(sim, language, locale, calendarFormat) {
  let globalPrefs = _path.default.resolve(sim.getDir(), 'Library', 'Preferences', '.GlobalPreferences.plist');

  let data = await read(globalPrefs);
  let updates = {};

  if (language) {
    _logger.default.debug(`New language: ${language}`);

    let supportedLangs = data.AppleLanguages || [];

    if (supportedLangs.indexOf(language) !== 0) {
      updates.AppleLanguages = [language].concat(_lodash.default.without(supportedLangs, language));
    }
  }

  if (locale || calendarFormat) {
    let calSplit = '@calendar=';
    let curLocaleAndCal = data.AppleLocale || language || 'en';
    let split = curLocaleAndCal.split(calSplit);
    let curLoc = split[0];

    if (calendarFormat || split[1]) {
      calendarFormat = `${calSplit}${calendarFormat || split[1] || ''}`;
    }

    calendarFormat = calendarFormat || '';
    let newLocaleAndCal = locale ? locale : curLoc;

    if (calendarFormat) {
      newLocaleAndCal = `${newLocaleAndCal}${calendarFormat}`;
    }

    if (newLocaleAndCal !== curLocaleAndCal) {
      _logger.default.debug(`New locale: ${newLocaleAndCal}`);

      updates.AppleLocale = newLocaleAndCal;
    }
  }

  if (_lodash.default.size(updates) === 0) {
    _logger.default.debug('No locale updates necessary.');

    return false;
  }

  _logger.default.debug('Writing new locale plist data');

  await update(globalPrefs, updates);
  return true;
}

async function stub() {
  return await plistPaths;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL3NldHRpbmdzLmpzIiwibmFtZXMiOlsicGxpc3RQYXRocyIsInNpbSIsImlkZW50aWZpZXIiLCJwYXRocyIsInNpbURpcmVjdG9yeSIsImdldERpciIsInB1c2giLCJwYXRoIiwicmVzb2x2ZSIsImdldEFwcERpciIsInNlbXZlciIsImx0IiwiY29lcmNlIiwieGNvZGVWZXJzaW9uIiwidmVyc2lvblN0cmluZyIsInVwZGF0ZVNldHRpbmdzIiwicGxpc3QiLCJ1cGRhdGVzIiwiQiIsInJlZHVjZSIsInJlZHVjZXIiLCJ1cGRhdGVkIiwidXBkYXRlIiwicGF0aFRvUGxpc3QiLCJjdXJyZW50U2V0dGluZ3MiLCJyZWFkIiwibmV3U2V0dGluZ3MiLCJPYmplY3QiLCJhc3NpZ24iLCJfIiwiaXNFcXVhbCIsInVwZGF0ZVBsaXN0RmlsZSIsInJlYWRTZXR0aW5ncyIsInNldHRpbmdzIiwicGFyc2VQbGlzdEZpbGUiLCJ1cGRhdGVMb2NhdGlvblNldHRpbmdzIiwiYnVuZGxlSWQiLCJhdXRob3JpemVkIiwibmV3Q2FjaGVQcmVmcyIsIkxhc3RGZW5jZUFjdGl2aXR5VGltZXN0YW1wIiwiQ2xlYW5TaHV0ZG93biIsIm5ld0NsaWVudFByZWZzIiwiQnVuZGxlSWQiLCJBdXRob3JpemVkIiwiV2hpdGVsaXN0ZWQiLCJmaWxlIiwibG9nIiwiZGVidWciLCJ3ZWlyZExvY0tleSIsImhhcyIsIkJ1bmRsZVBhdGgiLCJFeGVjdXRhYmxlIiwiUmVnaXN0ZXJlZCIsImJhc2VTZXR0aW5nIiwiZGVmYXVsdHMiLCJzZXRSZWR1Y2VNb3Rpb24iLCJyZWR1Y2VNb3Rpb24iLCJSZWR1Y2VNb3Rpb25FbmFibGVkIiwidXBkYXRlU2FmYXJpR2xvYmFsU2V0dGluZ3MiLCJzZXR0aW5nU2V0Iiwic2FmYXJpU2V0dGluZ1NldCIsInRvUGFpcnMiLCJrZXkiLCJ2YWx1ZSIsImlzRW1wdHkiLCJ1cGRhdGVTYWZhcmlVc2VyU2V0dGluZ3MiLCJuZXdVc2VyU2V0dGluZ3MiLCJzYWZhcmlBbGxvd0phdmFTY3JpcHQiLCJXZWJLaXRKYXZhU2NyaXB0RW5hYmxlZCIsInNhZmFyaUFsbG93UG9wdXBzIiwiV2ViS2l0SmF2YVNjcmlwdENhbk9wZW5XaW5kb3dzQXV0b21hdGljYWxseSIsInNhZmFyaUZvcmNlRnJhdWRXYXJuaW5nIiwiV2FybkFib3V0RnJhdWR1bGVudFdlYnNpdGVzIiwidXNlclNldHRpbmdTZXQiLCJyZXN0cmljdGVkQm9vbCIsInVwZGF0ZUxvY2FsZSIsImxhbmd1YWdlIiwibG9jYWxlIiwiY2FsZW5kYXJGb3JtYXQiLCJnbG9iYWxQcmVmcyIsImRhdGEiLCJzdXBwb3J0ZWRMYW5ncyIsIkFwcGxlTGFuZ3VhZ2VzIiwiaW5kZXhPZiIsImNvbmNhdCIsIndpdGhvdXQiLCJjYWxTcGxpdCIsImN1ckxvY2FsZUFuZENhbCIsIkFwcGxlTG9jYWxlIiwic3BsaXQiLCJjdXJMb2MiLCJuZXdMb2NhbGVBbmRDYWwiLCJzaXplIiwic3R1YiJdLCJzb3VyY2VSb290IjoiLi4vLi4iLCJzb3VyY2VzIjpbImxpYi9zZXR0aW5ncy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgcGxpc3QgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBzZW12ZXIgZnJvbSAnc2VtdmVyJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcblxuXG4vLyByZXR1cm5zIHBhdGggdG8gcGxpc3QgYmFzZWQgb24gaWQgZm9yIHBsaXN0LlxuLy8gdGhlc2UgaWRzIGFyZSBhcHBpdW0gdGVybXNcbmFzeW5jIGZ1bmN0aW9uIHBsaXN0UGF0aHMgKHNpbSwgaWRlbnRpZmllcikge1xuICBsZXQgcGF0aHMgPSBbXTtcbiAgbGV0IHNpbURpcmVjdG9yeSA9IHNpbS5nZXREaXIoKTtcblxuICBzd2l0Y2ggKGlkZW50aWZpZXIpIHtcbiAgICBjYXNlICd3ZWJJbnNwZWN0b3InOlxuICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdQcmVmZXJlbmNlcycsICdjb20uYXBwbGUud2ViSW5zcGVjdG9yLnBsaXN0JykpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnbW9iaWxlU2FmYXJpJzpcbiAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKGF3YWl0IHNpbS5nZXRBcHBEaXIoJ2NvbS5hcHBsZS5tb2JpbGVzYWZhcmknKSwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLCAnY29tLmFwcGxlLm1vYmlsZXNhZmFyaS5wbGlzdCcpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2dsb2JhbE1vYmlsZVNhZmFyaSc6XG4gICAgICBwYXRocy5wdXNoKHBhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS5tb2JpbGVzYWZhcmkucGxpc3QnKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICd3ZWJVSSc6XG4gICAgICBwYXRocy5wdXNoKHBhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS5XZWJVSS5wbGlzdCcpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3dlYkZvdW5kYXRpb24nOlxuICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdQcmVmZXJlbmNlcycsICdjb20uYXBwbGUuV2ViRm91bmRhdGlvbi5wbGlzdCcpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3ByZWZlcmVuY2VzJzpcbiAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLCAnY29tLmFwcGxlLlByZWZlcmVuY2VzLnBsaXN0JykpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnbG9jYXRpb25TZXJ2aWNlcyc6XG4gICAgICBwYXRocy5wdXNoKHBhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS5sb2NhdGlvbmQucGxpc3QnKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdsb2NhdGlvbkNsaWVudHMnOlxuICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdDYWNoZXMnLCAnbG9jYXRpb25kJywgJ2NsaWVudHMucGxpc3QnKSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlICdsb2NhdGlvbkNhY2hlJzpcbiAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnQ2FjaGVzJywgJ2xvY2F0aW9uZCcsICdjYWNoZS5wbGlzdCcpKTtcbiAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLCAnY29tLmFwcGxlLmxvY2F0aW9uZC5wbGlzdCcpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ3VzZXJTZXR0aW5ncyc6XG4gICAgICBpZiAoc2VtdmVyLmx0KHNlbXZlci5jb2VyY2Uoc2ltLnhjb2RlVmVyc2lvbi52ZXJzaW9uU3RyaW5nKSwgc2VtdmVyLmNvZXJjZSgnNy4zJykpKSB7XG4gICAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnQ29uZmlndXJhdGlvblByb2ZpbGVzJywgJ1VzZXJTZXR0aW5ncy5wbGlzdCcpKTtcbiAgICAgICAgcGF0aHMucHVzaChwYXRoLnJlc29sdmUoc2ltRGlyZWN0b3J5LCAnTGlicmFyeScsICdDb25maWd1cmF0aW9uUHJvZmlsZXMnLCAnRWZmZWN0aXZlVXNlclNldHRpbmdzLnBsaXN0JykpO1xuICAgICAgICBwYXRocy5wdXNoKHBhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ0NvbmZpZ3VyYXRpb25Qcm9maWxlcycsICdQdWJsaWNJbmZvJywgJ1B1YmxpY0VmZmVjdGl2ZVVzZXJTZXR0aW5ncy5wbGlzdCcpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnVXNlckNvbmZpZ3VyYXRpb25Qcm9maWxlcycsICdVc2VyU2V0dGluZ3MucGxpc3QnKSk7XG4gICAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnVXNlckNvbmZpZ3VyYXRpb25Qcm9maWxlcycsICdFZmZlY3RpdmVVc2VyU2V0dGluZ3MucGxpc3QnKSk7XG4gICAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnVXNlckNvbmZpZ3VyYXRpb25Qcm9maWxlcycsICdQdWJsaWNJbmZvJywgJ1B1YmxpY0VmZmVjdGl2ZVVzZXJTZXR0aW5ncy5wbGlzdCcpKTtcbiAgICAgIH1cbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2VmZmVjdGl2ZVVzZXJTZXR0aW5ncyc6XG4gICAgICBwYXRocy5wdXNoKHBhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ0NvbmZpZ3VyYXRpb25Qcm9maWxlcycsICdFZmZlY3RpdmVVc2VyU2V0dGluZ3MucGxpc3QnKSk7XG4gICAgICBwYXRocy5wdXNoKHBhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ0NvbmZpZ3VyYXRpb25Qcm9maWxlcycsICdQdWJsaWNJbmZvJywgJ1B1YmxpY0VmZmVjdGl2ZVVzZXJTZXR0aW5ncy5wbGlzdCcpKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2FjY2Vzc2liaWxpdHlTZXR0aW5ncyc6XG4gICAgICBwYXRocy5wdXNoKHBhdGgucmVzb2x2ZShzaW1EaXJlY3RvcnksICdMaWJyYXJ5JywgJ1ByZWZlcmVuY2VzJywgJ2NvbS5hcHBsZS5BY2Nlc3NpYmlsaXR5LnBsaXN0JykpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAndWlTdHlsZVNldHRpbmdzJzpcbiAgICAgIHBhdGhzLnB1c2gocGF0aC5yZXNvbHZlKHNpbURpcmVjdG9yeSwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLCAnY29tLmFwcGxlLnVpa2l0c2VydmljZXMudXNlckludGVyZmFjZVN0eWxlTW9kZS5wbGlzdCcpKTtcbiAgICAgIGJyZWFrO1xuICB9XG5cbiAgcmV0dXJuIHBhdGhzO1xufVxuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVTZXR0aW5ncyAoc2ltLCBwbGlzdCwgdXBkYXRlcykge1xuICByZXR1cm4gYXdhaXQgQi5yZWR1Y2UoYXdhaXQgcGxpc3RQYXRocyhzaW0sIHBsaXN0KSwgYXN5bmMgZnVuY3Rpb24gcmVkdWNlciAodXBkYXRlZCwgcGF0aCkge1xuICAgIHJldHVybiBhd2FpdCB1cGRhdGUocGF0aCwgdXBkYXRlcykgfHwgdXBkYXRlZDtcbiAgfSwgZmFsc2UpO1xufVxuXG4vLyB1cGRhdGUgYSBwbGlzdCBmaWxlLCBsb2NhdGVkIGF0IHBhdGhUb1BsaXN0XG4vLyBwYXNzIGluIGFuIG9iamVjdCwgYWxsIHNldHRpbmdzIHNwZWNpZmllZCBpbiB0aGUgb2JqZWN0IHdpbGwgYmVcbi8vIHVwZGF0ZWQgb24gdGhlIHBsaXN0LCBhbGwgb3RoZXJzIGxlZnQgYXMtaXNcbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZSAocGF0aFRvUGxpc3QsIHVwZGF0ZXMpIHtcbiAgY29uc3QgY3VycmVudFNldHRpbmdzID0gYXdhaXQgcmVhZChwYXRoVG9QbGlzdCk7XG4gIGNvbnN0IG5ld1NldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgY3VycmVudFNldHRpbmdzLCB1cGRhdGVzKTtcblxuICBpZiAoXy5pc0VxdWFsKGN1cnJlbnRTZXR0aW5ncywgbmV3U2V0dGluZ3MpKSB7XG4gICAgLy8gbm8gc2V0dGluZyBjaGFuZ2VzLCBzbyBkbyBub3RoaW5nXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgYXdhaXQgcGxpc3QudXBkYXRlUGxpc3RGaWxlKHBhdGhUb1BsaXN0LCBuZXdTZXR0aW5ncywgdHJ1ZSwgZmFsc2UpO1xuICByZXR1cm4gdHJ1ZTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVhZFNldHRpbmdzIChzaW0sIHBsaXN0KSB7XG4gIGxldCBzZXR0aW5ncyA9IHt9O1xuICBmb3IgKGxldCBwYXRoIG9mIGF3YWl0IHBsaXN0UGF0aHMoc2ltLCBwbGlzdCkpIHtcbiAgICBzZXR0aW5nc1twYXRoXSA9IGF3YWl0IHJlYWQocGF0aCk7XG4gIH1cbiAgcmV0dXJuIHNldHRpbmdzO1xufVxuXG5hc3luYyBmdW5jdGlvbiByZWFkIChwYXRoVG9QbGlzdCkge1xuICByZXR1cm4gYXdhaXQgcGxpc3QucGFyc2VQbGlzdEZpbGUocGF0aFRvUGxpc3QsIGZhbHNlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlTG9jYXRpb25TZXR0aW5ncyAoc2ltLCBidW5kbGVJZCwgYXV0aG9yaXplZCkge1xuICAvLyB1cGRhdGUgbG9jYXRpb24gY2FjaGVcbiAgY29uc3QgbmV3Q2FjaGVQcmVmcyA9IHtcbiAgICBMYXN0RmVuY2VBY3Rpdml0eVRpbWVzdGFtcDogNDEyMTIyMTAzLjIzMjk4MyxcbiAgICBDbGVhblNodXRkb3duOiB0cnVlXG4gIH07XG4gIGxldCB1cGRhdGVkID0gYXdhaXQgdXBkYXRlU2V0dGluZ3Moc2ltLCAnbG9jYXRpb25DYWNoZScsIHtbYnVuZGxlSWRdOiBuZXdDYWNoZVByZWZzfSk7XG5cbiAgLy8gdXBkYXRlIGxvY2F0aW9uIGNsaWVudHNcbiAgY29uc3QgbmV3Q2xpZW50UHJlZnMgPSB7XG4gICAgQnVuZGxlSWQ6IGJ1bmRsZUlkLFxuICAgIEF1dGhvcml6ZWQ6ICEhYXV0aG9yaXplZCxcbiAgICBXaGl0ZWxpc3RlZDogZmFsc2UsXG4gIH07XG4gIGZvciAoY29uc3QgZmlsZSBvZiBhd2FpdCBwbGlzdFBhdGhzKHNpbSwgJ2xvY2F0aW9uQ2xpZW50cycpKSB7XG4gICAgbG9nLmRlYnVnKGBVcGRhdGluZyBsb2NhdGlvbiBjbGllbnQgZmlsZTogJHtmaWxlfWApO1xuXG4gICAgbGV0IHVwZGF0ZXMgPSB7fTtcblxuICAgIC8vIHNlZSBpZiB0aGUgYnVuZGxlIGlzIGFscmVhZHkgdGhlcmVcbiAgICBjb25zdCBwbGlzdCA9IGF3YWl0IHJlYWQoZmlsZSk7XG5cbiAgICAvLyByYW5kb20gZGF0YSB0aGF0IGFsd2F5cyBzZWVtcyB0byBiZSBpbiB0aGUgY2xpZW50cy5wbGlzdFxuICAgIGNvbnN0IHdlaXJkTG9jS2V5ID0gJ2NvbS5hcHBsZS5sb2NhdGlvbmQuYnVuZGxlLS9TeXN0ZW0vTGlicmFyeS8nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICdQcml2YXRlRnJhbWV3b3Jrcy9BT1NOb3RpZmljYXRpb24uZnJhbWV3b3JrJztcbiAgICBpZiAoIV8uaGFzKHBsaXN0LCB3ZWlyZExvY0tleSkpIHtcbiAgICAgIHVwZGF0ZXNbd2VpcmRMb2NLZXldID0ge1xuICAgICAgICBCdW5kbGVQYXRoOiAnL1N5c3RlbS9MaWJyYXJ5L1ByaXZhdGVGcmFtZXdvcmtzL0FPU05vdGlmaWNhdGlvbi5mcmFtZXdvcmsnLFxuICAgICAgICBXaGl0ZWxpc3RlZDogZmFsc2UsXG4gICAgICAgIEV4ZWN1dGFibGU6ICcnLFxuICAgICAgICBSZWdpc3RlcmVkOiAnJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgdGhlIHVwZGF0ZSwgYW5kIG1ha2Ugc3VyZSBpdCBoYXMgc2Vuc2libGUgdmFsdWVzXG4gICAgY29uc3QgYmFzZVNldHRpbmcgPSBfLmhhcyhwbGlzdCwgYnVuZGxlSWQpID8gcGxpc3RbYnVuZGxlSWRdIDoge307XG4gICAgdXBkYXRlc1tidW5kbGVJZF0gPSBfLmRlZmF1bHRzKG5ld0NsaWVudFByZWZzLCBiYXNlU2V0dGluZyk7XG4gICAgdXBkYXRlc1tidW5kbGVJZF0uRXhlY3V0YWJsZSA9IHVwZGF0ZXNbYnVuZGxlSWRdLkV4ZWN1dGFibGUgfHwgJyc7XG4gICAgdXBkYXRlc1tidW5kbGVJZF0uUmVnaXN0ZXJlZCA9IHVwZGF0ZXNbYnVuZGxlSWRdLlJlZ2lzdGVyZWQgfHwgJyc7XG5cbiAgICB1cGRhdGVkID0gYXdhaXQgdXBkYXRlKGZpbGUsIHVwZGF0ZXMpIHx8IHVwZGF0ZWQ7XG4gIH1cblxuICByZXR1cm4gdXBkYXRlZDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2V0UmVkdWNlTW90aW9uIChzaW0sIHJlZHVjZU1vdGlvbiA9IHRydWUpIHtcbiAgbG9nLmRlYnVnKGBVcGRhdGluZyByZWR1Y2UgbW90aW9uLiBTZXR0aW5nIHRvICR7cmVkdWNlTW90aW9ufS5gKTtcbiAgY29uc3QgcGF0aHMgPSBhd2FpdCBwbGlzdFBhdGhzKHNpbSwgJ2FjY2Vzc2liaWxpdHlTZXR0aW5ncycpO1xuICBmb3IgKGNvbnN0IGZpbGUgb2YgcGF0aHMpIHtcbiAgICBhd2FpdCB1cGRhdGUoZmlsZSwge1xuICAgICAgUmVkdWNlTW90aW9uRW5hYmxlZDogcmVkdWNlTW90aW9uID8gMSA6IDBcbiAgICB9KTtcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVTYWZhcmlHbG9iYWxTZXR0aW5ncyAoc2ltLCBzZXR0aW5nU2V0KSB7XG4gIGxvZy5kZWJ1ZygnVXBkYXRpbmcgU2FmYXJpIGdsb2JhbCBzZXR0aW5ncycpO1xuXG4gIGxldCB1cGRhdGVkID0gZmFsc2U7XG4gIGZvciAoY29uc3QgW2ZpbGUsIHNhZmFyaVNldHRpbmdTZXRdIG9mIF8udG9QYWlycyhhd2FpdCByZWFkU2V0dGluZ3Moc2ltLCAnZ2xvYmFsTW9iaWxlU2FmYXJpJykpKSB7XG4gICAgbGV0IG5ld1NldHRpbmdzID0ge307XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgXy50b1BhaXJzKHNldHRpbmdTZXQpKSB7XG4gICAgICBpZiAoc2FmYXJpU2V0dGluZ1NldFtrZXldICE9PSB2YWx1ZSkge1xuICAgICAgICBuZXdTZXR0aW5nc1trZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChfLmlzRW1wdHkobmV3U2V0dGluZ3MpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICB1cGRhdGVkID0gYXdhaXQgdXBkYXRlKGZpbGUsIG5ld1NldHRpbmdzKSB8fCB1cGRhdGVkO1xuICB9XG4gIHJldHVybiB1cGRhdGVkO1xufVxuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVTYWZhcmlVc2VyU2V0dGluZ3MgKHNpbSwgc2V0dGluZ1NldCkge1xuICBsb2cuZGVidWcoJ1VwZGF0aW5nIFNhZmFyaSB1c2VyIHNldHRpbmdzJyk7XG5cbiAgLy8gYWRkIGV4dHJhIHN0dWZmIHRvIFVzZXJTZXR0aW5ncy5wbGlzdCBhbmQgRWZmZWN0aXZlVXNlclNldHRpbmdzLnBsaXN0XG4gIGxldCBuZXdVc2VyU2V0dGluZ3MgPSB7fTtcbiAgaWYgKF8uaGFzKHNldHRpbmdTZXQsICdXZWJLaXRKYXZhU2NyaXB0RW5hYmxlZCcpKSB7XG4gICAgbmV3VXNlclNldHRpbmdzLnNhZmFyaUFsbG93SmF2YVNjcmlwdCA9IHNldHRpbmdTZXQuV2ViS2l0SmF2YVNjcmlwdEVuYWJsZWQ7XG4gIH1cbiAgaWYgKF8uaGFzKHNldHRpbmdTZXQsICdXZWJLaXRKYXZhU2NyaXB0Q2FuT3BlbldpbmRvd3NBdXRvbWF0aWNhbGx5JykpIHtcbiAgICBuZXdVc2VyU2V0dGluZ3Muc2FmYXJpQWxsb3dQb3B1cHMgPSBzZXR0aW5nU2V0LldlYktpdEphdmFTY3JpcHRDYW5PcGVuV2luZG93c0F1dG9tYXRpY2FsbHk7XG4gIH1cbiAgaWYgKF8uaGFzKHNldHRpbmdTZXQsICdXYXJuQWJvdXRGcmF1ZHVsZW50V2Vic2l0ZXMnKSkge1xuICAgIG5ld1VzZXJTZXR0aW5ncy5zYWZhcmlGb3JjZUZyYXVkV2FybmluZyA9ICFzZXR0aW5nU2V0Lldhcm5BYm91dEZyYXVkdWxlbnRXZWJzaXRlcztcbiAgfVxuXG4gIGlmIChfLmlzRW1wdHkobmV3VXNlclNldHRpbmdzKSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGxldCB1cGRhdGVkID0gZmFsc2U7XG4gIGZvciAoY29uc3QgW2ZpbGUsIHVzZXJTZXR0aW5nU2V0XSBvZiBfLnRvUGFpcnMoYXdhaXQgcmVhZFNldHRpbmdzKHNpbSwgJ3VzZXJTZXR0aW5ncycpKSkge1xuICAgIC8vIHRoZSB1c2VyIHNldHRpbmdzIHBsaXN0IGhhcyB0d28gYnVja2V0cywgb25lIGZvclxuICAgIC8vIGJvb2xlYW4gc2V0dGluZ3MgKGByZXN0cmljdGVkQm9vbGApIGFuZCBvbmUgZm9yXG4gICAgLy8gb3RoZXIgdmFsdWUgc2V0dGluZ3MgKGByZXN0cmljdGVkVmFsdWVgKS4gSW4gZWFjaCwgdGhlIHZhbHVlXG4gICAgLy8gaXMgaW4gYSBgdmFsdWVgIHN1Yi1maWVsZC5cbiAgICBpZiAoIV8uaGFzKHVzZXJTZXR0aW5nU2V0LCAncmVzdHJpY3RlZEJvb2wnKSkge1xuICAgICAgdXNlclNldHRpbmdTZXQucmVzdHJpY3RlZEJvb2wgPSB7fTtcbiAgICB9XG4gICAgZm9yIChsZXQgW2tleSwgdmFsdWVdIG9mIF8udG9QYWlycyhuZXdVc2VyU2V0dGluZ3MpKSB7XG4gICAgICB1c2VyU2V0dGluZ1NldC5yZXN0cmljdGVkQm9vbFtrZXldID0ge3ZhbHVlfTtcbiAgICB9XG5cbiAgICAvLyBhY3R1YWxseSBkbyB0aGUgdXBkYXRlXG4gICAgdXBkYXRlZCA9IGF3YWl0IHVwZGF0ZShmaWxlLCB1c2VyU2V0dGluZ1NldCkgfHwgdXBkYXRlZDtcbiAgfVxuXG4gIHJldHVybiB1cGRhdGVkO1xufVxuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVMb2NhbGUgKHNpbSwgbGFuZ3VhZ2UsIGxvY2FsZSwgY2FsZW5kYXJGb3JtYXQpIHtcbiAgbGV0IGdsb2JhbFByZWZzID0gcGF0aC5yZXNvbHZlKHNpbS5nZXREaXIoKSwgJ0xpYnJhcnknLCAnUHJlZmVyZW5jZXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy5HbG9iYWxQcmVmZXJlbmNlcy5wbGlzdCcpO1xuXG4gIC8vIGdldCB0aGUgY3VycmVudCBkYXRhXG4gIGxldCBkYXRhID0gYXdhaXQgcmVhZChnbG9iYWxQcmVmcyk7XG4gIGxldCB1cGRhdGVzID0ge307XG5cbiAgLy8gaWYgd2UgYXJlIHNldHRpbmcgdGhlIGxhbmd1YWdlLCBhZGQgaXQgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgbGlzdCBvZiBsYW5ndWFnZXNcbiAgaWYgKGxhbmd1YWdlKSB7XG4gICAgbG9nLmRlYnVnKGBOZXcgbGFuZ3VhZ2U6ICR7bGFuZ3VhZ2V9YCk7XG4gICAgbGV0IHN1cHBvcnRlZExhbmdzID0gZGF0YS5BcHBsZUxhbmd1YWdlcyB8fCBbXTtcbiAgICAvLyBpZiB0aGUgbGFuZ3VhZ2UgaXMgZmlyc3QsIHdlIGRvbid0IG5lZWQgdG8gZG8gYW55dGhpbmdcbiAgICBpZiAoc3VwcG9ydGVkTGFuZ3MuaW5kZXhPZihsYW5ndWFnZSkgIT09IDApIHtcbiAgICAgIHVwZGF0ZXMuQXBwbGVMYW5ndWFnZXMgPSBbbGFuZ3VhZ2VdLmNvbmNhdChfLndpdGhvdXQoc3VwcG9ydGVkTGFuZ3MsIGxhbmd1YWdlKSk7XG4gICAgfVxuICB9XG4gIC8vIGlmIHdlIGFyZSBzZXR0aW5nIHRoZSBsb2NhbGUgb3IgY2FsZW5kYXIgZm9ybWF0LCBzZXQgdGhlbSBhcyBhcHByb3ByaWF0ZVxuICBpZiAobG9jYWxlIHx8IGNhbGVuZGFyRm9ybWF0KSB7XG4gICAgbGV0IGNhbFNwbGl0ID0gJ0BjYWxlbmRhcj0nO1xuICAgIGxldCBjdXJMb2NhbGVBbmRDYWwgPSBkYXRhLkFwcGxlTG9jYWxlIHx8IGxhbmd1YWdlIHx8ICdlbic7XG5cbiAgICBsZXQgc3BsaXQgPSBjdXJMb2NhbGVBbmRDYWwuc3BsaXQoY2FsU3BsaXQpO1xuICAgIGxldCBjdXJMb2MgPSBzcGxpdFswXTtcbiAgICBpZiAoY2FsZW5kYXJGb3JtYXQgfHwgc3BsaXRbMV0pIHtcbiAgICAgIGNhbGVuZGFyRm9ybWF0ID0gYCR7Y2FsU3BsaXR9JHtjYWxlbmRhckZvcm1hdCB8fCBzcGxpdFsxXSB8fCAnJ31gO1xuICAgIH1cbiAgICBjYWxlbmRhckZvcm1hdCA9IGNhbGVuZGFyRm9ybWF0IHx8ICcnO1xuICAgIGxldCBuZXdMb2NhbGVBbmRDYWwgPSBsb2NhbGUgPyBsb2NhbGUgOiBjdXJMb2M7XG4gICAgaWYgKGNhbGVuZGFyRm9ybWF0KSB7XG4gICAgICBuZXdMb2NhbGVBbmRDYWwgPSBgJHtuZXdMb2NhbGVBbmRDYWx9JHtjYWxlbmRhckZvcm1hdH1gO1xuICAgIH1cbiAgICAvLyBvbmx5IG5lZWQgdG8gdXBkYXRlIGlmIGl0IGhhcyBjaGFuZ2VkXG4gICAgaWYgKG5ld0xvY2FsZUFuZENhbCAhPT0gY3VyTG9jYWxlQW5kQ2FsKSB7XG4gICAgICBsb2cuZGVidWcoYE5ldyBsb2NhbGU6ICR7bmV3TG9jYWxlQW5kQ2FsfWApO1xuICAgICAgdXBkYXRlcy5BcHBsZUxvY2FsZSA9IG5ld0xvY2FsZUFuZENhbDtcbiAgICB9XG4gIH1cblxuICBpZiAoXy5zaXplKHVwZGF0ZXMpID09PSAwKSB7XG4gICAgbG9nLmRlYnVnKCdObyBsb2NhbGUgdXBkYXRlcyBuZWNlc3NhcnkuJyk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgbG9nLmRlYnVnKCdXcml0aW5nIG5ldyBsb2NhbGUgcGxpc3QgZGF0YScpO1xuICBhd2FpdCB1cGRhdGUoZ2xvYmFsUHJlZnMsIHVwZGF0ZXMpO1xuICByZXR1cm4gdHJ1ZTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc3R1YiAoKSB7XG4gIHJldHVybiBhd2FpdCBwbGlzdFBhdGhzO1xufVxuXG5leHBvcnQge1xuICB1cGRhdGUsIHVwZGF0ZVNldHRpbmdzLCB1cGRhdGVMb2NhdGlvblNldHRpbmdzLCBzZXRSZWR1Y2VNb3Rpb24sXG4gIHVwZGF0ZVNhZmFyaVVzZXJTZXR0aW5ncywgdXBkYXRlU2FmYXJpR2xvYmFsU2V0dGluZ3MsIHVwZGF0ZUxvY2FsZSwgcmVhZCxcbiAgcmVhZFNldHRpbmdzLCBzdHViLFxufTtcbiJdLCJtYXBwaW5ncyI6Ijs7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
