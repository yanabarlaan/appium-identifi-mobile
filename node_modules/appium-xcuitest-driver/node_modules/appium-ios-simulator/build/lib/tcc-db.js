"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _path = _interopRequireDefault(require("path"));

var _support = require("@appium/support");

var _utils = require("./utils");

class TCCDB {
  constructor(xcodeVersion, sharedResourcesDir) {
    this.xcodeVersion = xcodeVersion;
    this.sharedResourcesDir = sharedResourcesDir;
  }

  async getDB() {
    if (this.db) {
      return this.db;
    }

    const tccPath = _path.default.resolve(this.sharedResourcesDir, 'Library', 'TCC');

    if (!(await _support.fs.exists(tccPath))) {
      await (0, _support.mkdirp)(tccPath);
    }

    this.db = _path.default.resolve(tccPath, 'TCC.db');
    await (0, _utils.execSQLiteQuery)(this.db, `CREATE TABLE IF NOT EXISTS access (
      service TEXT NOT NULL DEFAULT '',
      client TEXT NOT NULL DEFAULT '',
      client_type INTEGER,
      allowed INTEGER,
      prompt_count INTEGER,
      csreq BLOB NOT NULL DEFAULT '',
      policy_ID INTEGER,
      PRIMARY KEY(service, client, client_type)
    );`);
    return this.db;
  }

  async execQuery(query, ...params) {
    return await (0, _utils.execSQLiteQuery)(await this.getDB(), query, ...params);
  }

}

var _default = TCCDB;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL3RjYy1kYi5qcyIsIm5hbWVzIjpbIlRDQ0RCIiwiY29uc3RydWN0b3IiLCJ4Y29kZVZlcnNpb24iLCJzaGFyZWRSZXNvdXJjZXNEaXIiLCJnZXREQiIsImRiIiwidGNjUGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiZnMiLCJleGlzdHMiLCJta2RpcnAiLCJleGVjU1FMaXRlUXVlcnkiLCJleGVjUXVlcnkiLCJxdWVyeSIsInBhcmFtcyJdLCJzb3VyY2VSb290IjoiLi4vLi4iLCJzb3VyY2VzIjpbImxpYi90Y2MtZGIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBmcywgbWtkaXJwIH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCB7IGV4ZWNTUUxpdGVRdWVyeSB9IGZyb20gJy4vdXRpbHMnO1xuXG5jbGFzcyBUQ0NEQiB7XG4gIGNvbnN0cnVjdG9yICh4Y29kZVZlcnNpb24sIHNoYXJlZFJlc291cmNlc0Rpcikge1xuICAgIHRoaXMueGNvZGVWZXJzaW9uID0geGNvZGVWZXJzaW9uO1xuICAgIHRoaXMuc2hhcmVkUmVzb3VyY2VzRGlyID0gc2hhcmVkUmVzb3VyY2VzRGlyO1xuICB9XG5cbiAgYXN5bmMgZ2V0REIgKCkge1xuICAgIGlmICh0aGlzLmRiKSB7XG4gICAgICByZXR1cm4gdGhpcy5kYjtcbiAgICB9XG5cbiAgICBjb25zdCB0Y2NQYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMuc2hhcmVkUmVzb3VyY2VzRGlyLCAnTGlicmFyeScsICdUQ0MnKTtcbiAgICBpZiAoIShhd2FpdCBmcy5leGlzdHModGNjUGF0aCkpKSB7XG4gICAgICBhd2FpdCBta2RpcnAodGNjUGF0aCk7XG4gICAgfVxuXG4gICAgdGhpcy5kYiA9IHBhdGgucmVzb2x2ZSh0Y2NQYXRoLCAnVENDLmRiJyk7XG4gICAgYXdhaXQgZXhlY1NRTGl0ZVF1ZXJ5KHRoaXMuZGIsIGBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBhY2Nlc3MgKFxuICAgICAgc2VydmljZSBURVhUIE5PVCBOVUxMIERFRkFVTFQgJycsXG4gICAgICBjbGllbnQgVEVYVCBOT1QgTlVMTCBERUZBVUxUICcnLFxuICAgICAgY2xpZW50X3R5cGUgSU5URUdFUixcbiAgICAgIGFsbG93ZWQgSU5URUdFUixcbiAgICAgIHByb21wdF9jb3VudCBJTlRFR0VSLFxuICAgICAgY3NyZXEgQkxPQiBOT1QgTlVMTCBERUZBVUxUICcnLFxuICAgICAgcG9saWN5X0lEIElOVEVHRVIsXG4gICAgICBQUklNQVJZIEtFWShzZXJ2aWNlLCBjbGllbnQsIGNsaWVudF90eXBlKVxuICAgICk7YCk7XG5cbiAgICByZXR1cm4gdGhpcy5kYjtcbiAgfVxuXG4gIGFzeW5jIGV4ZWNRdWVyeSAocXVlcnksIC4uLnBhcmFtcykge1xuICAgIHJldHVybiBhd2FpdCBleGVjU1FMaXRlUXVlcnkoYXdhaXQgdGhpcy5nZXREQigpLCBxdWVyeSwgLi4ucGFyYW1zKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBUQ0NEQjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxLQUFOLENBQVk7RUFDVkMsV0FBVyxDQUFFQyxZQUFGLEVBQWdCQyxrQkFBaEIsRUFBb0M7SUFDN0MsS0FBS0QsWUFBTCxHQUFvQkEsWUFBcEI7SUFDQSxLQUFLQyxrQkFBTCxHQUEwQkEsa0JBQTFCO0VBQ0Q7O0VBRVUsTUFBTEMsS0FBSyxHQUFJO0lBQ2IsSUFBSSxLQUFLQyxFQUFULEVBQWE7TUFDWCxPQUFPLEtBQUtBLEVBQVo7SUFDRDs7SUFFRCxNQUFNQyxPQUFPLEdBQUdDLGFBQUEsQ0FBS0MsT0FBTCxDQUFhLEtBQUtMLGtCQUFsQixFQUFzQyxTQUF0QyxFQUFpRCxLQUFqRCxDQUFoQjs7SUFDQSxJQUFJLEVBQUUsTUFBTU0sV0FBQSxDQUFHQyxNQUFILENBQVVKLE9BQVYsQ0FBUixDQUFKLEVBQWlDO01BQy9CLE1BQU0sSUFBQUssZUFBQSxFQUFPTCxPQUFQLENBQU47SUFDRDs7SUFFRCxLQUFLRCxFQUFMLEdBQVVFLGFBQUEsQ0FBS0MsT0FBTCxDQUFhRixPQUFiLEVBQXNCLFFBQXRCLENBQVY7SUFDQSxNQUFNLElBQUFNLHNCQUFBLEVBQWdCLEtBQUtQLEVBQXJCLEVBQTBCO0FBQ3BDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQVRVLENBQU47SUFXQSxPQUFPLEtBQUtBLEVBQVo7RUFDRDs7RUFFYyxNQUFUUSxTQUFTLENBQUVDLEtBQUYsRUFBUyxHQUFHQyxNQUFaLEVBQW9CO0lBQ2pDLE9BQU8sTUFBTSxJQUFBSCxzQkFBQSxFQUFnQixNQUFNLEtBQUtSLEtBQUwsRUFBdEIsRUFBb0NVLEtBQXBDLEVBQTJDLEdBQUdDLE1BQTlDLENBQWI7RUFDRDs7QUFqQ1M7O2VBb0NHZixLIn0=
