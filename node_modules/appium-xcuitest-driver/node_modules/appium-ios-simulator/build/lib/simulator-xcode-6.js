"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.SimulatorXcode6 = exports.SPRINGBOARD_BUNDLE_ID = exports.BOOT_COMPLETED_EVENT = void 0;

require("source-map-support/register");

var _path = _interopRequireDefault(require("path"));

var _appiumXcode = _interopRequireWildcard(require("appium-xcode"));

var _logger = _interopRequireDefault(require("./logger"));

var _support = require("@appium/support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _lodash = _interopRequireDefault(require("lodash"));

var _asyncLock = _interopRequireDefault(require("async-lock"));

var _utils = require("./utils.js");

var _asyncbox = require("asyncbox");

var settings = _interopRequireWildcard(require("./settings"));

var _teen_process = require("teen_process");

var _tailUntil = require("./tail-until.js");

var _index = _interopRequireDefault(require("./extensions/index"));

var _events = require("events");

var _calendar = _interopRequireDefault(require("./calendar"));

var _permissions = _interopRequireDefault(require("./permissions"));

var _nodeSimctl = _interopRequireDefault(require("node-simctl"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

const STARTUP_TIMEOUT = 60 * 1000;
const EXTRA_STARTUP_TIME = 2000;
const UI_CLIENT_ACCESS_GUARD = new _asyncLock.default();
const UI_CLIENT_BUNDLE_ID = 'com.apple.iphonesimulator';
const SPRINGBOARD_BUNDLE_ID = 'com.apple.SpringBoard';
exports.SPRINGBOARD_BUNDLE_ID = SPRINGBOARD_BUNDLE_ID;
const BOOT_COMPLETED_EVENT = 'bootCompleted';
exports.BOOT_COMPLETED_EVENT = BOOT_COMPLETED_EVENT;

class SimulatorXcode6 extends _events.EventEmitter {
  constructor(udid, xcodeVersion) {
    super();
    this.udid = String(udid);
    this.simctl = new _nodeSimctl.default({
      udid: this.udid
    });
    this.xcodeVersion = xcodeVersion;
    this._platformVersion = null;
    this.keychainPath = _path.default.resolve(this.getDir(), 'Library', 'Keychains');
    this.simulatorApp = 'iOS Simulator.app';
    this.appDataBundlePaths = {};
    this.isFreshFiles = ['Library/ConfigurationProfiles', 'Library/Cookies', 'Library/Preferences/.GlobalPreferences.plist', 'Library/Preferences/com.apple.springboard.plist', 'var/run/syslog.pid'];
    this.extraStartupTime = EXTRA_STARTUP_TIME;
    this.calendar = new _calendar.default(xcodeVersion, this.getDir());
    this.permissions = new _permissions.default(xcodeVersion, this.getDir(), this.udid);
  }

  get uiClientBundleId() {
    return UI_CLIENT_BUNDLE_ID;
  }

  get devicesSetPath() {
    return this.simctl.devicesSetPath;
  }

  set devicesSetPath(value) {
    this.simctl.devicesSetPath = value;
  }

  async getUIClientPid() {
    let stdout;

    try {
      ({
        stdout
      } = await (0, _teen_process.exec)('pgrep', ['-fn', `${this.simulatorApp}/Contents/MacOS/`]));
    } catch (e) {
      return null;
    }

    if (isNaN(parseInt(stdout, 10))) {
      return null;
    }

    stdout = stdout.trim();

    _logger.default.debug(`Got Simulator UI client PID: ${stdout}`);

    return stdout;
  }

  async isUIClientRunning() {
    return !_lodash.default.isNull(await this.getUIClientPid());
  }

  get startupTimeout() {
    return STARTUP_TIMEOUT;
  }

  async getPlatformVersion() {
    if (!this._platformVersion) {
      let {
        sdk
      } = await this.stat();
      this._platformVersion = sdk;
    }

    return this._platformVersion;
  }

  getRootDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Developer', 'CoreSimulator', 'Devices');
  }

  getDir() {
    return _path.default.resolve(this.getRootDir(), this.udid, 'data');
  }

  getLogDir() {
    let home = process.env.HOME;
    return _path.default.resolve(home, 'Library', 'Logs', 'CoreSimulator', this.udid);
  }

  async installApp(app) {
    return await this.simctl.installApp(app);
  }

  async isAppInstalled(bundleId, appFile = null) {
    let appDirs = await this.getAppDirs(appFile, bundleId);
    return appDirs.length !== 0;
  }

  async getUserInstalledBundleIdsByBundleName(bundleName) {
    const rootUserAppDir = await this.buildBundlePathMap('Bundle');
    const bundleIds = [];

    if (_lodash.default.isEmpty(rootUserAppDir)) {
      return bundleIds;
    }

    for (const [bundleId, userAppDirPath] of Object.entries(rootUserAppDir)) {
      const appFile = (await _support.fs.readdir(userAppDirPath)).find(file => _path.default.extname(file).toLowerCase() === '.app');

      const infoPlistPath = _path.default.resolve(userAppDirPath, appFile, 'Info.plist');

      if (!(await _support.fs.exists(infoPlistPath))) {
        continue;
      }

      try {
        const infoPlist = await _support.plist.parsePlistFile(infoPlistPath, false);

        if (infoPlist.CFBundleName === bundleName) {
          bundleIds.push(bundleId);
        }
      } catch (err) {
        _logger.default.warn(`Failed to read plist ${infoPlistPath}. Original error '${err.message}'`);

        continue;
      }
    }

    _logger.default.debug(`The simulator has '${bundleIds.length}' bundles which have '${bundleName}' as their 'CFBundleName':`);

    for (const bundleId of bundleIds) {
      _logger.default.debug(`    '${bundleId}'`);
    }

    return bundleIds;
  }

  async getAppDir(id, subDir = 'Data') {
    this.appDataBundlePaths[subDir] = this.appDataBundlePaths[subDir] || {};

    if (_lodash.default.isEmpty(this.appDataBundlePaths[subDir]) && !(await this.isFresh())) {
      this.appDataBundlePaths[subDir] = await this.buildBundlePathMap(subDir);
    }

    return this.appDataBundlePaths[subDir][id];
  }

  async buildBundlePathMap(subDir = 'Data') {
    _logger.default.debug('Building bundle path map');

    let applicationList;
    let pathBundlePair;

    if ((await this.getPlatformVersion()) === '7.1') {
      applicationList = _path.default.resolve(this.getDir(), 'Applications');

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let appFiles = await _support.fs.glob(`${dir}/*.app`);
        let bundleId = appFiles[0].match(/.*\/(.*)\.app/)[1];
        return {
          path: dir,
          bundleId
        };
      };
    } else {
      applicationList = _path.default.resolve(this.getDir(), 'Containers', subDir, 'Application');

      let readBundleId = async dir => {
        let plist = _path.default.resolve(dir, '.com.apple.mobile_container_manager.metadata.plist');

        let metadata = await settings.read(plist);
        return metadata.MCMMetadataIdentifier;
      };

      pathBundlePair = async dir => {
        dir = _path.default.resolve(applicationList, dir);
        let bundleId = await readBundleId(dir);
        return {
          path: dir,
          bundleId
        };
      };
    }

    if (!(await _support.fs.exists(applicationList))) {
      _logger.default.warn(`No directory path '${applicationList}'`);

      return {};
    }

    let bundlePathDirs = await _support.fs.readdir(applicationList);
    let bundlePathPairs = await (0, _asyncbox.asyncmap)(bundlePathDirs, async function (dir) {
      return await pathBundlePair(dir);
    }, false);
    return bundlePathPairs.reduce((bundleMap, bundlePath) => {
      bundleMap[bundlePath.bundleId] = bundlePath.path;
      return bundleMap;
    }, {});
  }

  async stat() {
    for (let [sdk, deviceArr] of _lodash.default.toPairs(await this.simctl.getDevices())) {
      for (let device of deviceArr) {
        if (device.udid === this.udid) {
          device.sdk = sdk;
          return device;
        }
      }
    }

    return {};
  }

  async isFresh() {
    let files = this.isFreshFiles;
    let pv = await this.getPlatformVersion();

    if (pv !== '7.1') {
      files.push('Library/Preferences/com.apple.Preferences.plist');
    } else {
      files.push('Applications');
    }

    const dir = this.getDir();
    files = files.map(s => _path.default.resolve(dir, s));
    const existences = await (0, _asyncbox.asyncmap)(files, async f => await _support.fs.hasAccess(f));
    const fresh = _lodash.default.compact(existences).length !== files.length;

    _logger.default.debug(`Checking whether simulator has been run before: ${fresh ? 'no' : 'yes'}`);

    return fresh;
  }

  async isRunning() {
    try {
      await this.simctl.getEnv('dummy');
      return true;
    } catch (e) {
      return false;
    }
  }

  async isShutdown() {
    try {
      await this.simctl.getEnv('dummy');
      return false;
    } catch (e) {
      return _lodash.default.includes(e.stderr, 'Current state: Shutdown');
    }
  }

  async waitForBoot(startupTimeout) {
    let bootedIndicator = await this.getBootedIndicatorString();
    await this.tailLogsUntil(bootedIndicator, startupTimeout);

    _logger.default.debug(`Waiting an extra ${this.extraStartupTime}ms for the simulator to really finish booting`);

    await _bluebird.default.delay(this.extraStartupTime);

    _logger.default.debug('Done waiting extra time for simulator');

    this.emit(BOOT_COMPLETED_EVENT);
  }

  async getBootedIndicatorString() {
    let indicator;
    let platformVersion = await this.getPlatformVersion();

    switch (platformVersion) {
      case '7.1':
      case '8.1':
      case '8.2':
      case '8.3':
      case '8.4':
        indicator = 'profiled: Service starting...';
        break;

      case '9.0':
      case '9.1':
      case '9.2':
      case '9.3':
        indicator = 'System app "com.apple.springboard" finished startup';
        break;

      case '10.0':
        indicator = 'Switching to keyboard';
        break;

      default:
        _logger.default.warn(`No boot indicator case for platform version '${platformVersion}'`);

        indicator = 'no boot indicator string available';
    }

    return indicator;
  }

  async startUIClient(opts = {}) {
    opts = _lodash.default.cloneDeep(opts);

    _lodash.default.defaultsDeep(opts, {
      scaleFactor: null,
      startupTimeout: this.startupTimeout
    });

    const simulatorApp = _path.default.resolve(await (0, _appiumXcode.getPath)(), 'Applications', this.simulatorApp);

    const args = ['-Fn', simulatorApp, '--args', '-CurrentDeviceUDID', this.udid];

    if (opts.scaleFactor) {
      const {
        name
      } = await this.stat();
      const formattedDeviceName = name.replace(/\s+/g, '-');
      const argumentName = `-SimulatorWindowLastScale-com.apple.CoreSimulator.SimDeviceType.${formattedDeviceName}`;
      args.push(argumentName, opts.scaleFactor);
    }

    _logger.default.info(`Starting Simulator UI with command: open ${args.join(' ')}`);

    try {
      await (0, _teen_process.exec)('open', args, {
        timeout: opts.startupTimeout
      });
    } catch (err) {
      if (!(err.stdout || '').includes('-10825') && !(err.stderr || '').includes('-10825')) {
        throw err;
      }

      _logger.default.warn(`Error while opening UI: ${err.stdout || err.stderr}. Continuing`);
    }
  }

  async run(opts = {}) {
    opts = Object.assign({
      startupTimeout: this.startupTimeout
    }, opts);
    const isServerRunning = await this.isRunning();
    const isUIClientRunning = await this.isUIClientRunning();

    if (isServerRunning && isUIClientRunning) {
      _logger.default.info(`Both Simulator with UDID ${this.udid} and the UI client are currently running`);

      return;
    }

    const timer = new _support.timing.Timer().start();

    try {
      await this.shutdown();
    } catch (err) {
      _logger.default.warn(`Error on Simulator shutdown: ${err.message}`);
    }

    await this.startUIClient(opts);
    await this.waitForBoot(opts.startupTimeout);

    _logger.default.info(`Simulator with UDID ${this.udid} booted in ${timer.getDuration().asSeconds.toFixed(3)}s`);
  }

  async clean() {
    await this.endSimulatorDaemon();

    _logger.default.info(`Cleaning simulator ${this.udid}`);

    await this.simctl.eraseDevice(10000);
  }

  async scrubCustomApp(appFile, appBundleId) {
    return await this.cleanCustomApp(appFile, appBundleId, true);
  }

  async cleanCustomApp(appFile, appBundleId, scrub = false) {
    _logger.default.debug(`Cleaning app data files for '${appFile}', '${appBundleId}'`);

    if (!scrub) {
      _logger.default.debug(`Deleting app altogether`);
    }

    let appDirs = await this.getAppDirs(appFile, appBundleId, scrub);

    if (appDirs.length === 0) {
      _logger.default.debug('Could not find app directories to delete. It is probably not installed');

      return;
    }

    let deletePromises = [];

    for (let dir of appDirs) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_support.fs.rimraf(dir));
    }

    if ((await this.getPlatformVersion()) >= 8) {
      let relRmPath = `Library/Preferences/${appBundleId}.plist`;

      let rmPath = _path.default.resolve(this.getRootDir(), relRmPath);

      _logger.default.debug(`Deleting file: '${rmPath}'`);

      deletePromises.push(_support.fs.rimraf(rmPath));
    }

    await _bluebird.default.all(deletePromises);
  }

  async getAppDirs(appFile, appBundleId, scrub = false) {
    let dirs = [];

    if ((await this.getPlatformVersion()) >= 8) {
      let data = await this.getAppDir(appBundleId);
      if (!data) return dirs;
      let bundle = !scrub ? await this.getAppDir(appBundleId, 'Bundle') : undefined;

      for (let src of [data, bundle]) {
        if (src) {
          dirs.push(src);
        }
      }
    } else {
      let data = await this.getAppDir(appFile);

      if (data) {
        dirs.push(data);
      }
    }

    return dirs;
  }

  async launchAndQuit(safari = false, startupTimeout = this.startupTimeout) {
    _logger.default.debug('Attempting to launch and quit the simulator to create the directory structure');

    await this.run({
      startupTimeout
    });

    if (safari) {
      _logger.default.debug('Spawning Safari browser in order to create the necessary file system items');

      await (0, _utils.launchApp)(this.simctl, _utils.MOBILE_SAFARI_BUNDLE_ID);
    }

    try {
      await (0, _asyncbox.retryInterval)(60, 250, async () => {
        if (await this.isFresh()) {
          throw new Error('Simulator files not fully created. Waiting a bit');
        }
      });
    } catch (err) {
      _logger.default.warn(`Timeout waiting for simulator files to be created. Continuing`);
    }

    await this.shutdown();
  }

  async endSimulatorDaemon() {
    _logger.default.debug(`Killing any simulator daemons for ${this.udid}`);

    let launchctlCmd = `launchctl list | grep ${this.udid} | cut -f 3 | xargs -n 1 launchctl`;

    try {
      let stopCmd = `${launchctlCmd} stop`;
      await (0, _teen_process.exec)('bash', ['-c', stopCmd]);
    } catch (err) {
      _logger.default.warn(`Could not stop simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      let removeCmd = `${launchctlCmd} remove`;
      await (0, _teen_process.exec)('bash', ['-c', removeCmd]);
    } catch (err) {
      _logger.default.warn(`Could not remove simulator daemons: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }

    try {
      await (0, _asyncbox.waitForCondition)(async () => {
        let {
          stdout
        } = await (0, _teen_process.exec)('bash', ['-c', `ps -e  | grep ${this.udid} | grep launchd_sim | grep -v bash | grep -v grep | awk {'print$1'}`]);
        return stdout.trim().length === 0;
      }, {
        waitMs: 10000,
        intervalMs: 500
      });
    } catch (err) {
      _logger.default.warn(`Could not end simulator daemon for ${this.udid}: ${err.message}`);

      _logger.default.debug('Carrying on anyway!');
    }
  }

  async shutdown(opts = {}) {
    if (await this.isShutdown()) {
      return;
    }

    await (0, _asyncbox.retryInterval)(5, 500, this.simctl.shutdownDevice.bind(this.simctl));
    const waitMs = parseInt(opts.timeout, 10);

    if (waitMs > 0) {
      try {
        await (0, _asyncbox.waitForCondition)(async () => await this.isShutdown(), {
          waitMs,
          intervalMs: 100
        });
      } catch (err) {
        throw new Error(`Simulator is not in 'Shutdown' state after ${waitMs}ms`);
      }
    }
  }

  async delete() {
    await this.simctl.deleteDevice();
  }

  async updateSettings(plist, updates) {
    return await settings.updateSettings(this, plist, updates);
  }

  async updateLocationSettings(bundleId, authorized) {
    return await settings.updateLocationSettings(this, bundleId, authorized);
  }

  async setReduceMotion(reduceMotion = true) {
    if (await this.isFresh()) {
      await this.launchAndQuit(false, STARTUP_TIMEOUT);
    }

    await settings.setReduceMotion(this, reduceMotion);
  }

  async setAppearance() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to set UI appearance`);
  }

  async getAppearance() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to get UI appearance`);
  }

  async updateSafariSettings(updates) {
    let updated = await settings.updateSafariUserSettings(this, updates);
    return (await settings.updateSettings(this, 'mobileSafari', updates)) || updated;
  }

  async updateSafariGlobalSettings(updates) {
    return await settings.updateSafariGlobalSettings(this, updates);
  }

  async updateLocale(language, locale, calendarFormat) {
    return await settings.updateLocale(this, language, locale, calendarFormat);
  }

  async deleteSafari() {
    _logger.default.debug('Deleting Safari apps from simulator');

    let dirs = [];
    dirs.push(await this.getAppDir(_utils.MOBILE_SAFARI_BUNDLE_ID));
    let pv = await this.getPlatformVersion();

    if (pv >= 8) {
      dirs.push(await this.getAppDir(_utils.MOBILE_SAFARI_BUNDLE_ID, 'Bundle'));
    }

    let deletePromises = [];

    for (let dir of _lodash.default.compact(dirs)) {
      _logger.default.debug(`Deleting directory: '${dir}'`);

      deletePromises.push(_support.fs.rimraf(dir));
    }

    await _bluebird.default.all(deletePromises);
  }

  async cleanSafari(keepPrefs = true) {
    _logger.default.debug('Cleaning mobile safari data files');

    if (await this.isFresh()) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let libraryDir = _path.default.resolve(this.getDir(), 'Library');

    let safariRoot = await this.getAppDir(_utils.MOBILE_SAFARI_BUNDLE_ID);

    if (!safariRoot) {
      _logger.default.info('Could not find Safari support directories to clean out old ' + 'data. Probably there is nothing to clean out');

      return;
    }

    let safariLibraryDir = _path.default.resolve(safariRoot, 'Library');

    let filesToDelete = [`Caches/Snapshots/${_utils.MOBILE_SAFARI_BUNDLE_ID}`, `Caches/${_utils.MOBILE_SAFARI_BUNDLE_ID}/*`, 'Caches/com.apple.WebAppCache/*', 'Caches/com.apple.WebKit.Networking/*', 'Caches/com.apple.WebKit.WebContent/*', 'Image Cache/*', `WebKit/${_utils.MOBILE_SAFARI_BUNDLE_ID}/*`, 'WebKit/GeolocationSites.plist', 'WebKit/LocalStorage/*.*', 'Safari/*', 'Cookies/*.binarycookies', 'Caches/com.apple.UIStatusBar/*', 'Caches/com.apple.keyboards/images/*', 'Caches/com.apple.Safari.SafeBrowsing/*', `../tmp/${_utils.MOBILE_SAFARI_BUNDLE_ID}/*`];
    let deletePromises = [];

    for (let file of filesToDelete) {
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(libraryDir, file)));
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(safariLibraryDir, file)));
    }

    if (!keepPrefs) {
      deletePromises.push(_support.fs.rimraf(_path.default.resolve(safariLibraryDir, 'Preferences/*.plist')));
    }

    await _bluebird.default.all(deletePromises);
  }

  async removeApp(bundleId) {
    await this.simctl.removeApp(bundleId);
  }

  async moveBuiltInApp(appName, appPath, newAppPath) {
    await (0, _utils.safeRimRaf)(newAppPath);
    await _support.fs.copyFile(appPath, newAppPath);

    _logger.default.debug(`Copied '${appName}' to '${newAppPath}'`);

    await _support.fs.rimraf(appPath);

    _logger.default.debug(`Temporarily deleted original app at '${appPath}'`);

    return [newAppPath, appPath];
  }

  async openUrl(url) {
    const SAFARI_BOOTED_INDICATOR = 'MobileSafari[';
    const SAFARI_STARTUP_TIMEOUT = 15 * 1000;
    const EXTRA_STARTUP_TIME = 3 * 1000;

    if (await this.isRunning()) {
      await (0, _asyncbox.retry)(5000, this.simctl.openUrl.bind(this.simctl), url);
      await this.tailLogsUntil(SAFARI_BOOTED_INDICATOR, SAFARI_STARTUP_TIMEOUT);

      _logger.default.debug(`Safari started, waiting ${EXTRA_STARTUP_TIME}ms for it to fully start`);

      await _bluebird.default.delay(EXTRA_STARTUP_TIME);

      _logger.default.debug('Done waiting for Safari');

      return;
    } else {
      throw new Error('Tried to open a url, but the Simulator is not Booted');
    }
  }

  async clearCaches(...folderNames) {
    const cachesRoot = _path.default.resolve(this.getDir(), 'Library', 'Caches');

    if (!(await _support.fs.hasAccess(cachesRoot))) {
      _logger.default.debug(`Caches root at '${cachesRoot}' does not exist or is not accessible. Nothing to do there`);

      return 0;
    }

    let itemsToRemove = folderNames.length ? folderNames : await _support.fs.readdir(cachesRoot);
    itemsToRemove = itemsToRemove.map(x => _path.default.resolve(cachesRoot, x));

    if (folderNames.length) {
      itemsToRemove = await _bluebird.default.filter(itemsToRemove, x => _support.fs.hasAccess(x));
    }

    itemsToRemove = await _bluebird.default.filter(itemsToRemove, async x => (await _support.fs.stat(x)).isDirectory());

    if (!itemsToRemove.length) {
      _logger.default.debug(`No Simulator cache items for cleanup were matched in '${cachesRoot}'`);

      return 0;
    }

    _logger.default.debug(`Matched ${_support.util.pluralize('simulator cache item', itemsToRemove.length, true)} ` + `for cleanup: ${itemsToRemove}`);

    try {
      await _bluebird.default.all(itemsToRemove, x => _support.fs.rimraf(x));
    } catch (e) {
      _logger.default.warn(`Got an exception while cleaning Simulator caches: ${e.message}`);
    }

    return itemsToRemove.length;
  }

  async tailLogsUntil(bootedIndicator, timeoutMs) {
    let simLog = _path.default.resolve(this.getLogDir(), 'system.log');

    await (0, _asyncbox.retryInterval)(200, 200, async () => {
      let exists = await _support.fs.exists(simLog);

      if (!exists) {
        throw new Error(`Could not find Simulator log: '${simLog}'`);
      }
    });

    _logger.default.info(`Simulator log at '${simLog}'`);

    _logger.default.info(`Tailing simulator logs until we encounter the string "${bootedIndicator}"`);

    _logger.default.info(`We will time out after ${timeoutMs}ms`);

    try {
      await (0, _tailUntil.tailUntil)(simLog, bootedIndicator, timeoutMs);
    } catch (err) {
      _logger.default.debug('Simulator startup timed out. Continuing anyway.');
    }
  }

  async enableCalendarAccess(bundleID) {
    await this.calendar.enableCalendarAccess(bundleID);
  }

  async disableCalendarAccess(bundleID) {
    await this.calendar.disableCalendarAccess(bundleID);
  }

  async hasCalendarAccess(bundleID) {
    return await this.calendar.hasCalendarAccess(bundleID);
  }

  async _activateWindow() {
    const pid = await this.getUIClientPid();

    if (pid) {
      try {
        return await (0, _utils.activateApp)(pid);
      } catch (e) {
        _logger.default.debug(e.stderr || e.message);
      }
    }

    return `
      tell application "System Events"
        tell process "Simulator"
          set frontmost to false
          set frontmost to true
        end tell
      end tell
    `;
  }

  async executeUIClientScript(appleScript) {
    const windowActivationScript = await this._activateWindow();
    const resultScript = `${windowActivationScript ? windowActivationScript + '\n' : ''}${appleScript}`;

    _logger.default.debug(`Executing UI Apple Script on Simulator with UDID ${this.udid}: ${resultScript}`);

    return await UI_CLIENT_ACCESS_GUARD.acquire(this.simulatorApp, async () => {
      try {
        const {
          stdout
        } = await (0, _teen_process.exec)('osascript', ['-e', resultScript]);
        return stdout;
      } catch (err) {
        _logger.default.errorAndThrow(`Could not complete operation. Make sure Simulator UI is running and the parent Appium application (e. g. Appium.app or Terminal.app) ` + `is present in System Preferences > Security & Privacy > Privacy > Accessibility list. If the operation is still unsuccessful then ` + `it is not supported by this Simulator. ` + `Original error: ${err.message}`);
      }
    });
  }

  async isBiometricEnrolled() {
    const output = await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
        end tell
      end tell
    `);

    _logger.default.debug(`Touch ID enrolled state: ${output}`);

    return _lodash.default.isString(output) && output.trim() === 'true';
  }

  async enrollBiometric(isEnabled = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "Touch ID Enrolled" of menu 1 of menu bar item "Hardware" of menu bar 1
          set isChecked to (value of attribute "AXMenuItemMarkChar" of dstMenuItem) is "✓"
          if ${isEnabled ? 'not ' : ''}isChecked then
            click dstMenuItem
          end if
        end tell
      end tell
    `);
  }

  async sendBiometricMatch(shouldMatch = true) {
    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          set dstMenuItem to menu item "${shouldMatch ? 'Matching' : 'Non-matching'}" of menu 1 of menu item "Simulate Finger Touch" of menu 1 of menu bar item "Hardware" of menu bar 1
          click dstMenuItem
        end tell
      end tell
    `);
  }

  async dismissDatabaseAlert(increase = true) {
    let button = increase ? 'Increase' : 'Cancel';

    _logger.default.debug(`Attempting to dismiss database alert with '${button}' button`);

    await this.executeUIClientScript(`
      tell application "System Events"
        tell process "Simulator"
          click button "${button}" of window 1
        end tell
      end tell
    `);
  }

  async backupKeychains() {
    if (!(await _support.fs.exists(this.keychainPath))) {
      return false;
    }

    const backupPath = await _support.tempDir.path({
      prefix: `keychains_backup_${Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1)}`,
      suffix: '.zip'
    });
    const zipArgs = ['-r', backupPath, `${this.keychainPath}${_path.default.sep}`];

    _logger.default.debug(`Creating keychains backup with 'zip ${zipArgs.join(' ')}' command`);

    await (0, _teen_process.exec)('zip', zipArgs);

    if (_lodash.default.isString(this._keychainsBackupPath) && (await _support.fs.exists(this._keychainsBackupPath))) {
      await _support.fs.unlink(this._keychainsBackupPath);
    }

    this._keychainsBackupPath = backupPath;
    return true;
  }

  async restoreKeychains(excludePatterns = []) {
    if (!_lodash.default.isString(this._keychainsBackupPath) || !(await _support.fs.exists(this._keychainsBackupPath))) {
      throw new Error(`The keychains backup archive does not exist. ` + `Are you sure it was created before?`);
    }

    if (_lodash.default.isString(excludePatterns)) {
      excludePatterns = excludePatterns.split(',').map(x => x.trim());
    }

    const isServerRunning = await this.isRunning();
    let plistPath;

    if (isServerRunning) {
      plistPath = _path.default.resolve(await this.getLaunchDaemonsRoot(), 'com.apple.securityd.plist');

      if (!(await _support.fs.exists(plistPath))) {
        throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
      }

      await this.simctl.spawnProcess(['launchctl', 'unload', plistPath]);
    }

    try {
      await _support.fs.rimraf(this.keychainPath);
      await (0, _support.mkdirp)(this.keychainPath);
      const unzipArgs = ['-o', this._keychainsBackupPath, ..._lodash.default.flatMap(excludePatterns.map(x => ['-x', x])), '-d', '/'];

      _logger.default.debug(`Restoring keychains with 'unzip ${unzipArgs.join(' ')}' command`);

      await (0, _teen_process.exec)('unzip', unzipArgs);
      await _support.fs.unlink(this._keychainsBackupPath);
      this._keychainsBackupPath = null;
    } finally {
      if (isServerRunning && plistPath) {
        await this.simctl.spawnProcess(['launchctl', 'load', plistPath]);
      }
    }

    return true;
  }

  async clearKeychains() {
    const plistPath = _path.default.resolve(await this.getLaunchDaemonsRoot(), 'com.apple.securityd.plist');

    if (!(await _support.fs.exists(plistPath))) {
      throw new Error(`Cannot clear keychains because '${plistPath}' does not exist`);
    }

    await this.simctl.spawnProcess(['launchctl', 'unload', plistPath]);

    try {
      if (await _support.fs.exists(this.keychainPath)) {
        await _support.fs.rimraf(this.keychainPath);
        await (0, _support.mkdirp)(this.keychainPath);
      }
    } finally {
      await this.simctl.spawnProcess(['launchctl', 'load', plistPath]);
    }
  }

  async ps() {
    const {
      stdout
    } = await this.simctl.spawnProcess(['launchctl', 'print', 'system']);
    const servicesMatch = /^\s*services\s*=\s*{([^}]+)/m.exec(stdout);

    if (!servicesMatch) {
      _logger.default.debug(stdout);

      throw new Error(`The list of active processes cannot be retrieved`);
    }

    const result = [];
    const pattern = /^\s*(\d+)\s+[\d-]+\s+([\w\-.]+:)?([\w\-.]+)/gm;
    let match;

    while (match = pattern.exec(servicesMatch[1])) {
      result.push({
        pid: parseInt(match[1], 10),
        group: _lodash.default.trimEnd(match[2], ':') || null,
        name: match[3]
      });
    }

    return result;
  }

  async setPermission(bundleId, permission, value) {
    await this.setPermissions(bundleId, {
      [permission]: value
    });
  }

  async setPermissions(bundleId, permissionsMapping) {
    _logger.default.debug(`Setting access for '${bundleId}': ` + JSON.stringify(permissionsMapping, null, 2));

    await this.permissions.setAccess(bundleId, permissionsMapping);
  }

  async getPermission(bundleId, serviceName) {
    const result = await this.permissions.getAccess(bundleId, serviceName);

    _logger.default.debug(`Got ${serviceName} access status for '${bundleId}': ${result}`);

    return result;
  }

  async addCertificate(payload) {
    if (await (0, _utils.hasSSLCert)(payload, this.udid)) {
      _logger.default.info(`SSL certificate '${_lodash.default.truncate(payload, {
        length: 20
      })}' already installed`);

      return false;
    }

    _logger.default.info(`Installing SSL root certificate '${_lodash.default.truncate(payload, {
      length: 20
    })}'`);

    await (0, _utils.installSSLCert)(payload, this.udid);
    return true;
  }

  async pushNotification() {
    throw new Error(`Xcode SDK '${this.xcodeVersion}' is too old to push notifications`);
  }

  async getLaunchDaemonsRoot() {
    const devRoot = await (0, _utils.getDeveloperRoot)();
    return _path.default.resolve(devRoot, 'Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator.sdk/System/Library/LaunchDaemons');
  }

  static async _getDeviceStringPlatformVersion(platformVersion) {
    let reqVersion = platformVersion;

    if (!reqVersion) {
      reqVersion = await _appiumXcode.default.getMaxIOSSDK();

      _logger.default.warn(`No platform version set. Using max SDK version: ${reqVersion}`);

      if (!_lodash.default.isString(reqVersion)) {
        reqVersion = reqVersion % 1 ? String(reqVersion) : `${reqVersion}.0`;
      }
    }

    return reqVersion;
  }

  static async _getDeviceStringVersionString(platformVersion) {
    let reqVersion = await this._getDeviceStringPlatformVersion(platformVersion);
    return `(${reqVersion} Simulator)`;
  }

  static _getDeviceStringConfigFix() {
    return {
      'iPad Simulator (7.1 Simulator)': 'iPad 2 (7.1 Simulator)',
      'iPad Simulator (8.0 Simulator)': 'iPad 2 (8.0 Simulator)',
      'iPad Simulator (8.1 Simulator)': 'iPad 2 (8.1 Simulator)',
      'iPad Simulator (8.2 Simulator)': 'iPad 2 (8.2 Simulator)',
      'iPad Simulator (8.3 Simulator)': 'iPad 2 (8.3 Simulator)',
      'iPad Simulator (8.4 Simulator)': 'iPad 2 (8.4 Simulator)',
      'iPhone Simulator (7.1 Simulator)': 'iPhone 5s (7.1 Simulator)',
      'iPhone Simulator (8.4 Simulator)': 'iPhone 6 (8.4 Simulator)',
      'iPhone Simulator (8.3 Simulator)': 'iPhone 6 (8.3 Simulator)',
      'iPhone Simulator (8.2 Simulator)': 'iPhone 6 (8.2 Simulator)',
      'iPhone Simulator (8.1 Simulator)': 'iPhone 6 (8.1 Simulator)',
      'iPhone Simulator (8.0 Simulator)': 'iPhone 6 (8.0 Simulator)'
    };
  }

  static async getDeviceString(opts) {
    opts = Object.assign({}, {
      deviceName: null,
      platformVersion: null,
      forceIphone: false,
      forceIpad: false
    }, opts);
    let logOpts = {
      deviceName: opts.deviceName,
      platformVersion: opts.platformVersion,
      forceIphone: opts.forceIphone,
      forceIpad: opts.forceIpad
    };

    _logger.default.debug(`Getting device string from options: ${JSON.stringify(logOpts)}`);

    if ((opts.deviceName || '')[0] === '=') {
      return opts.deviceName.substring(1);
    }

    let isiPhone = !!opts.forceIphone || !opts.forceIpad;

    if (opts.deviceName) {
      let device = opts.deviceName.toLowerCase();

      if (device.indexOf('iphone') !== -1) {
        isiPhone = true;
      } else if (device.indexOf('ipad') !== -1) {
        isiPhone = false;
      }
    }

    let iosDeviceString = opts.deviceName || (isiPhone ? 'iPhone Simulator' : 'iPad Simulator');

    if (/^(iPhone|iPad)$/.test(iosDeviceString)) {
      iosDeviceString += ' Simulator';
    }

    if (/[^(iPhone|iPad)] Simulator/.test(iosDeviceString)) {
      iosDeviceString = iosDeviceString.replace(' Simulator', '');
    }

    iosDeviceString += ` ${await this._getDeviceStringVersionString(opts.platformVersion)}`;

    let CONFIG_FIX = this._getDeviceStringConfigFix();

    let configFix = CONFIG_FIX;

    if (configFix[iosDeviceString]) {
      iosDeviceString = configFix[iosDeviceString];

      _logger.default.debug(`Fixing device. Changed from '${opts.deviceName}' ` + `to '${iosDeviceString}'`);
    }

    _logger.default.debug(`Final device string is '${iosDeviceString}'`);

    return iosDeviceString;
  }

  async getWebInspectorSocket() {
    return null;
  }

}

exports.SimulatorXcode6 = SimulatorXcode6;

for (let [cmd, fn] of _lodash.default.toPairs(_index.default)) {
  SimulatorXcode6.prototype[cmd] = fn;
}

var _default = SimulatorXcode6;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL3NpbXVsYXRvci14Y29kZS02LmpzIiwibmFtZXMiOlsiU1RBUlRVUF9USU1FT1VUIiwiRVhUUkFfU1RBUlRVUF9USU1FIiwiVUlfQ0xJRU5UX0FDQ0VTU19HVUFSRCIsIkFzeW5jTG9jayIsIlVJX0NMSUVOVF9CVU5ETEVfSUQiLCJTUFJJTkdCT0FSRF9CVU5ETEVfSUQiLCJCT09UX0NPTVBMRVRFRF9FVkVOVCIsIlNpbXVsYXRvclhjb2RlNiIsIkV2ZW50RW1pdHRlciIsImNvbnN0cnVjdG9yIiwidWRpZCIsInhjb2RlVmVyc2lvbiIsIlN0cmluZyIsInNpbWN0bCIsIlNpbWN0bCIsIl9wbGF0Zm9ybVZlcnNpb24iLCJrZXljaGFpblBhdGgiLCJwYXRoIiwicmVzb2x2ZSIsImdldERpciIsInNpbXVsYXRvckFwcCIsImFwcERhdGFCdW5kbGVQYXRocyIsImlzRnJlc2hGaWxlcyIsImV4dHJhU3RhcnR1cFRpbWUiLCJjYWxlbmRhciIsIkNhbGVuZGFyIiwicGVybWlzc2lvbnMiLCJQZXJtaXNzaW9ucyIsInVpQ2xpZW50QnVuZGxlSWQiLCJkZXZpY2VzU2V0UGF0aCIsInZhbHVlIiwiZ2V0VUlDbGllbnRQaWQiLCJzdGRvdXQiLCJleGVjIiwiZSIsImlzTmFOIiwicGFyc2VJbnQiLCJ0cmltIiwibG9nIiwiZGVidWciLCJpc1VJQ2xpZW50UnVubmluZyIsIl8iLCJpc051bGwiLCJzdGFydHVwVGltZW91dCIsImdldFBsYXRmb3JtVmVyc2lvbiIsInNkayIsInN0YXQiLCJnZXRSb290RGlyIiwiaG9tZSIsInByb2Nlc3MiLCJlbnYiLCJIT01FIiwiZ2V0TG9nRGlyIiwiaW5zdGFsbEFwcCIsImFwcCIsImlzQXBwSW5zdGFsbGVkIiwiYnVuZGxlSWQiLCJhcHBGaWxlIiwiYXBwRGlycyIsImdldEFwcERpcnMiLCJsZW5ndGgiLCJnZXRVc2VySW5zdGFsbGVkQnVuZGxlSWRzQnlCdW5kbGVOYW1lIiwiYnVuZGxlTmFtZSIsInJvb3RVc2VyQXBwRGlyIiwiYnVpbGRCdW5kbGVQYXRoTWFwIiwiYnVuZGxlSWRzIiwiaXNFbXB0eSIsInVzZXJBcHBEaXJQYXRoIiwiT2JqZWN0IiwiZW50cmllcyIsImZzIiwicmVhZGRpciIsImZpbmQiLCJmaWxlIiwiZXh0bmFtZSIsInRvTG93ZXJDYXNlIiwiaW5mb1BsaXN0UGF0aCIsImV4aXN0cyIsImluZm9QbGlzdCIsInBsaXN0IiwicGFyc2VQbGlzdEZpbGUiLCJDRkJ1bmRsZU5hbWUiLCJwdXNoIiwiZXJyIiwid2FybiIsIm1lc3NhZ2UiLCJnZXRBcHBEaXIiLCJpZCIsInN1YkRpciIsImlzRnJlc2giLCJhcHBsaWNhdGlvbkxpc3QiLCJwYXRoQnVuZGxlUGFpciIsImRpciIsImFwcEZpbGVzIiwiZ2xvYiIsIm1hdGNoIiwicmVhZEJ1bmRsZUlkIiwibWV0YWRhdGEiLCJzZXR0aW5ncyIsInJlYWQiLCJNQ01NZXRhZGF0YUlkZW50aWZpZXIiLCJidW5kbGVQYXRoRGlycyIsImJ1bmRsZVBhdGhQYWlycyIsImFzeW5jbWFwIiwicmVkdWNlIiwiYnVuZGxlTWFwIiwiYnVuZGxlUGF0aCIsImRldmljZUFyciIsInRvUGFpcnMiLCJnZXREZXZpY2VzIiwiZGV2aWNlIiwiZmlsZXMiLCJwdiIsIm1hcCIsInMiLCJleGlzdGVuY2VzIiwiZiIsImhhc0FjY2VzcyIsImZyZXNoIiwiY29tcGFjdCIsImlzUnVubmluZyIsImdldEVudiIsImlzU2h1dGRvd24iLCJpbmNsdWRlcyIsInN0ZGVyciIsIndhaXRGb3JCb290IiwiYm9vdGVkSW5kaWNhdG9yIiwiZ2V0Qm9vdGVkSW5kaWNhdG9yU3RyaW5nIiwidGFpbExvZ3NVbnRpbCIsIkIiLCJkZWxheSIsImVtaXQiLCJpbmRpY2F0b3IiLCJwbGF0Zm9ybVZlcnNpb24iLCJzdGFydFVJQ2xpZW50Iiwib3B0cyIsImNsb25lRGVlcCIsImRlZmF1bHRzRGVlcCIsInNjYWxlRmFjdG9yIiwiZ2V0WGNvZGVQYXRoIiwiYXJncyIsIm5hbWUiLCJmb3JtYXR0ZWREZXZpY2VOYW1lIiwicmVwbGFjZSIsImFyZ3VtZW50TmFtZSIsImluZm8iLCJqb2luIiwidGltZW91dCIsInJ1biIsImFzc2lnbiIsImlzU2VydmVyUnVubmluZyIsInRpbWVyIiwidGltaW5nIiwiVGltZXIiLCJzdGFydCIsInNodXRkb3duIiwiZ2V0RHVyYXRpb24iLCJhc1NlY29uZHMiLCJ0b0ZpeGVkIiwiY2xlYW4iLCJlbmRTaW11bGF0b3JEYWVtb24iLCJlcmFzZURldmljZSIsInNjcnViQ3VzdG9tQXBwIiwiYXBwQnVuZGxlSWQiLCJjbGVhbkN1c3RvbUFwcCIsInNjcnViIiwiZGVsZXRlUHJvbWlzZXMiLCJyaW1yYWYiLCJyZWxSbVBhdGgiLCJybVBhdGgiLCJhbGwiLCJkaXJzIiwiZGF0YSIsImJ1bmRsZSIsInVuZGVmaW5lZCIsInNyYyIsImxhdW5jaEFuZFF1aXQiLCJzYWZhcmkiLCJsYXVuY2hBcHAiLCJNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCIsInJldHJ5SW50ZXJ2YWwiLCJFcnJvciIsImxhdW5jaGN0bENtZCIsInN0b3BDbWQiLCJyZW1vdmVDbWQiLCJ3YWl0Rm9yQ29uZGl0aW9uIiwid2FpdE1zIiwiaW50ZXJ2YWxNcyIsInNodXRkb3duRGV2aWNlIiwiYmluZCIsImRlbGV0ZSIsImRlbGV0ZURldmljZSIsInVwZGF0ZVNldHRpbmdzIiwidXBkYXRlcyIsInVwZGF0ZUxvY2F0aW9uU2V0dGluZ3MiLCJhdXRob3JpemVkIiwic2V0UmVkdWNlTW90aW9uIiwicmVkdWNlTW90aW9uIiwic2V0QXBwZWFyYW5jZSIsImdldEFwcGVhcmFuY2UiLCJ1cGRhdGVTYWZhcmlTZXR0aW5ncyIsInVwZGF0ZWQiLCJ1cGRhdGVTYWZhcmlVc2VyU2V0dGluZ3MiLCJ1cGRhdGVTYWZhcmlHbG9iYWxTZXR0aW5ncyIsInVwZGF0ZUxvY2FsZSIsImxhbmd1YWdlIiwibG9jYWxlIiwiY2FsZW5kYXJGb3JtYXQiLCJkZWxldGVTYWZhcmkiLCJjbGVhblNhZmFyaSIsImtlZXBQcmVmcyIsImxpYnJhcnlEaXIiLCJzYWZhcmlSb290Iiwic2FmYXJpTGlicmFyeURpciIsImZpbGVzVG9EZWxldGUiLCJyZW1vdmVBcHAiLCJtb3ZlQnVpbHRJbkFwcCIsImFwcE5hbWUiLCJhcHBQYXRoIiwibmV3QXBwUGF0aCIsInNhZmVSaW1SYWYiLCJjb3B5RmlsZSIsIm9wZW5VcmwiLCJ1cmwiLCJTQUZBUklfQk9PVEVEX0lORElDQVRPUiIsIlNBRkFSSV9TVEFSVFVQX1RJTUVPVVQiLCJyZXRyeSIsImNsZWFyQ2FjaGVzIiwiZm9sZGVyTmFtZXMiLCJjYWNoZXNSb290IiwiaXRlbXNUb1JlbW92ZSIsIngiLCJmaWx0ZXIiLCJpc0RpcmVjdG9yeSIsInV0aWwiLCJwbHVyYWxpemUiLCJ0aW1lb3V0TXMiLCJzaW1Mb2ciLCJ0YWlsVW50aWwiLCJlbmFibGVDYWxlbmRhckFjY2VzcyIsImJ1bmRsZUlEIiwiZGlzYWJsZUNhbGVuZGFyQWNjZXNzIiwiaGFzQ2FsZW5kYXJBY2Nlc3MiLCJfYWN0aXZhdGVXaW5kb3ciLCJwaWQiLCJhY3RpdmF0ZUFwcCIsImV4ZWN1dGVVSUNsaWVudFNjcmlwdCIsImFwcGxlU2NyaXB0Iiwid2luZG93QWN0aXZhdGlvblNjcmlwdCIsInJlc3VsdFNjcmlwdCIsImFjcXVpcmUiLCJlcnJvckFuZFRocm93IiwiaXNCaW9tZXRyaWNFbnJvbGxlZCIsIm91dHB1dCIsImlzU3RyaW5nIiwiZW5yb2xsQmlvbWV0cmljIiwiaXNFbmFibGVkIiwic2VuZEJpb21ldHJpY01hdGNoIiwic2hvdWxkTWF0Y2giLCJkaXNtaXNzRGF0YWJhc2VBbGVydCIsImluY3JlYXNlIiwiYnV0dG9uIiwiYmFja3VwS2V5Y2hhaW5zIiwiYmFja3VwUGF0aCIsInRlbXBEaXIiLCJwcmVmaXgiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0cmluZyIsInN1ZmZpeCIsInppcEFyZ3MiLCJzZXAiLCJfa2V5Y2hhaW5zQmFja3VwUGF0aCIsInVubGluayIsInJlc3RvcmVLZXljaGFpbnMiLCJleGNsdWRlUGF0dGVybnMiLCJzcGxpdCIsInBsaXN0UGF0aCIsImdldExhdW5jaERhZW1vbnNSb290Iiwic3Bhd25Qcm9jZXNzIiwibWtkaXJwIiwidW56aXBBcmdzIiwiZmxhdE1hcCIsImNsZWFyS2V5Y2hhaW5zIiwicHMiLCJzZXJ2aWNlc01hdGNoIiwicmVzdWx0IiwicGF0dGVybiIsImdyb3VwIiwidHJpbUVuZCIsInNldFBlcm1pc3Npb24iLCJwZXJtaXNzaW9uIiwic2V0UGVybWlzc2lvbnMiLCJwZXJtaXNzaW9uc01hcHBpbmciLCJKU09OIiwic3RyaW5naWZ5Iiwic2V0QWNjZXNzIiwiZ2V0UGVybWlzc2lvbiIsInNlcnZpY2VOYW1lIiwiZ2V0QWNjZXNzIiwiYWRkQ2VydGlmaWNhdGUiLCJwYXlsb2FkIiwiaGFzU1NMQ2VydCIsInRydW5jYXRlIiwiaW5zdGFsbFNTTENlcnQiLCJwdXNoTm90aWZpY2F0aW9uIiwiZGV2Um9vdCIsImdldERldmVsb3BlclJvb3QiLCJfZ2V0RGV2aWNlU3RyaW5nUGxhdGZvcm1WZXJzaW9uIiwicmVxVmVyc2lvbiIsInhjb2RlIiwiZ2V0TWF4SU9TU0RLIiwiX2dldERldmljZVN0cmluZ1ZlcnNpb25TdHJpbmciLCJfZ2V0RGV2aWNlU3RyaW5nQ29uZmlnRml4IiwiZ2V0RGV2aWNlU3RyaW5nIiwiZGV2aWNlTmFtZSIsImZvcmNlSXBob25lIiwiZm9yY2VJcGFkIiwibG9nT3B0cyIsImlzaVBob25lIiwiaW5kZXhPZiIsImlvc0RldmljZVN0cmluZyIsInRlc3QiLCJDT05GSUdfRklYIiwiY29uZmlnRml4IiwiZ2V0V2ViSW5zcGVjdG9yU29ja2V0IiwiY21kIiwiZm4iLCJleHRlbnNpb25zIiwicHJvdG90eXBlIl0sInNvdXJjZVJvb3QiOiIuLi8uLiIsInNvdXJjZXMiOlsibGliL3NpbXVsYXRvci14Y29kZS02LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZGVmYXVsdCBhcyB4Y29kZSwgZ2V0UGF0aCBhcyBnZXRYY29kZVBhdGggfSBmcm9tICdhcHBpdW0teGNvZGUnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgeyBmcywgdGVtcERpciwgbWtkaXJwLCBwbGlzdCwgdGltaW5nLCB1dGlsIH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgQXN5bmNMb2NrIGZyb20gJ2FzeW5jLWxvY2snO1xuaW1wb3J0IHtcbiAgc2FmZVJpbVJhZiwgZ2V0RGV2ZWxvcGVyUm9vdCwgaW5zdGFsbFNTTENlcnQsIGhhc1NTTENlcnQsIGFjdGl2YXRlQXBwLFxuICBNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCwgbGF1bmNoQXBwXG59IGZyb20gJy4vdXRpbHMuanMnO1xuaW1wb3J0IHsgYXN5bmNtYXAsIHJldHJ5SW50ZXJ2YWwsIHdhaXRGb3JDb25kaXRpb24sIHJldHJ5IH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0ICogYXMgc2V0dGluZ3MgZnJvbSAnLi9zZXR0aW5ncyc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IHRhaWxVbnRpbCB9IGZyb20gJy4vdGFpbC11bnRpbC5qcyc7XG5pbXBvcnQgZXh0ZW5zaW9ucyBmcm9tICcuL2V4dGVuc2lvbnMvaW5kZXgnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCBDYWxlbmRhciBmcm9tICcuL2NhbGVuZGFyJztcbmltcG9ydCBQZXJtaXNzaW9ucyBmcm9tICcuL3Blcm1pc3Npb25zJztcbmltcG9ydCBTaW1jdGwgZnJvbSAnbm9kZS1zaW1jdGwnO1xuXG5cbmNvbnN0IFNUQVJUVVBfVElNRU9VVCA9IDYwICogMTAwMDtcbmNvbnN0IEVYVFJBX1NUQVJUVVBfVElNRSA9IDIwMDA7XG5jb25zdCBVSV9DTElFTlRfQUNDRVNTX0dVQVJEID0gbmV3IEFzeW5jTG9jaygpO1xuY29uc3QgVUlfQ0xJRU5UX0JVTkRMRV9JRCA9ICdjb20uYXBwbGUuaXBob25lc2ltdWxhdG9yJztcbmNvbnN0IFNQUklOR0JPQVJEX0JVTkRMRV9JRCA9ICdjb20uYXBwbGUuU3ByaW5nQm9hcmQnO1xuXG4vKlxuICogVGhpcyBldmVudCBpcyBlbWl0dGVkIGFzIHNvb24gYXMgaU9TIFNpbXVsYXRvclxuICogaGFzIGZpbmlzaGVkIGJvb3RpbmcgYW5kIGl0IGlzIHJlYWR5IHRvIGFjY2VwdCB4Y3J1biBjb21tYW5kcy5cbiAqIFRoZSBldmVudCBoYW5kbGVyIGlzIGNhbGxlZCBhZnRlciAncnVuJyBtZXRob2QgaXMgY29tcGxldGVkXG4gKiBmb3IgWGNvZGUgNyBhbmQgb2xkZXIgYW5kIGlzIG9ubHkgdXNlZnVsIGluIFhjb2RlIDgrLFxuICogc2luY2Ugb25lIGNhbiBzdGFydCBkb2luZyBzdHVmZiAoZm9yIGV4YW1wbGUgaW5zdGFsbC91bmluc3RhbGwgYW4gYXBwKSBpbiBwYXJhbGxlbFxuICogd2l0aCBTaW11bGF0b3IgVUkgc3RhcnR1cCwgd2hpY2ggc2hvcnRlbnMgc2Vzc2lvbiBzdGFydHVwIHRpbWUuXG4gKi9cbmNvbnN0IEJPT1RfQ09NUExFVEVEX0VWRU5UID0gJ2Jvb3RDb21wbGV0ZWQnO1xuXG5cbmNsYXNzIFNpbXVsYXRvclhjb2RlNiBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG5cbiAgLyoqXG4gICAqIENvbnN0cnVjdHMgdGhlIG9iamVjdCB3aXRoIHRoZSBgdWRpZGAgYW5kIHZlcnNpb24gb2YgWGNvZGUuIFVzZSB0aGUgZXhwb3J0ZWQgYGdldFNpbXVsYXRvcih1ZGlkKWAgbWV0aG9kIGluc3RlYWQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIC0gVGhlIFNpbXVsYXRvciBJRC5cbiAgICogQHBhcmFtIHtvYmplY3R9IHhjb2RlVmVyc2lvbiAtIFRoZSB0YXJnZXQgWGNvZGUgdmVyc2lvbiBpbiBmb3JtYXQge21ham9yLCBtaW5vciwgYnVpbGR9LlxuICAgKi9cbiAgY29uc3RydWN0b3IgKHVkaWQsIHhjb2RlVmVyc2lvbikge1xuICAgIHN1cGVyKCk7XG5cbiAgICB0aGlzLnVkaWQgPSBTdHJpbmcodWRpZCk7XG4gICAgdGhpcy5zaW1jdGwgPSBuZXcgU2ltY3RsKHtcbiAgICAgIHVkaWQ6IHRoaXMudWRpZCxcbiAgICB9KTtcbiAgICB0aGlzLnhjb2RlVmVyc2lvbiA9IHhjb2RlVmVyc2lvbjtcblxuICAgIC8vIHBsYXRmb3JtVmVyc2lvbiBjYW5ub3QgYmUgZm91bmQgaW5pdGlhbGx5LCBzaW5jZSBnZXR0aW5nIGl0IGhhcyBzaWRlIGVmZmVjdHMgZm9yXG4gICAgLy8gb3VyIGxvZ2ljIGZvciBmaWd1cmluZyBvdXQgaWYgYSBzaW0gaGFzIGJlZW4gcnVuXG4gICAgLy8gaXQgd2lsbCBiZSBzZXQgd2hlbiBpdCBpcyBuZWVkZWRcbiAgICB0aGlzLl9wbGF0Zm9ybVZlcnNpb24gPSBudWxsO1xuXG4gICAgdGhpcy5rZXljaGFpblBhdGggPSBwYXRoLnJlc29sdmUodGhpcy5nZXREaXIoKSwgJ0xpYnJhcnknLCAnS2V5Y2hhaW5zJyk7XG4gICAgdGhpcy5zaW11bGF0b3JBcHAgPSAnaU9TIFNpbXVsYXRvci5hcHAnO1xuXG4gICAgdGhpcy5hcHBEYXRhQnVuZGxlUGF0aHMgPSB7fTtcblxuICAgIC8vIGxpc3Qgb2YgZmlsZXMgdG8gY2hlY2sgZm9yIHdoZW4gc2VlaW5nIGlmIGEgc2ltdWxhdG9yIGlzIFwiZnJlc2hcIlxuICAgIC8vIChtZWFuaW5nIGl0IGhhcyBuZXZlciBiZWVuIGJvb3RlZCkuXG4gICAgLy8gSWYgdGhlc2UgZmlsZXMgYXJlIHByZXNlbnQsIHdlIGFzc3VtZSBpdCdzIGJlZW4gc3VjY2Vzc2Z1bGx5IGJvb3RlZFxuICAgIHRoaXMuaXNGcmVzaEZpbGVzID0gW1xuICAgICAgJ0xpYnJhcnkvQ29uZmlndXJhdGlvblByb2ZpbGVzJyxcbiAgICAgICdMaWJyYXJ5L0Nvb2tpZXMnLFxuICAgICAgJ0xpYnJhcnkvUHJlZmVyZW5jZXMvLkdsb2JhbFByZWZlcmVuY2VzLnBsaXN0JyxcbiAgICAgICdMaWJyYXJ5L1ByZWZlcmVuY2VzL2NvbS5hcHBsZS5zcHJpbmdib2FyZC5wbGlzdCcsXG4gICAgICAndmFyL3J1bi9zeXNsb2cucGlkJ1xuICAgIF07XG5cbiAgICAvLyBleHRyYSB0aW1lIHRvIHdhaXQgZm9yIHNpbXVsYXRvciB0byBiZSBkZWVtZWQgYm9vdGVkXG4gICAgdGhpcy5leHRyYVN0YXJ0dXBUaW1lID0gRVhUUkFfU1RBUlRVUF9USU1FO1xuXG4gICAgdGhpcy5jYWxlbmRhciA9IG5ldyBDYWxlbmRhcih4Y29kZVZlcnNpb24sIHRoaXMuZ2V0RGlyKCkpO1xuICAgIHRoaXMucGVybWlzc2lvbnMgPSBuZXcgUGVybWlzc2lvbnMoeGNvZGVWZXJzaW9uLCB0aGlzLmdldERpcigpLCB0aGlzLnVkaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQnVuZGxlIGlkZW50aWZpZXIgb2YgU2ltdWxhdG9yIFVJIGNsaWVudC5cbiAgICovXG4gIGdldCB1aUNsaWVudEJ1bmRsZUlkICgpIHtcbiAgICByZXR1cm4gVUlfQ0xJRU5UX0JVTkRMRV9JRDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcmV0dXJuIHs/c3RyaW5nfSBUaGUgZnVsbCBwYXRoIHRvIHRoZSBkZXZpY2VzIHNldCB3aGVyZSB0aGUgY3VycmVudCBzaW11bGF0b3IgaXMgbG9jYXRlZC5cbiAgICogYG51bGxgIHZhbHVlIG1lYW5zIHRoYXQgdGhlIGRlZmF1bHQgcGF0aCBpcyB1c2VkLCB3aGljaCBpcyB1c3VhbGx5IGB+L0xpYnJhcnkvRGV2ZWxvcGVyL0NvcmVTaW11bGF0b3IvRGV2aWNlc2BcbiAgICovXG4gIGdldCBkZXZpY2VzU2V0UGF0aCAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2ltY3RsLmRldmljZXNTZXRQYXRoO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgZnVsbCBwYXRoIHRvIHRoZSBkZXZpY2VzIHNldC4gSXQgaXMgcmVjb21tZW5kZWQgdG8gc2V0IHRoaXMgdmFsdWVcbiAgICogb25jZSByaWdodCBhZnRlciBTaW11bGF0b3IgaW5zdGFuY2UgaXMgY3JlYXRlZCBhbmQgdG8gbm90IGNoYW5nZSBpdCBkdXJpbmdcbiAgICogdGhlIGluc3RhbmNlIGxpZmVjeWNsZVxuICAgKlxuICAgKiBAcGFyYW0gez9zdHJpbmd9IHZhbHVlIFRoZSBmdWxsIHBhdGggdG8gdGhlIGRldmljZXMgc2V0IHJvb3Qgb24gdGhlXG4gICAqIGxvY2FsIGZpbGUgc3lzdGVtXG4gICAqL1xuICBzZXQgZGV2aWNlc1NldFBhdGggKHZhbHVlKSB7XG4gICAgdGhpcy5zaW1jdGwuZGV2aWNlc1NldFBhdGggPSB2YWx1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgcHJvY2VzcyBpZCBvZiB0aGUgVUkgY2xpZW50XG4gICAqXG4gICAqIEByZXR1cm4gez9zdHJpbmd9IFRoZSBwcm9jZXNzIElEIG9yIG51bGwgaWYgdGhlIFVJIGNsaWVudCBpcyBub3QgcnVubmluZ1xuICAgKi9cbiAgYXN5bmMgZ2V0VUlDbGllbnRQaWQgKCkge1xuICAgIGxldCBzdGRvdXQ7XG4gICAgdHJ5IHtcbiAgICAgICh7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3BncmVwJywgWyctZm4nLCBgJHt0aGlzLnNpbXVsYXRvckFwcH0vQ29udGVudHMvTWFjT1MvYF0pKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaWYgKGlzTmFOKHBhcnNlSW50KHN0ZG91dCwgMTApKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHN0ZG91dCA9IHN0ZG91dC50cmltKCk7XG4gICAgbG9nLmRlYnVnKGBHb3QgU2ltdWxhdG9yIFVJIGNsaWVudCBQSUQ6ICR7c3Rkb3V0fWApO1xuICAgIHJldHVybiBzdGRvdXQ7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgdGhlIHN0YXRlIG9mIFNpbXVsYXRvciBVSSBjbGllbnQuXG4gICAqXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgb2YgaWYgVUkgY2xpZW50IGlzIHJ1bm5pbmcgb3IgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgKi9cbiAgYXN5bmMgaXNVSUNsaWVudFJ1bm5pbmcgKCkge1xuICAgIHJldHVybiAhXy5pc051bGwoYXdhaXQgdGhpcy5nZXRVSUNsaWVudFBpZCgpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIb3cgbG9uZyB0byB3YWl0IGJlZm9yZSB0aHJvd2luZyBhbiBlcnJvciBhYm91dCBTaW11bGF0b3Igc3RhcnR1cCB0aW1lb3V0IGhhcHBlbmVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzLlxuICAgKi9cbiAgZ2V0IHN0YXJ0dXBUaW1lb3V0ICgpIHtcbiAgICByZXR1cm4gU1RBUlRVUF9USU1FT1VUO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgcGxhdGZvcm0gdmVyc2lvbiBvZiB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gU0RLIHZlcnNpb24sIGZvciBleGFtcGxlICc4LjMnLlxuICAgKi9cbiAgYXN5bmMgZ2V0UGxhdGZvcm1WZXJzaW9uICgpIHtcbiAgICBpZiAoIXRoaXMuX3BsYXRmb3JtVmVyc2lvbikge1xuICAgICAgbGV0IHtzZGt9ID0gYXdhaXQgdGhpcy5zdGF0KCk7XG4gICAgICB0aGlzLl9wbGF0Zm9ybVZlcnNpb24gPSBzZGs7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9wbGF0Zm9ybVZlcnNpb247XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IHdoZXJlIFNpbXVsYXRvciBzdHVmZiBpcyBsb2NhdGVkLlxuICAgKlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSBwYXRoIHN0cmluZy5cbiAgICovXG4gIGdldFJvb3REaXIgKCkge1xuICAgIGxldCBob21lID0gcHJvY2Vzcy5lbnYuSE9NRTtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKGhvbWUsICdMaWJyYXJ5JywgJ0RldmVsb3BlcicsICdDb3JlU2ltdWxhdG9yJywgJ0RldmljZXMnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSB0aGUgZnVsbCBwYXRoIHRvIHRoZSBkaXJlY3Rvcnkgd2hlcmUgU2ltdWxhdG9yIGFwcGxpY2F0aW9ucyBkYXRhIGlzIGxvY2F0ZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhdGggc3RyaW5nLlxuICAgKi9cbiAgZ2V0RGlyICgpIHtcbiAgICByZXR1cm4gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0Um9vdERpcigpLCB0aGlzLnVkaWQsICdkYXRhJyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGZ1bGwgcGF0aCB0byB0aGUgZGlyZWN0b3J5IHdoZXJlIFNpbXVsYXRvciBsb2dzIGFyZSBzdG9yZWQuXG4gICAqXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHBhdGggc3RyaW5nLlxuICAgKi9cbiAgZ2V0TG9nRGlyICgpIHtcbiAgICBsZXQgaG9tZSA9IHByb2Nlc3MuZW52LkhPTUU7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZShob21lLCAnTGlicmFyeScsICdMb2dzJywgJ0NvcmVTaW11bGF0b3InLCB0aGlzLnVkaWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEluc3RhbGwgdmFsaWQgLmFwcCBwYWNrYWdlIG9uIFNpbXVsYXRvci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcCAtIFRoZSBwYXRoIHRvIHRoZSAuYXBwIHBhY2thZ2UuXG4gICAqL1xuICBhc3luYyBpbnN0YWxsQXBwIChhcHApIHtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5zaW1jdGwuaW5zdGFsbEFwcChhcHApO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmeSB3aGV0aGVyIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIGlzIGluc3RhbGxlZCBvbiBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidW5kbGUgaWQgb2YgdGhlIGFwcGxpY2F0aW9uIHRvIGJlIGNoZWNrZWQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBGdWxlIC0gQXBwbGljYXRpb24gbmFtZSBtaW51cyBcIi5hcHBcIiAoZm9yIGlPUyA3LjEpXG4gICAqIEByZXR1cm4ge2Jvb2xlYW59IFRydWUgaWYgdGhlIGdpdmVuIGFwcGxpY2F0aW9uIGlzIGluc3RhbGxlZFxuICAgKi9cbiAgYXN5bmMgaXNBcHBJbnN0YWxsZWQgKGJ1bmRsZUlkLCBhcHBGaWxlID0gbnVsbCkge1xuICAgIC8vIGBhcHBGaWxlYCBhcmd1bWVudCBvbmx5IG5lY2Vzc2FyeSBmb3IgaU9TIGJlbG93IHZlcnNpb24gOFxuICAgIGxldCBhcHBEaXJzID0gYXdhaXQgdGhpcy5nZXRBcHBEaXJzKGFwcEZpbGUsIGJ1bmRsZUlkKTtcbiAgICByZXR1cm4gYXBwRGlycy5sZW5ndGggIT09IDA7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB1c2VyIGluc3RhbGxlZCBidW5kbGUgaWRzIHdoaWNoIGhhcyAnYnVuZGxlTmFtZScgaW4gdGhlaXIgSW5mby5QbGlzdCBhcyAnQ0ZCdW5kbGVOYW1lJ1xuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSWQgLSBUaGUgYnVuZGxlIGlkIG9mIHRoZSBhcHBsaWNhdGlvbiB0byBiZSBjaGVja2VkLlxuICAgKiBAcmV0dXJuIHthcnJheTxzdHJpbmc+fSAtIFRoZSBsaXN0IG9mIGJ1bmRsZSBpZHMgd2hpY2ggaGF2ZSAnYnVuZGxlTmFtZSdcbiAgICovXG4gIGFzeW5jIGdldFVzZXJJbnN0YWxsZWRCdW5kbGVJZHNCeUJ1bmRsZU5hbWUgKGJ1bmRsZU5hbWUpIHtcbiAgICBjb25zdCByb290VXNlckFwcERpciA9IGF3YWl0IHRoaXMuYnVpbGRCdW5kbGVQYXRoTWFwKCdCdW5kbGUnKTtcbiAgICBjb25zdCBidW5kbGVJZHMgPSBbXTtcbiAgICBpZiAoXy5pc0VtcHR5KHJvb3RVc2VyQXBwRGlyKSkge1xuICAgICAgcmV0dXJuIGJ1bmRsZUlkcztcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IFtidW5kbGVJZCwgdXNlckFwcERpclBhdGhdIG9mIE9iamVjdC5lbnRyaWVzKHJvb3RVc2VyQXBwRGlyKSkge1xuICAgICAgY29uc3QgYXBwRmlsZSA9IChhd2FpdCBmcy5yZWFkZGlyKHVzZXJBcHBEaXJQYXRoKSkuZmluZChcbiAgICAgICAgKGZpbGUpID0+IHBhdGguZXh0bmFtZShmaWxlKS50b0xvd2VyQ2FzZSgpID09PSAnLmFwcCcpO1xuICAgICAgY29uc3QgaW5mb1BsaXN0UGF0aCA9IHBhdGgucmVzb2x2ZSh1c2VyQXBwRGlyUGF0aCwgYXBwRmlsZSwgJ0luZm8ucGxpc3QnKTtcbiAgICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKGluZm9QbGlzdFBhdGgpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaW5mb1BsaXN0ID0gYXdhaXQgcGxpc3QucGFyc2VQbGlzdEZpbGUoaW5mb1BsaXN0UGF0aCwgZmFsc2UpO1xuICAgICAgICBpZiAoaW5mb1BsaXN0LkNGQnVuZGxlTmFtZSA9PT0gYnVuZGxlTmFtZSkge1xuICAgICAgICAgIGJ1bmRsZUlkcy5wdXNoKGJ1bmRsZUlkKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZy53YXJuKGBGYWlsZWQgdG8gcmVhZCBwbGlzdCAke2luZm9QbGlzdFBhdGh9LiBPcmlnaW5hbCBlcnJvciAnJHtlcnIubWVzc2FnZX0nYCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2cuZGVidWcoYFRoZSBzaW11bGF0b3IgaGFzICcke2J1bmRsZUlkcy5sZW5ndGh9JyBidW5kbGVzIHdoaWNoIGhhdmUgJyR7YnVuZGxlTmFtZX0nIGFzIHRoZWlyICdDRkJ1bmRsZU5hbWUnOmApO1xuICAgIGZvciAoY29uc3QgYnVuZGxlSWQgb2YgYnVuZGxlSWRzKSB7XG4gICAgICBsb2cuZGVidWcoYCAgICAnJHtidW5kbGVJZH0nYCk7XG4gICAgfVxuICAgIHJldHVybiBidW5kbGVJZHM7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgdGhlIGRpcmVjdG9yeSBmb3IgYSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uJ3MgZGF0YS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gRWl0aGVyIGEgYnVuZGxlSWQgKGUuZy4sIGNvbS5hcHBsZS5tb2JpbGVzYWZhcmkpIG9yLCBmb3IgaU9TIDcuMSwgdGhlIGFwcCBuYW1lIHdpdGhvdXQgYC5hcHBgIChlLmcuLCBNb2JpbGVTYWZhcmkpXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzdWJkaXIgLSBUaGUgc3ViLWRpcmVjdG9yeSB3ZSBleHBlY3QgdG8gYmUgd2l0aGluIHRoZSBhcHBsaWNhdGlvbiBkaXJlY3RvcnkuIERlZmF1bHRzIHRvIFwiRGF0YVwiLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFRoZSByb290IGFwcGxpY2F0aW9uIGZvbGRlci5cbiAgICovXG4gIGFzeW5jIGdldEFwcERpciAoaWQsIHN1YkRpciA9ICdEYXRhJykge1xuICAgIHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl0gPSB0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdIHx8IHt9O1xuICAgIGlmIChfLmlzRW1wdHkodGhpcy5hcHBEYXRhQnVuZGxlUGF0aHNbc3ViRGlyXSkgJiYgIWF3YWl0IHRoaXMuaXNGcmVzaCgpKSB7XG4gICAgICB0aGlzLmFwcERhdGFCdW5kbGVQYXRoc1tzdWJEaXJdID0gYXdhaXQgdGhpcy5idWlsZEJ1bmRsZVBhdGhNYXAoc3ViRGlyKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuYXBwRGF0YUJ1bmRsZVBhdGhzW3N1YkRpcl1baWRdO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSB4Y29kZSA2IHNpbXVsYXRvcnMgYXJlIHJlYWxseSBhbm5veWluZywgYW5kIGJ1cnkgdGhlIG1haW4gYXBwXG4gICAqIGRpcmVjdG9yaWVzIGluc2lkZSBkaXJlY3RvcmllcyBqdXN0IG5hbWVkIHdpdGggSGFzaGVzLlxuICAgKiBUaGlzIGZ1bmN0aW9uIGZpbmRzIHRoZSBwcm9wZXIgZGlyZWN0b3J5IGJ5IHRyYXZlcnNpbmcgYWxsIG9mIHRoZW1cbiAgICogYW5kIHJlYWRpbmcgYSBtZXRhZGF0YSBwbGlzdCAoTW9iaWxlIENvbnRhaW5lciBNYW5hZ2VyKSB0byBnZXQgdGhlXG4gICAqIGJ1bmRsZSBpZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHN1YmRpciAtIFRoZSBzdWItZGlyZWN0b3J5IHdlIGV4cGVjdCB0byBiZSB3aXRoaW4gdGhlIGFwcGxpY2F0aW9uIGRpcmVjdG9yeS4gRGVmYXVsdHMgdG8gXCJEYXRhXCIuXG4gICAqIEByZXR1cm4ge29iamVjdH0gVGhlIGxpc3Qgb2YgcGF0aC1idW5kbGUgcGFpcnMgdG8gYW4gb2JqZWN0IHdoZXJlIGJ1bmRsZUlkcyBhcmUgbWFwcGVkIHRvIHBhdGhzLlxuICAgKi9cbiAgYXN5bmMgYnVpbGRCdW5kbGVQYXRoTWFwIChzdWJEaXIgPSAnRGF0YScpIHtcbiAgICBsb2cuZGVidWcoJ0J1aWxkaW5nIGJ1bmRsZSBwYXRoIG1hcCcpO1xuICAgIGxldCBhcHBsaWNhdGlvbkxpc3Q7XG4gICAgbGV0IHBhdGhCdW5kbGVQYWlyO1xuICAgIGlmIChhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpID09PSAnNy4xJykge1xuICAgICAgLy8gYXBwcyBhdmFpbGFibGVcbiAgICAgIC8vICAgV2ViLmFwcCxcbiAgICAgIC8vICAgV2ViVmlld1NlcnZpY2UuYXBwLFxuICAgICAgLy8gICBNb2JpbGVTYWZhcmkuYXBwLFxuICAgICAgLy8gICBXZWJDb250ZW50QW5hbHlzaXNVSS5hcHAsXG4gICAgICAvLyAgIEREQWN0aW9uc1NlcnZpY2UuYXBwLFxuICAgICAgLy8gICBTdG9yZUtpdFVJU2VydmljZS5hcHBcbiAgICAgIGFwcGxpY2F0aW9uTGlzdCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnQXBwbGljYXRpb25zJyk7XG4gICAgICBwYXRoQnVuZGxlUGFpciA9IGFzeW5jIChkaXIpID0+IHtcbiAgICAgICAgZGlyID0gcGF0aC5yZXNvbHZlKGFwcGxpY2F0aW9uTGlzdCwgZGlyKTtcbiAgICAgICAgbGV0IGFwcEZpbGVzID0gYXdhaXQgZnMuZ2xvYihgJHtkaXJ9LyouYXBwYCk7XG4gICAgICAgIGxldCBidW5kbGVJZCA9IGFwcEZpbGVzWzBdLm1hdGNoKC8uKlxcLyguKilcXC5hcHAvKVsxXTtcbiAgICAgICAgcmV0dXJuIHtwYXRoOiBkaXIsIGJ1bmRsZUlkfTtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGFwcGxpY2F0aW9uTGlzdCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnQ29udGFpbmVycycsIHN1YkRpciwgJ0FwcGxpY2F0aW9uJyk7XG4gICAgICAvLyBnaXZlbiBhIGRpcmVjdG9yeSwgZmluZCB0aGUgcGxpc3QgZmlsZSBhbmQgcHVsbCB0aGUgYnVuZGxlIGlkIGZyb20gaXRcbiAgICAgIGxldCByZWFkQnVuZGxlSWQgPSBhc3luYyAoZGlyKSA9PiB7XG4gICAgICAgIGxldCBwbGlzdCA9IHBhdGgucmVzb2x2ZShkaXIsICcuY29tLmFwcGxlLm1vYmlsZV9jb250YWluZXJfbWFuYWdlci5tZXRhZGF0YS5wbGlzdCcpO1xuICAgICAgICBsZXQgbWV0YWRhdGEgPSBhd2FpdCBzZXR0aW5ncy5yZWFkKHBsaXN0KTtcbiAgICAgICAgcmV0dXJuIG1ldGFkYXRhLk1DTU1ldGFkYXRhSWRlbnRpZmllcjtcbiAgICAgIH07XG4gICAgICAvLyBnaXZlbiBhIGRpcmVjdG9yeSwgcmV0dXJuIHRoZSBwYXRoIGFuZCBidW5kbGUgaWQgYXNzb2NpYXRlZCB3aXRoIGl0XG4gICAgICBwYXRoQnVuZGxlUGFpciA9IGFzeW5jIChkaXIpID0+IHtcbiAgICAgICAgZGlyID0gcGF0aC5yZXNvbHZlKGFwcGxpY2F0aW9uTGlzdCwgZGlyKTtcbiAgICAgICAgbGV0IGJ1bmRsZUlkID0gYXdhaXQgcmVhZEJ1bmRsZUlkKGRpcik7XG4gICAgICAgIHJldHVybiB7cGF0aDogZGlyLCBidW5kbGVJZH07XG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKGFwcGxpY2F0aW9uTGlzdCkpIHtcbiAgICAgIGxvZy53YXJuKGBObyBkaXJlY3RvcnkgcGF0aCAnJHthcHBsaWNhdGlvbkxpc3R9J2ApO1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cblxuICAgIGxldCBidW5kbGVQYXRoRGlycyA9IGF3YWl0IGZzLnJlYWRkaXIoYXBwbGljYXRpb25MaXN0KTtcbiAgICBsZXQgYnVuZGxlUGF0aFBhaXJzID0gYXdhaXQgYXN5bmNtYXAoYnVuZGxlUGF0aERpcnMsIGFzeW5jIGZ1bmN0aW9uIChkaXIpIHtcbiAgICAgIHJldHVybiBhd2FpdCBwYXRoQnVuZGxlUGFpcihkaXIpO1xuICAgIH0sIGZhbHNlKTtcblxuICAgIC8vIHJlZHVjZSB0aGUgbGlzdCBvZiBwYXRoLWJ1bmRsZSBwYWlycyB0byBhbiBvYmplY3Qgd2hlcmUgYnVuZGxlSWRzIGFyZSBtYXBwZWQgdG8gcGF0aHNcbiAgICByZXR1cm4gYnVuZGxlUGF0aFBhaXJzLnJlZHVjZSgoYnVuZGxlTWFwLCBidW5kbGVQYXRoKSA9PiB7XG4gICAgICBidW5kbGVNYXBbYnVuZGxlUGF0aC5idW5kbGVJZF0gPSBidW5kbGVQYXRoLnBhdGg7XG4gICAgICByZXR1cm4gYnVuZGxlTWFwO1xuICAgIH0sIHt9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHN0YXRlIGFuZCBzcGVjaWZpY3Mgb2YgdGhpcyBzaW0uXG4gICAqXG4gICAqIEByZXR1cm4ge29iamVjdH0gU2ltdWxhdG9yIHN0YXRzIG1hcHBpbmcsIGZvciBleGFtcGxlOlxuICAgKiB7IG5hbWU6ICdpUGhvbmUgNHMnLFxuICAgKiAgIHVkaWQ6ICdDMDlCMzRFNS03RENCLTQ0MkUtQjc5Qy1BQjZCQzAzNTc0MTcnLFxuICAgKiAgIHN0YXRlOiAnU2h1dGRvd24nLFxuICAgKiAgIHNkazogJzguMydcbiAgICogfVxuICAgKi9cbiAgYXN5bmMgc3RhdCAoKSB7XG4gICAgZm9yIChsZXQgW3NkaywgZGV2aWNlQXJyXSBvZiBfLnRvUGFpcnMoYXdhaXQgdGhpcy5zaW1jdGwuZ2V0RGV2aWNlcygpKSkge1xuICAgICAgZm9yIChsZXQgZGV2aWNlIG9mIGRldmljZUFycikge1xuICAgICAgICBpZiAoZGV2aWNlLnVkaWQgPT09IHRoaXMudWRpZCkge1xuICAgICAgICAgIGRldmljZS5zZGsgPSBzZGs7XG4gICAgICAgICAgcmV0dXJuIGRldmljZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIGlzIGEgYmVzdC1iZXQgaGV1cmlzdGljIGZvciB3aGV0aGVyIG9yIG5vdCBhIHNpbSBoYXMgYmVlbiBib290ZWRcbiAgICogYmVmb3JlLiBXZSB1c3VhbGx5IHdhbnQgdG8gc3RhcnQgYSBzaW11bGF0b3IgdG8gXCJ3YXJtXCIgaXQgdXAsIGhhdmVcbiAgICogWGNvZGUgcG9wdWxhdGUgaXQgd2l0aCBwbGlzdHMgZm9yIHVzIHRvIG1hbmlwdWxhdGUgYmVmb3JlIGEgcmVhbFxuICAgKiB0ZXN0IHJ1bi5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgY3VycmVudCBTaW11bGF0b3IgaGFzIG5ldmVyIGJlZW4gc3RhcnRlZCBiZWZvcmVcbiAgICovXG4gIGFzeW5jIGlzRnJlc2ggKCkge1xuICAgIC8vIGlmIHRoZSBmb2xsb3dpbmcgZmlsZXMgZG9uJ3QgZXhpc3QsIGl0IGhhc24ndCBiZWVuIGJvb3RlZC5cbiAgICAvLyBUSElTIElTIE5PVCBBTiBFWEhBVVNUSVZFIExJU1RcbiAgICBsZXQgZmlsZXMgPSB0aGlzLmlzRnJlc2hGaWxlcztcblxuICAgIGxldCBwdiA9IGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCk7XG4gICAgaWYgKHB2ICE9PSAnNy4xJykge1xuICAgICAgZmlsZXMucHVzaCgnTGlicmFyeS9QcmVmZXJlbmNlcy9jb20uYXBwbGUuUHJlZmVyZW5jZXMucGxpc3QnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmlsZXMucHVzaCgnQXBwbGljYXRpb25zJyk7XG4gICAgfVxuXG4gICAgY29uc3QgZGlyID0gdGhpcy5nZXREaXIoKTtcbiAgICBmaWxlcyA9IGZpbGVzLm1hcCgocykgPT4gcGF0aC5yZXNvbHZlKGRpciwgcykpO1xuXG4gICAgY29uc3QgZXhpc3RlbmNlcyA9IGF3YWl0IGFzeW5jbWFwKGZpbGVzLCBhc3luYyAoZikgPT4gYXdhaXQgZnMuaGFzQWNjZXNzKGYpKTtcbiAgICBjb25zdCBmcmVzaCA9IF8uY29tcGFjdChleGlzdGVuY2VzKS5sZW5ndGggIT09IGZpbGVzLmxlbmd0aDtcbiAgICBsb2cuZGVidWcoYENoZWNraW5nIHdoZXRoZXIgc2ltdWxhdG9yIGhhcyBiZWVuIHJ1biBiZWZvcmU6ICR7ZnJlc2ggPyAnbm8nIDogJ3llcyd9YCk7XG5cbiAgICByZXR1cm4gZnJlc2g7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHRoZSBzdGF0ZSBvZiB0aGUgY3VycmVudCBTaW11bGF0b3IuIE9uZSBzaG91bGQgZGlzdGluZ3Vpc2ggdGhlXG4gICAqIHN0YXRlcyBvZiBTaW11bGF0b3IgVUkgYW5kIHRoZSBTaW11bGF0b3IgaXRzZWxmLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBjdXJyZW50IFNpbXVsYXRvciBpcyBydW5uaW5nLlxuICAgKi9cbiAgYXN5bmMgaXNSdW5uaW5nICgpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5zaW1jdGwuZ2V0RW52KCdkdW1teScpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVja3MgaWYgdGhlIHNpbXVsYXRvciBpcyBpbiBzaHV0ZG93biBzdGF0ZS5cbiAgICogVGhpcyBtZXRob2QgaXMgbmVjZXNzYXJ5LCBiZWNhdXNlIFNpbXVsYXRvciBtaWdodCBhbHNvIGJlXG4gICAqIGluIHRoZSB0cmFuc2l0aW9uYWwgU2h1dHRpbmcgRG93biBzdGF0ZSByaWdodCBhZnRlciB0aGUgYHNodXRkb3duYFxuICAgKiBjb21tYW5kIGhhcyBiZWVuIGlzc3VlZC5cbiAgICpcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gVHJ1ZSBpZiB0aGUgY3VycmVudCBTaW11bGF0b3IgaXMgc2h1dCBkb3duLlxuICAgKi9cbiAgYXN5bmMgaXNTaHV0ZG93biAoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuc2ltY3RsLmdldEVudignZHVtbXknKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gXy5pbmNsdWRlcyhlLnN0ZGVyciwgJ0N1cnJlbnQgc3RhdGU6IFNodXRkb3duJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmeSB3aGV0aGVyIHRoZSBTaW11bGF0b3IgYm9vdGluZyBpcyBjb21wbGV0ZWQgYW5kL29yIHdhaXQgZm9yIGl0XG4gICAqIHVudGlsIHRoZSB0aW1lb3V0IGV4cGlyZXMuXG4gICAqXG4gICAqIEBwYXJhbSB7bnVtYmVyfSBzdGFydHVwVGltZW91dCAtIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgYm9vdGluZyBpcyBjb21wbGV0ZWQuXG4gICAqIEBlbWl0cyBCT09UX0NPTVBMRVRFRF9FVkVOVCBpZiB0aGUgY3VycmVudCBTaW11bGF0b3IgaXMgcmVhZHkgdG8gYWNjZXB0IHNpbWN0bCBjb21tYW5kcywgbGlrZSAnaW5zdGFsbCcuXG4gICAqL1xuICBhc3luYyB3YWl0Rm9yQm9vdCAoc3RhcnR1cFRpbWVvdXQpIHtcbiAgICAvLyB3YWl0IGZvciB0aGUgc2ltdWxhdG9yIHRvIGJvb3RcbiAgICAvLyB3YWl0aW5nIGZvciB0aGUgc2ltdWxhdG9yIHN0YXR1cyB0byBiZSAnYm9vdGVkJyBpc24ndCBnb29kIGVub3VnaFxuICAgIC8vIGl0IGNsYWltcyB0byBiZSBib290ZWQgd2F5IGJlZm9yZSBmaW5pc2hpbmcgbG9hZGluZ1xuICAgIC8vIGxldCdzIHRhaWwgdGhlIHNpbXVsYXRvciBzeXN0ZW0gbG9nIHVudGlsIHdlIHNlZSBhIG1hZ2ljIGxpbmUgKHRoaXMuYm9vdGVkSW5kaWNhdG9yKVxuICAgIGxldCBib290ZWRJbmRpY2F0b3IgPSBhd2FpdCB0aGlzLmdldEJvb3RlZEluZGljYXRvclN0cmluZygpO1xuICAgIGF3YWl0IHRoaXMudGFpbExvZ3NVbnRpbChib290ZWRJbmRpY2F0b3IsIHN0YXJ0dXBUaW1lb3V0KTtcblxuICAgIC8vIHNvIHNvcnJ5LCBidXQgd2Ugc2hvdWxkIHdhaXQgYW5vdGhlciB0d28gc2Vjb25kcywganVzdCB0byBtYWtlIHN1cmUgd2UndmUgcmVhbGx5IHN0YXJ0ZWRcbiAgICAvLyB3ZSBjYW4ndCBsb29rIGZvciBhbm90aGVyIG1hZ2ljIGxvZyBsaW5lLCBiZWNhdXNlIHRoZXkgc2VlbSB0byBiZSBhcHAtZGVwZW5kZW50IChub3Qgc3lzdGVtIGRlcGVuZGVudClcbiAgICBsb2cuZGVidWcoYFdhaXRpbmcgYW4gZXh0cmEgJHt0aGlzLmV4dHJhU3RhcnR1cFRpbWV9bXMgZm9yIHRoZSBzaW11bGF0b3IgdG8gcmVhbGx5IGZpbmlzaCBib290aW5nYCk7XG4gICAgYXdhaXQgQi5kZWxheSh0aGlzLmV4dHJhU3RhcnR1cFRpbWUpO1xuICAgIGxvZy5kZWJ1ZygnRG9uZSB3YWl0aW5nIGV4dHJhIHRpbWUgZm9yIHNpbXVsYXRvcicpO1xuXG4gICAgdGhpcy5lbWl0KEJPT1RfQ09NUExFVEVEX0VWRU5UKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgbWFnaWMgc3RyaW5nLCB3aGljaCwgaWYgcHJlc2VudCBpbiBsb2dzLCByZWZsZWN0cyB0aGUgZmFjdCB0aGF0IHNpbXVsYXRvciBib290aW5nIGhhcyBiZWVuIGNvbXBsZXRlZC5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgbWFnaWMgbG9nIHN0cmluZy5cbiAgICovXG4gIGFzeW5jIGdldEJvb3RlZEluZGljYXRvclN0cmluZyAoKSB7XG4gICAgbGV0IGluZGljYXRvcjtcbiAgICBsZXQgcGxhdGZvcm1WZXJzaW9uID0gYXdhaXQgdGhpcy5nZXRQbGF0Zm9ybVZlcnNpb24oKTtcbiAgICBzd2l0Y2ggKHBsYXRmb3JtVmVyc2lvbikge1xuICAgICAgY2FzZSAnNy4xJzpcbiAgICAgIGNhc2UgJzguMSc6XG4gICAgICBjYXNlICc4LjInOlxuICAgICAgY2FzZSAnOC4zJzpcbiAgICAgIGNhc2UgJzguNCc6XG4gICAgICAgIGluZGljYXRvciA9ICdwcm9maWxlZDogU2VydmljZSBzdGFydGluZy4uLic7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnOS4wJzpcbiAgICAgIGNhc2UgJzkuMSc6XG4gICAgICBjYXNlICc5LjInOlxuICAgICAgY2FzZSAnOS4zJzpcbiAgICAgICAgaW5kaWNhdG9yID0gJ1N5c3RlbSBhcHAgXCJjb20uYXBwbGUuc3ByaW5nYm9hcmRcIiBmaW5pc2hlZCBzdGFydHVwJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICcxMC4wJzpcbiAgICAgICAgaW5kaWNhdG9yID0gJ1N3aXRjaGluZyB0byBrZXlib2FyZCc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgbG9nLndhcm4oYE5vIGJvb3QgaW5kaWNhdG9yIGNhc2UgZm9yIHBsYXRmb3JtIHZlcnNpb24gJyR7cGxhdGZvcm1WZXJzaW9ufSdgKTtcbiAgICAgICAgaW5kaWNhdG9yID0gJ25vIGJvb3QgaW5kaWNhdG9yIHN0cmluZyBhdmFpbGFibGUnO1xuICAgIH1cbiAgICByZXR1cm4gaW5kaWNhdG9yO1xuICB9XG5cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gU2ltdWxhdG9yT3B0aW9uc1xuICAgKiBAcHJvcGVydHkgez9zdHJpbmd9IHNjYWxlRmFjdG9yIFtudWxsXSAtIERlZmluZXMgdGhlIHdpbmRvdyBzY2FsZSB2YWx1ZSBmb3IgdGhlIFVJIGNsaWVudCB3aW5kb3cgZm9yIHRoZSBjdXJyZW50IFNpbXVsYXRvci5cbiAgICogICBFcXVhbHMgdG8gbnVsbCBieSBkZWZhdWx0LCB3aGljaCBrZWVwcyB0aGUgY3VycmVudCBzY2FsZSB1bmNoYW5nZWQuXG4gICAqICAgSXQgc2hvdWxkIGJlIG9uZSBvZiBbJzEuMCcsICcwLjc1JywgJzAuNScsICcwLjMzJywgJzAuMjUnXS5cbiAgICogQHByb3BlcnR5IHtudW1iZXJ9IHN0YXJ0dXBUaW1lb3V0IFs2MDAwMF0gLSBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIHRvIHdhaXQgdW50aWwgU2ltdWxhdG9yIGJvb3RpbmdcbiAgICogICBwcm9jZXNzIGlzIGNvbXBsZXRlZC4gVGhlIGRlZmF1bHQgdGltZW91dCB3aWxsIGJlIHVzZWQgaWYgbm90IHNldCBleHBsaWNpdGx5LlxuICAgKi9cblxuICAvKipcbiAgICogU3RhcnQgdGhlIFNpbXVsYXRvciBVSSBjbGllbnQgd2l0aCB0aGUgZ2l2ZW4gYXJndW1lbnRzXG4gICAqIEBwYXJhbSB7U2ltdWxhdG9yT3B0aW9uc30gb3B0cyAtIFNpbXVsYXRvciBzdGFydHVwIG9wdGlvbnNcbiAgICovXG4gIGFzeW5jIHN0YXJ0VUlDbGllbnQgKG9wdHMgPSB7fSkge1xuICAgIG9wdHMgPSBfLmNsb25lRGVlcChvcHRzKTtcbiAgICBfLmRlZmF1bHRzRGVlcChvcHRzLCB7XG4gICAgICBzY2FsZUZhY3RvcjogbnVsbCxcbiAgICAgIHN0YXJ0dXBUaW1lb3V0OiB0aGlzLnN0YXJ0dXBUaW1lb3V0LFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc2ltdWxhdG9yQXBwID0gcGF0aC5yZXNvbHZlKGF3YWl0IGdldFhjb2RlUGF0aCgpLCAnQXBwbGljYXRpb25zJywgdGhpcy5zaW11bGF0b3JBcHApO1xuICAgIGNvbnN0IGFyZ3MgPSBbXG4gICAgICAnLUZuJywgc2ltdWxhdG9yQXBwLFxuICAgICAgJy0tYXJncycsICctQ3VycmVudERldmljZVVESUQnLCB0aGlzLnVkaWQsXG4gICAgXTtcblxuICAgIGlmIChvcHRzLnNjYWxlRmFjdG9yKSB7XG4gICAgICBjb25zdCB7bmFtZX0gPSBhd2FpdCB0aGlzLnN0YXQoKTtcbiAgICAgIGNvbnN0IGZvcm1hdHRlZERldmljZU5hbWUgPSBuYW1lLnJlcGxhY2UoL1xccysvZywgJy0nKTtcbiAgICAgIGNvbnN0IGFyZ3VtZW50TmFtZSA9IGAtU2ltdWxhdG9yV2luZG93TGFzdFNjYWxlLWNvbS5hcHBsZS5Db3JlU2ltdWxhdG9yLlNpbURldmljZVR5cGUuJHtmb3JtYXR0ZWREZXZpY2VOYW1lfWA7XG4gICAgICBhcmdzLnB1c2goYXJndW1lbnROYW1lLCBvcHRzLnNjYWxlRmFjdG9yKTtcbiAgICB9XG5cbiAgICBsb2cuaW5mbyhgU3RhcnRpbmcgU2ltdWxhdG9yIFVJIHdpdGggY29tbWFuZDogb3BlbiAke2FyZ3Muam9pbignICcpfWApO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBleGVjKCdvcGVuJywgYXJncywge3RpbWVvdXQ6IG9wdHMuc3RhcnR1cFRpbWVvdXR9KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghKGVyci5zdGRvdXQgfHwgJycpLmluY2x1ZGVzKCctMTA4MjUnKSAmJiAhKGVyci5zdGRlcnIgfHwgJycpLmluY2x1ZGVzKCctMTA4MjUnKSkge1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgICBsb2cud2FybihgRXJyb3Igd2hpbGUgb3BlbmluZyBVSTogJHtlcnIuc3Rkb3V0IHx8IGVyci5zdGRlcnJ9LiBDb250aW51aW5nYCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGVzIGdpdmVuIFNpbXVsYXRvciB3aXRoIG9wdGlvbnMuIFRoZSBTaW11bGF0b3Igd2lsbCBub3QgYmUgcmVzdGFydGVkIGlmXG4gICAqIGl0IGlzIGFscmVhZHkgcnVubmluZy5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IG9wdHMgLSBPbmUgb3IgbW9yZSBvZiBhdmFpbGFibGUgU2ltdWxhdG9yIG9wdGlvbnMuXG4gICAqICAgU2VlIHsjc3RhcnRVSUNsaWVudChvcHRzKX0gZG9jdW1lbnRhdGlvbiBmb3IgbW9yZSBkZXRhaWxzIG9uIG90aGVyIHN1cHBvcnRlZCBrZXlzLlxuICAgKi9cbiAgYXN5bmMgcnVuIChvcHRzID0ge30pIHtcbiAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7XG4gICAgICBzdGFydHVwVGltZW91dDogdGhpcy5zdGFydHVwVGltZW91dCxcbiAgICB9LCBvcHRzKTtcbiAgICBjb25zdCBpc1NlcnZlclJ1bm5pbmcgPSBhd2FpdCB0aGlzLmlzUnVubmluZygpO1xuICAgIGNvbnN0IGlzVUlDbGllbnRSdW5uaW5nID0gYXdhaXQgdGhpcy5pc1VJQ2xpZW50UnVubmluZygpO1xuICAgIGlmIChpc1NlcnZlclJ1bm5pbmcgJiYgaXNVSUNsaWVudFJ1bm5pbmcpIHtcbiAgICAgIGxvZy5pbmZvKGBCb3RoIFNpbXVsYXRvciB3aXRoIFVESUQgJHt0aGlzLnVkaWR9IGFuZCB0aGUgVUkgY2xpZW50IGFyZSBjdXJyZW50bHkgcnVubmluZ2ApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCB0aW1lciA9IG5ldyB0aW1pbmcuVGltZXIoKS5zdGFydCgpO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0aGlzLnNodXRkb3duKCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgRXJyb3Igb24gU2ltdWxhdG9yIHNodXRkb3duOiAke2Vyci5tZXNzYWdlfWApO1xuICAgIH1cbiAgICBhd2FpdCB0aGlzLnN0YXJ0VUlDbGllbnQob3B0cyk7XG5cbiAgICBhd2FpdCB0aGlzLndhaXRGb3JCb290KG9wdHMuc3RhcnR1cFRpbWVvdXQpO1xuICAgIGxvZy5pbmZvKGBTaW11bGF0b3Igd2l0aCBVRElEICR7dGhpcy51ZGlkfSBib290ZWQgaW4gJHt0aW1lci5nZXREdXJhdGlvbigpLmFzU2Vjb25kcy50b0ZpeGVkKDMpfXNgKTtcbiAgfVxuXG4gIC8vIFRPRE8ga2VlcCBrZXljaGFpbnNcbiAgLyoqXG4gICAqIFJlc2V0IHRoZSBjdXJyZW50IFNpbXVsYXRvciB0byB0aGUgY2xlYW4gc3RhdGUuXG4gICAqL1xuICBhc3luYyBjbGVhbiAoKSB7XG4gICAgYXdhaXQgdGhpcy5lbmRTaW11bGF0b3JEYWVtb24oKTtcbiAgICBsb2cuaW5mbyhgQ2xlYW5pbmcgc2ltdWxhdG9yICR7dGhpcy51ZGlkfWApO1xuICAgIGF3YWl0IHRoaXMuc2ltY3RsLmVyYXNlRGV2aWNlKDEwMDAwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTY3J1YiAoZGVsZXRlIHRoZSBwcmVmZXJlbmNlcyBhbmQgY2hhbmdlZCBmaWxlcykgdGhlIHBhcnRpY3VsYXIgYXBwbGljYXRpb24gb24gU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwRmlsZSAtIEFwcGxpY2F0aW9uIG5hbWUgbWludXMgXCIuYXBwXCIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBCdW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICovXG4gIGFzeW5jIHNjcnViQ3VzdG9tQXBwIChhcHBGaWxlLCBhcHBCdW5kbGVJZCkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmNsZWFuQ3VzdG9tQXBwKGFwcEZpbGUsIGFwcEJ1bmRsZUlkLCB0cnVlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbi9zY3J1YiB0aGUgcGFydGljdWxhciBhcHBsaWNhdGlvbiBvbiBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBGaWxlIC0gQXBwbGljYXRpb24gbmFtZSBtaW51cyBcIi5hcHBcIi5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcEJ1bmRsZUlkIC0gQnVuZGxlIGlkZW50aWZpZXIgb2YgdGhlIGFwcGxpY2F0aW9uLlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHNjcnViIC0gSWYgYHNjcnViYCBpcyBmYWxzZSwgd2Ugd2FudCB0byBjbGVhbiBieSBkZWxldGluZyB0aGUgYXBwIGFuZCBhbGxcbiAgICogICBmaWxlcyBhc3NvY2lhdGVkIHdpdGggaXQuIElmIGBzY3J1YmAgaXMgdHJ1ZSwgd2UganVzdCB3YW50IHRvIGRlbGV0ZSB0aGUgcHJlZmVyZW5jZXMgYW5kXG4gICAqICAgY2hhbmdlZCBmaWxlcy5cbiAgICovXG4gIGFzeW5jIGNsZWFuQ3VzdG9tQXBwIChhcHBGaWxlLCBhcHBCdW5kbGVJZCwgc2NydWIgPSBmYWxzZSkge1xuICAgIGxvZy5kZWJ1ZyhgQ2xlYW5pbmcgYXBwIGRhdGEgZmlsZXMgZm9yICcke2FwcEZpbGV9JywgJyR7YXBwQnVuZGxlSWR9J2ApO1xuICAgIGlmICghc2NydWIpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgRGVsZXRpbmcgYXBwIGFsdG9nZXRoZXJgKTtcbiAgICB9XG5cbiAgICAvLyBnZXQgdGhlIGRpcmVjdG9yaWVzIHRvIGJlIGRlbGV0ZWRcbiAgICBsZXQgYXBwRGlycyA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlycyhhcHBGaWxlLCBhcHBCdW5kbGVJZCwgc2NydWIpO1xuXG4gICAgaWYgKGFwcERpcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICBsb2cuZGVidWcoJ0NvdWxkIG5vdCBmaW5kIGFwcCBkaXJlY3RvcmllcyB0byBkZWxldGUuIEl0IGlzIHByb2JhYmx5IG5vdCBpbnN0YWxsZWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgZGVsZXRlUHJvbWlzZXMgPSBbXTtcblxuICAgIGZvciAobGV0IGRpciBvZiBhcHBEaXJzKSB7XG4gICAgICBsb2cuZGVidWcoYERlbGV0aW5nIGRpcmVjdG9yeTogJyR7ZGlyfSdgKTtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKGRpcikpO1xuICAgIH1cblxuICAgIGlmIChhd2FpdCB0aGlzLmdldFBsYXRmb3JtVmVyc2lvbigpID49IDgpIHtcbiAgICAgIGxldCByZWxSbVBhdGggPSBgTGlicmFyeS9QcmVmZXJlbmNlcy8ke2FwcEJ1bmRsZUlkfS5wbGlzdGA7XG4gICAgICBsZXQgcm1QYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMuZ2V0Um9vdERpcigpLCByZWxSbVBhdGgpO1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGluZyBmaWxlOiAnJHtybVBhdGh9J2ApO1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocm1QYXRoKSk7XG4gICAgfVxuXG4gICAgYXdhaXQgQi5hbGwoZGVsZXRlUHJvbWlzZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlIHBhdGhzIHRvIGRpcnMgd2hlcmUgYXBwbGljYXRpb24gZGF0YSBpcyBzdG9yZWQuIGlPUyA4KyBzdG9yZXMgYXBwIGRhdGEgaW4gdHdvIHBsYWNlcyxcbiAgICogYW5kIGlPUyA3LjEgaGFzIG9ubHkgb25lIGRpcmVjdG9yeVxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwRmlsZSAtIEFwcGxpY2F0aW9uIG5hbWUgbWludXMgXCIuYXBwXCIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBhcHBCdW5kbGVJZCAtIEJ1bmRsZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbi5cbiAgICogQHBhcmFtIHtib29sZWFufSBzY3J1YiAtIFRoZSBgQnVuZGxlYCBkaXJlY3RvcnkgaGFzIHRoZSBhY3R1YWwgYXBwIGluIGl0LiBJZiB3ZSBhcmUganVzdCBzY3J1YmJpbmcsXG4gICAqICAgd2Ugd2FudCB0aGlzIHRvIHN0YXkuIElmIHdlIGFyZSBjbGVhbmluZyB3ZSBkZWxldGUuXG4gICAqIEByZXR1cm4ge2FycmF5PHN0cmluZz59IEFycmF5IG9mIGFwcGxpY2F0aW9uIGRhdGEgcGF0aHMuXG4gICAqL1xuICBhc3luYyBnZXRBcHBEaXJzIChhcHBGaWxlLCBhcHBCdW5kbGVJZCwgc2NydWIgPSBmYWxzZSkge1xuICAgIGxldCBkaXJzID0gW107XG4gICAgaWYgKGF3YWl0IHRoaXMuZ2V0UGxhdGZvcm1WZXJzaW9uKCkgPj0gOCkge1xuICAgICAgbGV0IGRhdGEgPSBhd2FpdCB0aGlzLmdldEFwcERpcihhcHBCdW5kbGVJZCk7XG4gICAgICBpZiAoIWRhdGEpIHJldHVybiBkaXJzOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGN1cmx5XG5cbiAgICAgIGxldCBidW5kbGUgPSAhc2NydWIgPyBhd2FpdCB0aGlzLmdldEFwcERpcihhcHBCdW5kbGVJZCwgJ0J1bmRsZScpIDogdW5kZWZpbmVkO1xuXG4gICAgICBmb3IgKGxldCBzcmMgb2YgW2RhdGEsIGJ1bmRsZV0pIHtcbiAgICAgICAgaWYgKHNyYykge1xuICAgICAgICAgIGRpcnMucHVzaChzcmMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBkYXRhID0gYXdhaXQgdGhpcy5nZXRBcHBEaXIoYXBwRmlsZSk7XG4gICAgICBpZiAoZGF0YSkge1xuICAgICAgICBkaXJzLnB1c2goZGF0YSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkaXJzO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgdGhlIFNpbXVsYXRvciBpbiBvcmRlciB0byBoYXZlIHRoZSBpbml0aWFsIGZpbGUgc3RydWN0dXJlIGNyZWF0ZWQgYW5kIHNodXRkb3duIGl0IGFmdGVyd2FyZHMuXG4gICAqXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gc2FmYXJpIC0gV2hldGhlciB0byBleGVjdXRlIG1vYmlsZSBTYWZhcmkgYWZ0ZXIgc3RhcnR1cC5cbiAgICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0dXBUaW1lb3V0IC0gSG93IGxvbmcgdG8gd2FpdCB1bnRpbCBTaW11bGF0b3IgYm9vdGluZyBpcyBjb21wbGV0ZWQgKGluIG1pbGxpc2Vjb25kcykuXG4gICAqL1xuICBhc3luYyBsYXVuY2hBbmRRdWl0IChzYWZhcmkgPSBmYWxzZSwgc3RhcnR1cFRpbWVvdXQgPSB0aGlzLnN0YXJ0dXBUaW1lb3V0KSB7XG4gICAgbG9nLmRlYnVnKCdBdHRlbXB0aW5nIHRvIGxhdW5jaCBhbmQgcXVpdCB0aGUgc2ltdWxhdG9yIHRvIGNyZWF0ZSB0aGUgZGlyZWN0b3J5IHN0cnVjdHVyZScpO1xuICAgIGF3YWl0IHRoaXMucnVuKHtzdGFydHVwVGltZW91dH0pO1xuXG4gICAgaWYgKHNhZmFyaSkge1xuICAgICAgbG9nLmRlYnVnKCdTcGF3bmluZyBTYWZhcmkgYnJvd3NlciBpbiBvcmRlciB0byBjcmVhdGUgdGhlIG5lY2Vzc2FyeSBmaWxlIHN5c3RlbSBpdGVtcycpO1xuICAgICAgYXdhaXQgbGF1bmNoQXBwKHRoaXMuc2ltY3RsLCBNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCk7XG4gICAgfVxuXG4gICAgLy8gd2FpdCBmb3IgdGhlIHN5c3RlbSB0byBjcmVhdGUgdGhlIGZpbGVzIHdlIHdpbGwgbWFuaXB1bGF0ZVxuICAgIC8vIG5lZWQgcXVpdGUgYSBoaWdoIHJldHJ5IG51bWJlciwgaW4gb3JkZXIgdG8gYWNjb21tb2RhdGUgaU9TIDcuMVxuICAgIC8vIGxvY2FsbHksIDcuMSBhdmVyYWdlcyA4LjUgcmV0cmllcyAoZnJvbSA2IC0gMTIpXG4gICAgLy8gICAgICAgICAgOCBhdmVyYWdlcyAwLjYgcmV0cmllcyAoZnJvbSAwIC0gMilcbiAgICAvLyAgICAgICAgICA5IGF2ZXJhZ2VzIDE0IHJldHJpZXNcbiAgICB0cnkge1xuICAgICAgYXdhaXQgcmV0cnlJbnRlcnZhbCg2MCwgMjUwLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGlmIChhd2FpdCB0aGlzLmlzRnJlc2goKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2ltdWxhdG9yIGZpbGVzIG5vdCBmdWxseSBjcmVhdGVkLiBXYWl0aW5nIGEgYml0Jyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYFRpbWVvdXQgd2FpdGluZyBmb3Igc2ltdWxhdG9yIGZpbGVzIHRvIGJlIGNyZWF0ZWQuIENvbnRpbnVpbmdgKTtcbiAgICB9XG5cbiAgICAvLyBhbmQgcXVpdFxuICAgIGF3YWl0IHRoaXMuc2h1dGRvd24oKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBMb29rcyBmb3IgbGF1bmNoZCBkYWVtb25zIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHNpbSB1ZGlkIGFuZCB0cmllcyB0byBzdG9wIHRoZW0gY2xlYW5seVxuICAgKiBUaGlzIHByZXZlbnRzIHhjcnVuIHNpbWN0bCBlcmFzZSBmcm9tIGhhbmdpbmcuXG4gICAqL1xuICBhc3luYyBlbmRTaW11bGF0b3JEYWVtb24gKCkge1xuICAgIGxvZy5kZWJ1ZyhgS2lsbGluZyBhbnkgc2ltdWxhdG9yIGRhZW1vbnMgZm9yICR7dGhpcy51ZGlkfWApO1xuXG4gICAgbGV0IGxhdW5jaGN0bENtZCA9IGBsYXVuY2hjdGwgbGlzdCB8IGdyZXAgJHt0aGlzLnVkaWR9IHwgY3V0IC1mIDMgfCB4YXJncyAtbiAxIGxhdW5jaGN0bGA7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBzdG9wQ21kID0gYCR7bGF1bmNoY3RsQ21kfSBzdG9wYDtcbiAgICAgIGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJywgc3RvcENtZF0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYENvdWxkIG5vdCBzdG9wIHNpbXVsYXRvciBkYWVtb25zOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgbG9nLmRlYnVnKCdDYXJyeWluZyBvbiBhbnl3YXkhJyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBsZXQgcmVtb3ZlQ21kID0gYCR7bGF1bmNoY3RsQ21kfSByZW1vdmVgO1xuICAgICAgYXdhaXQgZXhlYygnYmFzaCcsIFsnLWMnLCByZW1vdmVDbWRdKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy53YXJuKGBDb3VsZCBub3QgcmVtb3ZlIHNpbXVsYXRvciBkYWVtb25zOiAke2Vyci5tZXNzYWdlfWApO1xuICAgICAgbG9nLmRlYnVnKCdDYXJyeWluZyBvbiBhbnl3YXkhJyk7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAvLyBXYWl0cyAxMCBzZWMgZm9yIHRoZSBzaW11bGF0b3IgbGF1bmNoZCBzZXJ2aWNlcyB0byBzdG9wLlxuICAgICAgYXdhaXQgd2FpdEZvckNvbmRpdGlvbihhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJyxcbiAgICAgICAgICBgcHMgLWUgIHwgZ3JlcCAke3RoaXMudWRpZH0gfCBncmVwIGxhdW5jaGRfc2ltIHwgZ3JlcCAtdiBiYXNoIHwgZ3JlcCAtdiBncmVwIHwgYXdrIHsncHJpbnQkMSd9YF0pO1xuICAgICAgICByZXR1cm4gc3Rkb3V0LnRyaW0oKS5sZW5ndGggPT09IDA7XG4gICAgICB9LCB7d2FpdE1zOiAxMDAwMCwgaW50ZXJ2YWxNczogNTAwfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgQ291bGQgbm90IGVuZCBzaW11bGF0b3IgZGFlbW9uIGZvciAke3RoaXMudWRpZH06ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICBsb2cuZGVidWcoJ0NhcnJ5aW5nIG9uIGFueXdheSEnKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHR5cGVkZWYge09iamVjdH0gU2h1dGRvd25PcHRpb25zXG4gICAqIEBwcm9wZXJ0eSB7P251bWJlcnxzdHJpbmd9IHRpbWVvdXQgVGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCB1bnRpbFxuICAgKiBTaW11bGF0b3IgaXMgc2h1dCBkb3duIGNvbXBsZXRlbHkuIE5vIHdhaXQgaGFwcGVucyBpZiB0aGUgdGltZW91dCB2YWx1ZSBpcyBub3Qgc2V0XG4gICAqL1xuXG4gIC8qKlxuICAgKiBTaHV0IGRvd24gdGhlIGN1cnJlbnQgU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0gez9TaHV0ZG93bk9wdGlvbnN9IG9wdHNcbiAgICogQHRocm93cyB7RXJyb3J9IElmIFNpbXVsYXRvciBmYWlscyB0byB0cmFuc2l0aW9uIGludG8gU2h1dGRvd24gc3RhdGUgYWZ0ZXJcbiAgICogdGhlIGdpdmVuIHRpbWVvdXRcbiAgICovXG4gIGFzeW5jIHNodXRkb3duIChvcHRzID0ge30pIHtcbiAgICBpZiAoYXdhaXQgdGhpcy5pc1NodXRkb3duKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBhd2FpdCByZXRyeUludGVydmFsKDUsIDUwMCwgdGhpcy5zaW1jdGwuc2h1dGRvd25EZXZpY2UuYmluZCh0aGlzLnNpbWN0bCkpO1xuICAgIGNvbnN0IHdhaXRNcyA9IHBhcnNlSW50KG9wdHMudGltZW91dCwgMTApO1xuICAgIGlmICh3YWl0TXMgPiAwKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IGF3YWl0IHRoaXMuaXNTaHV0ZG93bigpLCB7XG4gICAgICAgICAgd2FpdE1zLFxuICAgICAgICAgIGludGVydmFsTXM6IDEwMCxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBTaW11bGF0b3IgaXMgbm90IGluICdTaHV0ZG93bicgc3RhdGUgYWZ0ZXIgJHt3YWl0TXN9bXNgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlIHRoZSBwYXJ0aWN1bGFyIFNpbXVsYXRvciBmcm9tIGRldmljZXMgbGlzdFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlICgpIHtcbiAgICBhd2FpdCB0aGlzLnNpbWN0bC5kZWxldGVEZXZpY2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgdGhlIHBhcnRpY3VsYXIgcHJlZmVyZW5jZSBmaWxlIHdpdGggdGhlIGdpdmVuIGtleS92YWx1ZSBwYWlycy5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBsaXN0IC0gVGhlIHByZWZlcmVuY2VzIGZpbGUgdG8gdXBkYXRlLlxuICAgKiBAcGFyYW0ge29iamVjdH0gdXBkYXRlcyAtIFRoZSBrZXkvdmFsdWUgcGFpcnMgdG8gdXBkYXRlLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlU2V0dGluZ3MgKHBsaXN0LCB1cGRhdGVzKSB7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZVNldHRpbmdzKHRoaXMsIHBsaXN0LCB1cGRhdGVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBdXRob3JpemUvZGUtYXV0aG9yaXplIGxvY2F0aW9uIHNldHRpbmdzIGZvciBhIHBhcnRpY3VsYXIgYXBwbGljYXRpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBhcHBsaWNhdGlvbiBJRCB0byB1cGRhdGUuXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gYXV0aG9yaXplZCAtIFdoZXRoZXIgb3Igbm90IHRvIGF1dGhvcml6ZS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZUxvY2F0aW9uU2V0dGluZ3MgKGJ1bmRsZUlkLCBhdXRob3JpemVkKSB7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZUxvY2F0aW9uU2V0dGluZ3ModGhpcywgYnVuZGxlSWQsIGF1dGhvcml6ZWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEVuYWJsZS9EaXNhYmxlIHJlZHVjZSBtb3Rpb24uXG4gICAqXG4gICAqIEBwYXJhbSB7Ym9vbGVhbn0gcmVkdWNlTW90aW9uIC0gV2hldGhlciBvciBub3QgdG8gZW5hYmxlIGl0LlxuICAgKi9cbiAgYXN5bmMgc2V0UmVkdWNlTW90aW9uIChyZWR1Y2VNb3Rpb24gPSB0cnVlKSB7XG4gICAgaWYgKGF3YWl0IHRoaXMuaXNGcmVzaCgpKSB7XG4gICAgICBhd2FpdCB0aGlzLmxhdW5jaEFuZFF1aXQoZmFsc2UsIFNUQVJUVVBfVElNRU9VVCk7XG4gICAgfVxuXG4gICAgYXdhaXQgc2V0dGluZ3Muc2V0UmVkdWNlTW90aW9uKHRoaXMsIHJlZHVjZU1vdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyBVSSBhcHBlYXJhbmNlIHN0eWxlLlxuICAgKiBUaGlzIGZ1bmN0aW9uIGNhbiBvbmx5IGJlIGNhbGxlZCBvbiBhIGJvb3RlZCBzaW11bGF0b3IuXG4gICAqXG4gICAqIEBzaW5jZSBYY29kZSBTREsgMTEuNFxuICAgKi9cbiAgYXN5bmMgc2V0QXBwZWFyYW5jZSAoLyogdmFsdWUgKi8pIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBYY29kZSBTREsgJyR7dGhpcy54Y29kZVZlcnNpb259JyBpcyB0b28gb2xkIHRvIHNldCBVSSBhcHBlYXJhbmNlYCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgY3VycmVudCBVSSBhcHBlYXJhbmNlIHN0eWxlXG4gICAqIFRoaXMgZnVuY3Rpb24gY2FuIG9ubHkgYmUgY2FsbGVkIG9uIGEgYm9vdGVkIHNpbXVsYXRvci5cbiAgICpcbiAgICogQHNpbmNlIFhjb2RlIFNESyAxMS40XG4gICAqL1xuICBhc3luYyBnZXRBcHBlYXJhbmNlICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBYY29kZSBTREsgJyR7dGhpcy54Y29kZVZlcnNpb259JyBpcyB0b28gb2xkIHRvIGdldCBVSSBhcHBlYXJhbmNlYCk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNldHRpbmdzIGZvciBTYWZhcmkuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSB1cGRhdGVzIC0gVGhlIGhhc2ggb2Yga2V5L3ZhbHVlIHBhaXJzIHRvIHVwZGF0ZSBmb3IgU2FmYXJpLlxuICAgKi9cbiAgYXN5bmMgdXBkYXRlU2FmYXJpU2V0dGluZ3MgKHVwZGF0ZXMpIHtcbiAgICBsZXQgdXBkYXRlZCA9IGF3YWl0IHNldHRpbmdzLnVwZGF0ZVNhZmFyaVVzZXJTZXR0aW5ncyh0aGlzLCB1cGRhdGVzKTtcbiAgICByZXR1cm4gYXdhaXQgc2V0dGluZ3MudXBkYXRlU2V0dGluZ3ModGhpcywgJ21vYmlsZVNhZmFyaScsIHVwZGF0ZXMpIHx8IHVwZGF0ZWQ7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGdsb2JhbCBzZXR0aW5ncyBmb3IgU2FmYXJpLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdH0gdXBkYXRlcyAtIFRoZSBoYXNoIG9mIGtleS92YWx1ZSBwYWlycyB0byB1cGRhdGUgZm9yIFNhZmFyaS5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZVNhZmFyaUdsb2JhbFNldHRpbmdzICh1cGRhdGVzKSB7XG4gICAgcmV0dXJuIGF3YWl0IHNldHRpbmdzLnVwZGF0ZVNhZmFyaUdsb2JhbFNldHRpbmdzKHRoaXMsIHVwZGF0ZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSB0aGUgbG9jYWxlIGZvciB0aGUgU2ltdWxhdG9yLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbGFuZ3VhZ2UgLSBUaGUgbGFuZ3VhZ2UgZm9yIHRoZSBzaW11bGF0b3IuIEUuZy4sIGBcImZyX1VTXCJgLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbG9jYWxlIC0gVGhlIGxvY2FsZSB0byBzZXQgZm9yIHRoZSBzaW11bGF0b3IuIEUuZy4sIGBcImVuXCJgLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gY2FsZW5kYXJGb3JtYXQgLSBUaGUgZm9ybWF0IG9mIHRoZSBjYWxlbmRhci5cbiAgICovXG4gIGFzeW5jIHVwZGF0ZUxvY2FsZSAobGFuZ3VhZ2UsIGxvY2FsZSwgY2FsZW5kYXJGb3JtYXQpIHtcbiAgICByZXR1cm4gYXdhaXQgc2V0dGluZ3MudXBkYXRlTG9jYWxlKHRoaXMsIGxhbmd1YWdlLCBsb2NhbGUsIGNhbGVuZGFyRm9ybWF0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21wbGV0ZWx5IGRlbGV0ZSBtb2JpbGUgU2FmYXJpIGFwcGxpY2F0aW9uIGZyb20gdGhlIGN1cnJlbnQgU2ltdWxhdG9yLlxuICAgKi9cbiAgYXN5bmMgZGVsZXRlU2FmYXJpICgpIHtcbiAgICBsb2cuZGVidWcoJ0RlbGV0aW5nIFNhZmFyaSBhcHBzIGZyb20gc2ltdWxhdG9yJyk7XG5cbiAgICBsZXQgZGlycyA9IFtdO1xuXG4gICAgLy8gZ2V0IHRoZSBkYXRhIGRpcmVjdG9yeVxuICAgIGRpcnMucHVzaChhd2FpdCB0aGlzLmdldEFwcERpcihNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCkpO1xuXG4gICAgbGV0IHB2ID0gYXdhaXQgdGhpcy5nZXRQbGF0Zm9ybVZlcnNpb24oKTtcbiAgICBpZiAocHYgPj0gOCkge1xuICAgICAgLy8gZ2V0IHRoZSBidW5kbGUgZGlyZWN0b3J5XG4gICAgICBkaXJzLnB1c2goYXdhaXQgdGhpcy5nZXRBcHBEaXIoTU9CSUxFX1NBRkFSSV9CVU5ETEVfSUQsICdCdW5kbGUnKSk7XG4gICAgfVxuXG4gICAgbGV0IGRlbGV0ZVByb21pc2VzID0gW107XG4gICAgZm9yIChsZXQgZGlyIG9mIF8uY29tcGFjdChkaXJzKSkge1xuICAgICAgbG9nLmRlYnVnKGBEZWxldGluZyBkaXJlY3Rvcnk6ICcke2Rpcn0nYCk7XG4gICAgICBkZWxldGVQcm9taXNlcy5wdXNoKGZzLnJpbXJhZihkaXIpKTtcbiAgICB9XG4gICAgYXdhaXQgQi5hbGwoZGVsZXRlUHJvbWlzZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFuIHVwIHRoZSBkaXJlY3RvcmllcyBmb3IgbW9iaWxlIFNhZmFyaS5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBrZWVwUHJlZnMgLSBXaGV0aGVyIHRvIGtlZXAgU2FmYXJpIHByZWZlcmVuY2VzIGZyb20gYmVpbmcgZGVsZXRlZC5cbiAgICovXG4gIGFzeW5jIGNsZWFuU2FmYXJpIChrZWVwUHJlZnMgPSB0cnVlKSB7XG4gICAgbG9nLmRlYnVnKCdDbGVhbmluZyBtb2JpbGUgc2FmYXJpIGRhdGEgZmlsZXMnKTtcbiAgICBpZiAoYXdhaXQgdGhpcy5pc0ZyZXNoKCkpIHtcbiAgICAgIGxvZy5pbmZvKCdDb3VsZCBub3QgZmluZCBTYWZhcmkgc3VwcG9ydCBkaXJlY3RvcmllcyB0byBjbGVhbiBvdXQgb2xkICcgK1xuICAgICAgICAgICAgICAgJ2RhdGEuIFByb2JhYmx5IHRoZXJlIGlzIG5vdGhpbmcgdG8gY2xlYW4gb3V0Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGxpYnJhcnlEaXIgPSBwYXRoLnJlc29sdmUodGhpcy5nZXREaXIoKSwgJ0xpYnJhcnknKTtcbiAgICBsZXQgc2FmYXJpUm9vdCA9IGF3YWl0IHRoaXMuZ2V0QXBwRGlyKE1PQklMRV9TQUZBUklfQlVORExFX0lEKTtcbiAgICBpZiAoIXNhZmFyaVJvb3QpIHtcbiAgICAgIGxvZy5pbmZvKCdDb3VsZCBub3QgZmluZCBTYWZhcmkgc3VwcG9ydCBkaXJlY3RvcmllcyB0byBjbGVhbiBvdXQgb2xkICcgK1xuICAgICAgICAgICAgICAgJ2RhdGEuIFByb2JhYmx5IHRoZXJlIGlzIG5vdGhpbmcgdG8gY2xlYW4gb3V0Jyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBzYWZhcmlMaWJyYXJ5RGlyID0gcGF0aC5yZXNvbHZlKHNhZmFyaVJvb3QsICdMaWJyYXJ5Jyk7XG4gICAgbGV0IGZpbGVzVG9EZWxldGUgPSBbXG4gICAgICBgQ2FjaGVzL1NuYXBzaG90cy8ke01PQklMRV9TQUZBUklfQlVORExFX0lEfWAsXG4gICAgICBgQ2FjaGVzLyR7TU9CSUxFX1NBRkFSSV9CVU5ETEVfSUR9LypgLFxuICAgICAgJ0NhY2hlcy9jb20uYXBwbGUuV2ViQXBwQ2FjaGUvKicsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5XZWJLaXQuTmV0d29ya2luZy8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLldlYktpdC5XZWJDb250ZW50LyonLFxuICAgICAgJ0ltYWdlIENhY2hlLyonLFxuICAgICAgYFdlYktpdC8ke01PQklMRV9TQUZBUklfQlVORExFX0lEfS8qYCxcbiAgICAgICdXZWJLaXQvR2VvbG9jYXRpb25TaXRlcy5wbGlzdCcsXG4gICAgICAnV2ViS2l0L0xvY2FsU3RvcmFnZS8qLionLFxuICAgICAgJ1NhZmFyaS8qJyxcbiAgICAgICdDb29raWVzLyouYmluYXJ5Y29va2llcycsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5VSVN0YXR1c0Jhci8qJyxcbiAgICAgICdDYWNoZXMvY29tLmFwcGxlLmtleWJvYXJkcy9pbWFnZXMvKicsXG4gICAgICAnQ2FjaGVzL2NvbS5hcHBsZS5TYWZhcmkuU2FmZUJyb3dzaW5nLyonLFxuICAgICAgYC4uL3RtcC8ke01PQklMRV9TQUZBUklfQlVORExFX0lEfS8qYFxuICAgIF07XG4gICAgbGV0IGRlbGV0ZVByb21pc2VzID0gW107XG5cbiAgICBmb3IgKGxldCBmaWxlIG9mIGZpbGVzVG9EZWxldGUpIHtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKHBhdGgucmVzb2x2ZShsaWJyYXJ5RGlyLCBmaWxlKSkpO1xuICAgICAgZGVsZXRlUHJvbWlzZXMucHVzaChmcy5yaW1yYWYocGF0aC5yZXNvbHZlKHNhZmFyaUxpYnJhcnlEaXIsIGZpbGUpKSk7XG4gICAgfVxuXG4gICAgaWYgKCFrZWVwUHJlZnMpIHtcbiAgICAgIGRlbGV0ZVByb21pc2VzLnB1c2goZnMucmltcmFmKHBhdGgucmVzb2x2ZShzYWZhcmlMaWJyYXJ5RGlyLCAnUHJlZmVyZW5jZXMvKi5wbGlzdCcpKSk7XG4gICAgfVxuXG4gICAgYXdhaXQgQi5hbGwoZGVsZXRlUHJvbWlzZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVuaW5zdGFsbCB0aGUgZ2l2ZW4gYXBwbGljYXRpb24gZnJvbSB0aGUgY3VycmVudCBTaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIFRoZSBidWluZGxlIElEIG9mIHRoZSBhcHBsaWNhdGlvbiB0byBiZSByZW1vdmVkLlxuICAgKi9cbiAgYXN5bmMgcmVtb3ZlQXBwIChidW5kbGVJZCkge1xuICAgIGF3YWl0IHRoaXMuc2ltY3RsLnJlbW92ZUFwcChidW5kbGVJZCk7XG4gIH1cblxuICAvKipcbiAgICogTW92ZSBhIGJ1aWx0LWluIGFwcGxpY2F0aW9uIHRvIGEgbmV3IHBsYWNlIChhY3R1YWxseSwgcmVuYW1lIGl0KS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGFwcE5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgYXBwIHRvIGJlIG1vdmVkLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBjdXJyZW50IHBhdGggdG8gdGhlIGFwcGxpY2F0aW9uLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbmV3QXBwUGF0aCAtIFRoZSBuZXcgcGF0aCB0byB0aGUgYXBwbGljYXRpb24uXG4gICAqICAgSWYgc29tZSBhcHBsaWNhdGlvbiBhbHJlYWR5IGV4aXN0cyBieSB0aGlzIHBhdGggdGhlbiBpdCdzIGdvaW5nIHRvIGJlIHJlbW92ZWQuXG4gICAqL1xuICBhc3luYyBtb3ZlQnVpbHRJbkFwcCAoYXBwTmFtZSwgYXBwUGF0aCwgbmV3QXBwUGF0aCkge1xuICAgIGF3YWl0IHNhZmVSaW1SYWYobmV3QXBwUGF0aCk7XG4gICAgYXdhaXQgZnMuY29weUZpbGUoYXBwUGF0aCwgbmV3QXBwUGF0aCk7XG4gICAgbG9nLmRlYnVnKGBDb3BpZWQgJyR7YXBwTmFtZX0nIHRvICcke25ld0FwcFBhdGh9J2ApO1xuXG4gICAgYXdhaXQgZnMucmltcmFmKGFwcFBhdGgpO1xuICAgIGxvZy5kZWJ1ZyhgVGVtcG9yYXJpbHkgZGVsZXRlZCBvcmlnaW5hbCBhcHAgYXQgJyR7YXBwUGF0aH0nYCk7XG5cbiAgICByZXR1cm4gW25ld0FwcFBhdGgsIGFwcFBhdGhdO1xuICB9XG5cbiAgLyoqXG4gICAqIE9wZW4gdGhlIGdpdmVuIFVSTCBpbiBtb2JpbGUgU2FmYXJpIGJyb3dzZXIuXG4gICAqIFRoZSBicm93c2VyIHdpbGwgYmUgc3RhcnRlZCBhdXRvbWF0aWNhbGx5IGlmIGl0IGlzIG5vdCBydW5uaW5nLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdXJsIC0gVGhlIFVSTCB0byBiZSBvcGVuZWQuXG4gICAqL1xuICBhc3luYyBvcGVuVXJsICh1cmwpIHtcbiAgICBjb25zdCBTQUZBUklfQk9PVEVEX0lORElDQVRPUiA9ICdNb2JpbGVTYWZhcmlbJztcbiAgICBjb25zdCBTQUZBUklfU1RBUlRVUF9USU1FT1VUID0gMTUgKiAxMDAwO1xuICAgIGNvbnN0IEVYVFJBX1NUQVJUVVBfVElNRSA9IDMgKiAxMDAwO1xuXG4gICAgaWYgKGF3YWl0IHRoaXMuaXNSdW5uaW5nKCkpIHtcbiAgICAgIGF3YWl0IHJldHJ5KDUwMDAsIHRoaXMuc2ltY3RsLm9wZW5VcmwuYmluZCh0aGlzLnNpbWN0bCksIHVybCk7XG4gICAgICBhd2FpdCB0aGlzLnRhaWxMb2dzVW50aWwoU0FGQVJJX0JPT1RFRF9JTkRJQ0FUT1IsIFNBRkFSSV9TVEFSVFVQX1RJTUVPVVQpO1xuICAgICAgLy8gU28gc29ycnksIGJ1dCB0aGUgbG9ncyBoYXZlIG5vdGhpbmcgZWxzZSBmb3IgU2FmYXJpIHN0YXJ0aW5nLi4ganVzdCBkZWxheSBhIGxpdHRsZSBiaXRcbiAgICAgIGxvZy5kZWJ1ZyhgU2FmYXJpIHN0YXJ0ZWQsIHdhaXRpbmcgJHtFWFRSQV9TVEFSVFVQX1RJTUV9bXMgZm9yIGl0IHRvIGZ1bGx5IHN0YXJ0YCk7XG4gICAgICBhd2FpdCBCLmRlbGF5KEVYVFJBX1NUQVJUVVBfVElNRSk7XG4gICAgICBsb2cuZGVidWcoJ0RvbmUgd2FpdGluZyBmb3IgU2FmYXJpJyk7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVHJpZWQgdG8gb3BlbiBhIHVybCwgYnV0IHRoZSBTaW11bGF0b3IgaXMgbm90IEJvb3RlZCcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtIFNpbXVsYXRvciBjYWNoZXMgY2xlYW51cC5cbiAgICpcbiAgICogQHBhcmFtIHsuLi5zdHJpbmd9IGZvbGRlck5hbWVzIC0gVGhlIG5hbWVzIG9mIENhY2hlcyBzdWJmb2xkZXJzIHRvIGJlIGNsZWFuZWQuXG4gICAqICAgTm9uLWFjY2Vzc2libGUvbm9uLWV4aXN0aW5nIHN1YmZvbGRlcnMgd2lsbCBiZSBza2lwcGVkLlxuICAgKiAgIEFsbCBleGlzdGluZyBzdWJmb2xkZXJzIHVuZGVyIENhY2hlcyB3aWxsIGJlIGRlbGV0ZWQgaWYgdGhpcyBwYXJhbWV0ZXIgaXMgb21pdHRlZC5cbiAgICogQHJldHVybnMge251bWJlcn0gVGhlIGNvdW50IG9mIGNsZWFuZWQgY2FjaGUgaXRlbXMuXG4gICAqICAgWmVybyBpcyByZXR1cm5lZCBpZiBubyBpdGVtcyB3ZXJlIG1hdGNoZWQgZm9yIGNsZWFudXAgKGVpdGhlciBub3QgYWNjZXNzaWJsZSBvciBub3QgZGlyZWN0b3JpZXMpLlxuICAgKi9cbiAgYXN5bmMgY2xlYXJDYWNoZXMgKC4uLmZvbGRlck5hbWVzKSB7XG4gICAgY29uc3QgY2FjaGVzUm9vdCA9IHBhdGgucmVzb2x2ZSh0aGlzLmdldERpcigpLCAnTGlicmFyeScsICdDYWNoZXMnKTtcbiAgICBpZiAoIShhd2FpdCBmcy5oYXNBY2Nlc3MoY2FjaGVzUm9vdCkpKSB7XG4gICAgICBsb2cuZGVidWcoYENhY2hlcyByb290IGF0ICcke2NhY2hlc1Jvb3R9JyBkb2VzIG5vdCBleGlzdCBvciBpcyBub3QgYWNjZXNzaWJsZS4gTm90aGluZyB0byBkbyB0aGVyZWApO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgbGV0IGl0ZW1zVG9SZW1vdmUgPSBmb2xkZXJOYW1lcy5sZW5ndGggPyBmb2xkZXJOYW1lcyA6IChhd2FpdCBmcy5yZWFkZGlyKGNhY2hlc1Jvb3QpKTtcbiAgICBpdGVtc1RvUmVtb3ZlID0gaXRlbXNUb1JlbW92ZS5tYXAoKHgpID0+IHBhdGgucmVzb2x2ZShjYWNoZXNSb290LCB4KSk7XG4gICAgaWYgKGZvbGRlck5hbWVzLmxlbmd0aCkge1xuICAgICAgaXRlbXNUb1JlbW92ZSA9IGF3YWl0IEIuZmlsdGVyKGl0ZW1zVG9SZW1vdmUsICh4KSA9PiBmcy5oYXNBY2Nlc3MoeCkpO1xuICAgIH1cbiAgICBpdGVtc1RvUmVtb3ZlID0gYXdhaXQgQi5maWx0ZXIoaXRlbXNUb1JlbW92ZSwgYXN5bmMgKHgpID0+IChhd2FpdCBmcy5zdGF0KHgpKS5pc0RpcmVjdG9yeSgpKTtcbiAgICBpZiAoIWl0ZW1zVG9SZW1vdmUubGVuZ3RoKSB7XG4gICAgICBsb2cuZGVidWcoYE5vIFNpbXVsYXRvciBjYWNoZSBpdGVtcyBmb3IgY2xlYW51cCB3ZXJlIG1hdGNoZWQgaW4gJyR7Y2FjaGVzUm9vdH0nYCk7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBsb2cuZGVidWcoYE1hdGNoZWQgJHt1dGlsLnBsdXJhbGl6ZSgnc2ltdWxhdG9yIGNhY2hlIGl0ZW0nLCBpdGVtc1RvUmVtb3ZlLmxlbmd0aCwgdHJ1ZSl9IGAgK1xuICAgICAgYGZvciBjbGVhbnVwOiAke2l0ZW1zVG9SZW1vdmV9YCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IEIuYWxsKGl0ZW1zVG9SZW1vdmUsICh4KSA9PiBmcy5yaW1yYWYoeCkpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGxvZy53YXJuKGBHb3QgYW4gZXhjZXB0aW9uIHdoaWxlIGNsZWFuaW5nIFNpbXVsYXRvciBjYWNoZXM6ICR7ZS5tZXNzYWdlfWApO1xuICAgIH1cbiAgICByZXR1cm4gaXRlbXNUb1JlbW92ZS5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogQmxvY2tzIHVudGlsIHRoZSBnaXZlbiBpbmRpY2F0ZXIgc3RyaW5nIGFwcGVhcnMgaW4gU2ltdWxhdG9yIGxvZ3MuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBib290ZWRJbmRpY2F0b3IgLSBUaGUgbWFnaWMgc3RyaW5nLCB3aGljaCBhcHBlYXJzIGluIGxvZ3MgYWZ0ZXIgU2ltdWxhdG9yIGJvb3RpbmcgaXMgY29tcGxldGVkLlxuICAgKiBAcGFyYW0ge251bWJlcn0gdGltZW91dE1zIC0gVGhlIG1heGltdW1tIG51bWJlciBvZiBtaWxsaXNlY29uZHMgdG8gd2FpdCBmb3IgdGhlIHN0cmluZyBpbmRpY2F0b3IgcHJlc2VuY2UuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlfSBBIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSBpb3Mgc2ltdWxhdG9yIGxvZ3Mgb3V0cHV0IGEgbGluZSBtYXRjaGluZyBgYm9vdGVkSW5kaWNhdG9yYFxuICAgKiB0aW1lcyBvdXQgYWZ0ZXIgdGltZW91dE1zXG4gICAqL1xuICBhc3luYyB0YWlsTG9nc1VudGlsIChib290ZWRJbmRpY2F0b3IsIHRpbWVvdXRNcykge1xuICAgIGxldCBzaW1Mb2cgPSBwYXRoLnJlc29sdmUodGhpcy5nZXRMb2dEaXIoKSwgJ3N5c3RlbS5sb2cnKTtcblxuICAgIC8vIHdlIG5lZWQgdG8gbWFrZSBzdXJlIGxvZyBmaWxlIGV4aXN0cyBiZWZvcmUgd2UgY2FuIHRhaWwgaXRcbiAgICBhd2FpdCByZXRyeUludGVydmFsKDIwMCwgMjAwLCBhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgZXhpc3RzID0gYXdhaXQgZnMuZXhpc3RzKHNpbUxvZyk7XG4gICAgICBpZiAoIWV4aXN0cykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBmaW5kIFNpbXVsYXRvciBsb2c6ICcke3NpbUxvZ30nYCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBsb2cuaW5mbyhgU2ltdWxhdG9yIGxvZyBhdCAnJHtzaW1Mb2d9J2ApO1xuICAgIGxvZy5pbmZvKGBUYWlsaW5nIHNpbXVsYXRvciBsb2dzIHVudGlsIHdlIGVuY291bnRlciB0aGUgc3RyaW5nIFwiJHtib290ZWRJbmRpY2F0b3J9XCJgKTtcbiAgICBsb2cuaW5mbyhgV2Ugd2lsbCB0aW1lIG91dCBhZnRlciAke3RpbWVvdXRNc31tc2ApO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCB0YWlsVW50aWwoc2ltTG9nLCBib290ZWRJbmRpY2F0b3IsIHRpbWVvdXRNcyk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cuZGVidWcoJ1NpbXVsYXRvciBzdGFydHVwIHRpbWVkIG91dC4gQ29udGludWluZyBhbnl3YXkuJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEVuYWJsZSBDYWxlbmRhciBhY2Nlc3MgZm9yIHRoZSBnaXZlbiBhcHBsaWNhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlEIC0gQnVuZGxlIElEIG9mIHRoZSBhcHBsaWNhdGlvbiwgZm9yIHdoaWNoIHRoZSBhY2Nlc3Mgc2hvdWxkIGJlIGdyYW50ZWQuXG4gICAqL1xuICBhc3luYyBlbmFibGVDYWxlbmRhckFjY2VzcyAoYnVuZGxlSUQpIHtcbiAgICBhd2FpdCB0aGlzLmNhbGVuZGFyLmVuYWJsZUNhbGVuZGFyQWNjZXNzKGJ1bmRsZUlEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNhYmxlIENhbGVuZGFyIGFjY2VzcyBmb3IgdGhlIGdpdmVuIGFwcGxpY2F0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYnVuZGxlSUQgLSBCdW5kbGUgSUQgb2YgdGhlIGFwcGxpY2F0aW9uLCBmb3Igd2hpY2ggdGhlIGFjY2VzcyBzaG91bGQgYmUgZGVuaWVkLlxuICAgKi9cbiAgYXN5bmMgZGlzYWJsZUNhbGVuZGFyQWNjZXNzIChidW5kbGVJRCkge1xuICAgIGF3YWl0IHRoaXMuY2FsZW5kYXIuZGlzYWJsZUNhbGVuZGFyQWNjZXNzKGJ1bmRsZUlEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayB3aGV0aGVyIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBoYXMgYWNjZXNzIHRvIENhbGVuZGFyLlxuICAgKlxuICAgKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBoYXMgdGhlIGFjY2Vzcy5cbiAgICovXG4gIGFzeW5jIGhhc0NhbGVuZGFyQWNjZXNzIChidW5kbGVJRCkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmNhbGVuZGFyLmhhc0NhbGVuZGFyQWNjZXNzKGJ1bmRsZUlEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBY3RpdmF0ZXMgU2ltdWxhdG9yIHdpbmRvdy5cbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHJldHVybnMgez9zdHJpbmd9IElmIHRoZSBtZXRob2QgcmV0dXJucyBhIHN0cmluZyB0aGVuIGl0IHNob3VsZCBiZSBhIHZhbGlkIEFwcGxlIFNjcmlwdCB3aGljaFxuICAgKiBpcyBhcHBlbmRlZCBiZWZvcmUgZWFjaCBVSSBjbGllbnQgY29tbWFuZCBpcyBleGVjdXRlZC4gT3RoZXJ3aXNlIHRoZSBtZXRob2Qgc2hvdWxkIGFjdGl2YXRlIHRoZSB3aW5kb3dcbiAgICogaXRzZWxmIGFuZCByZXR1cm4gbm90aGluZy5cbiAgICovXG4gIGFzeW5jIF9hY3RpdmF0ZVdpbmRvdyAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIGNvbnN0IHBpZCA9IGF3YWl0IHRoaXMuZ2V0VUlDbGllbnRQaWQoKTtcbiAgICBpZiAocGlkKSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gYXdhaXQgYWN0aXZhdGVBcHAocGlkKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nLmRlYnVnKGUuc3RkZXJyIHx8IGUubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGZyb250bW9zdCB0byBmYWxzZVxuICAgICAgICAgIHNldCBmcm9udG1vc3QgdG8gdHJ1ZVxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgZ2l2ZW4gQXBwbGUgU2NyaXB0IGluc2lkZSBhIGNyaXRpY2FsIHNlY3Rpb24sIHNvIG90aGVyXG4gICAqIHNlc3Npb25zIGNhbm5vdCBpbmZsdWVuY2UgdGhlIFVJIGNsaWVudCBhdCB0aGUgc2FtZSB0aW1lLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gYXBwbGVTY3JpcHQgLSBUaGUgdmFsaWQgQXBwbGUgU2NyaXB0IHNuaXBwZXQgdG8gYmUgZXhlY3V0ZWQuXG4gICAqIEByZXR1cm4ge3N0cmluZ30gVGhlIHN0ZG91dCBvdXRwdXQgcHJvZHVjZWQgYnkgdGhlIHNjcmlwdC5cbiAgICogQHRocm93cyB7RXJyb3J9IElmIG9zYXNjcmlwdCB0b29sIHJldHVybnMgbm9uLXplcm8gZXhpdCBjb2RlLlxuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZVVJQ2xpZW50U2NyaXB0IChhcHBsZVNjcmlwdCkge1xuICAgIGNvbnN0IHdpbmRvd0FjdGl2YXRpb25TY3JpcHQgPSBhd2FpdCB0aGlzLl9hY3RpdmF0ZVdpbmRvdygpO1xuICAgIGNvbnN0IHJlc3VsdFNjcmlwdCA9IGAke3dpbmRvd0FjdGl2YXRpb25TY3JpcHQgPyB3aW5kb3dBY3RpdmF0aW9uU2NyaXB0ICsgJ1xcbicgOiAnJ30ke2FwcGxlU2NyaXB0fWA7XG4gICAgbG9nLmRlYnVnKGBFeGVjdXRpbmcgVUkgQXBwbGUgU2NyaXB0IG9uIFNpbXVsYXRvciB3aXRoIFVESUQgJHt0aGlzLnVkaWR9OiAke3Jlc3VsdFNjcmlwdH1gKTtcbiAgICByZXR1cm4gYXdhaXQgVUlfQ0xJRU5UX0FDQ0VTU19HVUFSRC5hY3F1aXJlKHRoaXMuc2ltdWxhdG9yQXBwLCBhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ29zYXNjcmlwdCcsIFsnLWUnLCByZXN1bHRTY3JpcHRdKTtcbiAgICAgICAgcmV0dXJuIHN0ZG91dDtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBsb2cuZXJyb3JBbmRUaHJvdyhgQ291bGQgbm90IGNvbXBsZXRlIG9wZXJhdGlvbi4gTWFrZSBzdXJlIFNpbXVsYXRvciBVSSBpcyBydW5uaW5nIGFuZCB0aGUgcGFyZW50IEFwcGl1bSBhcHBsaWNhdGlvbiAoZS4gZy4gQXBwaXVtLmFwcCBvciBUZXJtaW5hbC5hcHApIGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBgaXMgcHJlc2VudCBpbiBTeXN0ZW0gUHJlZmVyZW5jZXMgPiBTZWN1cml0eSAmIFByaXZhY3kgPiBQcml2YWN5ID4gQWNjZXNzaWJpbGl0eSBsaXN0LiBJZiB0aGUgb3BlcmF0aW9uIGlzIHN0aWxsIHVuc3VjY2Vzc2Z1bCB0aGVuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICBgaXQgaXMgbm90IHN1cHBvcnRlZCBieSB0aGlzIFNpbXVsYXRvci4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgc3RhdGUgb2YgQmlvbWV0cmljIEVucm9sbG1lbnQgZmVhdHVyZS5cbiAgICpcbiAgICogQHJldHVybnMge2Jvb2xlYW59IEVpdGhlciB0cnVlIG9yIGZhbHNlXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiBFbnJvbGxtZW50IHN0YXRlIGNhbm5vdCBiZSBkZXRlcm1pbmVkXG4gICAqL1xuICBhc3luYyBpc0Jpb21ldHJpY0Vucm9sbGVkICgpIHtcbiAgICBjb25zdCBvdXRwdXQgPSBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgc2V0IGRzdE1lbnVJdGVtIHRvIG1lbnUgaXRlbSBcIlRvdWNoIElEIEVucm9sbGVkXCIgb2YgbWVudSAxIG9mIG1lbnUgYmFyIGl0ZW0gXCJIYXJkd2FyZVwiIG9mIG1lbnUgYmFyIDFcbiAgICAgICAgICBzZXQgaXNDaGVja2VkIHRvICh2YWx1ZSBvZiBhdHRyaWJ1dGUgXCJBWE1lbnVJdGVtTWFya0NoYXJcIiBvZiBkc3RNZW51SXRlbSkgaXMgXCLinJNcIlxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgKTtcbiAgICBsb2cuZGVidWcoYFRvdWNoIElEIGVucm9sbGVkIHN0YXRlOiAke291dHB1dH1gKTtcbiAgICByZXR1cm4gXy5pc1N0cmluZyhvdXRwdXQpICYmIG91dHB1dC50cmltKCkgPT09ICd0cnVlJztcbiAgfVxuXG4gIC8qKlxuICAgKiBFbnJvbGxzIGJpb21ldHJpYyAoVG91Y2hJZCwgRmFjZUlkKSBmZWF0dXJlIHRlc3RpbmcgaW4gU2ltdWxhdG9yIFVJIGNsaWVudC5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBpc0VuYWJsZWQgLSBEZWZpbmVzIHdoZXRoZXIgYmlvbWV0cmljIHN0YXRlIGlzIGVuYWJsZWQvZGlzYWJsZWRcbiAgICogQHRocm93cyB7RXJyb3J9IElmIHRoZSBlbnJvbGxlZCBzdGF0ZSBjYW5ub3QgYmUgY2hhbmdlZFxuICAgKi9cbiAgYXN5bmMgZW5yb2xsQmlvbWV0cmljIChpc0VuYWJsZWQgPSB0cnVlKSB7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlVUlDbGllbnRTY3JpcHQoYFxuICAgICAgdGVsbCBhcHBsaWNhdGlvbiBcIlN5c3RlbSBFdmVudHNcIlxuICAgICAgICB0ZWxsIHByb2Nlc3MgXCJTaW11bGF0b3JcIlxuICAgICAgICAgIHNldCBkc3RNZW51SXRlbSB0byBtZW51IGl0ZW0gXCJUb3VjaCBJRCBFbnJvbGxlZFwiIG9mIG1lbnUgMSBvZiBtZW51IGJhciBpdGVtIFwiSGFyZHdhcmVcIiBvZiBtZW51IGJhciAxXG4gICAgICAgICAgc2V0IGlzQ2hlY2tlZCB0byAodmFsdWUgb2YgYXR0cmlidXRlIFwiQVhNZW51SXRlbU1hcmtDaGFyXCIgb2YgZHN0TWVudUl0ZW0pIGlzIFwi4pyTXCJcbiAgICAgICAgICBpZiAke2lzRW5hYmxlZCA/ICdub3QgJyA6ICcnfWlzQ2hlY2tlZCB0aGVuXG4gICAgICAgICAgICBjbGljayBkc3RNZW51SXRlbVxuICAgICAgICAgIGVuZCBpZlxuICAgICAgICBlbmQgdGVsbFxuICAgICAgZW5kIHRlbGxcbiAgICBgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kcyBhIG5vdGlmaWNhdGlvbiB0byBtYXRjaC9ub3QgbWF0Y2ggdGhlIHRvdWNoIGlkLlxuICAgKlxuICAgKiBAcGFyYW0gez9ib29sZWFufSBzaG91bGRNYXRjaCBbdHJ1ZV0gLSBTZXQgaXQgdG8gdHJ1ZSBvciBmYWxzZSBpbiBvcmRlciB0byBlbXVsYXRlXG4gICAqIG1hdGNoaW5nL25vdCBtYXRjaGluZyB0aGUgY29ycmVzcG9uZGluZyBiaW9tZXRyaWNcbiAgICovXG4gIGFzeW5jIHNlbmRCaW9tZXRyaWNNYXRjaCAoc2hvdWxkTWF0Y2ggPSB0cnVlKSB7XG4gICAgYXdhaXQgdGhpcy5leGVjdXRlVUlDbGllbnRTY3JpcHQoYFxuICAgICAgdGVsbCBhcHBsaWNhdGlvbiBcIlN5c3RlbSBFdmVudHNcIlxuICAgICAgICB0ZWxsIHByb2Nlc3MgXCJTaW11bGF0b3JcIlxuICAgICAgICAgIHNldCBkc3RNZW51SXRlbSB0byBtZW51IGl0ZW0gXCIke3Nob3VsZE1hdGNoID8gJ01hdGNoaW5nJyA6ICdOb24tbWF0Y2hpbmcnfVwiIG9mIG1lbnUgMSBvZiBtZW51IGl0ZW0gXCJTaW11bGF0ZSBGaW5nZXIgVG91Y2hcIiBvZiBtZW51IDEgb2YgbWVudSBiYXIgaXRlbSBcIkhhcmR3YXJlXCIgb2YgbWVudSBiYXIgMVxuICAgICAgICAgIGNsaWNrIGRzdE1lbnVJdGVtXG4gICAgICAgIGVuZCB0ZWxsXG4gICAgICBlbmQgdGVsbFxuICAgIGApO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYSBzcGVjaWFsIEFwcGxlIHNjcmlwdCwgd2hpY2ggY2xpY2tzIHRoZSBwYXJ0aWN1bGFyIGJ1dHRvbiBvbiBEYXRhYmFzZSBhbGVydC5cbiAgICpcbiAgICogQHBhcmFtIHtib29sZWFufSBpbmNyZWFzZSAtIENsaWNrIHRoZSBidXR0b24gd2l0aCAnSW5jcmVhc2UnIHRpdGxlIG9uIHRoZSBhbGVydCBpZiB0aGlzXG4gICAqICAgcGFyYW1ldGVyIGlzIHRydWUuIFRoZSAnQ2FuY2VsJyBidXR0b24gd2lsbCBiZSBjbGlja2VkIG90aGVyd2lzZS5cbiAgICovXG4gIGFzeW5jIGRpc21pc3NEYXRhYmFzZUFsZXJ0IChpbmNyZWFzZSA9IHRydWUpIHtcbiAgICBsZXQgYnV0dG9uID0gaW5jcmVhc2UgPyAnSW5jcmVhc2UnIDogJ0NhbmNlbCc7XG4gICAgbG9nLmRlYnVnKGBBdHRlbXB0aW5nIHRvIGRpc21pc3MgZGF0YWJhc2UgYWxlcnQgd2l0aCAnJHtidXR0b259JyBidXR0b25gKTtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVVSUNsaWVudFNjcmlwdChgXG4gICAgICB0ZWxsIGFwcGxpY2F0aW9uIFwiU3lzdGVtIEV2ZW50c1wiXG4gICAgICAgIHRlbGwgcHJvY2VzcyBcIlNpbXVsYXRvclwiXG4gICAgICAgICAgY2xpY2sgYnV0dG9uIFwiJHtidXR0b259XCIgb2Ygd2luZG93IDFcbiAgICAgICAgZW5kIHRlbGxcbiAgICAgIGVuZCB0ZWxsXG4gICAgYCk7XG4gIH1cblxuICAvL3JlZ2lvbiBLZXljaGFpbnMgSW50ZXJhY3Rpb25cbiAgLyoqXG4gICAqIENyZWF0ZSB0aGUgYmFja3VwIG9mIGtleWNoYWlucyBmb2xkZXIuXG4gICAqIFRoZSBwcmV2aW91c2x5IGNyZWF0ZWQgYmFja3VwIHdpbGwgYmUgYXV0b21hdGljYWxseVxuICAgKiBkZWxldGVkIGlmIHRoaXMgbWV0aG9kIHdhcyBjYWxsZWQgdHdpY2UgaW4gYSByb3cgd2l0aG91dFxuICAgKiBgcmVzdG9yZUtleWNoYWluc2AgYmVpbmcgaW52b2tlZC5cbiAgICpcbiAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIGJhY2t1cCBvcGVyYXRpb24gd2FzIHN1Y2Nlc3NmdWxsLlxuICAgKi9cbiAgYXN5bmMgYmFja3VwS2V5Y2hhaW5zICgpIHtcbiAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyh0aGlzLmtleWNoYWluUGF0aCkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBiYWNrdXBQYXRoID0gYXdhaXQgdGVtcERpci5wYXRoKHtcbiAgICAgIHByZWZpeDogYGtleWNoYWluc19iYWNrdXBfJHtNYXRoLmZsb29yKCgxICsgTWF0aC5yYW5kb20oKSkgKiAweDEwMDAwKS50b1N0cmluZygxNikuc3Vic3RyaW5nKDEpfWAsXG4gICAgICBzdWZmaXg6ICcuemlwJyxcbiAgICB9KTtcbiAgICBjb25zdCB6aXBBcmdzID0gW1xuICAgICAgJy1yJywgYmFja3VwUGF0aCxcbiAgICAgIGAke3RoaXMua2V5Y2hhaW5QYXRofSR7cGF0aC5zZXB9YFxuICAgIF07XG4gICAgbG9nLmRlYnVnKGBDcmVhdGluZyBrZXljaGFpbnMgYmFja3VwIHdpdGggJ3ppcCAke3ppcEFyZ3Muam9pbignICcpfScgY29tbWFuZGApO1xuICAgIGF3YWl0IGV4ZWMoJ3ppcCcsIHppcEFyZ3MpO1xuICAgIGlmIChfLmlzU3RyaW5nKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpICYmIGF3YWl0IGZzLmV4aXN0cyh0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoKSkge1xuICAgICAgYXdhaXQgZnMudW5saW5rKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpO1xuICAgIH1cbiAgICB0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoID0gYmFja3VwUGF0aDtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXN0b3JlIHRoZSBwcmV2aXNvdWx5IGNyZWF0ZWQga2V5Y2hhaW5zIGJhY2t1cC5cbiAgICpcbiAgICogQHBhcmFtIHs/c3RyaW5nfEFycmF5PHN0cmluZz59IGV4Y2x1ZGVQYXR0ZXJucyAtIFRoZSBsaXN0XG4gICAqIG9mIGZpbGUgbmFtZSBwYXR0ZXJucyB0byBiZSBleGNsdWRlZCBmcm9tIHJlc3RvcmUuIFRoZSBmb3JtYXRcbiAgICogb2YgZWFjaCBpdGVtIHNob3VsZCBiZSB0aGUgc2FtZSBhcyAnLXgnIG9wdGlvbiBmb3JtYXQgZm9yXG4gICAqICd1bnppcCcgdXRpbGl0eS4gVGhpcyBjYW4gYWxzbyBiZSBhIGNvbW1hLXNlcGFyYXRlZCBzdHJpbmcsXG4gICAqIHdoaWNoIGlzIGdvaW5nIGJlIHRyYW5zZm9ybWVkIGludG8gYSBsaXN0IGF1dG9tYXRpY2FsbHksXG4gICAqIGZvciBleGFtcGxlOiAnKi5kYiosYmxhYmxhLnNxbGl0ZSdcbiAgICogQHJldHVybnMge2Jvb2xlYW59IElmIHRoZSByZXN0b3JlIG9wcmF0aW9uIHdhcyBzdWNjZXNzZnVsLlxuICAgKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgaXMgbm8ga2V5Y2hhaW5zIGJhY2t1cCBhdmFpbGFibGUgZm9yIHJlc3RvcmUuXG4gICAqL1xuICBhc3luYyByZXN0b3JlS2V5Y2hhaW5zIChleGNsdWRlUGF0dGVybnMgPSBbXSkge1xuICAgIGlmICghXy5pc1N0cmluZyh0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoKSB8fCAhYXdhaXQgZnMuZXhpc3RzKHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBrZXljaGFpbnMgYmFja3VwIGFyY2hpdmUgZG9lcyBub3QgZXhpc3QuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBBcmUgeW91IHN1cmUgaXQgd2FzIGNyZWF0ZWQgYmVmb3JlP2ApO1xuICAgIH1cblxuICAgIGlmIChfLmlzU3RyaW5nKGV4Y2x1ZGVQYXR0ZXJucykpIHtcbiAgICAgIGV4Y2x1ZGVQYXR0ZXJucyA9IGV4Y2x1ZGVQYXR0ZXJucy5zcGxpdCgnLCcpLm1hcCgoeCkgPT4geC50cmltKCkpO1xuICAgIH1cbiAgICBjb25zdCBpc1NlcnZlclJ1bm5pbmcgPSBhd2FpdCB0aGlzLmlzUnVubmluZygpO1xuICAgIGxldCBwbGlzdFBhdGg7XG4gICAgaWYgKGlzU2VydmVyUnVubmluZykge1xuICAgICAgcGxpc3RQYXRoID0gcGF0aC5yZXNvbHZlKGF3YWl0IHRoaXMuZ2V0TGF1bmNoRGFlbW9uc1Jvb3QoKSwgJ2NvbS5hcHBsZS5zZWN1cml0eWQucGxpc3QnKTtcbiAgICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHBsaXN0UGF0aCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY2xlYXIga2V5Y2hhaW5zIGJlY2F1c2UgJyR7cGxpc3RQYXRofScgZG9lcyBub3QgZXhpc3RgKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbJ2xhdW5jaGN0bCcsICd1bmxvYWQnLCBwbGlzdFBhdGhdKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGZzLnJpbXJhZih0aGlzLmtleWNoYWluUGF0aCk7XG4gICAgICBhd2FpdCBta2RpcnAodGhpcy5rZXljaGFpblBhdGgpO1xuICAgICAgY29uc3QgdW56aXBBcmdzID0gW1xuICAgICAgICAnLW8nLCB0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoLFxuICAgICAgICAuLi4oXy5mbGF0TWFwKGV4Y2x1ZGVQYXR0ZXJucy5tYXAoKHgpID0+IFsnLXgnLCB4XSkpKSxcbiAgICAgICAgJy1kJywgJy8nXG4gICAgICBdO1xuICAgICAgbG9nLmRlYnVnKGBSZXN0b3Jpbmcga2V5Y2hhaW5zIHdpdGggJ3VuemlwICR7dW56aXBBcmdzLmpvaW4oJyAnKX0nIGNvbW1hbmRgKTtcbiAgICAgIGF3YWl0IGV4ZWMoJ3VuemlwJywgdW56aXBBcmdzKTtcbiAgICAgIGF3YWl0IGZzLnVubGluayh0aGlzLl9rZXljaGFpbnNCYWNrdXBQYXRoKTtcbiAgICAgIHRoaXMuX2tleWNoYWluc0JhY2t1cFBhdGggPSBudWxsO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBpZiAoaXNTZXJ2ZXJSdW5uaW5nICYmIHBsaXN0UGF0aCkge1xuICAgICAgICBhd2FpdCB0aGlzLnNpbWN0bC5zcGF3blByb2Nlc3MoWydsYXVuY2hjdGwnLCAnbG9hZCcsIHBsaXN0UGF0aF0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhcnMgS2V5Y2hhaW5zIGZvciB0aGUgcGFydGljdWxhciBzaW11bGF0b3IgaW4gcnVudGltZSAodGhlcmUgaXMgbm8gbmVlZCB0byBzdG9wIGl0KS5cbiAgICpcbiAgICogQHRocm93cyB7RXJyb3J9IElmIGtleWNoYWluIGNsZWFudXAgaGFzIGZhaWxlZC5cbiAgICovXG4gIGFzeW5jIGNsZWFyS2V5Y2hhaW5zICgpIHtcbiAgICBjb25zdCBwbGlzdFBhdGggPSBwYXRoLnJlc29sdmUoYXdhaXQgdGhpcy5nZXRMYXVuY2hEYWVtb25zUm9vdCgpLCAnY29tLmFwcGxlLnNlY3VyaXR5ZC5wbGlzdCcpO1xuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHBsaXN0UGF0aCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNsZWFyIGtleWNoYWlucyBiZWNhdXNlICcke3BsaXN0UGF0aH0nIGRvZXMgbm90IGV4aXN0YCk7XG4gICAgfVxuICAgIGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbJ2xhdW5jaGN0bCcsICd1bmxvYWQnLCBwbGlzdFBhdGhdKTtcbiAgICB0cnkge1xuICAgICAgaWYgKGF3YWl0IGZzLmV4aXN0cyh0aGlzLmtleWNoYWluUGF0aCkpIHtcbiAgICAgICAgYXdhaXQgZnMucmltcmFmKHRoaXMua2V5Y2hhaW5QYXRoKTtcbiAgICAgICAgYXdhaXQgbWtkaXJwKHRoaXMua2V5Y2hhaW5QYXRoKTtcbiAgICAgIH1cbiAgICB9IGZpbmFsbHkge1xuICAgICAgYXdhaXQgdGhpcy5zaW1jdGwuc3Bhd25Qcm9jZXNzKFsnbGF1bmNoY3RsJywgJ2xvYWQnLCBwbGlzdFBhdGhdKTtcbiAgICB9XG4gIH1cblxuICAvL2VuZHJlZ2lvblxuXG4gIC8qKlxuICAgKiBAdHlwZWRlZiB7T2JqZWN0fSBQcm9jZXNzSW5mb1xuICAgKiBAcHJvcGVydHkge251bWJlcn0gcGlkIFRoZSBhY3R1YWwgcHJvY2VzcyBpZGVudGlmaWVyLlxuICAgKiBDb3VsZCBiZSB6ZXJvIGlmIHRoZSBwcm9jZXNzIGlzIHRoZSBzeXN0ZW0gb25lLlxuICAgKiBAcHJvcGVydHkgez9zdHJpbmd9IGdyb3VwIFRoZSBwcm9jZXNzIGdyb3VwIGlkZW50aWZpZXIuXG4gICAqIFRoaXMgY291bGQgYmUgYG51bGxgIGlmIHRoZSBwcm9jZXNzIGlzIG5vdCBhIHBhcnQgb2YgdGhlXG4gICAqIHBhcnRpY3VsYXIgZ3JvdXAuIEZvciBgbm9ybWFsYCBhcHBsaWNhdGlvbiBwcm9jZXNzZXMgdGhlIGdyb3VwXG4gICAqIG5hbWUgdXN1YWxseSBlcXVhbHMgdG8gYFVJS2l0QXBwbGljYXRpb25gLlxuICAgKiBAcHJvcGVydHkge3N0cmluZ30gbmFtZSBUaGUgcHJvY2VzcyBuYW1lLCBmb3IgZXhhbXBsZVxuICAgKiBgY29tLmFwcGxlLlByZWZlcmVuY2VzYFxuICAgKi9cblxuICAvKipcbiAgICogTGlzdHMgcHJvY2Vzc2VzIHRoYXQgYXJlIGN1cnJlbnRseSBydW5uaW5nIG9uIHRoZSBnaXZlbiBTaW11bGF0b3IuXG4gICAqIFRoZSBzaW11bGF0b3IgbXVzdCBiZSBpbiBydW5uaW5nIHN0YXRlIGluIG9yZGVyIGZvciB0aGlzXG4gICAqIG1ldGhvZCB0byB3b3JrIHByb3Blcmx5LlxuICAgKlxuICAgKiBAcmV0dXJuIHtBcnJheTxQcm9jZXNzSW5mbz59IFRoZSBsaXN0IG9mIHJldHJpZXZlZCBwcm9jZXNzXG4gICAqIGluZm9ybWF0aW9uXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBpZiBubyBwcm9jZXNzIGluZm9ybWF0aW9uIGNvdWxkIGJlIHJldHJpZXZlZC5cbiAgICovXG4gIGFzeW5jIHBzICgpIHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IHRoaXMuc2ltY3RsLnNwYXduUHJvY2VzcyhbXG4gICAgICAnbGF1bmNoY3RsJyxcbiAgICAgICdwcmludCcsXG4gICAgICAnc3lzdGVtJyxcbiAgICBdKTtcblxuICAgIGNvbnN0IHNlcnZpY2VzTWF0Y2ggPSAvXlxccypzZXJ2aWNlc1xccyo9XFxzKnsoW159XSspL20uZXhlYyhzdGRvdXQpO1xuICAgIGlmICghc2VydmljZXNNYXRjaCkge1xuICAgICAgbG9nLmRlYnVnKHN0ZG91dCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBsaXN0IG9mIGFjdGl2ZSBwcm9jZXNzZXMgY2Fubm90IGJlIHJldHJpZXZlZGApO1xuICAgIH1cbiAgICAvKlxuICAgIEV4YW1wbGUgbWF0Y2g6XG4gICAgICAgIDAgICAgIDc4IFx0Y29tLmFwcGxlLnJlc291cmNlZ3JhYmJlcmRcbiAgICA4MjE1OCAgICAgIC0gXHRjb20uYXBwbGUuYXNzaXN0YW50X3NlcnZpY2VcbiAgICA4MjEyMCAgICAgIC0gXHRjb20uYXBwbGUubmFub3JlZ2lzdHJ5ZFxuICAgIDgyMDg3ICAgICAgLSBcdGNvbS5hcHBsZS5ub3RpZnlkXG4gICAgODIyNjQgICAgICAtIFx0VUlLaXRBcHBsaWNhdGlvbjpjb20uYXBwbGUuUHJlZmVyZW5jZXNbNzA0Yl1bcmItbGVnYWN5XVxuICAgICovXG4gICAgY29uc3QgcmVzdWx0ID0gW107XG4gICAgY29uc3QgcGF0dGVybiA9IC9eXFxzKihcXGQrKVxccytbXFxkLV0rXFxzKyhbXFx3XFwtLl0rOik/KFtcXHdcXC0uXSspL2dtO1xuICAgIGxldCBtYXRjaDtcbiAgICB3aGlsZSAoKG1hdGNoID0gcGF0dGVybi5leGVjKHNlcnZpY2VzTWF0Y2hbMV0pKSkge1xuICAgICAgcmVzdWx0LnB1c2goe1xuICAgICAgICBwaWQ6IHBhcnNlSW50KG1hdGNoWzFdLCAxMCksXG4gICAgICAgIGdyb3VwOiBfLnRyaW1FbmQobWF0Y2hbMl0sICc6JykgfHwgbnVsbCxcbiAgICAgICAgbmFtZTogbWF0Y2hbM10sXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBwYXJ0aWN1bGFyIHBlcm1pc3Npb24gdG8gdGhlIGFwcGxpY2F0aW9uIGJ1bmRsZS4gU2VlXG4gICAqIGh0dHBzOi8vZ2l0aHViLmNvbS93aXgvQXBwbGVTaW11bGF0b3JVdGlscyBmb3IgbW9yZSBkZXRhaWxzIG9uXG4gICAqIHRoZSBhdmFpbGFibGUgc2VydmljZSBuYW1lcyBhbmQgc3RhdHVzZXMuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIEFwcGxpY2F0aW9uIGJ1bmRsZSBpZGVudGlmaWVyLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGVybWlzc2lvbiAtIFNlcnZpY2UgbmFtZSB0byBiZSBzZXQuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIFRoZSBkZXNpcmVkIHN0YXR1cyBmb3IgdGhlIHNlcnZpY2UuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgY2hhbmdpbmcgcGVybWlzc2lvbi5cbiAgICovXG4gIGFzeW5jIHNldFBlcm1pc3Npb24gKGJ1bmRsZUlkLCBwZXJtaXNzaW9uLCB2YWx1ZSkge1xuICAgIGF3YWl0IHRoaXMuc2V0UGVybWlzc2lvbnMoYnVuZGxlSWQsIHtbcGVybWlzc2lvbl06IHZhbHVlfSk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgcGVybWlzc2lvbnMgZm9yIHRoZSBwYXJ0aWN1bGFyIGFwcGxpY2F0aW9uIGJ1bmRsZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGJ1bmRsZUlkIC0gQXBwbGljYXRpb24gYnVuZGxlIGlkZW50aWZpZXIuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwZXJtaXNzaW9uc01hcHBpbmcgLSBBIG1hcHBpbmcgd2hlcmUga2F5c1xuICAgKiBhcmUgc2VydmljZSBuYW1lcyBhbmQgdmFsdWVzIGFyZSB0aGVpciBjb3JyZXNwb25kaW5nIHN0YXR1cyB2YWx1ZXMuXG4gICAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vd2l4L0FwcGxlU2ltdWxhdG9yVXRpbHNcbiAgICogZm9yIG1vcmUgZGV0YWlscyBvbiBhdmFpbGFibGUgc2VydmljZSBuYW1lcyBhbmQgc3RhdHVzZXMuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgY2hhbmdpbmcgcGVybWlzc2lvbnMuXG4gICAqL1xuICBhc3luYyBzZXRQZXJtaXNzaW9ucyAoYnVuZGxlSWQsIHBlcm1pc3Npb25zTWFwcGluZykge1xuICAgIGxvZy5kZWJ1ZyhgU2V0dGluZyBhY2Nlc3MgZm9yICcke2J1bmRsZUlkfSc6IGAgK1xuICAgICAgSlNPTi5zdHJpbmdpZnkocGVybWlzc2lvbnNNYXBwaW5nLCBudWxsLCAyKSk7XG4gICAgYXdhaXQgdGhpcy5wZXJtaXNzaW9ucy5zZXRBY2Nlc3MoYnVuZGxlSWQsIHBlcm1pc3Npb25zTWFwcGluZyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGN1cnJlbnQgcGVybWlzc2lvbiBzdGF0dXMgZm9yIHRoZSBnaXZlbiBhcHBsaWNhdGlvbiBidW5kbGUuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCAtIEFwcGxpY2F0aW9uIGJ1bmRsZSBpZGVudGlmaWVyLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gc2VydmljZU5hbWUgLSBPbmUgb2YgYXZhaWxhYmxlIHNlcnZpY2UgbmFtZXMuXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgcmV0cmlldmluZyBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIGdldFBlcm1pc3Npb24gKGJ1bmRsZUlkLCBzZXJ2aWNlTmFtZSkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucGVybWlzc2lvbnMuZ2V0QWNjZXNzKGJ1bmRsZUlkLCBzZXJ2aWNlTmFtZSk7XG4gICAgbG9nLmRlYnVnKGBHb3QgJHtzZXJ2aWNlTmFtZX0gYWNjZXNzIHN0YXR1cyBmb3IgJyR7YnVuZGxlSWR9JzogJHtyZXN1bHR9YCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIHRoZSBnaXZlbiBjZXJ0aWZpY2F0ZSBpbnRvIHRoZSBUcnVzdGVkIFJvb3QgU3RvcmUgb24gdGhlIHNpbXVsYXRvci5cbiAgICogVGhlIHNpbXVsYXRvciBtdXN0IGJlIHNodXQgZG93biBpbiBvcmRlciBmb3IgdGhpcyBtZXRob2QgdG8gd29yayBwcm9wZXJseS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHBheWxvYWQgdGhlIGNvbnRlbnQgb2YgdGhlIFBFTSBjZXJ0aWZpY2F0ZVxuICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gYHRydWVgIGlmIHRoZSBjZXJ0aWZpY2F0ZSBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgaW5zdGFsbGVkXG4gICAqIG9yIGBmYWxzZWAgaWYgaXQgaGFzIGFscmVhZHkgYmVlbiB0aGVyZVxuICAgKi9cbiAgYXN5bmMgYWRkQ2VydGlmaWNhdGUgKHBheWxvYWQsIC8qIG9wdHMgPSB7fSAqLykge1xuICAgIGlmIChhd2FpdCBoYXNTU0xDZXJ0KHBheWxvYWQsIHRoaXMudWRpZCkpIHtcbiAgICAgIGxvZy5pbmZvKGBTU0wgY2VydGlmaWNhdGUgJyR7Xy50cnVuY2F0ZShwYXlsb2FkLCB7bGVuZ3RoOiAyMH0pfScgYWxyZWFkeSBpbnN0YWxsZWRgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgbG9nLmluZm8oYEluc3RhbGxpbmcgU1NMIHJvb3QgY2VydGlmaWNhdGUgJyR7Xy50cnVuY2F0ZShwYXlsb2FkLCB7bGVuZ3RoOiAyMH0pfSdgKTtcbiAgICBhd2FpdCBpbnN0YWxsU1NMQ2VydChwYXlsb2FkLCB0aGlzLnVkaWQpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFNpbXVsYXRlcyBwdXNoIG5vdGlmaWNhdGlvbiBkZWxpdmVyeVxuICAgKlxuICAgKiBAc2luY2UgWGNvZGUgU0RLIDExLjRcbiAgICovXG4gIGFzeW5jIHB1c2hOb3RpZmljYXRpb24gKC8qIHBheWxvYWQgKi8pIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBYY29kZSBTREsgJyR7dGhpcy54Y29kZVZlcnNpb259JyBpcyB0b28gb2xkIHRvIHB1c2ggbm90aWZpY2F0aW9uc2ApO1xuICB9XG5cbiAgYXN5bmMgZ2V0TGF1bmNoRGFlbW9uc1Jvb3QgKCkge1xuICAgIGNvbnN0IGRldlJvb3QgPSBhd2FpdCBnZXREZXZlbG9wZXJSb290KCk7XG4gICAgcmV0dXJuIHBhdGgucmVzb2x2ZShkZXZSb290LFxuICAgICAgJ1BsYXRmb3Jtcy9pUGhvbmVTaW11bGF0b3IucGxhdGZvcm0vRGV2ZWxvcGVyL1NES3MvaVBob25lU2ltdWxhdG9yLnNkay9TeXN0ZW0vTGlicmFyeS9MYXVuY2hEYWVtb25zJyk7XG4gIH1cblxuICBzdGF0aWMgYXN5bmMgX2dldERldmljZVN0cmluZ1BsYXRmb3JtVmVyc2lvbiAocGxhdGZvcm1WZXJzaW9uKSB7XG4gICAgbGV0IHJlcVZlcnNpb24gPSBwbGF0Zm9ybVZlcnNpb247XG4gICAgaWYgKCFyZXFWZXJzaW9uKSB7XG4gICAgICByZXFWZXJzaW9uID0gYXdhaXQgeGNvZGUuZ2V0TWF4SU9TU0RLKCk7XG4gICAgICBsb2cud2FybihgTm8gcGxhdGZvcm0gdmVyc2lvbiBzZXQuIFVzaW5nIG1heCBTREsgdmVyc2lvbjogJHtyZXFWZXJzaW9ufWApO1xuICAgICAgLy8gdGhpcyB3aWxsIGJlIGEgbnVtYmVyLCBhbmQgcG9zc2libHkgYW4gaW50ZWdlciAoZS5nLiwgaWYgbWF4IGlPUyBTREsgaXMgOSlcbiAgICAgIC8vIHNvIHR1cm4gaXQgaW50byBhIHN0cmluZyBhbmQgYWRkIGEgLjAgaWYgbmVjZXNzYXJ5XG4gICAgICBpZiAoIV8uaXNTdHJpbmcocmVxVmVyc2lvbikpIHtcbiAgICAgICAgcmVxVmVyc2lvbiA9IChyZXFWZXJzaW9uICUgMSkgPyBTdHJpbmcocmVxVmVyc2lvbikgOiBgJHtyZXFWZXJzaW9ufS4wYDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcVZlcnNpb247XG4gIH1cblxuICAvLyBjaGFuZ2UgdGhlIGZvcm1hdCBpbiBzdWJjbGFzc2VzLCBhcyBuZWNlc3NhcnlcbiAgc3RhdGljIGFzeW5jIF9nZXREZXZpY2VTdHJpbmdWZXJzaW9uU3RyaW5nIChwbGF0Zm9ybVZlcnNpb24pIHtcbiAgICBsZXQgcmVxVmVyc2lvbiA9IGF3YWl0IHRoaXMuX2dldERldmljZVN0cmluZ1BsYXRmb3JtVmVyc2lvbihwbGF0Zm9ybVZlcnNpb24pO1xuXG4gICAgcmV0dXJuIGAoJHtyZXFWZXJzaW9ufSBTaW11bGF0b3IpYDtcbiAgfVxuXG4gIC8vIGNoYW5nZSB0aGUgZm9ybWF0IGluIHN1YmNsYXNzZXMsIGFzIG5lY2Vzc2FyeVxuICBzdGF0aWMgX2dldERldmljZVN0cmluZ0NvbmZpZ0ZpeCAoKSB7XG4gICAgLy8gc29tZSBkZXZpY2VzIG5lZWQgdG8gYmUgdXBkYXRlZFxuICAgIHJldHVybiB7XG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDcuMSBTaW11bGF0b3IpJzogJ2lQYWQgMiAoNy4xIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjAgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguMCBTaW11bGF0b3IpJyxcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoOC4xIFNpbXVsYXRvciknOiAnaVBhZCAyICg4LjEgU2ltdWxhdG9yKScsXG4gICAgICAnaVBhZCBTaW11bGF0b3IgKDguMiBTaW11bGF0b3IpJzogJ2lQYWQgMiAoOC4yIFNpbXVsYXRvciknLFxuICAgICAgJ2lQYWQgU2ltdWxhdG9yICg4LjMgU2ltdWxhdG9yKSc6ICdpUGFkIDIgKDguMyBTaW11bGF0b3IpJyxcbiAgICAgICdpUGFkIFNpbXVsYXRvciAoOC40IFNpbXVsYXRvciknOiAnaVBhZCAyICg4LjQgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoNy4xIFNpbXVsYXRvciknOiAnaVBob25lIDVzICg3LjEgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoOC40IFNpbXVsYXRvciknOiAnaVBob25lIDYgKDguNCBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjMgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC4zIFNpbXVsYXRvciknLFxuICAgICAgJ2lQaG9uZSBTaW11bGF0b3IgKDguMiBTaW11bGF0b3IpJzogJ2lQaG9uZSA2ICg4LjIgU2ltdWxhdG9yKScsXG4gICAgICAnaVBob25lIFNpbXVsYXRvciAoOC4xIFNpbXVsYXRvciknOiAnaVBob25lIDYgKDguMSBTaW11bGF0b3IpJyxcbiAgICAgICdpUGhvbmUgU2ltdWxhdG9yICg4LjAgU2ltdWxhdG9yKSc6ICdpUGhvbmUgNiAoOC4wIFNpbXVsYXRvciknXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUYWtlcyBhIHNldCBvZiBvcHRpb25zIGFuZCBmaW5kcyB0aGUgY29ycmVjdCBkZXZpY2Ugc3RyaW5nIGluIG9yZGVyIGZvciBJbnN0cnVtZW50cyB0b1xuICAgKiBpZGVudGlmeSB0aGUgY29ycmVjdCBzaW11bGF0b3IuXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRzIC0gVGhlIG9wdGlvbnMgYXZhaWxhYmxlIGFyZTpcbiAgICogICAtIGBkZXZpY2VOYW1lYCAtIGEgbmFtZSBmb3IgdGhlIGRldmljZS4gSWYgdGhlIGdpdmVuIGRldmljZSBuYW1lIHN0YXJ0cyB3aXRoIGA9YCwgdGhlIG5hbWUsIGxlc3MgdGhlIGVxdWFscyBzaWduLCBpcyByZXR1cm5lZC5cbiAgICogICAtIGBwbGF0Zm9ybVZlcnNpb25gIC0gdGhlIHZlcnNpb24gb2YgaU9TIHRvIHVzZS4gRGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgWGNvZGUncyBtYXhpbXVtIFNESyB2ZXJzaW9uLlxuICAgKiAgIC0gYGZvcmNlSXBob25lYCAtIGZvcmNlIHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSBkZXZpY2Ugc3RyaW5nIHRvIGlQaG9uZS4gRGVmYXVsdHMgdG8gYGZhbHNlYC5cbiAgICogICAtIGBmb3JjZUlwYWRgIC0gZm9yY2UgdGhlIGNvbmZpZ3VyYXRpb24gb2YgdGhlIGRldmljZSBzdHJpbmcgdG8gaVBhZC4gRGVmYXVsdHMgdG8gYGZhbHNlYC5cbiAgICogICBJZiBib3RoIGBmb3JjZUlwaG9uZWAgYW5kIGBmb3JjZUlwYWRgIGFyZSB0cnVlLCB0aGUgZGV2aWNlIHdpbGwgYmUgZm9yY2VkIHRvIGlQaG9uZS5cbiAgICpcbiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgZm91bmQgZGV2aWNlIHN0cmluZy5cbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXREZXZpY2VTdHJpbmcgKG9wdHMpIHtcbiAgICBvcHRzID0gT2JqZWN0LmFzc2lnbih7fSwge1xuICAgICAgZGV2aWNlTmFtZTogbnVsbCxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbjogbnVsbCxcbiAgICAgIGZvcmNlSXBob25lOiBmYWxzZSxcbiAgICAgIGZvcmNlSXBhZDogZmFsc2VcbiAgICB9LCBvcHRzKTtcbiAgICBsZXQgbG9nT3B0cyA9IHtcbiAgICAgIGRldmljZU5hbWU6IG9wdHMuZGV2aWNlTmFtZSxcbiAgICAgIHBsYXRmb3JtVmVyc2lvbjogb3B0cy5wbGF0Zm9ybVZlcnNpb24sXG4gICAgICBmb3JjZUlwaG9uZTogb3B0cy5mb3JjZUlwaG9uZSxcbiAgICAgIGZvcmNlSXBhZDogb3B0cy5mb3JjZUlwYWRcbiAgICB9O1xuICAgIGxvZy5kZWJ1ZyhgR2V0dGluZyBkZXZpY2Ugc3RyaW5nIGZyb20gb3B0aW9uczogJHtKU09OLnN0cmluZ2lmeShsb2dPcHRzKX1gKTtcblxuICAgIC8vIHNob3J0IGNpcmN1aXQgaWYgd2UgYWxyZWFkeSBoYXZlIGEgZGV2aWNlIG5hbWVcbiAgICBpZiAoKG9wdHMuZGV2aWNlTmFtZSB8fCAnJylbMF0gPT09ICc9Jykge1xuICAgICAgcmV0dXJuIG9wdHMuZGV2aWNlTmFtZS5zdWJzdHJpbmcoMSk7XG4gICAgfVxuXG4gICAgbGV0IGlzaVBob25lID0gISFvcHRzLmZvcmNlSXBob25lIHx8ICFvcHRzLmZvcmNlSXBhZDtcblxuICAgIGlmIChvcHRzLmRldmljZU5hbWUpIHtcbiAgICAgIGxldCBkZXZpY2UgPSBvcHRzLmRldmljZU5hbWUudG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmIChkZXZpY2UuaW5kZXhPZignaXBob25lJykgIT09IC0xKSB7XG4gICAgICAgIGlzaVBob25lID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAoZGV2aWNlLmluZGV4T2YoJ2lwYWQnKSAhPT0gLTEpIHtcbiAgICAgICAgaXNpUGhvbmUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgaW9zRGV2aWNlU3RyaW5nID0gb3B0cy5kZXZpY2VOYW1lIHx8IChpc2lQaG9uZSA/ICdpUGhvbmUgU2ltdWxhdG9yJyA6ICdpUGFkIFNpbXVsYXRvcicpO1xuXG4gICAgLy8gaWYgc29tZW9uZSBwYXNzZXMgaW4ganVzdCBcImlQaG9uZVwiLCBtYWtlIHRoYXQgXCJpUGhvbmUgU2ltdWxhdG9yXCIgdG9cbiAgICAvLyBjb25mb3JtIHRvIGFsbCB0aGUgbG9naWMgYmVsb3dcbiAgICBpZiAoL14oaVBob25lfGlQYWQpJC8udGVzdChpb3NEZXZpY2VTdHJpbmcpKSB7XG4gICAgICBpb3NEZXZpY2VTdHJpbmcgKz0gJyBTaW11bGF0b3InO1xuICAgIH1cblxuICAgIC8vIHdlIHN1cHBvcnQgZGV2aWNlTmFtZTogXCJpUGhvbmUgU2ltdWxhdG9yXCIsIGFuZCBhbHNvIHdhbnQgdG8gc3VwcG9ydFxuICAgIC8vIFwiaVBob25lIFhZWiBTaW11bGF0b3JcIiwgYnV0IHRoZXNlIHN0cmluZ3MgYXJlbid0IGluIHRoZSBkZXZpY2UgbGlzdC5cbiAgICAvLyBTbywgaWYgc29tZW9uZSBzZW50IGluIFwiaVBob25lIFhZWiBTaW11bGF0b3JcIiwgc3RyaXAgb2ZmIFwiIFNpbXVsYXRvclwiXG4gICAgLy8gaW4gb3JkZXIgdG8gYWxsb3cgdGhlIGRlZmF1bHQgXCJpUGhvbmUgWFlaXCIgbWF0Y2hcbiAgICBpZiAoL1teKGlQaG9uZXxpUGFkKV0gU2ltdWxhdG9yLy50ZXN0KGlvc0RldmljZVN0cmluZykpIHtcbiAgICAgIGlvc0RldmljZVN0cmluZyA9IGlvc0RldmljZVN0cmluZy5yZXBsYWNlKCcgU2ltdWxhdG9yJywgJycpO1xuICAgIH1cbiAgICBpb3NEZXZpY2VTdHJpbmcgKz0gYCAke2F3YWl0IHRoaXMuX2dldERldmljZVN0cmluZ1ZlcnNpb25TdHJpbmcob3B0cy5wbGF0Zm9ybVZlcnNpb24pfWA7XG5cbiAgICBsZXQgQ09ORklHX0ZJWCA9IHRoaXMuX2dldERldmljZVN0cmluZ0NvbmZpZ0ZpeCgpO1xuXG4gICAgbGV0IGNvbmZpZ0ZpeCA9IENPTkZJR19GSVg7XG4gICAgaWYgKGNvbmZpZ0ZpeFtpb3NEZXZpY2VTdHJpbmddKSB7XG4gICAgICBpb3NEZXZpY2VTdHJpbmcgPSBjb25maWdGaXhbaW9zRGV2aWNlU3RyaW5nXTtcbiAgICAgIGxvZy5kZWJ1ZyhgRml4aW5nIGRldmljZS4gQ2hhbmdlZCBmcm9tICcke29wdHMuZGV2aWNlTmFtZX0nIGAgK1xuICAgICAgICAgICAgICAgIGB0byAnJHtpb3NEZXZpY2VTdHJpbmd9J2ApO1xuICAgIH1cblxuICAgIGxvZy5kZWJ1ZyhgRmluYWwgZGV2aWNlIHN0cmluZyBpcyAnJHtpb3NEZXZpY2VTdHJpbmd9J2ApO1xuICAgIHJldHVybiBpb3NEZXZpY2VTdHJpbmc7XG4gIH1cblxuICAvKipcbiAgICogQHJldHVybiB7P3N0cmluZ30gVGhlIGZ1bGwgcGF0aCB0byB0aGUgc2ltdWxhdG9yJ3MgV2ViSW5zcGVjdG9yIFVuaXggRG9tYWluIFNvY2tldFxuICAgKiAgIG9yIGBudWxsYCBpZiB0aGVyZSBpcyBubyBzb2NrZXQuXG4gICAqL1xuICBhc3luYyBnZXRXZWJJbnNwZWN0b3JTb2NrZXQgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICAvLyB0aGVyZSBpcyBubyBXZWJJbnNwZWN0b3Igc29ja2V0IGZvciB0aGlzIHZlcnNpb24gb2YgWGNvZGVcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5mb3IgKGxldCBbY21kLCBmbl0gb2YgXy50b1BhaXJzKGV4dGVuc2lvbnMpKSB7XG4gIFNpbXVsYXRvclhjb2RlNi5wcm90b3R5cGVbY21kXSA9IGZuO1xufVxuXG5leHBvcnQgZGVmYXVsdCBTaW11bGF0b3JYY29kZTY7XG5leHBvcnQgeyBTaW11bGF0b3JYY29kZTYsIEJPT1RfQ09NUExFVEVEX0VWRU5ULCBTUFJJTkdCT0FSRF9CVU5ETEVfSUQgfTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFJQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7Ozs7O0FBR0EsTUFBTUEsZUFBZSxHQUFHLEtBQUssSUFBN0I7QUFDQSxNQUFNQyxrQkFBa0IsR0FBRyxJQUEzQjtBQUNBLE1BQU1DLHNCQUFzQixHQUFHLElBQUlDLGtCQUFKLEVBQS9CO0FBQ0EsTUFBTUMsbUJBQW1CLEdBQUcsMkJBQTVCO0FBQ0EsTUFBTUMscUJBQXFCLEdBQUcsdUJBQTlCOztBQVVBLE1BQU1DLG9CQUFvQixHQUFHLGVBQTdCOzs7QUFHQSxNQUFNQyxlQUFOLFNBQThCQyxvQkFBOUIsQ0FBMkM7RUFRekNDLFdBQVcsQ0FBRUMsSUFBRixFQUFRQyxZQUFSLEVBQXNCO0lBQy9CO0lBRUEsS0FBS0QsSUFBTCxHQUFZRSxNQUFNLENBQUNGLElBQUQsQ0FBbEI7SUFDQSxLQUFLRyxNQUFMLEdBQWMsSUFBSUMsbUJBQUosQ0FBVztNQUN2QkosSUFBSSxFQUFFLEtBQUtBO0lBRFksQ0FBWCxDQUFkO0lBR0EsS0FB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
