"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SAFARI_STARTUP_TIMEOUT = exports.MOBILE_SAFARI_BUNDLE_ID = void 0;
exports.activateApp = activateApp;
exports.endAllSimulatorDaemons = endAllSimulatorDaemons;
exports.execSQLiteQuery = execSQLiteQuery;
exports.getDeveloperRoot = getDeveloperRoot;
exports.getSimulatorInfo = getSimulatorInfo;
exports.hasSSLCert = hasSSLCert;
exports.installSSLCert = installSSLCert;
exports.killAllSimulators = killAllSimulators;
exports.launchApp = launchApp;
exports.safeRimRaf = safeRimRaf;
exports.simExists = simExists;
exports.toBiometricDomainComponent = toBiometricDomainComponent;
exports.uninstallSSLCert = uninstallSSLCert;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("./logger"));

var _lodash = _interopRequireDefault(require("lodash"));

var _teen_process = require("teen_process");

var _asyncbox = require("asyncbox");

var _appiumXcode = require("appium-xcode");

var _nodeSimctl = _interopRequireDefault(require("node-simctl"));

var _support = require("@appium/support");

var _certificate = require("./certificate");

var _path = _interopRequireDefault(require("path"));

var _simulatorXcode = _interopRequireDefault(require("./simulator-xcode-6"));

const DEFAULT_SIM_SHUTDOWN_TIMEOUT = 30000;
const SAFARI_STARTUP_TIMEOUT = 25 * 1000;
exports.SAFARI_STARTUP_TIMEOUT = SAFARI_STARTUP_TIMEOUT;
const MOBILE_SAFARI_BUNDLE_ID = 'com.apple.mobilesafari';
exports.MOBILE_SAFARI_BUNDLE_ID = MOBILE_SAFARI_BUNDLE_ID;

const PROCESS_LAUNCH_OK_PATTERN = bundleId => new RegExp(`${bundleId.replace('.', '\\.')}:\\s+\\d+`);

const APP_ACTIVATION_SCRIPT = pid => `#!/usr/bin/python

from AppKit import NSApplicationActivateIgnoringOtherApps, NSApplicationActivateAllWindows
from Cocoa import NSRunningApplication

app = NSRunningApplication.runningApplicationWithProcessIdentifier_(${pid})
if not app:
    raise ValueError('App with PID ${pid} is not running')
if not app.activateWithOptions_(NSApplicationActivateAllWindows | NSApplicationActivateIgnoringOtherApps):
    raise ValueError('App with PID ${pid} cannot be activated')
`;

const BIOMETRICS = {
  touchId: 'fingerTouch',
  faceId: 'pearl'
};

function toBiometricDomainComponent(name) {
  if (!BIOMETRICS[name]) {
    throw new Error(`'${name}' is not a valid biometric. Use one of: ${JSON.stringify(_lodash.default.keys(BIOMETRICS))}`);
  }

  return BIOMETRICS[name];
}

async function pkill(appName, forceKill = false) {
  let args = forceKill ? ['-9'] : [];
  args.push('-x', appName);

  try {
    await (0, _teen_process.exec)('pkill', args);
    return 0;
  } catch (err) {
    if (!_lodash.default.isUndefined(err.code)) {
      throw new Error(`Cannot forcefully terminate ${appName}. pkill error code: ${err.code}`);
    }

    _logger.default.error(`Received unexpected error while trying to kill ${appName}: ${err.message}`);

    throw err;
  }
}

async function killAllSimulators(timeout = DEFAULT_SIM_SHUTDOWN_TIMEOUT) {
  _logger.default.debug('Killing all iOS Simulators');

  const xcodeVersion = await (0, _appiumXcode.getVersion)(true);
  const appName = xcodeVersion.major >= 7 ? 'Simulator' : 'iOS Simulator';
  timeout = timeout * (xcodeVersion.major >= 8 ? 2 : 1);

  try {
    await (0, _teen_process.exec)('xcrun', ['simctl', 'shutdown', xcodeVersion.major > 8 ? 'all' : 'booted'], {
      timeout
    });
  } catch (ign) {}

  const pids = [];

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('pgrep', ['-f', `${appName}.app/Contents/MacOS/`]);

    if (stdout.trim()) {
      pids.push(...stdout.trim().split(/\s+/));
    }
  } catch (e) {
    if (e.code === 1) {
      _logger.default.debug(`${appName} is not running. Continuing...`);

      return;
    }

    if (_lodash.default.isEmpty(pids)) {
      _logger.default.warn(`pgrep error ${e.code} while detecting whether ${appName} is running. Trying to kill anyway.`);
    }
  }

  if (!_lodash.default.isEmpty(pids)) {
    _logger.default.debug(`Killing processes: ${pids.join(', ')}`);

    try {
      await (0, _teen_process.exec)('kill', ['-9', ...pids.map(pid => `${pid}`)]);
    } catch (ign) {}
  }

  _logger.default.debug(`Using pkill to kill application: ${appName}`);

  try {
    await pkill(appName, true);
  } catch (ign) {}

  let remainingDevices = [];

  async function allSimsAreDown() {
    remainingDevices = [];
    let devices = await new _nodeSimctl.default().getDevices();
    devices = _lodash.default.flatten(_lodash.default.values(devices));
    return _lodash.default.every(devices, sim => {
      let state = sim.state.toLowerCase();
      let done = state === 'shutdown' || state === 'unavailable' || state === 'disconnected';

      if (!done) {
        remainingDevices.push(`${sim.name} (${sim.sdk}, udid: ${sim.udid}) is still in state '${state}'`);
      }

      return done;
    });
  }

  try {
    await (0, _asyncbox.waitForCondition)(allSimsAreDown, {
      waitMs: timeout,
      intervalMs: 200
    });
  } catch (err) {
    if (remainingDevices.length > 0) {
      _logger.default.warn(`The following devices are still not in the correct state after ${timeout} ms:`);

      for (let device of remainingDevices) {
        _logger.default.warn(`    ${device}`);
      }
    }

    throw err;
  }
}

async function endAllSimulatorDaemons() {
  _logger.default.debug('Ending all simulator daemons');

  for (let servicePattern of ['com.apple.iphonesimulator', 'com.apple.CoreSimulator']) {
    _logger.default.debug(`Killing any other ${servicePattern} daemons`);

    let launchCtlCommand = `launchctl list | grep ${servicePattern} | cut -f 3 | xargs -n 1 launchctl`;

    try {
      let stopCmd = `${launchCtlCommand} stop`;
      await (0, _teen_process.exec)('bash', ['-c', stopCmd]);
    } catch (err) {
      _logger.default.warn(`Could not stop ${servicePattern} daemons, carrying on anyway!`);
    }

    try {
      let removeCmd = `${launchCtlCommand} remove`;
      await (0, _teen_process.exec)('bash', ['-c', removeCmd]);
    } catch (err) {
      _logger.default.warn(`Could not remove ${servicePattern} daemons, carrying on anyway!`);
    }
  }

  try {
    await (0, _asyncbox.waitForCondition)(async () => {
      let {
        stdout
      } = await (0, _teen_process.exec)('bash', ['-c', `ps -e  | grep launchd_sim | grep -v bash | grep -v grep | awk {'print$1'}`]);
      return stdout.trim().length === 0;
    }, {
      waitMs: 5000,
      intervalMs: 500
    });
  } catch (err) {
    _logger.default.warn(`Could not end all simulator daemons, carrying on!`);
  }

  _logger.default.debug('Finishing ending all simulator daemons');
}

async function getSimulatorInfo(udid, opts = {}) {
  const {
    devicesSetPath
  } = opts;
  let devices = await new _nodeSimctl.default({
    devicesSetPath
  }).getDevices();
  devices = _lodash.default.toPairs(devices).map(pair => pair[1]).reduce((a, b) => a.concat(b), []);
  return _lodash.default.find(devices, sim => sim.udid === udid);
}

async function simExists(udid) {
  return !!(await getSimulatorInfo(udid));
}

async function safeRimRaf(delPath, tryNum = 0) {
  try {
    await _support.fs.rimraf(delPath);
  } catch (err) {
    if (tryNum < 20) {
      if (err.message.indexOf('ENOTEMPTY') !== -1) {
        _logger.default.debug(`Path '${delPath}' was not empty during delete; retrying`);

        return await safeRimRaf(delPath, tryNum + 1);
      } else if (err.message.indexOf('ENOENT') !== -1) {
        _logger.default.debug(`Path '${delPath}' did not exist when we tried to delete, ignoring`);

        return await safeRimRaf(delPath, tryNum + 1);
      }
    }
  }
}

async function installSSLCert(pemText, udid) {
  try {
    await _support.fs.which('openssl');
  } catch (e) {
    _logger.default.debug(`customSSLCert requires openssl to be available on path`);

    _logger.default.errorAndThrow(`Command 'openssl' not found`);
  }

  try {
    await _support.fs.which('sqlite3');
  } catch (e) {
    _logger.default.debug(`customSSLCert requires sqlite3 to be available on path`);

    _logger.default.errorAndThrow(`Command 'sqlite3' not found`);
  }

  let tempFileName = _path.default.resolve(await _support.tempDir.openDir(), 'temp-ssl-cert.pem');

  let pathToKeychain = new _simulatorXcode.default(udid).getDir();
  await _support.fs.writeFile(tempFileName, pemText);

  try {
    await _support.fs.stat(pathToKeychain);
  } catch (e) {
    _logger.default.debug(`Could not install SSL certificate. No simulator with udid '${udid}'`);

    _logger.default.errorAndThrow(e);
  }

  let certificate = new _certificate.Certificate(tempFileName);

  _logger.default.debug(`Installing certificate to ${pathToKeychain}`);

  await certificate.add(pathToKeychain);
  await _support.fs.unlink(tempFileName);
  return certificate;
}

async function uninstallSSLCert(pemText, udid) {
  try {
    let tempFileName = _path.default.resolve(__dirname, 'temp-ssl-cert.pem');

    let pathToKeychain = _path.default.resolve(new _simulatorXcode.default(udid).getDir());

    await _support.fs.writeFile(tempFileName, pemText);
    let certificate = new _certificate.Certificate(tempFileName);
    await certificate.remove(pathToKeychain);
    await _support.fs.unlink(tempFileName);
    return certificate;
  } catch (e) {
    _logger.default.debug(`Could not uninstall SSL certificate. No simulator with udid '${udid}'`);

    _logger.default.errorAndThrow(e);
  }
}

async function hasSSLCert(pemText, udid) {
  const tempFileName = _path.default.resolve(await _support.tempDir.openDir(), 'temp-ssl-cert.pem');

  const pathToKeychain = new _simulatorXcode.default(udid).getDir();
  await _support.fs.writeFile(tempFileName, pemText);
  const certificate = new _certificate.Certificate(tempFileName);
  return certificate.has(pathToKeychain);
}

async function execSQLiteQuery(db, query, ...queryParams) {
  query = query.replace(/\n+/g, ' ');
  let queryTokens = query.split('?');
  let formattedQuery = [];
  queryParams.map(param => `${param}`).forEach((param, i) => {
    formattedQuery.push(queryTokens[i]);
    formattedQuery.push(param.replace(/'/g, "''"));
  });
  formattedQuery.push(queryTokens[queryTokens.length - 1]);

  _logger.default.debug(`Executing SQL query "${formattedQuery.join('')}" on '${db}'`);

  try {
    return (await (0, _teen_process.exec)('sqlite3', ['-line', db, formattedQuery.join('')])).stdout;
  } catch (err) {
    throw new Error(`Cannot execute SQLite query "${formattedQuery.join('')}" to '${db}'. ` + `Original error: ${err.stderr}`);
  }
}

async function getDeveloperRoot() {
  const {
    stdout
  } = await (0, _teen_process.exec)('xcode-select', ['-p']);
  return stdout.trim();
}

async function activateApp(pid) {
  const tmpScript = await _support.tempDir.path({
    prefix: `activate_sim_${_support.util.uuidV4().substring(0, 8)}`,
    suffix: '.py'
  });
  await _support.fs.writeFile(tmpScript, APP_ACTIVATION_SCRIPT(pid), 'utf8');

  try {
    await (0, _teen_process.exec)('/usr/bin/python', [tmpScript]);
  } finally {
    await _support.fs.rimraf(tmpScript);
  }
}

async function launchApp(simctl, bundleId, timeoutMs = 25000) {
  let lastError;

  try {
    await (0, _asyncbox.waitForCondition)(async () => {
      try {
        const stdout = await simctl.launchApp(MOBILE_SAFARI_BUNDLE_ID, 1);
        return PROCESS_LAUNCH_OK_PATTERN(MOBILE_SAFARI_BUNDLE_ID).test(stdout);
      } catch (err) {
        lastError = err.stderr || err.message;
      }

      return false;
    }, {
      waitMs: timeoutMs,
      intervalMs: 500
    });
  } catch (e) {
    let msg = `'${bundleId}' did not run after ${timeoutMs}ms timeout.`;

    if (lastError) {
      msg += ` Original error: ${lastError}`;
    }

    throw new Error(msg);
  }
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL3V0aWxzLmpzIiwibmFtZXMiOlsiREVGQVVMVF9TSU1fU0hVVERPV05fVElNRU9VVCIsIlNBRkFSSV9TVEFSVFVQX1RJTUVPVVQiLCJNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCIsIlBST0NFU1NfTEFVTkNIX09LX1BBVFRFUk4iLCJidW5kbGVJZCIsIlJlZ0V4cCIsInJlcGxhY2UiLCJBUFBfQUNUSVZBVElPTl9TQ1JJUFQiLCJwaWQiLCJCSU9NRVRSSUNTIiwidG91Y2hJZCIsImZhY2VJZCIsInRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50IiwibmFtZSIsIkVycm9yIiwiSlNPTiIsInN0cmluZ2lmeSIsIl8iLCJrZXlzIiwicGtpbGwiLCJhcHBOYW1lIiwiZm9yY2VLaWxsIiwiYXJncyIsInB1c2giLCJleGVjIiwiZXJyIiwiaXNVbmRlZmluZWQiLCJjb2RlIiwibG9nIiwiZXJyb3IiLCJtZXNzYWdlIiwia2lsbEFsbFNpbXVsYXRvcnMiLCJ0aW1lb3V0IiwiZGVidWciLCJ4Y29kZVZlcnNpb24iLCJnZXRWZXJzaW9uIiwibWFqb3IiLCJpZ24iLCJwaWRzIiwic3Rkb3V0IiwidHJpbSIsInNwbGl0IiwiZSIsImlzRW1wdHkiLCJ3YXJuIiwiam9pbiIsIm1hcCIsInJlbWFpbmluZ0RldmljZXMiLCJhbGxTaW1zQXJlRG93biIsImRldmljZXMiLCJTaW1jdGwiLCJnZXREZXZpY2VzIiwiZmxhdHRlbiIsInZhbHVlcyIsImV2ZXJ5Iiwic2ltIiwic3RhdGUiLCJ0b0xvd2VyQ2FzZSIsImRvbmUiLCJzZGsiLCJ1ZGlkIiwid2FpdEZvckNvbmRpdGlvbiIsIndhaXRNcyIsImludGVydmFsTXMiLCJsZW5ndGgiLCJkZXZpY2UiLCJlbmRBbGxTaW11bGF0b3JEYWVtb25zIiwic2VydmljZVBhdHRlcm4iLCJsYXVuY2hDdGxDb21tYW5kIiwic3RvcENtZCIsInJlbW92ZUNtZCIsImdldFNpbXVsYXRvckluZm8iLCJvcHRzIiwiZGV2aWNlc1NldFBhdGgiLCJ0b1BhaXJzIiwicGFpciIsInJlZHVjZSIsImEiLCJiIiwiY29uY2F0IiwiZmluZCIsInNpbUV4aXN0cyIsInNhZmVSaW1SYWYiLCJkZWxQYXRoIiwidHJ5TnVtIiwiZnMiLCJyaW1yYWYiLCJpbmRleE9mIiwiaW5zdGFsbFNTTENlcnQiLCJwZW1UZXh0Iiwid2hpY2giLCJlcnJvckFuZFRocm93IiwidGVtcEZpbGVOYW1lIiwicGF0aCIsInJlc29sdmUiLCJ0ZW1wRGlyIiwib3BlbkRpciIsInBhdGhUb0tleWNoYWluIiwiU2ltdWxhdG9yIiwiZ2V0RGlyIiwid3JpdGVGaWxlIiwic3RhdCIsImNlcnRpZmljYXRlIiwiQ2VydGlmaWNhdGUiLCJhZGQiLCJ1bmxpbmsiLCJ1bmluc3RhbGxTU0xDZXJ0IiwiX19kaXJuYW1lIiwicmVtb3ZlIiwiaGFzU1NMQ2VydCIsImhhcyIsImV4ZWNTUUxpdGVRdWVyeSIsImRiIiwicXVlcnkiLCJxdWVyeVBhcmFtcyIsInF1ZXJ5VG9rZW5zIiwiZm9ybWF0dGVkUXVlcnkiLCJwYXJhbSIsImZvckVhY2giLCJpIiwic3RkZXJyIiwiZ2V0RGV2ZWxvcGVyUm9vdCIsImFjdGl2YXRlQXBwIiwidG1wU2NyaXB0IiwicHJlZml4IiwidXRpbCIsInV1aWRWNCIsInN1YnN0cmluZyIsInN1ZmZpeCIsImxhdW5jaEFwcCIsInNpbWN0bCIsInRpbWVvdXRNcyIsImxhc3RFcnJvciIsInRlc3QiLCJtc2ciXSwic291cmNlUm9vdCI6Ii4uLy4uIiwic291cmNlcyI6WyJsaWIvdXRpbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyB3YWl0Rm9yQ29uZGl0aW9uIH0gZnJvbSAnYXN5bmNib3gnO1xuaW1wb3J0IHsgZ2V0VmVyc2lvbiB9IGZyb20gJ2FwcGl1bS14Y29kZSc7XG5pbXBvcnQgU2ltY3RsIGZyb20gJ25vZGUtc2ltY3RsJztcbmltcG9ydCB7IGZzLCB0ZW1wRGlyLCB1dGlsIH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCB7IENlcnRpZmljYXRlIH0gZnJvbSAnLi9jZXJ0aWZpY2F0ZSc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBTaW11bGF0b3IgZnJvbSAnLi9zaW11bGF0b3IteGNvZGUtNic7XG5cblxuY29uc3QgREVGQVVMVF9TSU1fU0hVVERPV05fVElNRU9VVCA9IDMwMDAwO1xuY29uc3QgU0FGQVJJX1NUQVJUVVBfVElNRU9VVCA9IDI1ICogMTAwMDtcbmNvbnN0IE1PQklMRV9TQUZBUklfQlVORExFX0lEID0gJ2NvbS5hcHBsZS5tb2JpbGVzYWZhcmknO1xuY29uc3QgUFJPQ0VTU19MQVVOQ0hfT0tfUEFUVEVSTiA9IChidW5kbGVJZCkgPT4gbmV3IFJlZ0V4cChgJHtidW5kbGVJZC5yZXBsYWNlKCcuJywgJ1xcXFwuJyl9OlxcXFxzK1xcXFxkK2ApO1xuY29uc3QgQVBQX0FDVElWQVRJT05fU0NSSVBUID0gKHBpZCkgPT4gYCMhL3Vzci9iaW4vcHl0aG9uXG5cbmZyb20gQXBwS2l0IGltcG9ydCBOU0FwcGxpY2F0aW9uQWN0aXZhdGVJZ25vcmluZ090aGVyQXBwcywgTlNBcHBsaWNhdGlvbkFjdGl2YXRlQWxsV2luZG93c1xuZnJvbSBDb2NvYSBpbXBvcnQgTlNSdW5uaW5nQXBwbGljYXRpb25cblxuYXBwID0gTlNSdW5uaW5nQXBwbGljYXRpb24ucnVubmluZ0FwcGxpY2F0aW9uV2l0aFByb2Nlc3NJZGVudGlmaWVyXygke3BpZH0pXG5pZiBub3QgYXBwOlxuICAgIHJhaXNlIFZhbHVlRXJyb3IoJ0FwcCB3aXRoIFBJRCAke3BpZH0gaXMgbm90IHJ1bm5pbmcnKVxuaWYgbm90IGFwcC5hY3RpdmF0ZVdpdGhPcHRpb25zXyhOU0FwcGxpY2F0aW9uQWN0aXZhdGVBbGxXaW5kb3dzIHwgTlNBcHBsaWNhdGlvbkFjdGl2YXRlSWdub3JpbmdPdGhlckFwcHMpOlxuICAgIHJhaXNlIFZhbHVlRXJyb3IoJ0FwcCB3aXRoIFBJRCAke3BpZH0gY2Fubm90IGJlIGFjdGl2YXRlZCcpXG5gO1xuXG5cbmNvbnN0IEJJT01FVFJJQ1MgPSB7XG4gIHRvdWNoSWQ6ICdmaW5nZXJUb3VjaCcsXG4gIGZhY2VJZDogJ3BlYXJsJyxcbn07XG5cbmZ1bmN0aW9uIHRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50IChuYW1lKSB7XG4gIGlmICghQklPTUVUUklDU1tuYW1lXSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJyR7bmFtZX0nIGlzIG5vdCBhIHZhbGlkIGJpb21ldHJpYy4gVXNlIG9uZSBvZjogJHtKU09OLnN0cmluZ2lmeShfLmtleXMoQklPTUVUUklDUykpfWApO1xuICB9XG4gIHJldHVybiBCSU9NRVRSSUNTW25hbWVdO1xufVxuXG4vLyBwZ3JlcC9wa2lsbCBleGl0IGNvZGVzOlxuLy8gMCAgICAgICBPbmUgb3IgbW9yZSBwcm9jZXNzZXMgd2VyZSBtYXRjaGVkLlxuLy8gMSAgICAgICBObyBwcm9jZXNzZXMgd2VyZSBtYXRjaGVkLlxuLy8gMiAgICAgICBJbnZhbGlkIG9wdGlvbnMgd2VyZSBzcGVjaWZpZWQgb24gdGhlIGNvbW1hbmQgbGluZS5cbi8vIDMgICAgICAgQW4gaW50ZXJuYWwgZXJyb3Igb2NjdXJyZWQuXG5cbmFzeW5jIGZ1bmN0aW9uIHBraWxsIChhcHBOYW1lLCBmb3JjZUtpbGwgPSBmYWxzZSkge1xuICBsZXQgYXJncyA9IGZvcmNlS2lsbCA/IFsnLTknXSA6IFtdO1xuICBhcmdzLnB1c2goJy14JywgYXBwTmFtZSk7XG4gIHRyeSB7XG4gICAgYXdhaXQgZXhlYygncGtpbGwnLCBhcmdzKTtcbiAgICByZXR1cm4gMDtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKCFfLmlzVW5kZWZpbmVkKGVyci5jb2RlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgZm9yY2VmdWxseSB0ZXJtaW5hdGUgJHthcHBOYW1lfS4gcGtpbGwgZXJyb3IgY29kZTogJHtlcnIuY29kZX1gKTtcbiAgICB9XG4gICAgbG9nLmVycm9yKGBSZWNlaXZlZCB1bmV4cGVjdGVkIGVycm9yIHdoaWxlIHRyeWluZyB0byBraWxsICR7YXBwTmFtZX06ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgdGhyb3cgZXJyO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGtpbGxBbGxTaW11bGF0b3JzICh0aW1lb3V0ID0gREVGQVVMVF9TSU1fU0hVVERPV05fVElNRU9VVCkge1xuICBsb2cuZGVidWcoJ0tpbGxpbmcgYWxsIGlPUyBTaW11bGF0b3JzJyk7XG4gIGNvbnN0IHhjb2RlVmVyc2lvbiA9IGF3YWl0IGdldFZlcnNpb24odHJ1ZSk7XG4gIGNvbnN0IGFwcE5hbWUgPSB4Y29kZVZlcnNpb24ubWFqb3IgPj0gNyA/ICdTaW11bGF0b3InIDogJ2lPUyBTaW11bGF0b3InO1xuXG4gIC8vIGxhdGVyIHZlcnNpb25zIGFyZSBzbG93ZXIgdG8gY2xvc2VcbiAgdGltZW91dCA9IHRpbWVvdXQgKiAoeGNvZGVWZXJzaW9uLm1ham9yID49IDggPyAyIDogMSk7XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBleGVjKCd4Y3J1bicsIFsnc2ltY3RsJywgJ3NodXRkb3duJywgeGNvZGVWZXJzaW9uLm1ham9yID4gOCA/ICdhbGwnIDogJ2Jvb3RlZCddLCB7dGltZW91dH0pO1xuICB9IGNhdGNoIChpZ24pIHt9XG5cbiAgY29uc3QgcGlkcyA9IFtdO1xuICB0cnkge1xuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygncGdyZXAnLCBbJy1mJywgYCR7YXBwTmFtZX0uYXBwL0NvbnRlbnRzL01hY09TL2BdKTtcbiAgICBpZiAoc3Rkb3V0LnRyaW0oKSkge1xuICAgICAgcGlkcy5wdXNoKC4uLihzdGRvdXQudHJpbSgpLnNwbGl0KC9cXHMrLykpKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZS5jb2RlID09PSAxKSB7XG4gICAgICBsb2cuZGVidWcoYCR7YXBwTmFtZX0gaXMgbm90IHJ1bm5pbmcuIENvbnRpbnVpbmcuLi5gKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKF8uaXNFbXB0eShwaWRzKSkge1xuICAgICAgbG9nLndhcm4oYHBncmVwIGVycm9yICR7ZS5jb2RlfSB3aGlsZSBkZXRlY3Rpbmcgd2hldGhlciAke2FwcE5hbWV9IGlzIHJ1bm5pbmcuIFRyeWluZyB0byBraWxsIGFueXdheS5gKTtcbiAgICB9XG4gIH1cbiAgaWYgKCFfLmlzRW1wdHkocGlkcykpIHtcbiAgICBsb2cuZGVidWcoYEtpbGxpbmcgcHJvY2Vzc2VzOiAke3BpZHMuam9pbignLCAnKX1gKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYygna2lsbCcsIFsnLTknLCAuLi4ocGlkcy5tYXAoKHBpZCkgPT4gYCR7cGlkfWApKV0pO1xuICAgIH0gY2F0Y2ggKGlnbikge31cbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgVXNpbmcgcGtpbGwgdG8ga2lsbCBhcHBsaWNhdGlvbjogJHthcHBOYW1lfWApO1xuICB0cnkge1xuICAgIGF3YWl0IHBraWxsKGFwcE5hbWUsIHRydWUpO1xuICB9IGNhdGNoIChpZ24pIHt9XG5cbiAgLy8gd2FpdCBmb3IgYWxsIHRoZSBkZXZpY2VzIHRvIGJlIHNodXRkb3duIGJlZm9yZSBDb250aW51aW5nXG4gIC8vIGJ1dCBvbmx5IHByaW50IG91dCB0aGUgZmFpbGVkIG9uZXMgd2hlbiB0aGV5IGFyZSBhY3R1YWxseSBmdWxseSBmYWlsZWRcbiAgbGV0IHJlbWFpbmluZ0RldmljZXMgPSBbXTtcbiAgYXN5bmMgZnVuY3Rpb24gYWxsU2ltc0FyZURvd24gKCkge1xuICAgIHJlbWFpbmluZ0RldmljZXMgPSBbXTtcbiAgICBsZXQgZGV2aWNlcyA9IGF3YWl0IG5ldyBTaW1jdGwoKS5nZXREZXZpY2VzKCk7XG4gICAgZGV2aWNlcyA9IF8uZmxhdHRlbihfLnZhbHVlcyhkZXZpY2VzKSk7XG4gICAgcmV0dXJuIF8uZXZlcnkoZGV2aWNlcywgKHNpbSkgPT4ge1xuICAgICAgbGV0IHN0YXRlID0gc2ltLnN0YXRlLnRvTG93ZXJDYXNlKCk7XG4gICAgICBsZXQgZG9uZSA9IHN0YXRlID09PSAnc2h1dGRvd24nIHx8XG4gICAgICAgICAgICAgICAgIHN0YXRlID09PSAndW5hdmFpbGFibGUnIHx8XG4gICAgICAgICAgICAgICAgIHN0YXRlID09PSAnZGlzY29ubmVjdGVkJztcbiAgICAgIGlmICghZG9uZSkge1xuICAgICAgICByZW1haW5pbmdEZXZpY2VzLnB1c2goYCR7c2ltLm5hbWV9ICgke3NpbS5zZGt9LCB1ZGlkOiAke3NpbS51ZGlkfSkgaXMgc3RpbGwgaW4gc3RhdGUgJyR7c3RhdGV9J2ApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGRvbmU7XG4gICAgfSk7XG4gIH1cbiAgdHJ5IHtcbiAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFsbFNpbXNBcmVEb3duLCB7XG4gICAgICB3YWl0TXM6IHRpbWVvdXQsXG4gICAgICBpbnRlcnZhbE1zOiAyMDBcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKHJlbWFpbmluZ0RldmljZXMubGVuZ3RoID4gMCkge1xuICAgICAgbG9nLndhcm4oYFRoZSBmb2xsb3dpbmcgZGV2aWNlcyBhcmUgc3RpbGwgbm90IGluIHRoZSBjb3JyZWN0IHN0YXRlIGFmdGVyICR7dGltZW91dH0gbXM6YCk7XG4gICAgICBmb3IgKGxldCBkZXZpY2Ugb2YgcmVtYWluaW5nRGV2aWNlcykge1xuICAgICAgICBsb2cud2FybihgICAgICR7ZGV2aWNlfWApO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyBlcnI7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZW5kQWxsU2ltdWxhdG9yRGFlbW9ucyAoKSB7XG4gIGxvZy5kZWJ1ZygnRW5kaW5nIGFsbCBzaW11bGF0b3IgZGFlbW9ucycpO1xuICBmb3IgKGxldCBzZXJ2aWNlUGF0dGVybiBvZiBbJ2NvbS5hcHBsZS5pcGhvbmVzaW11bGF0b3InLCAnY29tLmFwcGxlLkNvcmVTaW11bGF0b3InXSkge1xuICAgIGxvZy5kZWJ1ZyhgS2lsbGluZyBhbnkgb3RoZXIgJHtzZXJ2aWNlUGF0dGVybn0gZGFlbW9uc2ApO1xuICAgIGxldCBsYXVuY2hDdGxDb21tYW5kID0gYGxhdW5jaGN0bCBsaXN0IHwgZ3JlcCAke3NlcnZpY2VQYXR0ZXJufSB8IGN1dCAtZiAzIHwgeGFyZ3MgLW4gMSBsYXVuY2hjdGxgO1xuICAgIHRyeSB7XG4gICAgICBsZXQgc3RvcENtZCA9IGAke2xhdW5jaEN0bENvbW1hbmR9IHN0b3BgO1xuICAgICAgYXdhaXQgZXhlYygnYmFzaCcsIFsnLWMnLCBzdG9wQ21kXSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2cud2FybihgQ291bGQgbm90IHN0b3AgJHtzZXJ2aWNlUGF0dGVybn0gZGFlbW9ucywgY2Fycnlpbmcgb24gYW55d2F5IWApO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgbGV0IHJlbW92ZUNtZCA9IGAke2xhdW5jaEN0bENvbW1hbmR9IHJlbW92ZWA7XG4gICAgICBhd2FpdCBleGVjKCdiYXNoJywgWyctYycsIHJlbW92ZUNtZF0pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oYENvdWxkIG5vdCByZW1vdmUgJHtzZXJ2aWNlUGF0dGVybn0gZGFlbW9ucywgY2Fycnlpbmcgb24gYW55d2F5IWApO1xuICAgIH1cbiAgfVxuICAvLyB3YWl0aW5nIHVudGlsIHRoZSBzaW11bGF0b3Igc2VydmljZSBoYXMgZGllZC5cbiAgdHJ5IHtcbiAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IHtcbiAgICAgIGxldCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ2Jhc2gnLCBbJy1jJyxcbiAgICAgICAgYHBzIC1lICB8IGdyZXAgbGF1bmNoZF9zaW0gfCBncmVwIC12IGJhc2ggfCBncmVwIC12IGdyZXAgfCBhd2sgeydwcmludCQxJ31gXSk7XG4gICAgICByZXR1cm4gc3Rkb3V0LnRyaW0oKS5sZW5ndGggPT09IDA7XG4gICAgfSwge3dhaXRNczogNTAwMCwgaW50ZXJ2YWxNczogNTAwfSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy53YXJuKGBDb3VsZCBub3QgZW5kIGFsbCBzaW11bGF0b3IgZGFlbW9ucywgY2Fycnlpbmcgb24hYCk7XG4gIH1cbiAgbG9nLmRlYnVnKCdGaW5pc2hpbmcgZW5kaW5nIGFsbCBzaW11bGF0b3IgZGFlbW9ucycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRTaW11bGF0b3JJbmZvICh1ZGlkLCBvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIGRldmljZXNTZXRQYXRoXG4gIH0gPSBvcHRzO1xuICAvLyBzZWUgdGhlIFJFQURNRSBmb3IgZ2l0aHViLmNvbS9hcHBpdW0vbm9kZS1zaW1jdGwgZm9yIGV4YW1wbGUgb3V0cHV0IG9mIGdldERldmljZXMoKVxuICBsZXQgZGV2aWNlcyA9IGF3YWl0IG5ldyBTaW1jdGwoe1xuICAgIGRldmljZXNTZXRQYXRoXG4gIH0pLmdldERldmljZXMoKTtcblxuICBkZXZpY2VzID0gXy50b1BhaXJzKGRldmljZXMpXG4gICAgLm1hcCgocGFpcikgPT4gcGFpclsxXSlcbiAgICAucmVkdWNlKChhLCBiKSA9PiBhLmNvbmNhdChiKSwgW10pO1xuICByZXR1cm4gXy5maW5kKGRldmljZXMsIChzaW0pID0+IHNpbS51ZGlkID09PSB1ZGlkKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2ltRXhpc3RzICh1ZGlkKSB7XG4gIHJldHVybiAhIShhd2FpdCBnZXRTaW11bGF0b3JJbmZvKHVkaWQpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2FmZVJpbVJhZiAoZGVsUGF0aCwgdHJ5TnVtID0gMCkge1xuICB0cnkge1xuICAgIGF3YWl0IGZzLnJpbXJhZihkZWxQYXRoKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgaWYgKHRyeU51bSA8IDIwKSB7XG4gICAgICBpZiAoZXJyLm1lc3NhZ2UuaW5kZXhPZignRU5PVEVNUFRZJykgIT09IC0xKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgUGF0aCAnJHtkZWxQYXRofScgd2FzIG5vdCBlbXB0eSBkdXJpbmcgZGVsZXRlOyByZXRyeWluZ2ApO1xuICAgICAgICByZXR1cm4gYXdhaXQgc2FmZVJpbVJhZihkZWxQYXRoLCB0cnlOdW0gKyAxKTtcbiAgICAgIH0gZWxzZSBpZiAoZXJyLm1lc3NhZ2UuaW5kZXhPZignRU5PRU5UJykgIT09IC0xKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgUGF0aCAnJHtkZWxQYXRofScgZGlkIG5vdCBleGlzdCB3aGVuIHdlIHRyaWVkIHRvIGRlbGV0ZSwgaWdub3JpbmdgKTtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHNhZmVSaW1SYWYoZGVsUGF0aCwgdHJ5TnVtICsgMSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogSW5zdGFsbCBhbiBTU0wgY2VydGlmaWNhdGUgdG8gYSBkZXZpY2Ugd2l0aCBnaXZlbiB1ZGlkXG4gKiBAcGFyYW0ge3N0cmluZ30gcGVtVGV4dCBTU0wgcGVtIHRleHRcbiAqIEBwYXJhbSB7c3RyaW5nfSB1ZGlkIElkZW50aWZpZXIgb2YgdGhlIFNpbXVsYXRvclxuICovXG5hc3luYyBmdW5jdGlvbiBpbnN0YWxsU1NMQ2VydCAocGVtVGV4dCwgdWRpZCkge1xuICAvLyBDaGVjayB0aGF0IG9wZW5zc2wgaXMgaW5zdGFsbGVkIG9uIHRoZSBwYXRoXG4gIHRyeSB7XG4gICAgYXdhaXQgZnMud2hpY2goJ29wZW5zc2wnKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5kZWJ1ZyhgY3VzdG9tU1NMQ2VydCByZXF1aXJlcyBvcGVuc3NsIHRvIGJlIGF2YWlsYWJsZSBvbiBwYXRoYCk7XG4gICAgbG9nLmVycm9yQW5kVGhyb3coYENvbW1hbmQgJ29wZW5zc2wnIG5vdCBmb3VuZGApO1xuICB9XG5cbiAgLy8gQ2hlY2sgdGhhdCBzcWxpdGUzIGlzIGluc3RhbGxlZCBvbiB0aGUgcGF0aFxuICB0cnkge1xuICAgIGF3YWl0IGZzLndoaWNoKCdzcWxpdGUzJyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2cuZGVidWcoYGN1c3RvbVNTTENlcnQgcmVxdWlyZXMgc3FsaXRlMyB0byBiZSBhdmFpbGFibGUgb24gcGF0aGApO1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb21tYW5kICdzcWxpdGUzJyBub3QgZm91bmRgKTtcbiAgfVxuXG4gIC8vIENyZWF0ZSBhIHRlbXBvcmFyeSBmaWxlIHRvIHN0b3JlIFBFTSB0ZXh0XG4gIC8vIChhIHRlbXAgZmlsZSBpcyBuZWNlc3NhcnkgdG8gcnVuIGBvcGVuc3NsYCBzaGVsbCBjb21tYW5kcywgY2FuJ3QgYmUgZG9uZSBpbiBtZW1vcnkpXG4gIGxldCB0ZW1wRmlsZU5hbWUgPSBwYXRoLnJlc29sdmUoYXdhaXQgdGVtcERpci5vcGVuRGlyKCksICd0ZW1wLXNzbC1jZXJ0LnBlbScpO1xuICBsZXQgcGF0aFRvS2V5Y2hhaW4gPSBuZXcgU2ltdWxhdG9yKHVkaWQpLmdldERpcigpO1xuICBhd2FpdCBmcy53cml0ZUZpbGUodGVtcEZpbGVOYW1lLCBwZW1UZXh0KTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBmcy5zdGF0KHBhdGhUb0tleWNoYWluKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5kZWJ1ZyhgQ291bGQgbm90IGluc3RhbGwgU1NMIGNlcnRpZmljYXRlLiBObyBzaW11bGF0b3Igd2l0aCB1ZGlkICcke3VkaWR9J2ApO1xuICAgIGxvZy5lcnJvckFuZFRocm93KGUpO1xuICB9XG5cbiAgLy8gRG8gdGhlIGNlcnRpZmljYXRlIGluc3RhbGxhdGlvblxuICBsZXQgY2VydGlmaWNhdGUgPSBuZXcgQ2VydGlmaWNhdGUodGVtcEZpbGVOYW1lKTtcbiAgbG9nLmRlYnVnKGBJbnN0YWxsaW5nIGNlcnRpZmljYXRlIHRvICR7cGF0aFRvS2V5Y2hhaW59YCk7XG4gIGF3YWl0IGNlcnRpZmljYXRlLmFkZChwYXRoVG9LZXljaGFpbik7XG5cbiAgLy8gUmVtb3ZlIHRoZSB0ZW1wb3JhcnkgZmlsZVxuICBhd2FpdCBmcy51bmxpbmsodGVtcEZpbGVOYW1lKTtcblxuICByZXR1cm4gY2VydGlmaWNhdGU7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVuaW5zdGFsbFNTTENlcnQgKHBlbVRleHQsIHVkaWQpIHtcbiAgdHJ5IHtcbiAgICBsZXQgdGVtcEZpbGVOYW1lID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJ3RlbXAtc3NsLWNlcnQucGVtJyk7XG4gICAgbGV0IHBhdGhUb0tleWNoYWluID0gcGF0aC5yZXNvbHZlKG5ldyBTaW11bGF0b3IodWRpZCkuZ2V0RGlyKCkpO1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZSh0ZW1wRmlsZU5hbWUsIHBlbVRleHQpO1xuICAgIGxldCBjZXJ0aWZpY2F0ZSA9IG5ldyBDZXJ0aWZpY2F0ZSh0ZW1wRmlsZU5hbWUpO1xuICAgIGF3YWl0IGNlcnRpZmljYXRlLnJlbW92ZShwYXRoVG9LZXljaGFpbik7XG4gICAgYXdhaXQgZnMudW5saW5rKHRlbXBGaWxlTmFtZSk7XG4gICAgcmV0dXJuIGNlcnRpZmljYXRlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nLmRlYnVnKGBDb3VsZCBub3QgdW5pbnN0YWxsIFNTTCBjZXJ0aWZpY2F0ZS4gTm8gc2ltdWxhdG9yIHdpdGggdWRpZCAnJHt1ZGlkfSdgKTtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhlKTtcbiAgfVxufVxuXG4vKipcbiAqIENoZWNrIGlmIHRoZSBTaW11bGF0b3IgYWxyZWFkeSBoYXMgdGhpcyBTU0wgY2VydGlmaWNhdGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBwZW1UZXh0IFBFTSB0ZXh0IG9mIFNTTCBjZXJ0XG4gKiBAcGFyYW0ge3N0cmluZ30gdWRpZCBJZGVudGlmaWVyIG9mIHRoZSBTaW11bGF0b3JcbiAqL1xuYXN5bmMgZnVuY3Rpb24gaGFzU1NMQ2VydCAocGVtVGV4dCwgdWRpZCkge1xuICBjb25zdCB0ZW1wRmlsZU5hbWUgPSBwYXRoLnJlc29sdmUoYXdhaXQgdGVtcERpci5vcGVuRGlyKCksICd0ZW1wLXNzbC1jZXJ0LnBlbScpO1xuICBjb25zdCBwYXRoVG9LZXljaGFpbiA9IG5ldyBTaW11bGF0b3IodWRpZCkuZ2V0RGlyKCk7XG4gIGF3YWl0IGZzLndyaXRlRmlsZSh0ZW1wRmlsZU5hbWUsIHBlbVRleHQpO1xuICBjb25zdCBjZXJ0aWZpY2F0ZSA9IG5ldyBDZXJ0aWZpY2F0ZSh0ZW1wRmlsZU5hbWUpO1xuICByZXR1cm4gY2VydGlmaWNhdGUuaGFzKHBhdGhUb0tleWNoYWluKTtcbn1cblxuLyoqXG4gKiBSdW5zIGEgY29tbWFuZCBsaW5lIHNxbGl0ZTMgcXVlcnlcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZGIgLSBGdWxsIHBhdGggdG8gc3FsaXRlIGRhdGFiYXNlXG4gKiBAcGFyYW0ge3N0cmluZ30gcXVlcnkgLSBUaGUgYWN0dWFsIHF1ZXJ5IHN0cmluZ1xuICogQHBhcmFtIHsuLi5zdHJpbmd9IHF1ZXJ5UGFyYW1zIC0gVGhlIGxpc3Qgb2YgcXVlcnkgcGFyYW1ldGVyc1xuICogQHJldHVybnMge3N0cmluZ30gc3FsaXRlIGNvbW1hbmQgc3Rkb3V0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGV4ZWNTUUxpdGVRdWVyeSAoZGIsIHF1ZXJ5LCAuLi5xdWVyeVBhcmFtcykge1xuICBxdWVyeSA9IHF1ZXJ5LnJlcGxhY2UoL1xcbisvZywgJyAnKTtcbiAgbGV0IHF1ZXJ5VG9rZW5zID0gcXVlcnkuc3BsaXQoJz8nKTtcbiAgbGV0IGZvcm1hdHRlZFF1ZXJ5ID0gW107XG4gIHF1ZXJ5UGFyYW1zXG4gICAgLm1hcCgocGFyYW0pID0+IGAke3BhcmFtfWApXG4gICAgLmZvckVhY2goKHBhcmFtLCBpKSA9PiB7XG4gICAgICBmb3JtYXR0ZWRRdWVyeS5wdXNoKHF1ZXJ5VG9rZW5zW2ldKTtcbiAgICAgIGZvcm1hdHRlZFF1ZXJ5LnB1c2gocGFyYW0ucmVwbGFjZSgvJy9nLCBcIicnXCIpKTtcbiAgICB9KTtcbiAgZm9ybWF0dGVkUXVlcnkucHVzaChxdWVyeVRva2Vuc1txdWVyeVRva2Vucy5sZW5ndGggLSAxXSk7XG5cbiAgbG9nLmRlYnVnKGBFeGVjdXRpbmcgU1FMIHF1ZXJ5IFwiJHtmb3JtYXR0ZWRRdWVyeS5qb2luKCcnKX1cIiBvbiAnJHtkYn0nYCk7XG4gIHRyeSB7XG4gICAgcmV0dXJuIChhd2FpdCBleGVjKCdzcWxpdGUzJywgWyctbGluZScsIGRiLCBmb3JtYXR0ZWRRdWVyeS5qb2luKCcnKV0pKS5zdGRvdXQ7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGV4ZWN1dGUgU1FMaXRlIHF1ZXJ5IFwiJHtmb3JtYXR0ZWRRdWVyeS5qb2luKCcnKX1cIiB0byAnJHtkYn0nLiBgICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlcnIuc3RkZXJyfWApO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldERldmVsb3BlclJvb3QgKCkge1xuICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3hjb2RlLXNlbGVjdCcsIFsnLXAnXSk7XG4gIHJldHVybiBzdGRvdXQudHJpbSgpO1xufVxuXG4vKipcbiAqIEFjdGl2YXRlcyB0aGUgYXBwIGhhdmluZyB0aGUgZ2l2ZW4gcHJvY2VzcyBpZGVudGlmaWVyLlxuICogU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmFwcGxlLmNvbS9kb2N1bWVudGF0aW9uL2FwcGtpdC9uc3J1bm5pbmdhcHBsaWNhdGlvbi8xNTI4NzI1LWFjdGl2YXRld2l0aG9wdGlvbnM/bGFuZ3VhZ2U9b2JqY1xuICogZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBAcGFyYW0ge251bWJlcnxzdHJpbmd9IHBpZCBBcHAgcHJvY2VzcyBpZGVudGlmaWVyXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIGdpdmVuIFBJRCBpcyBub3QgcnVubmluZyBvciB0aGVyZSB3YXMgYSBmYWlsdXJlXG4gKiB3aGlsZSBhY3RpdmF0aW5nIHRoZSBhcHBcbiAqL1xuYXN5bmMgZnVuY3Rpb24gYWN0aXZhdGVBcHAgKHBpZCkge1xuICBjb25zdCB0bXBTY3JpcHQgPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe1xuICAgIHByZWZpeDogYGFjdGl2YXRlX3NpbV8ke3V0aWwudXVpZFY0KCkuc3Vic3RyaW5nKDAsIDgpfWAsXG4gICAgc3VmZml4OiAnLnB5JyxcbiAgfSk7XG4gIGF3YWl0IGZzLndyaXRlRmlsZSh0bXBTY3JpcHQsIEFQUF9BQ1RJVkFUSU9OX1NDUklQVChwaWQpLCAndXRmOCcpO1xuICB0cnkge1xuICAgIGF3YWl0IGV4ZWMoJy91c3IvYmluL3B5dGhvbicsIFt0bXBTY3JpcHRdKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBhd2FpdCBmcy5yaW1yYWYodG1wU2NyaXB0KTtcbiAgfVxufVxuXG4vKipcbiAqIEV4ZWN1dGVzIGFuIGFwcCBhbmQgdmVyaWZpZXMgaWYgaXQgd2FzIGxhdW5jaGVkIHByb3Blcmx5XG4gKlxuICogQHBhcmFtIHtTaW1jdGx9IHNpbWN0bCBTaW1jdGwgaW5zdGFuY2VcbiAqIEBwYXJhbSB7c3RyaW5nfSBidW5kbGVJZCBidW5kbGUgaWRlbnRpZmllciBvZiB0aGUgZGVzdGluYXRpb24gYXBwXG4gKiBAcGFyYW0ge251bWJlcn0gdGltZW91dE1zIFsyNTAwMF0gVGhlIG1heGltdW0gdGltZSB0byB3YWl0IHVudGlsXG4gKiB0aGUgYXBwIGlzIHJ1bm5pbmdcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgYXBwIGlzIHN0aWxsIG5vdCBydW5uaW5nIGFmdGVyIHRoZSBnaXZlbiB0aW1lb3V0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGxhdW5jaEFwcCAoc2ltY3RsLCBidW5kbGVJZCwgdGltZW91dE1zID0gMjUwMDApIHtcbiAgbGV0IGxhc3RFcnJvcjtcbiAgdHJ5IHtcbiAgICBhd2FpdCB3YWl0Rm9yQ29uZGl0aW9uKGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHN0ZG91dCA9IGF3YWl0IHNpbWN0bC5sYXVuY2hBcHAoTU9CSUxFX1NBRkFSSV9CVU5ETEVfSUQsIDEpO1xuICAgICAgICByZXR1cm4gUFJPQ0VTU19MQVVOQ0hfT0tfUEFUVEVSTihNT0JJTEVfU0FGQVJJX0JVTkRMRV9JRCkudGVzdChzdGRvdXQpO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxhc3RFcnJvciA9IGVyci5zdGRlcnIgfHwgZXJyLm1lc3NhZ2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSwge3dhaXRNczogdGltZW91dE1zLCBpbnRlcnZhbE1zOiA1MDB9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxldCBtc2cgPSBgJyR7YnVuZGxlSWR9JyBkaWQgbm90IHJ1biBhZnRlciAke3RpbWVvdXRNc31tcyB0aW1lb3V0LmA7XG4gICAgaWYgKGxhc3RFcnJvcikge1xuICAgICAgbXNnICs9IGAgT3JpZ2luYWwgZXJyb3I6ICR7bGFzdEVycm9yfWA7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihtc2cpO1xuICB9XG59XG5cbmV4cG9ydCB7XG4gIGtpbGxBbGxTaW11bGF0b3JzLFxuICBlbmRBbGxTaW11bGF0b3JEYWVtb25zLFxuICBzYWZlUmltUmFmLFxuICBzaW1FeGlzdHMsXG4gIGdldFNpbXVsYXRvckluZm8sXG4gIGluc3RhbGxTU0xDZXJ0LFxuICB1bmluc3RhbGxTU0xDZXJ0LFxuICBoYXNTU0xDZXJ0LFxuICBleGVjU1FMaXRlUXVlcnksXG4gIHRvQmlvbWV0cmljRG9tYWluQ29tcG9uZW50LFxuICBnZXREZXZlbG9wZXJSb290LFxuICBhY3RpdmF0ZUFwcCxcbiAgU0FGQVJJX1NUQVJUVVBfVElNRU9VVCxcbiAgTU9CSUxFX1NBRkFSSV9CVU5ETEVfSUQsXG4gIGxhdW5jaEFwcCxcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLE1BQU1BLDRCQUE0QixHQUFHLEtBQXJDO0FBQ0EsTUFBTUMsc0JBQXNCLEdBQUcsS0FBSyxJQUFwQzs7QUFD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
