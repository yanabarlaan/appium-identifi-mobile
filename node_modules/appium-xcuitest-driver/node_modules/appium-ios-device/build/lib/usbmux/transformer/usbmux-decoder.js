"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.UsbmuxDecoder = void 0;

require("source-map-support/register");

var _stream = _interopRequireDefault(require("stream"));

var _support = require("@appium/support");

const HEADER_LENGTH = 16;

class UsbmuxDecoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, onData) {
    this._decode(data);

    onData();
  }

  _decode(data) {
    const header = {
      length: data.readUInt32LE(0),
      version: data.readUInt32LE(4),
      type: data.readUInt32LE(8),
      tag: data.readUInt32LE(12)
    };
    let payload = data.slice(HEADER_LENGTH, data.length);
    this.push({
      header,
      payload: _support.plist.parsePlist(payload)
    });
  }

}

exports.UsbmuxDecoder = UsbmuxDecoder;
var _default = UsbmuxDecoder;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL3VzYm11eC90cmFuc2Zvcm1lci91c2JtdXgtZGVjb2Rlci5qcyIsIm5hbWVzIjpbIkhFQURFUl9MRU5HVEgiLCJVc2JtdXhEZWNvZGVyIiwiU3RyZWFtIiwiVHJhbnNmb3JtIiwiY29uc3RydWN0b3IiLCJvYmplY3RNb2RlIiwiX3RyYW5zZm9ybSIsImRhdGEiLCJlbmNvZGluZyIsIm9uRGF0YSIsIl9kZWNvZGUiLCJoZWFkZXIiLCJsZW5ndGgiLCJyZWFkVUludDMyTEUiLCJ2ZXJzaW9uIiwidHlwZSIsInRhZyIsInBheWxvYWQiLCJzbGljZSIsInB1c2giLCJwbGlzdCIsInBhcnNlUGxpc3QiXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uIiwic291cmNlcyI6WyJsaWIvdXNibXV4L3RyYW5zZm9ybWVyL3VzYm11eC1kZWNvZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdHJlYW0gZnJvbSAnc3RyZWFtJztcbmltcG9ydCB7IHBsaXN0IH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcblxuY29uc3QgSEVBREVSX0xFTkdUSCA9IDE2O1xuXG5jbGFzcyBVc2JtdXhEZWNvZGVyIGV4dGVuZHMgU3RyZWFtLlRyYW5zZm9ybSB7XG5cbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHN1cGVyKHsgb2JqZWN0TW9kZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIF90cmFuc2Zvcm0gKGRhdGEsIGVuY29kaW5nLCBvbkRhdGEpIHtcbiAgICB0aGlzLl9kZWNvZGUoZGF0YSk7XG4gICAgb25EYXRhKCk7XG4gIH1cblxuICBfZGVjb2RlIChkYXRhKSB7XG4gICAgY29uc3QgaGVhZGVyID0ge1xuICAgICAgbGVuZ3RoOiBkYXRhLnJlYWRVSW50MzJMRSgwKSxcbiAgICAgIHZlcnNpb246IGRhdGEucmVhZFVJbnQzMkxFKDQpLFxuICAgICAgdHlwZTogZGF0YS5yZWFkVUludDMyTEUoOCksXG4gICAgICB0YWc6IGRhdGEucmVhZFVJbnQzMkxFKDEyKVxuICAgIH07XG5cbiAgICBsZXQgcGF5bG9hZCA9IGRhdGEuc2xpY2UoSEVBREVSX0xFTkdUSCwgZGF0YS5sZW5ndGgpO1xuICAgIHRoaXMucHVzaCh7IGhlYWRlciwgcGF5bG9hZDogcGxpc3QucGFyc2VQbGlzdChwYXlsb2FkKSB9KTtcbiAgfVxuXG59XG5cbmV4cG9ydCB7IFVzYm11eERlY29kZXIgfTtcbmV4cG9ydCBkZWZhdWx0IFVzYm11eERlY29kZXI7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBRUEsTUFBTUEsYUFBYSxHQUFHLEVBQXRCOztBQUVBLE1BQU1DLGFBQU4sU0FBNEJDLGdCQUFPQyxTQUFuQyxDQUE2QztFQUUzQ0MsV0FBVyxHQUFJO0lBQ2IsTUFBTTtNQUFFQyxVQUFVLEVBQUU7SUFBZCxDQUFOO0VBQ0Q7O0VBRURDLFVBQVUsQ0FBRUMsSUFBRixFQUFRQyxRQUFSLEVBQWtCQyxNQUFsQixFQUEwQjtJQUNsQyxLQUFLQyxPQUFMLENBQWFILElBQWI7O0lBQ0FFLE1BQU07RUFDUDs7RUFFREMsT0FBTyxDQUFFSCxJQUFGLEVBQVE7SUFDYixNQUFNSSxNQUFNLEdBQUc7TUFDYkMsTUFBTSxFQUFFTCxJQUFJLENBQUNNLFlBQUwsQ0FBa0IsQ0FBbEIsQ0FESztNQUViQyxPQUFPLEVBQUVQLElBQUksQ0FBQ00sWUFBTCxDQUFrQixDQUFsQixDQUZJO01BR2JFLElBQUksRUFBRVIsSUFBSSxDQUFDTSxZQUFMLENBQWtCLENBQWxCLENBSE87TUFJYkcsR0FBRyxFQUFFVCxJQUFJLENBQUNNLFlBQUwsQ0FBa0IsRUFBbEI7SUFKUSxDQUFmO0lBT0EsSUFBSUksT0FBTyxHQUFHVixJQUFJLENBQUNXLEtBQUwsQ0FBV2xCLGFBQVgsRUFBMEJPLElBQUksQ0FBQ0ssTUFBL0IsQ0FBZDtJQUNBLEtBQUtPLElBQUwsQ0FBVTtNQUFFUixNQUFGO01BQVVNLE9BQU8sRUFBRUcsZUFBTUMsVUFBTixDQUFpQkosT0FBakI7SUFBbkIsQ0FBVjtFQUNEOztBQXJCMEM7OztlQTBCOUJoQixhIn0=
