"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.NSUUID = exports.NSURL = exports.NSDate = exports.BaseArchiveHandler = void 0;
exports.archive = archive;
exports.unarchive = unarchive;
exports.updateNSKeyedArchiveClass = updateNSKeyedArchiveClass;

require("source-map-support/register");

var _bplistParser = _interopRequireDefault(require("bplist-parser"));

var _bplistCreator = _interopRequireDefault(require("bplist-creator"));

var _uuid = require("uuid");

var _lodash = _interopRequireDefault(require("lodash"));

const NSKEYED_ARCHIVE_VERSION = 100000;
const NULL_UID = new _bplistParser.default.UID(0);
const CYCLE_TOKEN = 'CycleToken';
const PRIMITIVE_TYPES = ['Number', 'String', 'Boolean', 'UID', 'Buffer'];
const NON_ENCODABLE_TYPES = ['number', 'boolean'];
const NSKEYEDARCHIVER = 'NSKeyedArchiver';
const UNIX2APPLE_TIMESTAMP_SECOND = 978307200;

class ArchivedObject {
  constructor(object, unarchiver) {
    this.object = object;
    this._unarchiver = unarchiver;
  }

  decodeIndex(index) {
    return this._unarchiver.decodeObject(index);
  }

  decode(key) {
    return this._unarchiver.decodeKey(this.object, key);
  }

}

class ArchivingObject {
  constructor(object, archiver) {
    this._archiveObj = object;
    this._archiver = archiver;
  }

  encode(key, val) {
    this._archiveObj[key] = this._archiver.encode(val);
  }

}

class BaseArchiveHandler {
  decodeArchive(archive) {
    throw new Error(`Did not know how to decode the object`);
  }

  encodeArchive(obj, archive) {
    throw new Error(`Did not know how to encode the object`);
  }

}

exports.BaseArchiveHandler = BaseArchiveHandler;

class DictArchive extends BaseArchiveHandler {
  decodeArchive(archive) {
    const keyUids = archive.decode('NS.keys');
    const valUids = archive.decode('NS.objects');
    const d = {};

    for (let i = 0; i < keyUids.length; i++) {
      const key = archive.decodeIndex(keyUids[i]);
      d[key] = archive.decodeIndex(valUids[i]);
    }

    return d;
  }

}

class ListArchive extends BaseArchiveHandler {
  decodeArchive(archive) {
    const uids = archive.decode('NS.objects');
    return uids.map(archive.decodeIndex.bind(archive));
  }

}

class DTTapMessagePlist extends BaseArchiveHandler {
  decodeArchive(archive) {
    return archive.decode('DTTapMessagePlist');
  }

}

class NSError extends BaseArchiveHandler {
  decodeArchive(archive) {
    return {
      '$class': 'NSError',
      'domain': archive.decode('NSDomain'),
      'userinfo': archive.decode('NSUserInfo'),
      'code': archive.decode('NSCode')
    };
  }

}

class NSException extends BaseArchiveHandler {
  decodeArchive(archive) {
    return {
      '$class': 'NSException',
      'reason': archive.decode('NS.reason'),
      'userinfo': archive.decode('userinfo'),
      'name': archive.decode('NS.name')
    };
  }

}

class NSURL extends BaseArchiveHandler {
  constructor(base, relative) {
    super();
    this._base = base;
    this._relative = relative;
  }

  decodeArchive(archive) {
    return {
      $class: 'NSURL',
      base: archive.decode('NS.base'),
      relative: archive.decode('NS.relative')
    };
  }

  encodeArchive(obj, archive) {
    archive.encode('NS.base', obj._base);
    archive.encode('NS.relative', obj._relative);
  }

}

exports.NSURL = NSURL;

class NSDate extends BaseArchiveHandler {
  constructor(data) {
    super();
    this._data = data;
  }

  decodeArchive(archive) {
    return UNIX2APPLE_TIMESTAMP_SECOND + archive.decode('NS.time');
  }

  encodeArchive(obj, archive) {
    archive.encode('NS.time', obj._data - UNIX2APPLE_TIMESTAMP_SECOND);
  }

}

exports.NSDate = NSDate;

class NSMutableString extends BaseArchiveHandler {
  decodeArchive(archive) {
    return archive.decode('NS.string');
  }

}

class NSMutableData extends BaseArchiveHandler {
  decodeArchive(archive) {
    return archive.decode('NS.data');
  }

}

class NSUUID extends BaseArchiveHandler {
  constructor(data) {
    super();
    this._data = data;
  }

  decodeArchive(archive) {
    return (0, _uuid.stringify)(archive.decode('NS.uuidbytes'));
  }

  encodeArchive(obj, archive) {
    archive._archiveObj['NS.uuidbytes'] = Buffer.from((0, _uuid.parse)(obj._data).buffer);
  }

}

exports.NSUUID = NSUUID;

class XCTCapabilities extends BaseArchiveHandler {
  decodeArchive(archive) {
    return archive.decode('capabilities-dictionary');
  }

}

class NSNull extends BaseArchiveHandler {
  decodeArchive() {
    return null;
  }

}

const UNARCHIVE_CLASS_MAP = {
  DTTapMessagePlist,
  DTSysmonTapMessage: DTTapMessagePlist,
  DTTapHeartbeatMessage: DTTapMessagePlist,
  DTTapMessageArchive: DTTapMessagePlist,
  DTKTraceTapMessage: DTTapMessagePlist,
  ErrorArchive: NSError,
  ExceptionArchive: NSException,
  NSDictionary: DictArchive,
  NSMutableDictionary: DictArchive,
  NSArray: ListArchive,
  NSMutableArray: ListArchive,
  NSMutableSet: ListArchive,
  NSSet: ListArchive,
  NSDate,
  NSError,
  NSException,
  NSMutableString,
  NSMutableData,
  NSNull,
  NSUUID,
  NSURL,
  XCTCapabilities
};

class Unarchive {
  constructor(inputBytes) {
    this.input = inputBytes;
    this.unpackedUids = {};
    this.topUID = NULL_UID;
    this.objects = [];
  }

  unpackArchiveHeader() {
    const plist = _bplistParser.default.parseBuffer(this.input)[0];

    if (plist.$archiver !== NSKEYEDARCHIVER) {
      throw new Error(`unsupported encoder: ${plist.$archiver}`);
    }

    if (plist.$version !== NSKEYED_ARCHIVE_VERSION) {
      throw new Error(`expected ${NSKEYED_ARCHIVE_VERSION}, got ${plist.$version}`);
    }

    const top = plist.$top;
    const topUID = top.root;

    if (!topUID) {
      throw new Error(`top object did not have a UID! dump: ${JSON.stringify(top)}`);
    }

    this.topUID = topUID;
    this.objects = plist.$objects;
  }

  classForUid(index) {
    const meta = this.objects[index.UID];
    const name = meta.$classname;
    const klass = UNARCHIVE_CLASS_MAP[name];

    if (!klass) {
      throw new Error(`no mapping for ${name} in UNARCHIVE_CLASS_MAP`);
    }

    return klass;
  }

  decodeKey(obj, key) {
    const val = obj[key];
    return _lodash.default.isNil(val === null || val === void 0 ? void 0 : val.UID) ? val : this.decodeObject(val);
  }

  decodeObject(index) {
    if (index === NULL_UID) {
      return null;
    }

    const obj = this.unpackedUids[index];

    if (obj === CYCLE_TOKEN) {
      throw new Error(`archive has a cycle with ${index}`);
    }

    if (!_lodash.default.isUndefined(obj)) {
      return obj;
    }

    const rawObj = this.objects[index.UID];
    this.unpackedUids[index.UID] = CYCLE_TOKEN;

    if (!(rawObj !== null && rawObj !== void 0 && rawObj.$class)) {
      this.unpackedUids[index.UID] = obj;
      return rawObj;
    }

    const klass = this.classForUid(rawObj.$class);
    const klassObj = new klass().decodeArchive(new ArchivedObject(rawObj, this));
    this.unpackedUids[index.UID] = klassObj;
    return klassObj;
  }

  toObject() {
    this.unpackArchiveHeader();
    return this.decodeObject(this.topUID);
  }

}

class Archive {
  constructor(inputObject) {
    this.input = inputObject;
    this.classMap = {};
    this.objects = ['$null'];
  }

  uidForArchiver(archiver) {
    let val = this.classMap[archiver];

    if (val) {
      return new _bplistParser.default.UID(val);
    }

    this.classMap[archiver] = this.objects.length;
    val = new _bplistParser.default.UID(this.objects.length);
    this.objects.push({
      '$classes': [archiver],
      '$classname': archiver
    });
    return val;
  }

  archive(obj) {
    if (_lodash.default.isUndefined(obj) || _lodash.default.isNull(obj)) {
      return NULL_UID;
    }

    const index = new _bplistParser.default.UID(this.objects.length);

    if (PRIMITIVE_TYPES.includes(obj.constructor.name)) {
      this.objects.push(obj);
      return index;
    }

    const archiveObj = {};
    this.objects.push(archiveObj);
    this.encodeTopLevel(obj, archiveObj);
    return index;
  }

  encode(val) {
    if (NON_ENCODABLE_TYPES.includes(typeof val)) {
      return val;
    }

    return this.archive(val);
  }

  encodeTopLevel(obj, archiveObj) {
    if (obj instanceof Array) {
      return this.encodeArray(obj, archiveObj);
    } else if (obj instanceof Set) {
      return this.encodeSet(obj, archiveObj);
    } else if (obj instanceof Object) {
      const objName = obj.constructor.name;

      if (objName in UNARCHIVE_CLASS_MAP) {
        archiveObj.$class = this.uidForArchiver(objName);
        obj.encodeArchive(obj, new ArchivingObject(archiveObj, this));
      } else {
        return this.encodeDict(obj, archiveObj);
      }
    } else {
      throw Error(`Unable to encode types: ${typeof obj}`);
    }
  }

  encodeArray(objs, archiveObj) {
    archiveObj.$class = this.uidForArchiver('NSArray');
    archiveObj['NS.objects'] = objs.map(this.archive.bind(this));
  }

  encodeSet(objs, archiveObj) {
    archiveObj.$class = this.uidForArchiver('NSSet');
    archiveObj['NS.objects'] = objs.map(this.archive.bind(this));
  }

  encodeDict(obj, archiveObj) {
    archiveObj.$class = this.uidForArchiver('NSDictionary');
    archiveObj['NS.keys'] = _lodash.default.keys(obj).map(this.archive.bind(this));
    archiveObj['NS.objects'] = _lodash.default.values(obj).map(this.archive.bind(this));
  }

  toBytes() {
    if (this.objects.length === 1) {
      this.archive(this.input);
    }

    const d = {
      '$version': NSKEYED_ARCHIVE_VERSION,
      '$archiver': NSKEYEDARCHIVER,
      '$top': {
        'root': new _bplistParser.default.UID(1)
      },
      '$objects': this.objects
    };
    return (0, _bplistCreator.default)(d);
  }

}

function archive(inputObject) {
  return new Archive(inputObject).toBytes();
}

function unarchive(inputBytes) {
  return new Unarchive(inputBytes).toObject();
}

function updateNSKeyedArchiveClass(name, subClass) {
  var _subClass$prototype, _subClass$prototype2;

  if (!_lodash.default.isFunction((_subClass$prototype = subClass.prototype) === null || _subClass$prototype === void 0 ? void 0 : _subClass$prototype.decodeArchive) && !_lodash.default.isFunction((_subClass$prototype2 = subClass.prototype) === null || _subClass$prototype2 === void 0 ? void 0 : _subClass$prototype2.encodeArchive)) {
    throw Error('subClass must have decodeArchive or encodeArchive methods');
  }

  if (!(name in UNARCHIVE_CLASS_MAP)) {
    UNARCHIVE_CLASS_MAP[name] = subClass;
  }
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL2luc3RydW1lbnQvdHJhbnNmb3JtZXIvbnNrZXllZC5qcyIsIm5hbWVzIjpbIk5TS0VZRURfQVJDSElWRV9WRVJTSU9OIiwiTlVMTF9VSUQiLCJwbGlzdGxpYiIsIlVJRCIsIkNZQ0xFX1RPS0VOIiwiUFJJTUlUSVZFX1RZUEVTIiwiTk9OX0VOQ09EQUJMRV9UWVBFUyIsIk5TS0VZRURBUkNISVZFUiIsIlVOSVgyQVBQTEVfVElNRVNUQU1QX1NFQ09ORCIsIkFyY2hpdmVkT2JqZWN0IiwiY29uc3RydWN0b3IiLCJvYmplY3QiLCJ1bmFyY2hpdmVyIiwiX3VuYXJjaGl2ZXIiLCJkZWNvZGVJbmRleCIsImluZGV4IiwiZGVjb2RlT2JqZWN0IiwiZGVjb2RlIiwia2V5IiwiZGVjb2RlS2V5IiwiQXJjaGl2aW5nT2JqZWN0IiwiYXJjaGl2ZXIiLCJfYXJjaGl2ZU9iaiIsIl9hcmNoaXZlciIsImVuY29kZSIsInZhbCIsIkJhc2VBcmNoaXZlSGFuZGxlciIsImRlY29kZUFyY2hpdmUiLCJhcmNoaXZlIiwiRXJyb3IiLCJlbmNvZGVBcmNoaXZlIiwib2JqIiwiRGljdEFyY2hpdmUiLCJrZXlVaWRzIiwidmFsVWlkcyIsImQiLCJpIiwibGVuZ3RoIiwiTGlzdEFyY2hpdmUiLCJ1aWRzIiwibWFwIiwiYmluZCIsIkRUVGFwTWVzc2FnZVBsaXN0IiwiTlNFcnJvciIsIk5TRXhjZXB0aW9uIiwiTlNVUkwiLCJiYXNlIiwicmVsYXRpdmUiLCJfYmFzZSIsIl9yZWxhdGl2ZSIsIiRjbGFzcyIsIk5TRGF0ZSIsImRhdGEiLCJfZGF0YSIsIk5TTXV0YWJsZVN0cmluZyIsIk5TTXV0YWJsZURhdGEiLCJOU1VVSUQiLCJCdWZmZXIiLCJmcm9tIiwiYnVmZmVyIiwiWENUQ2FwYWJpbGl0aWVzIiwiTlNOdWxsIiwiVU5BUkNISVZFX0NMQVNTX01BUCIsIkRUU3lzbW9uVGFwTWVzc2FnZSIsIkRUVGFwSGVhcnRiZWF0TWVzc2FnZSIsIkRUVGFwTWVzc2FnZUFyY2hpdmUiLCJEVEtUcmFjZVRhcE1lc3NhZ2UiLCJFcnJvckFyY2hpdmUiLCJFeGNlcHRpb25BcmNoaXZlIiwiTlNEaWN0aW9uYXJ5IiwiTlNNdXRhYmxlRGljdGlvbmFyeSIsIk5TQXJyYXkiLCJOU011dGFibGVBcnJheSIsIk5TTXV0YWJsZVNldCIsIk5TU2V0IiwiVW5hcmNoaXZlIiwiaW5wdXRCeXRlcyIsImlucHV0IiwidW5wYWNrZWRVaWRzIiwidG9wVUlEIiwib2JqZWN0cyIsInVucGFja0FyY2hpdmVIZWFkZXIiLCJwbGlzdCIsInBhcnNlQnVmZmVyIiwiJGFyY2hpdmVyIiwiJHZlcnNpb24iLCJ0b3AiLCIkdG9wIiwicm9vdCIsIkpTT04iLCJzdHJpbmdpZnkiLCIkb2JqZWN0cyIsImNsYXNzRm9yVWlkIiwibWV0YSIsIm5hbWUiLCIkY2xhc3NuYW1lIiwia2xhc3MiLCJfIiwiaXNOaWwiLCJpc1VuZGVmaW5lZCIsInJhd09iaiIsImtsYXNzT2JqIiwidG9PYmplY3QiLCJBcmNoaXZlIiwiaW5wdXRPYmplY3QiLCJjbGFzc01hcCIsInVpZEZvckFyY2hpdmVyIiwicHVzaCIsImlzTnVsbCIsImluY2x1ZGVzIiwiYXJjaGl2ZU9iaiIsImVuY29kZVRvcExldmVsIiwiQXJyYXkiLCJlbmNvZGVBcnJheSIsIlNldCIsImVuY29kZVNldCIsIk9iamVjdCIsIm9iak5hbWUiLCJlbmNvZGVEaWN0Iiwib2JqcyIsImtleXMiLCJ2YWx1ZXMiLCJ0b0J5dGVzIiwidW5hcmNoaXZlIiwidXBkYXRlTlNLZXllZEFyY2hpdmVDbGFzcyIsInN1YkNsYXNzIiwiaXNGdW5jdGlvbiIsInByb3RvdHlwZSJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4iLCJzb3VyY2VzIjpbImxpYi9pbnN0cnVtZW50L3RyYW5zZm9ybWVyL25za2V5ZWQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHBsaXN0bGliIGZyb20gJ2JwbGlzdC1wYXJzZXInO1xuaW1wb3J0IGJwbGlzdENyZWF0ZSBmcm9tICdicGxpc3QtY3JlYXRvcic7XG5pbXBvcnQge3BhcnNlIGFzIHV1aWRQYXJzZSwgc3RyaW5naWZ5IGFzIHV1aWRTdHJpbmdpZnl9IGZyb20gJ3V1aWQnO1xuaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcblxuY29uc3QgTlNLRVlFRF9BUkNISVZFX1ZFUlNJT04gPSAxMDBfMDAwO1xuY29uc3QgTlVMTF9VSUQgPSBuZXcgcGxpc3RsaWIuVUlEKDApO1xuY29uc3QgQ1lDTEVfVE9LRU4gPSAnQ3ljbGVUb2tlbic7XG5jb25zdCBQUklNSVRJVkVfVFlQRVMgPSBbJ051bWJlcicsICdTdHJpbmcnLCAnQm9vbGVhbicsICdVSUQnLCAnQnVmZmVyJ107XG5jb25zdCBOT05fRU5DT0RBQkxFX1RZUEVTID0gWydudW1iZXInLCAnYm9vbGVhbiddO1xuY29uc3QgTlNLRVlFREFSQ0hJVkVSID0gJ05TS2V5ZWRBcmNoaXZlcic7XG5jb25zdCBVTklYMkFQUExFX1RJTUVTVEFNUF9TRUNPTkQgPSA5NzgzMDcyMDA7XG5cblxuY2xhc3MgQXJjaGl2ZWRPYmplY3Qge1xuICAvKipcbiAgICogU3RhdGVmdWwgd3JhcHBlciBhcm91bmQgQXJjaGl2ZSBmb3IgYW4gb2JqZWN0IGJlaW5nIGFyY2hpdmVkLlxuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0XG4gICAqIEBwYXJhbSB7VW5hcmNoaXZlfSB1bmFyY2hpdmVyXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cbiAgY29uc3RydWN0b3IgKG9iamVjdCwgdW5hcmNoaXZlcikge1xuICAgIHRoaXMub2JqZWN0ID0gb2JqZWN0O1xuICAgIHRoaXMuX3VuYXJjaGl2ZXIgPSB1bmFyY2hpdmVyO1xuICB9XG5cbiAgZGVjb2RlSW5kZXggKGluZGV4KSB7XG4gICAgcmV0dXJuIHRoaXMuX3VuYXJjaGl2ZXIuZGVjb2RlT2JqZWN0KGluZGV4KTtcbiAgfVxuXG4gIGRlY29kZSAoa2V5KSB7XG4gICAgcmV0dXJuIHRoaXMuX3VuYXJjaGl2ZXIuZGVjb2RlS2V5KHRoaXMub2JqZWN0LCBrZXkpO1xuICB9XG59XG5cbmNsYXNzIEFyY2hpdmluZ09iamVjdCB7XG4gIC8qKlxuICAgKiBTdGF0ZWZ1bCB3cmFwcGVyIGFyb3VuZCBVbmFyY2hpdmUgZm9yIGFuIGFyY2hpdmVkIG9iamVjdFxuICAgKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0XG4gICAqIEBwYXJhbSB7QXJjaGl2ZX0gYXJjaGl2ZXJcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqL1xuICBjb25zdHJ1Y3RvciAob2JqZWN0LCBhcmNoaXZlcikge1xuICAgIHRoaXMuX2FyY2hpdmVPYmogPSBvYmplY3Q7XG4gICAgdGhpcy5fYXJjaGl2ZXIgPSBhcmNoaXZlcjtcbiAgfVxuXG4gIGVuY29kZSAoa2V5LCB2YWwpIHtcbiAgICB0aGlzLl9hcmNoaXZlT2JqW2tleV0gPSB0aGlzLl9hcmNoaXZlci5lbmNvZGUodmFsKTtcbiAgfVxufVxuXG4vKipcbiAqIFRoaXMgY2xhc3MgbXVzdCBiZSBpbmhlcml0ZWQgd2hlbiBjcmVhdGluZyBhbiBhcmNoaXZlL3VuYXJjaGl2ZSBzdWJjbGFzc1xuICogQW5kIHlvdSBuZWVkIHRvIGNhbGwgYHVwZGF0ZU5TS2V5ZWRBcmNoaXZlQ2xhc3NgIGFkZCBzdWJjbGFzcyB0byBhcmNoaXZlL3VuYXJjaGl2ZSBvYmplY3RcbiAqL1xuY2xhc3MgQmFzZUFyY2hpdmVIYW5kbGVyIHtcbiAgLyoqXG4gICAqIEBwYXJhbSB7QXJjaGl2ZWRPYmplY3R9IGFyY2hpdmVcbiAgICovXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICBkZWNvZGVBcmNoaXZlIChhcmNoaXZlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBEaWQgbm90IGtub3cgaG93IHRvIGRlY29kZSB0aGUgb2JqZWN0YCk7XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtPYmplY3R9IG9iaiAgYW4gaW5zdGFuY2Ugb2YgdGhpcyBjbGFzc1xuICAgKiBAcGFyYW0ge0FyY2hpdmluZ09iamVjdH0gYXJjaGl2ZVxuICAgKi9cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXVudXNlZC12YXJzXG4gIGVuY29kZUFyY2hpdmUgKG9iaiwgYXJjaGl2ZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgRGlkIG5vdCBrbm93IGhvdyB0byBlbmNvZGUgdGhlIG9iamVjdGApO1xuICB9XG59XG5cbi8qKlxuICogXCJEZWxlZ2F0ZSBmb3IgcGFja2luZy91bnBhY2tpbmcgTlMoTXV0YWJsZSlEaWN0aW9uYXJ5IG9iamVjdHNcIlxuICovXG5jbGFzcyBEaWN0QXJjaGl2ZSBleHRlbmRzIEJhc2VBcmNoaXZlSGFuZGxlciB7XG4gIGRlY29kZUFyY2hpdmUgKGFyY2hpdmUpIHtcbiAgICBjb25zdCBrZXlVaWRzID0gYXJjaGl2ZS5kZWNvZGUoJ05TLmtleXMnKTtcbiAgICBjb25zdCB2YWxVaWRzID0gYXJjaGl2ZS5kZWNvZGUoJ05TLm9iamVjdHMnKTtcbiAgICBjb25zdCBkID0ge307XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBrZXlVaWRzLmxlbmd0aCA7IGkrKykge1xuICAgICAgY29uc3Qga2V5ID0gYXJjaGl2ZS5kZWNvZGVJbmRleChrZXlVaWRzW2ldKTtcbiAgICAgIGRba2V5XSA9IGFyY2hpdmUuZGVjb2RlSW5kZXgodmFsVWlkc1tpXSk7XG4gICAgfVxuICAgIHJldHVybiBkO1xuICB9XG59XG5cbi8qKlxuICogRGVsZWdhdGUgZm9yIHBhY2tpbmcvdW5wYWNraW5nIE5TKE11dGFibGUpQXJyYXkgb2JqZWN0c1xuICovXG5jbGFzcyBMaXN0QXJjaGl2ZSBleHRlbmRzIEJhc2VBcmNoaXZlSGFuZGxlciB7XG4gIGRlY29kZUFyY2hpdmUgKGFyY2hpdmUpIHtcbiAgICBjb25zdCB1aWRzID0gYXJjaGl2ZS5kZWNvZGUoJ05TLm9iamVjdHMnKTtcbiAgICByZXR1cm4gdWlkcy5tYXAoYXJjaGl2ZS5kZWNvZGVJbmRleC5iaW5kKGFyY2hpdmUpKTtcbiAgfVxufVxuXG5jbGFzcyBEVFRhcE1lc3NhZ2VQbGlzdCBleHRlbmRzIEJhc2VBcmNoaXZlSGFuZGxlciB7XG4gIGRlY29kZUFyY2hpdmUgKGFyY2hpdmUpIHtcbiAgICByZXR1cm4gYXJjaGl2ZS5kZWNvZGUoJ0RUVGFwTWVzc2FnZVBsaXN0Jyk7XG4gIH1cbn1cblxuY2xhc3MgTlNFcnJvciBleHRlbmRzIEJhc2VBcmNoaXZlSGFuZGxlciB7XG4gIGRlY29kZUFyY2hpdmUgKGFyY2hpdmUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgJyRjbGFzcyc6ICdOU0Vycm9yJyxcbiAgICAgICdkb21haW4nOiBhcmNoaXZlLmRlY29kZSgnTlNEb21haW4nKSxcbiAgICAgICd1c2VyaW5mbyc6IGFyY2hpdmUuZGVjb2RlKCdOU1VzZXJJbmZvJyksXG4gICAgICAnY29kZSc6IGFyY2hpdmUuZGVjb2RlKCdOU0NvZGUnKVxuICAgIH07XG4gIH1cbn1cblxuY2xhc3MgTlNFeGNlcHRpb24gZXh0ZW5kcyBCYXNlQXJjaGl2ZUhhbmRsZXIge1xuICBkZWNvZGVBcmNoaXZlIChhcmNoaXZlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICckY2xhc3MnOiAnTlNFeGNlcHRpb24nLFxuICAgICAgJ3JlYXNvbic6IGFyY2hpdmUuZGVjb2RlKCdOUy5yZWFzb24nKSxcbiAgICAgICd1c2VyaW5mbyc6IGFyY2hpdmUuZGVjb2RlKCd1c2VyaW5mbycpLFxuICAgICAgJ25hbWUnOiBhcmNoaXZlLmRlY29kZSgnTlMubmFtZScpXG4gICAgfTtcbiAgfVxufVxuXG5jbGFzcyBOU1VSTCBleHRlbmRzIEJhc2VBcmNoaXZlSGFuZGxlciB7XG4gIC8qKlxuICAgKiBAcGFyYW0geyp9IGJhc2VcbiAgICogQHBhcmFtIHtzdHJpbmd9IHJlbGF0aXZlIHVzdWFsbHkgaW9zIGRldmljZSByZWxhdGl2ZSBwYXRoIGUuZzogZmlsZTovL3h4L1xuICAgKi9cbiAgY29uc3RydWN0b3IgKGJhc2UsIHJlbGF0aXZlKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLl9iYXNlID0gYmFzZTtcbiAgICB0aGlzLl9yZWxhdGl2ZSA9IHJlbGF0aXZlO1xuICB9XG5cbiAgZGVjb2RlQXJjaGl2ZSAoYXJjaGl2ZSkge1xuICAgIHJldHVybiB7JGNsYXNzOiAnTlNVUkwnLCBiYXNlOiBhcmNoaXZlLmRlY29kZSgnTlMuYmFzZScpLCByZWxhdGl2ZTogYXJjaGl2ZS5kZWNvZGUoJ05TLnJlbGF0aXZlJyl9O1xuICB9XG5cbiAgZW5jb2RlQXJjaGl2ZSAob2JqLCBhcmNoaXZlKSB7XG4gICAgYXJjaGl2ZS5lbmNvZGUoJ05TLmJhc2UnLCBvYmouX2Jhc2UpO1xuICAgIGFyY2hpdmUuZW5jb2RlKCdOUy5yZWxhdGl2ZScsIG9iai5fcmVsYXRpdmUpO1xuICB9XG59XG5cbmNsYXNzIE5TRGF0ZSBleHRlbmRzIEJhc2VBcmNoaXZlSGFuZGxlciB7XG4gIC8qKlxuICAgKiBAcGFyYW0ge251bWJlcn0gZGF0YSB0aW1lc3RhbXAgaW4gc2Vjb25kc1xuICAgKi9cbiAgY29uc3RydWN0b3IgKGRhdGEpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX2RhdGEgPSBkYXRhO1xuICB9XG5cbiAgZGVjb2RlQXJjaGl2ZSAoYXJjaGl2ZSkge1xuICAgIHJldHVybiBVTklYMkFQUExFX1RJTUVTVEFNUF9TRUNPTkQgKyBhcmNoaXZlLmRlY29kZSgnTlMudGltZScpO1xuICB9XG5cbiAgZW5jb2RlQXJjaGl2ZSAob2JqLCBhcmNoaXZlKSB7XG4gICAgYXJjaGl2ZS5lbmNvZGUoJ05TLnRpbWUnLCBvYmouX2RhdGEgLSBVTklYMkFQUExFX1RJTUVTVEFNUF9TRUNPTkQpO1xuICB9XG59XG5cbmNsYXNzIE5TTXV0YWJsZVN0cmluZyBleHRlbmRzIEJhc2VBcmNoaXZlSGFuZGxlciB7XG4gIGRlY29kZUFyY2hpdmUgKGFyY2hpdmUpIHtcbiAgICByZXR1cm4gYXJjaGl2ZS5kZWNvZGUoJ05TLnN0cmluZycpO1xuICB9XG59XG5cbmNsYXNzIE5TTXV0YWJsZURhdGEgZXh0ZW5kcyBCYXNlQXJjaGl2ZUhhbmRsZXIge1xuICBkZWNvZGVBcmNoaXZlIChhcmNoaXZlKSB7XG4gICAgcmV0dXJuIGFyY2hpdmUuZGVjb2RlKCdOUy5kYXRhJyk7XG4gIH1cbn1cblxuY2xhc3MgTlNVVUlEIGV4dGVuZHMgQmFzZUFyY2hpdmVIYW5kbGVyIHtcbiAgLyoqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBkYXRhIHV1aWQgZm9ybWF0IGRhdGEgZS5nOjAwMDAwMDAwLTAwMDAtMDAwMC0wMDAwLTAwMDAwMDAwMDAwMFxuICAgKi9cbiAgY29uc3RydWN0b3IgKGRhdGEpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX2RhdGEgPSBkYXRhO1xuICB9XG5cbiAgZGVjb2RlQXJjaGl2ZSAoYXJjaGl2ZSkge1xuICAgIHJldHVybiB1dWlkU3RyaW5naWZ5KGFyY2hpdmUuZGVjb2RlKCdOUy51dWlkYnl0ZXMnKSk7XG4gIH1cblxuICBlbmNvZGVBcmNoaXZlIChvYmosIGFyY2hpdmUpIHtcbiAgICBhcmNoaXZlLl9hcmNoaXZlT2JqWydOUy51dWlkYnl0ZXMnXSA9IEJ1ZmZlci5mcm9tKHV1aWRQYXJzZShvYmouX2RhdGEpLmJ1ZmZlcik7XG4gIH1cbn1cblxuY2xhc3MgWENUQ2FwYWJpbGl0aWVzIGV4dGVuZHMgQmFzZUFyY2hpdmVIYW5kbGVyIHtcbiAgZGVjb2RlQXJjaGl2ZSAoYXJjaGl2ZSkge1xuICAgIHJldHVybiBhcmNoaXZlLmRlY29kZSgnY2FwYWJpbGl0aWVzLWRpY3Rpb25hcnknKTtcbiAgfVxufVxuXG5jbGFzcyBOU051bGwgZXh0ZW5kcyBCYXNlQXJjaGl2ZUhhbmRsZXIge1xuICBkZWNvZGVBcmNoaXZlICgpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIGRlY29kZSBhbmQgZW5jb2RlIEFyY2hpdmUgb2YgY3VycmVudGx5IGtub3duIGRhdGEgZm9ybWF0c1xuICovXG5jb25zdCBVTkFSQ0hJVkVfQ0xBU1NfTUFQID0ge1xuICBEVFRhcE1lc3NhZ2VQbGlzdCxcbiAgRFRTeXNtb25UYXBNZXNzYWdlOiBEVFRhcE1lc3NhZ2VQbGlzdCxcbiAgRFRUYXBIZWFydGJlYXRNZXNzYWdlOiBEVFRhcE1lc3NhZ2VQbGlzdCxcbiAgRFRUYXBNZXNzYWdlQXJjaGl2ZTogRFRUYXBNZXNzYWdlUGxpc3QsXG4gIERUS1RyYWNlVGFwTWVzc2FnZTogRFRUYXBNZXNzYWdlUGxpc3QsXG4gIEVycm9yQXJjaGl2ZTogTlNFcnJvcixcbiAgRXhjZXB0aW9uQXJjaGl2ZTogTlNFeGNlcHRpb24sXG4gIE5TRGljdGlvbmFyeTogRGljdEFyY2hpdmUsXG4gIE5TTXV0YWJsZURpY3Rpb25hcnk6IERpY3RBcmNoaXZlLFxuICBOU0FycmF5OiBMaXN0QXJjaGl2ZSxcbiAgTlNNdXRhYmxlQXJyYXk6IExpc3RBcmNoaXZlLFxuICBOU011dGFibGVTZXQ6IExpc3RBcmNoaXZlLFxuICBOU1NldDogTGlzdEFyY2hpdmUsXG4gIE5TRGF0ZSxcbiAgTlNFcnJvcixcbiAgTlNFeGNlcHRpb24sXG4gIE5TTXV0YWJsZVN0cmluZyxcbiAgTlNNdXRhYmxlRGF0YSxcbiAgTlNOdWxsLFxuICBOU1VVSUQsXG4gIE5TVVJMLFxuICBYQ1RDYXBhYmlsaXRpZXNcbn07XG5cbi8qKlxuICogQ2FwYWJsZSBvZiB1bnBhY2tpbmcgYW4gYXJjaGl2ZWQgb2JqZWN0IHRyZWUgaW4gdGhlIE5TS2V5ZWRBcmNoaXZlIGZvcm1hdC5cbiAqIEFwcGxlJ3MgaW1wbGVtZW50YXRpb24gY2FuIGJlIGZvdW5kIGhlcmU6XG4gKiBodHRwczovL2dpdGh1Yi5jb20vYXBwbGUvc3dpZnQtY29yZWxpYnMtZm91bmRhdGlvbi9ibG9iL21haW4vU291cmNlcy9Gb3VuZGF0aW9uL05TS2V5ZWRVbmFyY2hpdmVyLnN3aWZ0XG4gKi9cbmNsYXNzIFVuYXJjaGl2ZSB7XG4gIGNvbnN0cnVjdG9yIChpbnB1dEJ5dGVzKSB7XG4gICAgdGhpcy5pbnB1dCA9IGlucHV0Qnl0ZXM7XG4gICAgdGhpcy51bnBhY2tlZFVpZHMgPSB7fTtcbiAgICB0aGlzLnRvcFVJRCA9IE5VTExfVUlEO1xuICAgIHRoaXMub2JqZWN0cyA9IFtdO1xuICB9XG5cbiAgdW5wYWNrQXJjaGl2ZUhlYWRlciAoKSB7XG4gICAgY29uc3QgcGxpc3QgPSBwbGlzdGxpYi5wYXJzZUJ1ZmZlcih0aGlzLmlucHV0KVswXTtcbiAgICBpZiAocGxpc3QuJGFyY2hpdmVyICE9PSBOU0tFWUVEQVJDSElWRVIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgdW5zdXBwb3J0ZWQgZW5jb2RlcjogJHtwbGlzdC4kYXJjaGl2ZXJ9YCk7XG4gICAgfVxuICAgIGlmIChwbGlzdC4kdmVyc2lvbiAhPT0gTlNLRVlFRF9BUkNISVZFX1ZFUlNJT04pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgZXhwZWN0ZWQgJHtOU0tFWUVEX0FSQ0hJVkVfVkVSU0lPTn0sIGdvdCAke3BsaXN0LiR2ZXJzaW9uIH1gKTtcbiAgICB9XG4gICAgY29uc3QgdG9wID0gcGxpc3QuJHRvcDtcbiAgICBjb25zdCB0b3BVSUQgPSB0b3Aucm9vdDtcbiAgICBpZiAoIXRvcFVJRCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGB0b3Agb2JqZWN0IGRpZCBub3QgaGF2ZSBhIFVJRCEgZHVtcDogJHtKU09OLnN0cmluZ2lmeSh0b3ApfWApO1xuICAgIH1cbiAgICB0aGlzLnRvcFVJRCA9IHRvcFVJRDtcbiAgICB0aGlzLm9iamVjdHMgPSBwbGlzdC4kb2JqZWN0cztcbiAgfVxuXG4gIC8qKlxuICAgKiB1c2UgdGhlIFVOQVJDSElWRV9DTEFTU19NQVAgdG8gZmluZCB0aGUgdW5hcmNoaXZpbmcgZGVsZWdhdGUgb2YgYSB1aWRcbiAgICovXG4gIGNsYXNzRm9yVWlkIChpbmRleCkge1xuICAgIGNvbnN0IG1ldGEgPSB0aGlzLm9iamVjdHNbaW5kZXguVUlEXTtcbiAgICBjb25zdCBuYW1lID0gbWV0YS4kY2xhc3NuYW1lO1xuICAgIGNvbnN0IGtsYXNzID0gVU5BUkNISVZFX0NMQVNTX01BUFtuYW1lXTtcbiAgICBpZiAoIWtsYXNzKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYG5vIG1hcHBpbmcgZm9yICR7bmFtZX0gaW4gVU5BUkNISVZFX0NMQVNTX01BUGApO1xuICAgIH1cbiAgICByZXR1cm4ga2xhc3M7XG4gIH1cblxuICBkZWNvZGVLZXkgKG9iaiwga2V5KSB7XG4gICAgY29uc3QgdmFsID0gb2JqW2tleV07XG4gICAgcmV0dXJuIF8uaXNOaWwodmFsPy5VSUQpID8gdmFsIDogdGhpcy5kZWNvZGVPYmplY3QodmFsKTtcbiAgfVxuXG4gIGRlY29kZU9iamVjdCAoaW5kZXgpIHtcbiAgICBpZiAoaW5kZXggPT09IE5VTExfVUlEKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3Qgb2JqID0gdGhpcy51bnBhY2tlZFVpZHNbaW5kZXhdO1xuICAgIGlmIChvYmogPT09IENZQ0xFX1RPS0VOKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYGFyY2hpdmUgaGFzIGEgY3ljbGUgd2l0aCAke2luZGV4fWApO1xuICAgIH1cbiAgICBpZiAoIV8uaXNVbmRlZmluZWQob2JqKSkge1xuICAgICAgcmV0dXJuIG9iajtcbiAgICB9XG4gICAgY29uc3QgcmF3T2JqID0gdGhpcy5vYmplY3RzW2luZGV4LlVJRF07XG4gICAgdGhpcy51bnBhY2tlZFVpZHNbaW5kZXguVUlEXSA9IENZQ0xFX1RPS0VOO1xuXG4gICAgaWYgKCFyYXdPYmo/LiRjbGFzcykge1xuICAgICAgdGhpcy51bnBhY2tlZFVpZHNbaW5kZXguVUlEXSA9IG9iajtcbiAgICAgIHJldHVybiByYXdPYmo7XG4gICAgfVxuICAgIGNvbnN0IGtsYXNzID0gdGhpcy5jbGFzc0ZvclVpZChyYXdPYmouJGNsYXNzKTtcbiAgICBjb25zdCBrbGFzc09iaiA9IG5ldyBrbGFzcygpLmRlY29kZUFyY2hpdmUobmV3IEFyY2hpdmVkT2JqZWN0KHJhd09iaiwgdGhpcykpO1xuICAgIHRoaXMudW5wYWNrZWRVaWRzW2luZGV4LlVJRF0gPSBrbGFzc09iajtcbiAgICByZXR1cm4ga2xhc3NPYmo7XG4gIH1cblxuICB0b09iamVjdCAoKSB7XG4gICAgdGhpcy51bnBhY2tBcmNoaXZlSGVhZGVyKCk7XG4gICAgcmV0dXJuIHRoaXMuZGVjb2RlT2JqZWN0KHRoaXMudG9wVUlEKTtcbiAgfVxufVxuXG4vKipcbiAqIENhcGFibGUgb2YgcGFja2luZyBhbiBvYmplY3QgdHJlZSBpbnRvIHRoZSBOU0tleWVkQXJjaGl2ZSBmb3JtYXQuXG4gKiBBcHBsZSdzIGltcGxlbWVudGF0aW9uIGNhbiBiZSBmb3VuZCBoZXJlOlxuICogaHR0cHM6Ly9naXRodWIuY29tL2FwcGxlL3N3aWZ0LWNvcmVsaWJzLWZvdW5kYXRpb24vYmxvYi9tYWluL1NvdXJjZXMvRm91bmRhdGlvbi9OU0tleWVkQXJjaGl2ZXIuc3dpZnRcbiAqL1xuY2xhc3MgQXJjaGl2ZSB7XG4gIGNvbnN0cnVjdG9yIChpbnB1dE9iamVjdCkge1xuICAgIHRoaXMuaW5wdXQgPSBpbnB1dE9iamVjdDtcbiAgICB0aGlzLmNsYXNzTWFwID0ge307XG4gICAgdGhpcy5vYmplY3RzID0gWyckbnVsbCddOyAvLyBvYmplY3RzIHRoYXQgZ28gZGlyZWN0bHkgaW50byB0aGUgYXJjaGl2ZSwgYWx3YXlzIHN0YXJ0IHdpdGggJG51bGxcbiAgfVxuXG4gIHVpZEZvckFyY2hpdmVyIChhcmNoaXZlcikge1xuICAgIGxldCB2YWwgPSB0aGlzLmNsYXNzTWFwW2FyY2hpdmVyXTtcbiAgICBpZiAodmFsKSB7XG4gICAgICByZXR1cm4gbmV3IHBsaXN0bGliLlVJRCh2YWwpO1xuICAgIH1cbiAgICB0aGlzLmNsYXNzTWFwW2FyY2hpdmVyXSA9IHRoaXMub2JqZWN0cy5sZW5ndGg7XG4gICAgdmFsID0gbmV3IHBsaXN0bGliLlVJRCh0aGlzLm9iamVjdHMubGVuZ3RoKTtcbiAgICB0aGlzLm9iamVjdHMucHVzaCh7XG4gICAgICAnJGNsYXNzZXMnOiBbYXJjaGl2ZXJdLFxuICAgICAgJyRjbGFzc25hbWUnOiBhcmNoaXZlclxuICAgIH0pO1xuICAgIHJldHVybiB2YWw7XG4gIH1cblxuICBhcmNoaXZlIChvYmopIHtcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChvYmopIHx8IF8uaXNOdWxsKG9iaikpIHtcbiAgICAgIHJldHVybiBOVUxMX1VJRDtcbiAgICB9XG4gICAgY29uc3QgaW5kZXggPSBuZXcgcGxpc3RsaWIuVUlEKHRoaXMub2JqZWN0cy5sZW5ndGgpO1xuICAgIGlmIChQUklNSVRJVkVfVFlQRVMuaW5jbHVkZXMob2JqLmNvbnN0cnVjdG9yLm5hbWUpKSB7XG4gICAgICB0aGlzLm9iamVjdHMucHVzaChvYmopO1xuICAgICAgcmV0dXJuIGluZGV4O1xuICAgIH1cbiAgICBjb25zdCBhcmNoaXZlT2JqID0ge307XG4gICAgdGhpcy5vYmplY3RzLnB1c2goYXJjaGl2ZU9iaik7XG4gICAgdGhpcy5lbmNvZGVUb3BMZXZlbChvYmosIGFyY2hpdmVPYmopO1xuICAgIHJldHVybiBpbmRleDtcbiAgfVxuXG4gIGVuY29kZSAodmFsKSB7XG4gICAgaWYgKE5PTl9FTkNPREFCTEVfVFlQRVMuaW5jbHVkZXModHlwZW9mIHZhbCkpIHtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmFyY2hpdmUodmFsKTtcbiAgfVxuXG4gIGVuY29kZVRvcExldmVsIChvYmosIGFyY2hpdmVPYmopIHtcbiAgICBpZiAob2JqIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIHJldHVybiB0aGlzLmVuY29kZUFycmF5KG9iaiwgYXJjaGl2ZU9iaik7XG4gICAgfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBTZXQpIHtcbiAgICAgIHJldHVybiB0aGlzLmVuY29kZVNldChvYmosIGFyY2hpdmVPYmopO1xuICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgT2JqZWN0KSB7XG4gICAgICBjb25zdCBvYmpOYW1lID0gb2JqLmNvbnN0cnVjdG9yLm5hbWU7XG4gICAgICAvLyBPbmx5IHNwZWNpYWwgY2xhc3MgaW5zdGFuY2UgYXJlIHVzZWZ1bCwgc3VjaCBhcyBOU1VSTCwgTlNVVUlELCBOU0RhdGUuXG4gICAgICAvLyBBbmQgdGhpcyBjbGFzcyBtdXN0IGFsc28gaGF2ZSB0aGUgZW5jb2RlQXJjaGl2ZSBtZXRob2RcbiAgICAgIGlmIChvYmpOYW1lIGluIFVOQVJDSElWRV9DTEFTU19NQVApIHtcbiAgICAgICAgYXJjaGl2ZU9iai4kY2xhc3MgPSB0aGlzLnVpZEZvckFyY2hpdmVyKG9iak5hbWUpO1xuICAgICAgICBvYmouZW5jb2RlQXJjaGl2ZShvYmosIG5ldyBBcmNoaXZpbmdPYmplY3QoYXJjaGl2ZU9iaiwgdGhpcykpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZW5jb2RlRGljdChvYmosIGFyY2hpdmVPYmopO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBFcnJvcihgVW5hYmxlIHRvIGVuY29kZSB0eXBlczogJHt0eXBlb2Ygb2JqfWApO1xuICAgIH1cbiAgfVxuXG4gIGVuY29kZUFycmF5IChvYmpzLCBhcmNoaXZlT2JqKSB7XG4gICAgYXJjaGl2ZU9iai4kY2xhc3MgPSB0aGlzLnVpZEZvckFyY2hpdmVyKCdOU0FycmF5Jyk7XG4gICAgYXJjaGl2ZU9ialsnTlMub2JqZWN0cyddID0gb2Jqcy5tYXAodGhpcy5hcmNoaXZlLmJpbmQodGhpcykpO1xuICB9XG5cbiAgZW5jb2RlU2V0IChvYmpzLCBhcmNoaXZlT2JqKSB7XG4gICAgYXJjaGl2ZU9iai4kY2xhc3MgPSB0aGlzLnVpZEZvckFyY2hpdmVyKCdOU1NldCcpO1xuICAgIGFyY2hpdmVPYmpbJ05TLm9iamVjdHMnXSA9IG9ianMubWFwKHRoaXMuYXJjaGl2ZS5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIGVuY29kZURpY3QgKG9iaiwgYXJjaGl2ZU9iaikge1xuICAgIGFyY2hpdmVPYmouJGNsYXNzID0gdGhpcy51aWRGb3JBcmNoaXZlcignTlNEaWN0aW9uYXJ5Jyk7XG4gICAgYXJjaGl2ZU9ialsnTlMua2V5cyddID0gXy5rZXlzKG9iaikubWFwKHRoaXMuYXJjaGl2ZS5iaW5kKHRoaXMpKTtcbiAgICBhcmNoaXZlT2JqWydOUy5vYmplY3RzJ10gPSBfLnZhbHVlcyhvYmopLm1hcCh0aGlzLmFyY2hpdmUuYmluZCh0aGlzKSk7XG4gIH1cblxuICB0b0J5dGVzICgpIHtcbiAgICBpZiAodGhpcy5vYmplY3RzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgdGhpcy5hcmNoaXZlKHRoaXMuaW5wdXQpO1xuICAgIH1cbiAgICBjb25zdCBkID0ge1xuICAgICAgJyR2ZXJzaW9uJzogTlNLRVlFRF9BUkNISVZFX1ZFUlNJT04sXG4gICAgICAnJGFyY2hpdmVyJzogTlNLRVlFREFSQ0hJVkVSLFxuICAgICAgJyR0b3AnOiB7J3Jvb3QnOiBuZXcgcGxpc3RsaWIuVUlEKDEpfSxcbiAgICAgICckb2JqZWN0cyc6IHRoaXMub2JqZWN0c1xuICAgIH07XG4gICAgcmV0dXJuIGJwbGlzdENyZWF0ZShkKTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgTlNLZXllZCBCdWZmZXIgZnJvbSBhbiBvYmplY3RcbiAqIEBwYXJhbSB7T2JqZWN0fSBpbnB1dE9iamVjdFxuICogQHJldHVybnMge0J1ZmZlcn0gTlNLZXllZCBCdWZmZXJcbiAqL1xuZnVuY3Rpb24gYXJjaGl2ZSAoaW5wdXRPYmplY3QpIHtcbiAgcmV0dXJuIG5ldyBBcmNoaXZlKGlucHV0T2JqZWN0KS50b0J5dGVzKCk7XG59XG5cbi8qKlxuICogUGFyc2VzIE5TS2V5ZWQgQnVmZmVyIGludG8gSlMgT2JqZWN0XG4gKiBAcGFyYW0ge0J1ZmZlcn0gaW5wdXRCeXRlcyBOU0tleWVkIEJ1ZmZlclxuICogQHJldHVybnMge09iamVjdH0gSlMgT2JqZWN0XG4gKi9cbmZ1bmN0aW9uIHVuYXJjaGl2ZSAoaW5wdXRCeXRlcykge1xuICByZXR1cm4gbmV3IFVuYXJjaGl2ZShpbnB1dEJ5dGVzKS50b09iamVjdCgpO1xufVxuXG4vKipcbiAqIFVwZGF0ZSB1bmtub3duIE5TS2V5ZWRBcmNoaXZlIHR5cGVzIGZvciBwYWNraW5nL3VucGFja2luZ1xuICogQHBhcmFtIHtTdHJpbmd9IG5hbWUgcGFja2luZy91bnBhY2tpbmcga2V5IG5hbWVcbiAqIEBwYXJhbSB7QmFzZUFyY2hpdmVIYW5kbGVyfSBzdWJDbGFzcyBpbmhlcml0IGZyb20gQmFzZUFyY2hpdmVIYW5kbGVyIGNsYXNzXG4gKi9cbmZ1bmN0aW9uIHVwZGF0ZU5TS2V5ZWRBcmNoaXZlQ2xhc3MgKG5hbWUsIHN1YkNsYXNzKSB7XG4gIGlmICghXy5pc0Z1bmN0aW9uKHN1YkNsYXNzLnByb3RvdHlwZT8uZGVjb2RlQXJjaGl2ZSkgJiYgIV8uaXNGdW5jdGlvbihzdWJDbGFzcy5wcm90b3R5cGU/LmVuY29kZUFyY2hpdmUpKSB7XG4gICAgdGhyb3cgRXJyb3IoJ3N1YkNsYXNzIG11c3QgaGF2ZSBkZWNvZGVBcmNoaXZlIG9yIGVuY29kZUFyY2hpdmUgbWV0aG9kcycpO1xuICB9XG4gIGlmICghKG5hbWUgaW4gVU5BUkNISVZFX0NMQVNTX01BUCkpIHtcbiAgICBVTkFSQ0hJVkVfQ0xBU1NfTUFQW25hbWVdID0gc3ViQ2xhc3M7XG4gIH1cbn1cblxuZXhwb3J0IHsgdXBkYXRlTlNLZXllZEFyY2hpdmVDbGFzcywgQmFzZUFyY2hpdmVIYW5kbGVyLCBOU1VSTCwgTlNVVUlELCBOU0RhdGUsIHVuYXJjaGl2ZSwgYXJjaGl2ZX07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsdUJBQXVCLEdBQUcsTUFBaEM7QUFDQSxNQUFNQyxRQUFRLEdBQUcsSUFBSUMsc0JBQVNDLEdBQWIsQ0FBaUIsQ0FBakIsQ0FBakI7QUFDQSxNQUFNQyxXQUFXLEdBQUcsWUFBcEI7QUFDQSxNQUFNQyxlQUFlLEdBQUcsQ0FBQyxRQUFELEVBQVcsUUFBWCxFQUFxQixTQUFyQixFQUFnQyxLQUFoQyxFQUF1QyxRQUF2QyxDQUF4QjtBQUNBLE1BQU1DLG1CQUFtQixHQUFHLENBQUMsUUFBRCxFQUFXLFNBQVgsQ0FBNUI7QUFDQSxNQUFNQyxlQUFlLEdBQUcsaUJBQXhCO0FBQ0EsTUFB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
