"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DTXEncoder = void 0;

require("source-map-support/register");

var _stream = _interopRequireDefault(require("stream"));

var _headers = require("../headers");

class DTXEncoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, onData) {
    this.push(this._encode(data), 'buffer');
    onData();
  }

  _encode(data) {
    const {
      sync,
      channelCode,
      selector,
      auxiliaries,
      identifier
    } = data;
    const dtx = new _headers.DTXMessage({
      identifier,
      channelCode,
      selector,
      expectsReply: sync
    });

    if (auxiliaries instanceof _headers.DTXMessageAuxBuffer) {
      dtx.auxiliaries = auxiliaries;
    } else {
      dtx.auxiliaries.data = auxiliaries;
    }

    return dtx.build();
  }

}

exports.DTXEncoder = DTXEncoder;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL2luc3RydW1lbnQvdHJhbnNmb3JtZXIvZHR4LWVuY29kZS5qcyIsIm5hbWVzIjpbIkRUWEVuY29kZXIiLCJTdHJlYW0iLCJUcmFuc2Zvcm0iLCJjb25zdHJ1Y3RvciIsIm9iamVjdE1vZGUiLCJfdHJhbnNmb3JtIiwiZGF0YSIsImVuY29kaW5nIiwib25EYXRhIiwicHVzaCIsIl9lbmNvZGUiLCJzeW5jIiwiY2hhbm5lbENvZGUiLCJzZWxlY3RvciIsImF1eGlsaWFyaWVzIiwiaWRlbnRpZmllciIsImR0eCIsIkRUWE1lc3NhZ2UiLCJleHBlY3RzUmVwbHkiLCJEVFhNZXNzYWdlQXV4QnVmZmVyIiwiYnVpbGQiXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uIiwic291cmNlcyI6WyJsaWIvaW5zdHJ1bWVudC90cmFuc2Zvcm1lci9kdHgtZW5jb2RlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBTdHJlYW0gZnJvbSAnc3RyZWFtJztcbmltcG9ydCB7RFRYTWVzc2FnZSwgRFRYTWVzc2FnZUF1eEJ1ZmZlcn0gZnJvbSAnLi4vaGVhZGVycyc7XG5cblxuY2xhc3MgRFRYRW5jb2RlciBleHRlbmRzIFN0cmVhbS5UcmFuc2Zvcm0ge1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcih7IG9iamVjdE1vZGU6IHRydWUgfSk7XG4gIH1cblxuICBfdHJhbnNmb3JtIChkYXRhLCBlbmNvZGluZywgb25EYXRhKSB7XG4gICAgdGhpcy5wdXNoKHRoaXMuX2VuY29kZShkYXRhKSwgJ2J1ZmZlcicpO1xuICAgIG9uRGF0YSgpO1xuICB9XG5cbiAgX2VuY29kZSAoZGF0YSkge1xuICAgIGNvbnN0IHtzeW5jLCBjaGFubmVsQ29kZSwgc2VsZWN0b3IsIGF1eGlsaWFyaWVzLCBpZGVudGlmaWVyfSA9IGRhdGE7XG4gICAgY29uc3QgZHR4ID0gbmV3IERUWE1lc3NhZ2Uoe1xuICAgICAgaWRlbnRpZmllcixcbiAgICAgIGNoYW5uZWxDb2RlLFxuICAgICAgc2VsZWN0b3IsXG4gICAgICBleHBlY3RzUmVwbHk6IHN5bmNcbiAgICB9KTtcbiAgICBpZiAoYXV4aWxpYXJpZXMgaW5zdGFuY2VvZiBEVFhNZXNzYWdlQXV4QnVmZmVyKSB7XG4gICAgICBkdHguYXV4aWxpYXJpZXMgPSBhdXhpbGlhcmllcztcbiAgICB9IGVsc2Uge1xuICAgICAgZHR4LmF1eGlsaWFyaWVzLmRhdGEgPSBhdXhpbGlhcmllcztcbiAgICB9XG4gICAgcmV0dXJuIGR0eC5idWlsZCgpO1xuICB9XG59XG5cbmV4cG9ydCB7IERUWEVuY29kZXIgfTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFHQSxNQUFNQSxVQUFOLFNBQXlCQyxnQkFBT0MsU0FBaEMsQ0FBMEM7RUFFeENDLFdBQVcsR0FBSTtJQUNiLE1BQU07TUFBRUMsVUFBVSxFQUFFO0lBQWQsQ0FBTjtFQUNEOztFQUVEQyxVQUFVLENBQUVDLElBQUYsRUFBUUMsUUFBUixFQUFrQkMsTUFBbEIsRUFBMEI7SUFDbEMsS0FBS0MsSUFBTCxDQUFVLEtBQUtDLE9BQUwsQ0FBYUosSUFBYixDQUFWLEVBQThCLFFBQTlCO0lBQ0FFLE1BQU07RUFDUDs7RUFFREUsT0FBTyxDQUFFSixJQUFGLEVBQVE7SUFDYixNQUFNO01BQUNLLElBQUQ7TUFBT0MsV0FBUDtNQUFvQkMsUUFBcEI7TUFBOEJDLFdBQTlCO01BQTJDQztJQUEzQyxJQUF5RFQsSUFBL0Q7SUFDQSxNQUFNVSxHQUFHLEdBQUcsSUFBSUMsbUJBQUosQ0FBZTtNQUN6QkYsVUFEeUI7TUFFekJILFdBRnlCO01BR3pCQyxRQUh5QjtNQUl6QkssWUFBWSxFQUFFUDtJQUpXLENBQWYsQ0FBWjs7SUFNQSxJQUFJRyxXQUFXLFlBQVlLLDRCQUEzQixFQUFnRDtNQUM5Q0gsR0FBRyxDQUFDRixXQUFKLEdBQWtCQSxXQUFsQjtJQUNELENBRkQsTUFFTztNQUNMRSxHQUFHLENBQUNGLFdBQUosQ0FBZ0JSLElBQWhCLEdBQXVCUSxXQUF2QjtJQUNEOztJQUNELE9BQU9FLEdBQUcsQ0FBQ0ksS0FBSixFQUFQO0VBQ0Q7O0FBekJ1QyJ9
