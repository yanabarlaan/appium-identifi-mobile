"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.WebInspectorEncoder = void 0;

require("source-map-support/register");

var _stream = _interopRequireDefault(require("stream"));

var _support = require("@appium/support");

const WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE = 8096;

class WebInspectorEncoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, onData) {
    let payloadBuffer = _support.plist.createPlist(data, true);

    for (let i = 0; i < payloadBuffer.length; i += this._encode(payloadBuffer, i)) {}

    onData();
  }

  _encode(data, pos) {
    const messageLength = Math.min(data.length - pos, WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE);

    if (messageLength < WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE) {
      this.push({
        WIRFinalMessageKey: data.slice(pos, messageLength + pos)
      });
    } else {
      this.push({
        WIRPartialMessageKey: data.slice(pos, messageLength + pos)
      });
    }

    return messageLength;
  }

}

exports.WebInspectorEncoder = WebInspectorEncoder;
var _default = WebInspectorEncoder;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL3dlYmluc3BlY3Rvci90cmFuc2Zvcm1lci93ZWJpbnNwZWN0b3ItZW5jb2Rlci5qcyIsIm5hbWVzIjpbIldFQklOU1BFQ1RPUl9QQVJUSUFMX1BBQ0tFVF9DSFVOS19TSVpFIiwiV2ViSW5zcGVjdG9yRW5jb2RlciIsIlN0cmVhbSIsIlRyYW5zZm9ybSIsImNvbnN0cnVjdG9yIiwib2JqZWN0TW9kZSIsIl90cmFuc2Zvcm0iLCJkYXRhIiwiZW5jb2RpbmciLCJvbkRhdGEiLCJwYXlsb2FkQnVmZmVyIiwicGxpc3QiLCJjcmVhdGVQbGlzdCIsImkiLCJsZW5ndGgiLCJfZW5jb2RlIiwicG9zIiwibWVzc2FnZUxlbmd0aCIsIk1hdGgiLCJtaW4iLCJwdXNoIiwiV0lSRmluYWxNZXNzYWdlS2V5Iiwic2xpY2UiLCJXSVJQYXJ0aWFsTWVzc2FnZUtleSJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4iLCJzb3VyY2VzIjpbImxpYi93ZWJpbnNwZWN0b3IvdHJhbnNmb3JtZXIvd2ViaW5zcGVjdG9yLWVuY29kZXIuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFN0cmVhbSBmcm9tICdzdHJlYW0nO1xuaW1wb3J0IHsgcGxpc3QgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuXG5jb25zdCBXRUJJTlNQRUNUT1JfUEFSVElBTF9QQUNLRVRfQ0hVTktfU0laRSA9IDgwOTY7XG5cbmNsYXNzIFdlYkluc3BlY3RvckVuY29kZXIgZXh0ZW5kcyBTdHJlYW0uVHJhbnNmb3JtIHtcblxuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgc3VwZXIoeyBvYmplY3RNb2RlOiB0cnVlIH0pO1xuICB9XG5cbiAgX3RyYW5zZm9ybSAoZGF0YSwgZW5jb2RpbmcsIG9uRGF0YSkge1xuICAgIGxldCBwYXlsb2FkQnVmZmVyID0gcGxpc3QuY3JlYXRlUGxpc3QoZGF0YSwgdHJ1ZSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXlsb2FkQnVmZmVyLmxlbmd0aDsgaSArPSB0aGlzLl9lbmNvZGUocGF5bG9hZEJ1ZmZlciwgaSkpIHt9XG4gICAgb25EYXRhKCk7XG4gIH1cblxuICBfZW5jb2RlIChkYXRhLCBwb3MpIHtcbiAgICBjb25zdCBtZXNzYWdlTGVuZ3RoID0gTWF0aC5taW4oZGF0YS5sZW5ndGggLSBwb3MsIFdFQklOU1BFQ1RPUl9QQVJUSUFMX1BBQ0tFVF9DSFVOS19TSVpFKTtcbiAgICBpZiAobWVzc2FnZUxlbmd0aCA8IFdFQklOU1BFQ1RPUl9QQVJUSUFMX1BBQ0tFVF9DSFVOS19TSVpFKSB7XG4gICAgICB0aGlzLnB1c2goe1dJUkZpbmFsTWVzc2FnZUtleTogZGF0YS5zbGljZShwb3MsIG1lc3NhZ2VMZW5ndGggKyBwb3MpfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucHVzaCh7V0lSUGFydGlhbE1lc3NhZ2VLZXk6IGRhdGEuc2xpY2UocG9zLCBtZXNzYWdlTGVuZ3RoICsgcG9zKX0pO1xuICAgIH1cbiAgICByZXR1cm4gbWVzc2FnZUxlbmd0aDtcbiAgfVxuXG59XG5cbmV4cG9ydCB7IFdlYkluc3BlY3RvckVuY29kZXIgfTtcbmV4cG9ydCBkZWZhdWx0IFdlYkluc3BlY3RvckVuY29kZXI7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBRUEsTUFBTUEsc0NBQXNDLEdBQUcsSUFBL0M7O0FBRUEsTUFBTUMsbUJBQU4sU0FBa0NDLGdCQUFPQyxTQUF6QyxDQUFtRDtFQUVqREMsV0FBVyxHQUFJO0lBQ2IsTUFBTTtNQUFFQyxVQUFVLEVBQUU7SUFBZCxDQUFOO0VBQ0Q7O0VBRURDLFVBQVUsQ0FBRUMsSUFBRixFQUFRQyxRQUFSLEVBQWtCQyxNQUFsQixFQUEwQjtJQUNsQyxJQUFJQyxhQUFhLEdBQUdDLGVBQU1DLFdBQU4sQ0FBa0JMLElBQWxCLEVBQXdCLElBQXhCLENBQXBCOztJQUNBLEtBQUssSUFBSU0sQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0gsYUFBYSxDQUFDSSxNQUFsQyxFQUEwQ0QsQ0FBQyxJQUFJLEtBQUtFLE9BQUwsQ0FBYUwsYUFBYixFQUE0QkcsQ0FBNUIsQ0FBL0MsRUFBK0UsQ0FBRTs7SUFDakZKLE1BQU07RUFDUDs7RUFFRE0sT0FBTyxDQUFFUixJQUFGLEVBQVFTLEdBQVIsRUFBYTtJQUNsQixNQUFNQyxhQUFhLEdBQUdDLElBQUksQ0FBQ0MsR0FBTCxDQUFTWixJQUFJLENBQUNPLE1BQUwsR0FBY0UsR0FBdkIsRUFBNEJoQixzQ0FBNUIsQ0FBdEI7O0lBQ0EsSUFBSWlCLGFBQWEsR0FBR2pCLHNDQUFwQixFQUE0RDtNQUMxRCxLQUFLb0IsSUFBTCxDQUFVO1FBQUNDLGtCQUFrQixFQUFFZCxJQUFJLENBQUNlLEtBQUwsQ0FBV04sR0FBWCxFQUFnQkMsYUFBYSxHQUFHRCxHQUFoQztNQUFyQixDQUFWO0lBQ0QsQ0FGRCxNQUVPO01BQ0wsS0FBS0ksSUFBTCxDQUFVO1FBQUNHLG9CQUFvQixFQUFFaEIsSUFBSSxDQUFDZSxLQUFMLENBQVdOLEdBQVgsRUFBZ0JDLGFBQWEsR0FBR0QsR0FBaEM7TUFBdkIsQ0FBVjtJQUNEOztJQUNELE9BQU9DLGFBQVA7RUFDRDs7QUFwQmdEOzs7ZUF5QnBDaEIsbUIifQ==
