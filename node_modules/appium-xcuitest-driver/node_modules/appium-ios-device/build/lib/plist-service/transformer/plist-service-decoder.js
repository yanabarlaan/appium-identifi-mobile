"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.PlistServiceDecoder = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _stream = _interopRequireDefault(require("stream"));

var _support = require("@appium/support");

const HEADER_LENGTH = 4;

class PlistServiceDecoder extends _stream.default.Transform {
  constructor() {
    super({
      objectMode: true
    });
  }

  _transform(data, encoding, onData) {
    this._decode(data);

    onData();
  }

  _decode(data) {
    const payload = data.slice(HEADER_LENGTH, data.length);

    if (_lodash.default.isEmpty(payload)) {
      return;
    }

    const object = _support.plist.parsePlist(payload);

    if (!object) {
      return;
    }

    this.push(object);
  }

}

exports.PlistServiceDecoder = PlistServiceDecoder;
var _default = PlistServiceDecoder;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL3BsaXN0LXNlcnZpY2UvdHJhbnNmb3JtZXIvcGxpc3Qtc2VydmljZS1kZWNvZGVyLmpzIiwibmFtZXMiOlsiSEVBREVSX0xFTkdUSCIsIlBsaXN0U2VydmljZURlY29kZXIiLCJTdHJlYW0iLCJUcmFuc2Zvcm0iLCJjb25zdHJ1Y3RvciIsIm9iamVjdE1vZGUiLCJfdHJhbnNmb3JtIiwiZGF0YSIsImVuY29kaW5nIiwib25EYXRhIiwiX2RlY29kZSIsInBheWxvYWQiLCJzbGljZSIsImxlbmd0aCIsIl8iLCJpc0VtcHR5Iiwib2JqZWN0IiwicGxpc3QiLCJwYXJzZVBsaXN0IiwicHVzaCJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4iLCJzb3VyY2VzIjpbImxpYi9wbGlzdC1zZXJ2aWNlL3RyYW5zZm9ybWVyL3BsaXN0LXNlcnZpY2UtZGVjb2Rlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IFN0cmVhbSBmcm9tICdzdHJlYW0nO1xuaW1wb3J0IHsgcGxpc3QgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuXG5jb25zdCBIRUFERVJfTEVOR1RIID0gNDtcblxuY2xhc3MgUGxpc3RTZXJ2aWNlRGVjb2RlciBleHRlbmRzIFN0cmVhbS5UcmFuc2Zvcm0ge1xuXG4gIGNvbnN0cnVjdG9yICgpIHtcbiAgICBzdXBlcih7IG9iamVjdE1vZGU6IHRydWUgfSk7XG4gIH1cblxuICBfdHJhbnNmb3JtIChkYXRhLCBlbmNvZGluZywgb25EYXRhKSB7XG4gICAgdGhpcy5fZGVjb2RlKGRhdGEpO1xuICAgIG9uRGF0YSgpO1xuICB9XG5cbiAgX2RlY29kZSAoZGF0YSkge1xuICAgIGNvbnN0IHBheWxvYWQgPSBkYXRhLnNsaWNlKEhFQURFUl9MRU5HVEgsIGRhdGEubGVuZ3RoKTtcbiAgICBpZiAoXy5pc0VtcHR5KHBheWxvYWQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IG9iamVjdCA9IHBsaXN0LnBhcnNlUGxpc3QocGF5bG9hZCk7XG4gICAgaWYgKCFvYmplY3QpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5wdXNoKG9iamVjdCk7XG4gIH1cbn1cblxuZXhwb3J0IHsgUGxpc3RTZXJ2aWNlRGVjb2RlciB9O1xuZXhwb3J0IGRlZmF1bHQgUGxpc3RTZXJ2aWNlRGVjb2RlcjtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxhQUFhLEdBQUcsQ0FBdEI7O0FBRUEsTUFBTUMsbUJBQU4sU0FBa0NDLGdCQUFPQyxTQUF6QyxDQUFtRDtFQUVqREMsV0FBVyxHQUFJO0lBQ2IsTUFBTTtNQUFFQyxVQUFVLEVBQUU7SUFBZCxDQUFOO0VBQ0Q7O0VBRURDLFVBQVUsQ0FBRUMsSUFBRixFQUFRQyxRQUFSLEVBQWtCQyxNQUFsQixFQUEwQjtJQUNsQyxLQUFLQyxPQUFMLENBQWFILElBQWI7O0lBQ0FFLE1BQU07RUFDUDs7RUFFREMsT0FBTyxDQUFFSCxJQUFGLEVBQVE7SUFDYixNQUFNSSxPQUFPLEdBQUdKLElBQUksQ0FBQ0ssS0FBTCxDQUFXWixhQUFYLEVBQTBCTyxJQUFJLENBQUNNLE1BQS9CLENBQWhCOztJQUNBLElBQUlDLGdCQUFFQyxPQUFGLENBQVVKLE9BQVYsQ0FBSixFQUF3QjtNQUN0QjtJQUNEOztJQUNELE1BQU1LLE1BQU0sR0FBR0MsZUFBTUMsVUFBTixDQUFpQlAsT0FBakIsQ0FBZjs7SUFDQSxJQUFJLENBQUNLLE1BQUwsRUFBYTtNQUNYO0lBQ0Q7O0lBQ0QsS0FBS0csSUFBTCxDQUFVSCxNQUFWO0VBQ0Q7O0FBckJnRDs7O2VBeUJwQ2YsbUIifQ==
