"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.IOSLog = void 0;

require("source-map-support/register");

var _events = require("events");

const MAX_LOG_ENTRIES_COUNT = 10000;

class IOSLog extends _events.EventEmitter {
  constructor() {
    super();
    this.logs = [];
    this.logIdxSinceLastRequest = -1;
    this.maxBufferSize = MAX_LOG_ENTRIES_COUNT;
  }

  async startCapture() {
    throw new Error(`Sub-classes need to implement a 'startCapture' function`);
  }

  async stopCapture() {
    throw new Error(`Sub-classes need to implement a 'stopCapture' function`);
  }

  get isCapturing() {
    throw new Error(`Sub-classes need to implement a 'isCapturing' function`);
  }

  broadcast(logLine) {
    const logObj = {
      timestamp: Date.now(),
      level: 'ALL',
      message: logLine
    };
    this.logs.push(logObj);
    this.emit('output', logObj);

    if (this.logs.length > this.maxBufferSize) {
      this.logs.shift();

      if (this.logIdxSinceLastRequest > 0) {
        --this.logIdxSinceLastRequest;
      }
    }
  }

  getLogs() {
    if (this.logs.length && this.logIdxSinceLastRequest < this.logs.length) {
      let result = this.logs;

      if (this.logIdxSinceLastRequest > 0) {
        result = result.slice(this.logIdxSinceLastRequest);
      }

      this.logIdxSinceLastRequest = this.logs.length;
      return result;
    }

    return [];
  }

  getAllLogs() {
    return this.logs;
  }

}

exports.IOSLog = IOSLog;
var _default = IOSLog;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL2RldmljZS1sb2cvaW9zLWxvZy5qcyIsIm5hbWVzIjpbIk1BWF9MT0dfRU5UUklFU19DT1VOVCIsIklPU0xvZyIsIkV2ZW50RW1pdHRlciIsImNvbnN0cnVjdG9yIiwibG9ncyIsImxvZ0lkeFNpbmNlTGFzdFJlcXVlc3QiLCJtYXhCdWZmZXJTaXplIiwic3RhcnRDYXB0dXJlIiwiRXJyb3IiLCJzdG9wQ2FwdHVyZSIsImlzQ2FwdHVyaW5nIiwiYnJvYWRjYXN0IiwibG9nTGluZSIsImxvZ09iaiIsInRpbWVzdGFtcCIsIkRhdGUiLCJub3ciLCJsZXZlbCIsIm1lc3NhZ2UiLCJwdXNoIiwiZW1pdCIsImxlbmd0aCIsInNoaWZ0IiwiZ2V0TG9ncyIsInJlc3VsdCIsInNsaWNlIiwiZ2V0QWxsTG9ncyJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4iLCJzb3VyY2VzIjpbImxpYi9kZXZpY2UtbG9nL2lvcy1sb2cuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcblxuLy8gV2Uga2VlcCBvbmx5IHRoZSBtb3N0IHJlY2VudCBsb2cgZW50cmllcyB0byBhdm9pZCBvdXQgb2YgbWVtb3J5IGVycm9yXG5jb25zdCBNQVhfTE9HX0VOVFJJRVNfQ09VTlQgPSAxMDAwMDtcblxuY2xhc3MgSU9TTG9nIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcblxuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmxvZ3MgPSBbXTtcbiAgICB0aGlzLmxvZ0lkeFNpbmNlTGFzdFJlcXVlc3QgPSAtMTtcbiAgICB0aGlzLm1heEJ1ZmZlclNpemUgPSBNQVhfTE9HX0VOVFJJRVNfQ09VTlQ7XG4gIH1cblxuICBhc3luYyBzdGFydENhcHR1cmUgKCkgeyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHJlcXVpcmUtYXdhaXRcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFN1Yi1jbGFzc2VzIG5lZWQgdG8gaW1wbGVtZW50IGEgJ3N0YXJ0Q2FwdHVyZScgZnVuY3Rpb25gKTtcbiAgfVxuXG4gIGFzeW5jIHN0b3BDYXB0dXJlICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgdGhyb3cgbmV3IEVycm9yKGBTdWItY2xhc3NlcyBuZWVkIHRvIGltcGxlbWVudCBhICdzdG9wQ2FwdHVyZScgZnVuY3Rpb25gKTtcbiAgfVxuXG4gIGdldCBpc0NhcHR1cmluZyAoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBTdWItY2xhc3NlcyBuZWVkIHRvIGltcGxlbWVudCBhICdpc0NhcHR1cmluZycgZnVuY3Rpb25gKTtcbiAgfVxuXG4gIGJyb2FkY2FzdCAobG9nTGluZSkge1xuICAgIGNvbnN0IGxvZ09iaiA9IHtcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIGxldmVsOiAnQUxMJyxcbiAgICAgIG1lc3NhZ2U6IGxvZ0xpbmVcbiAgICB9O1xuICAgIHRoaXMubG9ncy5wdXNoKGxvZ09iaik7XG4gICAgdGhpcy5lbWl0KCdvdXRwdXQnLCBsb2dPYmopO1xuICAgIGlmICh0aGlzLmxvZ3MubGVuZ3RoID4gdGhpcy5tYXhCdWZmZXJTaXplKSB7XG4gICAgICB0aGlzLmxvZ3Muc2hpZnQoKTtcbiAgICAgIGlmICh0aGlzLmxvZ0lkeFNpbmNlTGFzdFJlcXVlc3QgPiAwKSB7XG4gICAgICAgIC0tdGhpcy5sb2dJZHhTaW5jZUxhc3RSZXF1ZXN0O1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGdldExvZ3MgKCkge1xuICAgIGlmICh0aGlzLmxvZ3MubGVuZ3RoICYmIHRoaXMubG9nSWR4U2luY2VMYXN0UmVxdWVzdCA8IHRoaXMubG9ncy5sZW5ndGgpIHtcbiAgICAgIGxldCByZXN1bHQgPSB0aGlzLmxvZ3M7XG4gICAgICBpZiAodGhpcy5sb2dJZHhTaW5jZUxhc3RSZXF1ZXN0ID4gMCkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQuc2xpY2UodGhpcy5sb2dJZHhTaW5jZUxhc3RSZXF1ZXN0KTtcbiAgICAgIH1cbiAgICAgIHRoaXMubG9nSWR4U2luY2VMYXN0UmVxdWVzdCA9IHRoaXMubG9ncy5sZW5ndGg7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICByZXR1cm4gW107XG4gIH1cblxuICBnZXRBbGxMb2dzICgpIHtcbiAgICByZXR1cm4gdGhpcy5sb2dzO1xuICB9XG59XG5cbmV4cG9ydCB7IElPU0xvZyB9O1xuZXhwb3J0IGRlZmF1bHQgSU9TTG9nO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFHQSxNQUFNQSxxQkFBcUIsR0FBRyxLQUE5Qjs7QUFFQSxNQUFNQyxNQUFOLFNBQXFCQyxvQkFBckIsQ0FBa0M7RUFFaENDLFdBQVcsR0FBSTtJQUNiO0lBQ0EsS0FBS0MsSUFBTCxHQUFZLEVBQVo7SUFDQSxLQUFLQyxzQkFBTCxHQUE4QixDQUFDLENBQS9CO0lBQ0EsS0FBS0MsYUFBTCxHQUFxQk4scUJBQXJCO0VBQ0Q7O0VBRWlCLE1BQVpPLFlBQVksR0FBSTtJQUNwQixNQUFNLElBQUlDLEtBQUosQ0FBVyx5REFBWCxDQUFOO0VBQ0Q7O0VBRWdCLE1BQVhDLFdBQVcsR0FBSTtJQUNuQixNQUFNLElBQUlELEtBQUosQ0FBVyx3REFBWCxDQUFOO0VBQ0Q7O0VBRWMsSUFBWEUsV0FBVyxHQUFJO0lBQ2pCLE1BQU0sSUFBSUYsS0FBSixDQUFXLHdEQUFYLENBQU47RUFDRDs7RUFFREcsU0FBUyxDQUFFQyxPQUFGLEVBQVc7SUFDbEIsTUFBTUMsTUFBTSxHQUFHO01BQ2JDLFNBQVMsRUFBRUMsSUFBSSxDQUFDQyxHQUFMLEVBREU7TUFFYkMsS0FBSyxFQUFFLEtBRk07TUFHYkMsT0FBTyxFQUFFTjtJQUhJLENBQWY7SUFLQSxLQUFLUixJQUFMLENBQVVlLElBQVYsQ0FBZU4sTUFBZjtJQUNBLEtBQUtPLElBQUwsQ0FBVSxRQUFWLEVBQW9CUCxNQUFwQjs7SUFDQSxJQUFJLEtBQUtULElBQUwsQ0FBVWlCLE1BQVYsR0FBbUIsS0FBS2YsYUFBNUIsRUFBMkM7TUFDekMsS0FBS0YsSUFBTCxDQUFVa0IsS0FBVjs7TUFDQSxJQUFJLEtBQUtqQixzQkFBTCxHQUE4QixDQUFsQyxFQUFxQztRQUNuQyxFQUFFLEtBQUtBLHNCQUFQO01BQ0Q7SUFDRjtFQUNGOztFQUVEa0IsT0FBTyxHQUFJO0lBQ1QsSUFBSSxLQUFLbkIsSUFBTCxDQUFVaUIsTUFBVixJQUFvQixLQUFLaEIsc0JBQUwsR0FBOEIsS0FBS0QsSUFBTCxDQUFVaUIsTUFBaEUsRUFBd0U7TUFDdEUsSUFBSUcsTUFBTSxHQUFHLEtBQUtwQixJQUFsQjs7TUFDQSxJQUFJLEtBQUtDLHNCQUFMLEdBQThCLENBQWxDLEVBQXFDO1FBQ25DbUIsTUFBTSxHQUFHQSxNQUFNLENBQUNDLEtBQVAsQ0FBYSxLQUFLcEIsc0JBQWxCLENBQVQ7TUFDRDs7TUFDRCxLQUFLQSxzQkFBTCxHQUE4QixLQUFLRCxJQUFMLENBQVVpQixNQUF4QztNQUNBLE9BQU9HLE1BQVA7SUFDRDs7SUFDRCxPQUFPLEVBQVA7RUFDRDs7RUFFREUsVUFBVSxHQUFJO0lBQ1osT0FBTyxLQUFLdEIsSUFBWjtFQUNEOztBQW5EK0I7OztlQXVEbkJILE0ifQ==
