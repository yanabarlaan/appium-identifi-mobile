"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.IOSDeviceLog = void 0;

require("source-map-support/register");

var _support = require("@appium/support");

var _iosLog = require("./ios-log");

var _appiumIosDevice = require("appium-ios-device");

const log = _support.logger.getLogger('IOSDeviceLog');

class IOSDeviceLog extends _iosLog.IOSLog {
  constructor(opts) {
    super();
    this.udid = opts.udid;
    this.showLogs = !!opts.showLogs;
    this.service = null;
  }

  async startCapture() {
    if (this.service) {
      return;
    }

    this.service = await _appiumIosDevice.services.startSyslogService(this.udid);
    this.service.start(this.onLog.bind(this));
  }

  onLog(logLine) {
    this.broadcast(logLine);

    if (this.showLogs) {
      log.info(logLine);
    }
  }

  get isCapturing() {
    return !!this.service;
  }

  stopCapture() {
    if (!this.service) {
      return;
    }

    this.service.close();
    this.service = null;
  }

}

exports.IOSDeviceLog = IOSDeviceLog;
var _default = IOSDeviceLog;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL2RldmljZS1sb2cvaW9zLWRldmljZS1sb2cuanMiLCJuYW1lcyI6WyJsb2ciLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJJT1NEZXZpY2VMb2ciLCJJT1NMb2ciLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJ1ZGlkIiwic2hvd0xvZ3MiLCJzZXJ2aWNlIiwic3RhcnRDYXB0dXJlIiwic2VydmljZXMiLCJzdGFydFN5c2xvZ1NlcnZpY2UiLCJzdGFydCIsIm9uTG9nIiwiYmluZCIsImxvZ0xpbmUiLCJicm9hZGNhc3QiLCJpbmZvIiwiaXNDYXB0dXJpbmciLCJzdG9wQ2FwdHVyZSIsImNsb3NlIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLiIsInNvdXJjZXMiOlsibGliL2RldmljZS1sb2cvaW9zLWRldmljZS1sb2cuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCB7IElPU0xvZyB9IGZyb20gJy4vaW9zLWxvZyc7XG5pbXBvcnQgeyBzZXJ2aWNlcyB9IGZyb20gJ2FwcGl1bS1pb3MtZGV2aWNlJztcblxuY29uc3QgbG9nID0gbG9nZ2VyLmdldExvZ2dlcignSU9TRGV2aWNlTG9nJyk7XG5cbmNsYXNzIElPU0RldmljZUxvZyBleHRlbmRzIElPU0xvZyB7XG5cbiAgY29uc3RydWN0b3IgKG9wdHMpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMudWRpZCA9IG9wdHMudWRpZDtcbiAgICB0aGlzLnNob3dMb2dzID0gISFvcHRzLnNob3dMb2dzO1xuICAgIHRoaXMuc2VydmljZSA9IG51bGw7XG4gIH1cblxuICBhc3luYyBzdGFydENhcHR1cmUgKCkge1xuICAgIGlmICh0aGlzLnNlcnZpY2UpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5zZXJ2aWNlID0gYXdhaXQgc2VydmljZXMuc3RhcnRTeXNsb2dTZXJ2aWNlKHRoaXMudWRpZCk7XG4gICAgdGhpcy5zZXJ2aWNlLnN0YXJ0KHRoaXMub25Mb2cuYmluZCh0aGlzKSk7XG4gIH1cblxuICBvbkxvZyAobG9nTGluZSkge1xuICAgIHRoaXMuYnJvYWRjYXN0KGxvZ0xpbmUpO1xuICAgIGlmICh0aGlzLnNob3dMb2dzKSB7XG4gICAgICBsb2cuaW5mbyhsb2dMaW5lKTtcbiAgICB9XG4gIH1cblxuICBnZXQgaXNDYXB0dXJpbmcgKCkge1xuICAgIHJldHVybiAhIXRoaXMuc2VydmljZTtcbiAgfVxuXG4gIHN0b3BDYXB0dXJlICgpIHtcbiAgICBpZiAoIXRoaXMuc2VydmljZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnNlcnZpY2UuY2xvc2UoKTtcbiAgICB0aGlzLnNlcnZpY2UgPSBudWxsO1xuICB9XG59XG5cbmV4cG9ydCB7IElPU0RldmljZUxvZyB9O1xuZXhwb3J0IGRlZmF1bHQgSU9TRGV2aWNlTG9nO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxHQUFHLEdBQUdDLGVBQUEsQ0FBT0MsU0FBUCxDQUFpQixjQUFqQixDQUFaOztBQUVBLE1BQU1DLFlBQU4sU0FBMkJDLGNBQTNCLENBQWtDO0VBRWhDQyxXQUFXLENBQUVDLElBQUYsRUFBUTtJQUNqQjtJQUNBLEtBQUtDLElBQUwsR0FBWUQsSUFBSSxDQUFDQyxJQUFqQjtJQUNBLEtBQUtDLFFBQUwsR0FBZ0IsQ0FBQyxDQUFDRixJQUFJLENBQUNFLFFBQXZCO0lBQ0EsS0FBS0MsT0FBTCxHQUFlLElBQWY7RUFDRDs7RUFFaUIsTUFBWkMsWUFBWSxHQUFJO0lBQ3BCLElBQUksS0FBS0QsT0FBVCxFQUFrQjtNQUNoQjtJQUNEOztJQUNELEtBQUtBLE9BQUwsR0FBZSxNQUFNRSx5QkFBQSxDQUFTQyxrQkFBVCxDQUE0QixLQUFLTCxJQUFqQyxDQUFyQjtJQUNBLEtBQUtFLE9BQUwsQ0FBYUksS0FBYixDQUFtQixLQUFLQyxLQUFMLENBQVdDLElBQVgsQ0FBZ0IsSUFBaEIsQ0FBbkI7RUFDRDs7RUFFREQsS0FBSyxDQUFFRSxPQUFGLEVBQVc7SUFDZCxLQUFLQyxTQUFMLENBQWVELE9BQWY7O0lBQ0EsSUFBSSxLQUFLUixRQUFULEVBQW1CO01BQ2pCUixHQUFHLENBQUNrQixJQUFKLENBQVNGLE9BQVQ7SUFDRDtFQUNGOztFQUVjLElBQVhHLFdBQVcsR0FBSTtJQUNqQixPQUFPLENBQUMsQ0FBQyxLQUFLVixPQUFkO0VBQ0Q7O0VBRURXLFdBQVcsR0FBSTtJQUNiLElBQUksQ0FBQyxLQUFLWCxPQUFWLEVBQW1CO01BQ2pCO0lBQ0Q7O0lBQ0QsS0FBS0EsT0FBTCxDQUFhWSxLQUFiO0lBQ0EsS0FBS1osT0FBTCxHQUFlLElBQWY7RUFDRDs7QUFsQytCOzs7ZUFzQ25CTixZIn0=
