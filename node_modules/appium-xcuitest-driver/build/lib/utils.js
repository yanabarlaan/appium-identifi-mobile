"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DEFAULT_TIMEOUT_KEY = void 0;
exports.checkAppPresent = checkAppPresent;
exports.clearLogs = clearLogs;
exports.clearSystemFiles = clearSystemFiles;
exports.detectUdid = detectUdid;
exports.encodeBase64OrUpload = encodeBase64OrUpload;
exports.getAndCheckIosSdkVersion = getAndCheckIosSdkVersion;
exports.getAndCheckXcodeVersion = getAndCheckXcodeVersion;
exports.getDriverInfo = getDriverInfo;
exports.getPIDsListeningOnPort = getPIDsListeningOnPort;
exports.isLocalHost = isLocalHost;
exports.markSystemFilesForCleanup = markSystemFilesForCleanup;
exports.normalizeCommandTimeouts = normalizeCommandTimeouts;
exports.normalizePlatformVersion = normalizePlatformVersion;
exports.printUser = printUser;
exports.removeAllSessionWebSocketHandlers = removeAllSessionWebSocketHandlers;
exports.translateDeviceName = translateDeviceName;

require("source-map-support/register");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _appiumIosDevice = require("appium-ios-device");

var _support = require("@appium/support");

var _path = _interopRequireDefault(require("path"));

var _teen_process = require("teen_process");

var _appiumXcode = _interopRequireDefault(require("appium-xcode"));

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _iosGenericSimulators = _interopRequireDefault(require("./ios-generic-simulators"));

var _url = _interopRequireDefault(require("url"));

var _os = _interopRequireDefault(require("os"));

var _semver = _interopRequireDefault(require("semver"));

const DEFAULT_TIMEOUT_KEY = 'default';
exports.DEFAULT_TIMEOUT_KEY = DEFAULT_TIMEOUT_KEY;
const XCTEST_LOG_FILES_PATTERNS = [/^Session-WebDriverAgentRunner.*\.log$/i, /^StandardOutputAndStandardError\.txt$/i];
const XCTEST_LOGS_CACHE_FOLDER_PREFIX = 'com.apple.dt.XCTest';

async function detectUdid() {
  _logger.default.debug('Auto-detecting real device udid...');

  const udids = await _appiumIosDevice.utilities.getConnectedDevices();

  if (_lodash.default.isEmpty(udids)) {
    throw new Error('No device is connected to the host');
  }

  const udid = _lodash.default.last(udids);

  if (udids.length > 1) {
    _logger.default.warn(`Multiple devices found: ${udids.join(', ')}`);

    _logger.default.warn(`Choosing '${udid}'. If this is wrong, manually set with 'udid' desired capability`);
  }

  _logger.default.debug(`Detected real device udid: '${udid}'`);

  return udid;
}

async function getAndCheckXcodeVersion() {
  let version;

  try {
    version = await _appiumXcode.default.getVersion(true);
  } catch (err) {
    _logger.default.debug(err);

    _logger.default.errorAndThrow(`Could not determine Xcode version: ${err.message}`);
  }

  if (version.versionFloat < 7.3) {
    _logger.default.errorAndThrow(`Xcode version '${version.versionString}'. Support for ` + `Xcode ${version.versionString} is not supported. ` + `Please upgrade to version 7.3 or higher`);
  }

  return version;
}

async function getAndCheckIosSdkVersion() {
  try {
    return await _appiumXcode.default.getMaxIOSSDK();
  } catch (err) {
    _logger.default.errorAndThrow(`Could not determine iOS SDK version: ${err.message}`);
  }
}

function getGenericSimulatorForIosVersion(platformVersion, deviceName) {
  let genericSimulators = _iosGenericSimulators.default[deviceName];

  if (genericSimulators) {
    genericSimulators = genericSimulators.sort(([simOne], [simTwo]) => _support.util.compareVersions(simOne, '<', simTwo) ? -1 : 1);
    let genericIosSimulator;

    for (const [platformVersionFromList, iosSimulator] of genericSimulators) {
      if (_support.util.compareVersions(platformVersionFromList, '>', platformVersion)) {
        break;
      }

      genericIosSimulator = iosSimulator;
    }

    return genericIosSimulator;
  }
}

function translateDeviceName(platformVersion, deviceName = '') {
  const deviceNameTranslated = getGenericSimulatorForIosVersion(platformVersion, deviceName.toLowerCase().trim());

  if (deviceNameTranslated) {
    _logger.default.debug(`Changing deviceName from '${deviceName}' to '${deviceNameTranslated}'`);

    return deviceNameTranslated;
  }

  return deviceName;
}

async function clearLogs(locations) {
  _logger.default.debug('Clearing log files');

  const cleanupPromises = [];

  for (const location of locations) {
    if (!(await _support.fs.exists(location))) {
      continue;
    }

    cleanupPromises.push((async () => {
      let size;

      try {
        const {
          stdout
        } = await (0, _teen_process.exec)('du', ['-sh', location]);
        size = stdout.trim().split(/\s+/)[0];
      } catch (ign) {}

      try {
        _logger.default.debug(`Deleting '${location}'. ${size ? `Freeing ${size}.` : ''}`);

        await _support.fs.rimraf(location);
      } catch (err) {
        _logger.default.warn(`Unable to delete '${location}': ${err.message}`);
      }
    })());
  }

  if (!_lodash.default.isEmpty(cleanupPromises)) {
    await _bluebird.default.all(cleanupPromises);
  }

  _logger.default.debug('Finished clearing log files');
}

const derivedDataCleanupMarkers = new Map();

async function markSystemFilesForCleanup(wda) {
  if (!wda || !(await wda.retrieveDerivedDataPath())) {
    _logger.default.warn('No WebDriverAgent derived data available, so unable to mark system files for cleanup');

    return;
  }

  const logsRoot = _path.default.resolve(await wda.retrieveDerivedDataPath(), 'Logs');

  let markersCount = 0;

  if (derivedDataCleanupMarkers.has(logsRoot)) {
    markersCount = derivedDataCleanupMarkers.get(logsRoot);
  }

  derivedDataCleanupMarkers.set(logsRoot, ++markersCount);
}

async function clearSystemFiles(wda) {
  if (!wda || !(await wda.retrieveDerivedDataPath())) {
    _logger.default.warn('No WebDriverAgent derived data available, so unable to clear system files');

    return;
  }

  const logsRoot = _path.default.resolve(await wda.retrieveDerivedDataPath(), 'Logs');

  if (derivedDataCleanupMarkers.has(logsRoot)) {
    let markersCount = derivedDataCleanupMarkers.get(logsRoot);
    derivedDataCleanupMarkers.set(logsRoot, --markersCount);

    if (markersCount > 0) {
      _logger.default.info(`Not cleaning '${logsRoot}' folder, because the other session does not expect it to be cleaned`);

      return;
    }
  }

  derivedDataCleanupMarkers.set(logsRoot, 0);
  const globPattern = `${_os.default.tmpdir()}/${XCTEST_LOGS_CACHE_FOLDER_PREFIX}*/`;
  const dstFolders = await _support.fs.glob(globPattern);

  if (_lodash.default.isEmpty(dstFolders)) {
    _logger.default.debug(`Did not find the temporary XCTest logs root at '${globPattern}'`);
  } else {
    for (const dstFolder of dstFolders) {
      let scheduledFilesCount = 0;

      _bluebird.default.resolve(_support.fs.walkDir(dstFolder, true, (itemPath, isDir) => {
        if (isDir) {
          return;
        }

        const fileName = _path.default.basename(itemPath);

        if (!XCTEST_LOG_FILES_PATTERNS.some(p => p.test(fileName))) {
          return;
        }

        _support.fs.unlink(itemPath).catch(e => {
          _logger.default.info(e.message);
        });

        scheduledFilesCount++;
      })).finally(() => {
        if (scheduledFilesCount > 0) {
          _logger.default.info(`Scheduled ${scheduledFilesCount} temporary XCTest log ` + `${_support.util.pluralize('file', scheduledFilesCount)} for cleanup in '${dstFolder}'`);
        }
      }).catch(e => {
        _logger.default.info(e.message);
      });
    }

    _logger.default.debug(`Started background XCTest logs cleanup in '${dstFolders}'`);
  }

  if (await _support.fs.exists(logsRoot)) {
    _logger.default.info(`Cleaning test logs in '${logsRoot}' folder`);

    await clearLogs([logsRoot]);
    return;
  }

  _logger.default.info(`There is no ${logsRoot} folder, so not cleaning files`);
}

async function checkAppPresent(app) {
  _logger.default.debug(`Checking whether app '${app}' is actually present on file system`);

  if (!(await _support.fs.exists(app))) {
    _logger.default.errorAndThrow(`Could not find app at '${app}'`);
  }

  _logger.default.debug('App is present');
}

async function getDriverInfo() {
  const stat = await _support.fs.stat(_path.default.resolve(__dirname, '..'));
  const built = stat.mtime.getTime();

  const pkg = require(__filename.includes('build/lib/utils') ? '../../package.json' : '../package.json');

  const version = pkg.version;
  return {
    built,
    version
  };
}

function normalizeCommandTimeouts(value) {
  if (typeof value !== 'string') {
    return value;
  }

  let result = {};

  if (!isNaN(value)) {
    result[DEFAULT_TIMEOUT_KEY] = _lodash.default.toInteger(value);
    return result;
  }

  try {
    result = JSON.parse(value);

    if (!_lodash.default.isPlainObject(result)) {
      throw new Error();
    }
  } catch (err) {
    _logger.default.errorAndThrow(`"commandTimeouts" capability should be a valid JSON object. "${value}" was given instead`);
  }

  for (let [cmd, timeout] of _lodash.default.toPairs(result)) {
    if (!_lodash.default.isInteger(timeout) || timeout <= 0) {
      _logger.default.errorAndThrow(`The timeout for "${cmd}" should be a valid natural number of milliseconds. "${timeout}" was given instead`);
    }
  }

  return result;
}

async function printUser() {
  try {
    let {
      stdout
    } = await (0, _teen_process.exec)('whoami');

    _logger.default.debug(`Current user: '${stdout.trim()}'`);
  } catch (err) {
    _logger.default.debug(`Unable to get username running server: ${err.message}`);
  }
}

async function getPIDsListeningOnPort(port, filteringFunc = null) {
  const result = [];

  try {
    const {
      stdout
    } = await (0, _teen_process.exec)('lsof', ['-ti', `tcp:${port}`]);
    result.push(...stdout.trim().split(/\n+/));
  } catch (e) {
    return result;
  }

  if (!_lodash.default.isFunction(filteringFunc)) {
    return result;
  }

  return await _bluebird.default.filter(result, async x => {
    const {
      stdout
    } = await (0, _teen_process.exec)('ps', ['-p', x, '-o', 'command']);
    return await filteringFunc(stdout);
  });
}

async function encodeBase64OrUpload(localPath, remotePath = null, uploadOptions = {}) {
  if (!(await _support.fs.exists(localPath))) {
    _logger.default.errorAndThrow(`The file at '${localPath}' does not exist or is not accessible`);
  }

  if (_lodash.default.isEmpty(remotePath)) {
    const {
      size
    } = await _support.fs.stat(localPath);

    _logger.default.debug(`The size of the file is ${_support.util.toReadableSizeString(size)}`);

    return (await _support.util.toInMemoryBase64(localPath)).toString();
  }

  const {
    user,
    pass,
    method,
    headers,
    fileFieldName,
    formFields
  } = uploadOptions;
  const options = {
    method: method || 'PUT',
    headers,
    fileFieldName,
    formFields
  };

  if (user && pass) {
    options.auth = {
      user,
      pass
    };
  }

  await _support.net.uploadFile(localPath, remotePath, options);
  return '';
}

async function removeAllSessionWebSocketHandlers(server, sessionId) {
  if (!server || !_lodash.default.isFunction(server.getWebSocketHandlers)) {
    return;
  }

  const activeHandlers = await server.getWebSocketHandlers(sessionId);

  for (const pathname of _lodash.default.keys(activeHandlers)) {
    await server.removeWebSocketHandler(pathname);
  }
}

function isLocalHost(urlString) {
  try {
    const {
      hostname
    } = _url.default.parse(urlString);

    return ['localhost', '127.0.0.1', '::1', '::ffff:127.0.0.1'].includes(hostname);
  } catch (ign) {
    _logger.default.warn(`'${urlString}' cannot be parsed as a valid URL`);
  }

  return false;
}

function normalizePlatformVersion(originalVersion) {
  const normalizedVersion = _semver.default.coerce(originalVersion);

  if (!normalizedVersion) {
    throw new Error(`The platform version '${originalVersion}' should be a valid version number`);
  }

  return `${normalizedVersion.major}.${normalizedVersion.minor}`;
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL3V0aWxzLmpzIiwibmFtZXMiOlsiREVGQVVMVF9USU1FT1VUX0tFWSIsIlhDVEVTVF9MT0dfRklMRVNfUEFUVEVSTlMiLCJYQ1RFU1RfTE9HU19DQUNIRV9GT0xERVJfUFJFRklYIiwiZGV0ZWN0VWRpZCIsImxvZyIsImRlYnVnIiwidWRpZHMiLCJ1dGlsaXRpZXMiLCJnZXRDb25uZWN0ZWREZXZpY2VzIiwiXyIsImlzRW1wdHkiLCJFcnJvciIsInVkaWQiLCJsYXN0IiwibGVuZ3RoIiwid2FybiIsImpvaW4iLCJnZXRBbmRDaGVja1hjb2RlVmVyc2lvbiIsInZlcnNpb24iLCJ4Y29kZSIsImdldFZlcnNpb24iLCJlcnIiLCJlcnJvckFuZFRocm93IiwibWVzc2FnZSIsInZlcnNpb25GbG9hdCIsInZlcnNpb25TdHJpbmciLCJnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24iLCJnZXRNYXhJT1NTREsiLCJnZXRHZW5lcmljU2ltdWxhdG9yRm9ySW9zVmVyc2lvbiIsInBsYXRmb3JtVmVyc2lvbiIsImRldmljZU5hbWUiLCJnZW5lcmljU2ltdWxhdG9ycyIsImlvc0dlbmVyaWNTaW11bGF0b3JzIiwic29ydCIsInNpbU9uZSIsInNpbVR3byIsInV0aWwiLCJjb21wYXJlVmVyc2lvbnMiLCJnZW5lcmljSW9zU2ltdWxhdG9yIiwicGxhdGZvcm1WZXJzaW9uRnJvbUxpc3QiLCJpb3NTaW11bGF0b3IiLCJ0cmFuc2xhdGVEZXZpY2VOYW1lIiwiZGV2aWNlTmFtZVRyYW5zbGF0ZWQiLCJ0b0xvd2VyQ2FzZSIsInRyaW0iLCJjbGVhckxvZ3MiLCJsb2NhdGlvbnMiLCJjbGVhbnVwUHJvbWlzZXMiLCJsb2NhdGlvbiIsImZzIiwiZXhpc3RzIiwicHVzaCIsInNpemUiLCJzdGRvdXQiLCJleGVjIiwic3BsaXQiLCJpZ24iLCJyaW1yYWYiLCJCIiwiYWxsIiwiZGVyaXZlZERhdGFDbGVhbnVwTWFya2VycyIsIk1hcCIsIm1hcmtTeXN0ZW1GaWxlc0ZvckNsZWFudXAiLCJ3ZGEiLCJyZXRyaWV2ZURlcml2ZWREYXRhUGF0aCIsImxvZ3NSb290IiwicGF0aCIsInJlc29sdmUiLCJtYXJrZXJzQ291bnQiLCJoYXMiLCJnZXQiLCJzZXQiLCJjbGVhclN5c3RlbUZpbGVzIiwiaW5mbyIsImdsb2JQYXR0ZXJuIiwib3MiLCJ0bXBkaXIiLCJkc3RGb2xkZXJzIiwiZ2xvYiIsImRzdEZvbGRlciIsInNjaGVkdWxlZEZpbGVzQ291bnQiLCJ3YWxrRGlyIiwiaXRlbVBhdGgiLCJpc0RpciIsImZpbGVOYW1lIiwiYmFzZW5hbWUiLCJzb21lIiwicCIsInRlc3QiLCJ1bmxpbmsiLCJjYXRjaCIsImUiLCJmaW5hbGx5IiwicGx1cmFsaXplIiwiY2hlY2tBcHBQcmVzZW50IiwiYXBwIiwiZ2V0RHJpdmVySW5mbyIsInN0YXQiLCJfX2Rpcm5hbWUiLCJidWlsdCIsIm10aW1lIiwiZ2V0VGltZSIsInBrZyIsInJlcXVpcmUiLCJfX2ZpbGVuYW1lIiwiaW5jbHVkZXMiLCJub3JtYWxpemVDb21tYW5kVGltZW91dHMiLCJ2YWx1ZSIsInJlc3VsdCIsImlzTmFOIiwidG9JbnRlZ2VyIiwiSlNPTiIsInBhcnNlIiwiaXNQbGFpbk9iamVjdCIsImNtZCIsInRpbWVvdXQiLCJ0b1BhaXJzIiwiaXNJbnRlZ2VyIiwicHJpbnRVc2VyIiwiZ2V0UElEc0xpc3RlbmluZ09uUG9ydCIsInBvcnQiLCJmaWx0ZXJpbmdGdW5jIiwiaXNGdW5jdGlvbiIsImZpbHRlciIsIngiLCJlbmNvZGVCYXNlNjRPclVwbG9hZCIsImxvY2FsUGF0aCIsInJlbW90ZVBhdGgiLCJ1cGxvYWRPcHRpb25zIiwidG9SZWFkYWJsZVNpemVTdHJpbmciLCJ0b0luTWVtb3J5QmFzZTY0IiwidG9TdHJpbmciLCJ1c2VyIiwicGFzcyIsIm1ldGhvZCIsImhlYWRlcnMiLCJmaWxlRmllbGROYW1lIiwiZm9ybUZpZWxkcyIsIm9wdGlvbnMiLCJhdXRoIiwibmV0IiwidXBsb2FkRmlsZSIsInJlbW92ZUFsbFNlc3Npb25XZWJTb2NrZXRIYW5kbGVycyIsInNlcnZlciIsInNlc3Npb25JZCIsImdldFdlYlNvY2tldEhhbmRsZXJzIiwiYWN0aXZlSGFuZGxlcnMiLCJwYXRobmFtZSIsImtleXMiLCJyZW1vdmVXZWJTb2NrZXRIYW5kbGVyIiwiaXNMb2NhbEhvc3QiLCJ1cmxTdHJpbmciLCJob3N0bmFtZSIsInVybCIsIm5vcm1hbGl6ZVBsYXRmb3JtVmVyc2lvbiIsIm9yaWdpbmFsVmVyc2lvbiIsIm5vcm1hbGl6ZWRWZXJzaW9uIiwic2VtdmVyIiwiY29lcmNlIiwibWFqb3IiLCJtaW5vciJdLCJzb3VyY2VSb290IjoiLi4vLi4iLCJzb3VyY2VzIjpbImxpYi91dGlscy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgeyB1dGlsaXRpZXMgfSBmcm9tICdhcHBpdW0taW9zLWRldmljZSc7XG5pbXBvcnQgeyBmcywgdXRpbCwgbmV0IH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeGNvZGUgZnJvbSAnYXBwaXVtLXhjb2RlJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBpb3NHZW5lcmljU2ltdWxhdG9ycyBmcm9tICcuL2lvcy1nZW5lcmljLXNpbXVsYXRvcnMnO1xuaW1wb3J0IHVybCBmcm9tICd1cmwnO1xuaW1wb3J0IG9zIGZyb20gJ29zJztcbmltcG9ydCBzZW12ZXIgZnJvbSAnc2VtdmVyJztcblxuXG5jb25zdCBERUZBVUxUX1RJTUVPVVRfS0VZID0gJ2RlZmF1bHQnO1xuY29uc3QgWENURVNUX0xPR19GSUxFU19QQVRURVJOUyA9IFtcbiAgL15TZXNzaW9uLVdlYkRyaXZlckFnZW50UnVubmVyLipcXC5sb2ckL2ksXG4gIC9eU3RhbmRhcmRPdXRwdXRBbmRTdGFuZGFyZEVycm9yXFwudHh0JC9pLFxuXTtcbmNvbnN0IFhDVEVTVF9MT0dTX0NBQ0hFX0ZPTERFUl9QUkVGSVggPSAnY29tLmFwcGxlLmR0LlhDVGVzdCc7XG5cblxuYXN5bmMgZnVuY3Rpb24gZGV0ZWN0VWRpZCAoKSB7XG4gIGxvZy5kZWJ1ZygnQXV0by1kZXRlY3RpbmcgcmVhbCBkZXZpY2UgdWRpZC4uLicpO1xuICBjb25zdCB1ZGlkcyA9IGF3YWl0IHV0aWxpdGllcy5nZXRDb25uZWN0ZWREZXZpY2VzKCk7XG4gIGlmIChfLmlzRW1wdHkodWRpZHMpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdObyBkZXZpY2UgaXMgY29ubmVjdGVkIHRvIHRoZSBob3N0Jyk7XG4gIH1cbiAgY29uc3QgdWRpZCA9IF8ubGFzdCh1ZGlkcyk7XG4gIGlmICh1ZGlkcy5sZW5ndGggPiAxKSB7XG4gICAgbG9nLndhcm4oYE11bHRpcGxlIGRldmljZXMgZm91bmQ6ICR7dWRpZHMuam9pbignLCAnKX1gKTtcbiAgICBsb2cud2FybihgQ2hvb3NpbmcgJyR7dWRpZH0nLiBJZiB0aGlzIGlzIHdyb25nLCBtYW51YWxseSBzZXQgd2l0aCAndWRpZCcgZGVzaXJlZCBjYXBhYmlsaXR5YCk7XG4gIH1cbiAgbG9nLmRlYnVnKGBEZXRlY3RlZCByZWFsIGRldmljZSB1ZGlkOiAnJHt1ZGlkfSdgKTtcbiAgcmV0dXJuIHVkaWQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEFuZENoZWNrWGNvZGVWZXJzaW9uICgpIHtcbiAgbGV0IHZlcnNpb247XG4gIHRyeSB7XG4gICAgdmVyc2lvbiA9IGF3YWl0IHhjb2RlLmdldFZlcnNpb24odHJ1ZSk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5kZWJ1ZyhlcnIpO1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgZGV0ZXJtaW5lIFhjb2RlIHZlcnNpb246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cblxuICAvLyB3ZSBkbyBub3Qgc3VwcG9ydCBYY29kZXMgPCA3LjMsXG4gIGlmICh2ZXJzaW9uLnZlcnNpb25GbG9hdCA8IDcuMykge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBYY29kZSB2ZXJzaW9uICcke3ZlcnNpb24udmVyc2lvblN0cmluZ30nLiBTdXBwb3J0IGZvciBgICtcbiAgICAgICAgICAgICAgICAgICAgICBgWGNvZGUgJHt2ZXJzaW9uLnZlcnNpb25TdHJpbmd9IGlzIG5vdCBzdXBwb3J0ZWQuIGAgK1xuICAgICAgICAgICAgICAgICAgICAgIGBQbGVhc2UgdXBncmFkZSB0byB2ZXJzaW9uIDcuMyBvciBoaWdoZXJgKTtcbiAgfVxuICByZXR1cm4gdmVyc2lvbjtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0QW5kQ2hlY2tJb3NTZGtWZXJzaW9uICgpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgeGNvZGUuZ2V0TWF4SU9TU0RLKCk7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgZGV0ZXJtaW5lIGlPUyBTREsgdmVyc2lvbjogJHtlcnIubWVzc2FnZX1gKTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCB0aGUgZ2VuZXJpYyBzaW11bGF0b3IgZm9yIGEgZ2l2ZW4gSU9TIHZlcnNpb24gYW5kIGRldmljZSB0eXBlIChpUGhvbmUsIGlQYWQpXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8bnVtYmVyfSBwbGF0Zm9ybVZlcnNpb24gSU9TIHZlcnNpb24uIGUuZy4pIDEzLjBcbiAqIEBwYXJhbSB7c3RyaW5nfSBkZXZpY2VOYW1lIFR5cGUgb2YgSU9TIGRldmljZS4gQ2FuIGJlIGlQaG9uZSwgaVBhZCAocG9zc2libHkgbW9yZSBpbiB0aGUgZnV0dXJlKVxuICpcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEdlbmVyaWMgaVBob25lIG9yIGlQYWQgc2ltdWxhdG9yIChpZiBhcHBsaWNhYmxlKVxuICovXG5mdW5jdGlvbiBnZXRHZW5lcmljU2ltdWxhdG9yRm9ySW9zVmVyc2lvbiAocGxhdGZvcm1WZXJzaW9uLCBkZXZpY2VOYW1lKSB7XG4gIGxldCBnZW5lcmljU2ltdWxhdG9ycyA9IGlvc0dlbmVyaWNTaW11bGF0b3JzW2RldmljZU5hbWVdO1xuXG4gIGlmIChnZW5lcmljU2ltdWxhdG9ycykge1xuICAgIGdlbmVyaWNTaW11bGF0b3JzID0gZ2VuZXJpY1NpbXVsYXRvcnMuc29ydCgoW3NpbU9uZV0sIFtzaW1Ud29dKSA9PiB1dGlsLmNvbXBhcmVWZXJzaW9ucyhzaW1PbmUsICc8Jywgc2ltVHdvKSA/IC0xIDogMSk7XG5cbiAgICAvLyBGaW5kIHRoZSBoaWdoZXN0IGlPUyB2ZXJzaW9uIGluIHRoZSBsaXN0IHRoYXQgaXMgYmVsb3cgdGhlIHByb3ZpZGVkIHZlcnNpb25cbiAgICBsZXQgZ2VuZXJpY0lvc1NpbXVsYXRvcjtcbiAgICBmb3IgKGNvbnN0IFtwbGF0Zm9ybVZlcnNpb25Gcm9tTGlzdCwgaW9zU2ltdWxhdG9yXSBvZiBnZW5lcmljU2ltdWxhdG9ycykge1xuICAgICAgaWYgKHV0aWwuY29tcGFyZVZlcnNpb25zKHBsYXRmb3JtVmVyc2lvbkZyb21MaXN0LCAnPicsIHBsYXRmb3JtVmVyc2lvbikpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBnZW5lcmljSW9zU2ltdWxhdG9yID0gaW9zU2ltdWxhdG9yO1xuICAgIH1cbiAgICByZXR1cm4gZ2VuZXJpY0lvc1NpbXVsYXRvcjtcbiAgfVxufVxuXG5mdW5jdGlvbiB0cmFuc2xhdGVEZXZpY2VOYW1lIChwbGF0Zm9ybVZlcnNpb24sIGRldmljZU5hbWUgPSAnJykge1xuICBjb25zdCBkZXZpY2VOYW1lVHJhbnNsYXRlZCA9IGdldEdlbmVyaWNTaW11bGF0b3JGb3JJb3NWZXJzaW9uKHBsYXRmb3JtVmVyc2lvbiwgZGV2aWNlTmFtZS50b0xvd2VyQ2FzZSgpLnRyaW0oKSk7XG4gIGlmIChkZXZpY2VOYW1lVHJhbnNsYXRlZCkge1xuICAgIGxvZy5kZWJ1ZyhgQ2hhbmdpbmcgZGV2aWNlTmFtZSBmcm9tICcke2RldmljZU5hbWV9JyB0byAnJHtkZXZpY2VOYW1lVHJhbnNsYXRlZH0nYCk7XG4gICAgcmV0dXJuIGRldmljZU5hbWVUcmFuc2xhdGVkO1xuICB9XG4gIHJldHVybiBkZXZpY2VOYW1lO1xufVxuXG5hc3luYyBmdW5jdGlvbiBjbGVhckxvZ3MgKGxvY2F0aW9ucykge1xuICBsb2cuZGVidWcoJ0NsZWFyaW5nIGxvZyBmaWxlcycpO1xuICBjb25zdCBjbGVhbnVwUHJvbWlzZXMgPSBbXTtcbiAgZm9yIChjb25zdCBsb2NhdGlvbiBvZiBsb2NhdGlvbnMpIHtcbiAgICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhsb2NhdGlvbikpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNsZWFudXBQcm9taXNlcy5wdXNoKChhc3luYyAoKSA9PiB7XG4gICAgICBsZXQgc2l6ZTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnZHUnLCBbJy1zaCcsIGxvY2F0aW9uXSk7XG4gICAgICAgIHNpemUgPSBzdGRvdXQudHJpbSgpLnNwbGl0KC9cXHMrLylbMF07XG4gICAgICB9IGNhdGNoIChpZ24pIHt9XG4gICAgICB0cnkge1xuICAgICAgICBsb2cuZGVidWcoYERlbGV0aW5nICcke2xvY2F0aW9ufScuICR7c2l6ZSA/IGBGcmVlaW5nICR7c2l6ZX0uYCA6ICcnfWApO1xuICAgICAgICBhd2FpdCBmcy5yaW1yYWYobG9jYXRpb24pO1xuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZy53YXJuKGBVbmFibGUgdG8gZGVsZXRlICcke2xvY2F0aW9ufSc6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICB9XG4gICAgfSkoKSk7XG4gIH1cbiAgaWYgKCFfLmlzRW1wdHkoY2xlYW51cFByb21pc2VzKSkge1xuICAgIGF3YWl0IEIuYWxsKGNsZWFudXBQcm9taXNlcyk7XG4gIH1cbiAgbG9nLmRlYnVnKCdGaW5pc2hlZCBjbGVhcmluZyBsb2cgZmlsZXMnKTtcbn1cblxuLy8gVGhpcyBtYXAgY29udGFpbnMgZGVyaXZlZCBkYXRhIGxvZ3MgZm9sZGVycyBhcyBrZXlzXG4vLyBhbmQgdmFsdWVzIGFyZSB0aGUgY291bnQgb2YgdGltZXMgdGhlIHBhcnRpY3VsYXJcbi8vIGZvbGRlciBoYXMgYmVlbiBzY2hlZHVsZWQgZm9yIHJlbW92YWxcbmNvbnN0IGRlcml2ZWREYXRhQ2xlYW51cE1hcmtlcnMgPSBuZXcgTWFwKCk7XG5cbmFzeW5jIGZ1bmN0aW9uIG1hcmtTeXN0ZW1GaWxlc0ZvckNsZWFudXAgKHdkYSkge1xuICBpZiAoIXdkYSB8fCAhYXdhaXQgd2RhLnJldHJpZXZlRGVyaXZlZERhdGFQYXRoKCkpIHtcbiAgICBsb2cud2FybignTm8gV2ViRHJpdmVyQWdlbnQgZGVyaXZlZCBkYXRhIGF2YWlsYWJsZSwgc28gdW5hYmxlIHRvIG1hcmsgc3lzdGVtIGZpbGVzIGZvciBjbGVhbnVwJyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgbG9nc1Jvb3QgPSBwYXRoLnJlc29sdmUoYXdhaXQgd2RhLnJldHJpZXZlRGVyaXZlZERhdGFQYXRoKCksICdMb2dzJyk7XG4gIGxldCBtYXJrZXJzQ291bnQgPSAwO1xuICBpZiAoZGVyaXZlZERhdGFDbGVhbnVwTWFya2Vycy5oYXMobG9nc1Jvb3QpKSB7XG4gICAgbWFya2Vyc0NvdW50ID0gZGVyaXZlZERhdGFDbGVhbnVwTWFya2Vycy5nZXQobG9nc1Jvb3QpO1xuICB9XG4gIGRlcml2ZWREYXRhQ2xlYW51cE1hcmtlcnMuc2V0KGxvZ3NSb290LCArK21hcmtlcnNDb3VudCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNsZWFyU3lzdGVtRmlsZXMgKHdkYSkge1xuICAvLyBvbmx5IHdhbnQgdG8gY2xlYXIgdGhlIHN5c3RlbSBmaWxlcyBmb3IgdGhlIHBhcnRpY3VsYXIgV0RBIHhjb2RlIHJ1blxuICBpZiAoIXdkYSB8fCAhYXdhaXQgd2RhLnJldHJpZXZlRGVyaXZlZERhdGFQYXRoKCkpIHtcbiAgICBsb2cud2FybignTm8gV2ViRHJpdmVyQWdlbnQgZGVyaXZlZCBkYXRhIGF2YWlsYWJsZSwgc28gdW5hYmxlIHRvIGNsZWFyIHN5c3RlbSBmaWxlcycpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGxvZ3NSb290ID0gcGF0aC5yZXNvbHZlKGF3YWl0IHdkYS5yZXRyaWV2ZURlcml2ZWREYXRhUGF0aCgpLCAnTG9ncycpO1xuICBpZiAoZGVyaXZlZERhdGFDbGVhbnVwTWFya2Vycy5oYXMobG9nc1Jvb3QpKSB7XG4gICAgbGV0IG1hcmtlcnNDb3VudCA9IGRlcml2ZWREYXRhQ2xlYW51cE1hcmtlcnMuZ2V0KGxvZ3NSb290KTtcbiAgICBkZXJpdmVkRGF0YUNsZWFudXBNYXJrZXJzLnNldChsb2dzUm9vdCwgLS1tYXJrZXJzQ291bnQpO1xuICAgIGlmIChtYXJrZXJzQ291bnQgPiAwKSB7XG4gICAgICBsb2cuaW5mbyhgTm90IGNsZWFuaW5nICcke2xvZ3NSb290fScgZm9sZGVyLCBiZWNhdXNlIHRoZSBvdGhlciBzZXNzaW9uIGRvZXMgbm90IGV4cGVjdCBpdCB0byBiZSBjbGVhbmVkYCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIGRlcml2ZWREYXRhQ2xlYW51cE1hcmtlcnMuc2V0KGxvZ3NSb290LCAwKTtcblxuICAvLyBDbGVhbmluZyB1cCBiaWcgdGVtcG9yYXJ5IGZpbGVzIGNyZWF0ZWQgYnkgWENUZXN0OiBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9pc3N1ZXMvOTQxMFxuICBjb25zdCBnbG9iUGF0dGVybiA9IGAke29zLnRtcGRpcigpfS8ke1hDVEVTVF9MT0dTX0NBQ0hFX0ZPTERFUl9QUkVGSVh9Ki9gO1xuICBjb25zdCBkc3RGb2xkZXJzID0gYXdhaXQgZnMuZ2xvYihnbG9iUGF0dGVybik7XG4gIGlmIChfLmlzRW1wdHkoZHN0Rm9sZGVycykpIHtcbiAgICBsb2cuZGVidWcoYERpZCBub3QgZmluZCB0aGUgdGVtcG9yYXJ5IFhDVGVzdCBsb2dzIHJvb3QgYXQgJyR7Z2xvYlBhdHRlcm59J2ApO1xuICB9IGVsc2Uge1xuICAgIC8vIHBlcmZvcm0gdGhlIGNsZWFudXAgYXN5bmNocm9ub3VzbHlcbiAgICBmb3IgKGNvbnN0IGRzdEZvbGRlciBvZiBkc3RGb2xkZXJzKSB7XG4gICAgICBsZXQgc2NoZWR1bGVkRmlsZXNDb3VudCA9IDA7XG4gICAgICBCLnJlc29sdmUoZnMud2Fsa0Rpcihkc3RGb2xkZXIsIHRydWUsIChpdGVtUGF0aCwgaXNEaXIpID0+IHtcbiAgICAgICAgaWYgKGlzRGlyKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZpbGVOYW1lID0gcGF0aC5iYXNlbmFtZShpdGVtUGF0aCk7XG4gICAgICAgIGlmICghWENURVNUX0xPR19GSUxFU19QQVRURVJOUy5zb21lKChwKSA9PiBwLnRlc3QoZmlsZU5hbWUpKSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGRlbGV0ZSB0aGUgZmlsZSBhc3luY2hyb25vdXNseVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgICAgICBmcy51bmxpbmsoaXRlbVBhdGgpLmNhdGNoKChlKSA9PiB7XG4gICAgICAgICAgbG9nLmluZm8oZS5tZXNzYWdlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHNjaGVkdWxlZEZpbGVzQ291bnQrKztcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLXRoZW5cbiAgICAgIH0pKS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgaWYgKHNjaGVkdWxlZEZpbGVzQ291bnQgPiAwKSB7XG4gICAgICAgICAgbG9nLmluZm8oYFNjaGVkdWxlZCAke3NjaGVkdWxlZEZpbGVzQ291bnR9IHRlbXBvcmFyeSBYQ1Rlc3QgbG9nIGAgK1xuICAgICAgICAgICAgYCR7dXRpbC5wbHVyYWxpemUoJ2ZpbGUnLCBzY2hlZHVsZWRGaWxlc0NvdW50KX0gZm9yIGNsZWFudXAgaW4gJyR7ZHN0Rm9sZGVyfSdgKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tdGhlblxuICAgICAgfSkuY2F0Y2goKGUpID0+IHtcbiAgICAgICAgbG9nLmluZm8oZS5tZXNzYWdlKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYFN0YXJ0ZWQgYmFja2dyb3VuZCBYQ1Rlc3QgbG9ncyBjbGVhbnVwIGluICcke2RzdEZvbGRlcnN9J2ApO1xuICB9XG5cbiAgaWYgKGF3YWl0IGZzLmV4aXN0cyhsb2dzUm9vdCkpIHtcbiAgICBsb2cuaW5mbyhgQ2xlYW5pbmcgdGVzdCBsb2dzIGluICcke2xvZ3NSb290fScgZm9sZGVyYCk7XG4gICAgYXdhaXQgY2xlYXJMb2dzKFtsb2dzUm9vdF0pO1xuICAgIHJldHVybjtcbiAgfVxuICBsb2cuaW5mbyhgVGhlcmUgaXMgbm8gJHtsb2dzUm9vdH0gZm9sZGVyLCBzbyBub3QgY2xlYW5pbmcgZmlsZXNgKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gY2hlY2tBcHBQcmVzZW50IChhcHApIHtcbiAgbG9nLmRlYnVnKGBDaGVja2luZyB3aGV0aGVyIGFwcCAnJHthcHB9JyBpcyBhY3R1YWxseSBwcmVzZW50IG9uIGZpbGUgc3lzdGVtYCk7XG4gIGlmICghKGF3YWl0IGZzLmV4aXN0cyhhcHApKSkge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBDb3VsZCBub3QgZmluZCBhcHAgYXQgJyR7YXBwfSdgKTtcbiAgfVxuICBsb2cuZGVidWcoJ0FwcCBpcyBwcmVzZW50Jyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldERyaXZlckluZm8gKCkge1xuICBjb25zdCBzdGF0ID0gYXdhaXQgZnMuc3RhdChwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4nKSk7XG4gIGNvbnN0IGJ1aWx0ID0gc3RhdC5tdGltZS5nZXRUaW1lKCk7XG5cbiAgLy8gZ2V0IHRoZSBwYWNrYWdlLmpzb24gYW5kIHRoZSB2ZXJzaW9uIGZyb20gaXRcbiAgY29uc3QgcGtnID0gcmVxdWlyZShfX2ZpbGVuYW1lLmluY2x1ZGVzKCdidWlsZC9saWIvdXRpbHMnKSA/ICcuLi8uLi9wYWNrYWdlLmpzb24nIDogJy4uL3BhY2thZ2UuanNvbicpO1xuICBjb25zdCB2ZXJzaW9uID0gcGtnLnZlcnNpb247XG5cbiAgcmV0dXJuIHtcbiAgICBidWlsdCxcbiAgICB2ZXJzaW9uLFxuICB9O1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVDb21tYW5kVGltZW91dHMgKHZhbHVlKSB7XG4gIC8vIFRoZSB2YWx1ZSBpcyBub3JtYWxpemVkIGFscmVhZHlcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICBsZXQgcmVzdWx0ID0ge307XG4gIC8vIFVzZSBhcyBkZWZhdWx0IHRpbWVvdXQgZm9yIGFsbCBjb21tYW5kcyBpZiBhIHNpbmdsZSBpbnRlZ2VyIHZhbHVlIGlzIHByb3ZpZGVkXG4gIGlmICghaXNOYU4odmFsdWUpKSB7XG4gICAgcmVzdWx0W0RFRkFVTFRfVElNRU9VVF9LRVldID0gXy50b0ludGVnZXIodmFsdWUpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvLyBKU09OIG9iamVjdCBoYXMgYmVlbiBwcm92aWRlZC4gTGV0J3MgcGFyc2UgaXRcbiAgdHJ5IHtcbiAgICByZXN1bHQgPSBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChyZXN1bHQpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGxvZy5lcnJvckFuZFRocm93KGBcImNvbW1hbmRUaW1lb3V0c1wiIGNhcGFiaWxpdHkgc2hvdWxkIGJlIGEgdmFsaWQgSlNPTiBvYmplY3QuIFwiJHt2YWx1ZX1cIiB3YXMgZ2l2ZW4gaW5zdGVhZGApO1xuICB9XG4gIGZvciAobGV0IFtjbWQsIHRpbWVvdXRdIG9mIF8udG9QYWlycyhyZXN1bHQpKSB7XG4gICAgaWYgKCFfLmlzSW50ZWdlcih0aW1lb3V0KSB8fCB0aW1lb3V0IDw9IDApIHtcbiAgICAgIGxvZy5lcnJvckFuZFRocm93KGBUaGUgdGltZW91dCBmb3IgXCIke2NtZH1cIiBzaG91bGQgYmUgYSB2YWxpZCBuYXR1cmFsIG51bWJlciBvZiBtaWxsaXNlY29uZHMuIFwiJHt0aW1lb3V0fVwiIHdhcyBnaXZlbiBpbnN0ZWFkYCk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHByaW50VXNlciAoKSB7XG4gIHRyeSB7XG4gICAgbGV0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnd2hvYW1pJyk7XG4gICAgbG9nLmRlYnVnKGBDdXJyZW50IHVzZXI6ICcke3N0ZG91dC50cmltKCl9J2ApO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICBsb2cuZGVidWcoYFVuYWJsZSB0byBnZXQgdXNlcm5hbWUgcnVubmluZyBzZXJ2ZXI6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgdGhlIElEcyBvZiBwcm9jZXNzZXMgbGlzdGVuaW5nIG9uIHRoZSBwYXJ0aWN1bGFyIHN5c3RlbSBwb3J0LlxuICogSXQgaXMgYWxzbyBwb3NzaWJsZSB0byBhcHBseSBhZGRpdGlvbmFsIGZpbHRlcmluZyBiYXNlZCBvbiB0aGVcbiAqIHByb2Nlc3MgY29tbWFuZCBsaW5lLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfG51bWJlcn0gcG9ydCAtIFRoZSBwb3J0IG51bWJlci5cbiAqIEBwYXJhbSB7P0Z1bmN0aW9ufSBmaWx0ZXJpbmdGdW5jIC0gT3B0aW9uYWwgbGFtYmRhIGZ1bmN0aW9uLCB3aGljaFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlcyBjb21tYW5kIGxpbmUgc3RyaW5nIG9mIHRoZSBwYXJ0aWN1bGFyIHByb2Nlc3NcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGVuaW5nIG9uIGdpdmVuIHBvcnQsIGFuZCBpcyBleHBlY3RlZCB0byByZXR1cm5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWl0aGVyIHRydWUgb3IgZmFsc2UgdG8gaW5jbHVkZS9leGNsdWRlIHRoZSBjb3JyZXNwb25kaW5nIFBJRFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tIHRoZSByZXN1bHRpbmcgYXJyYXkuXG4gKiBAcmV0dXJucyB7QXJyYXk8c3RyaW5nPn0gLSB0aGUgbGlzdCBvZiBtYXRjaGVkIHByb2Nlc3MgaWRzLlxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRQSURzTGlzdGVuaW5nT25Qb3J0IChwb3J0LCBmaWx0ZXJpbmdGdW5jID0gbnVsbCkge1xuICBjb25zdCByZXN1bHQgPSBbXTtcbiAgdHJ5IHtcbiAgICAvLyBUaGlzIG9ubHkgd29ya3Mgc2luY2UgTWFjIE9TIFggRWwgQ2FwaXRhblxuICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnbHNvZicsIFsnLXRpJywgYHRjcDoke3BvcnR9YF0pO1xuICAgIHJlc3VsdC5wdXNoKC4uLihzdGRvdXQudHJpbSgpLnNwbGl0KC9cXG4rLykpKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBpZiAoIV8uaXNGdW5jdGlvbihmaWx0ZXJpbmdGdW5jKSkge1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IEIuZmlsdGVyKHJlc3VsdCwgYXN5bmMgKHgpID0+IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoJ3BzJywgWyctcCcsIHgsICctbycsICdjb21tYW5kJ10pO1xuICAgIHJldHVybiBhd2FpdCBmaWx0ZXJpbmdGdW5jKHN0ZG91dCk7XG4gIH0pO1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFVwbG9hZE9wdGlvbnNcbiAqXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHVzZXIgLSBUaGUgbmFtZSBvZiB0aGUgdXNlciBmb3IgdGhlIHJlbW90ZSBhdXRoZW50aWNhdGlvbi4gT25seSB3b3JrcyBpZiBgcmVtb3RlUGF0aGAgaXMgcHJvdmlkZWQuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHBhc3MgLSBUaGUgcGFzc3dvcmQgZm9yIHRoZSByZW1vdGUgYXV0aGVudGljYXRpb24uIE9ubHkgd29ya3MgaWYgYHJlbW90ZVBhdGhgIGlzIHByb3ZpZGVkLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBtZXRob2QgLSBUaGUgaHR0cCBtdWx0aXBhcnQgdXBsb2FkIG1ldGhvZCBuYW1lLiBUaGUgJ1BVVCcgb25lIGlzIHVzZWQgYnkgZGVmYXVsdC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT25seSB3b3JrcyBpZiBgcmVtb3RlUGF0aGAgaXMgcHJvdmlkZWQuXG4gKiBAcHJvcGVydHkgez9PYmplY3R9IGhlYWRlcnMgLSBBZGRpdGlvbmFsIGhlYWRlcnMgbWFwcGluZyBmb3IgbXVsdGlwYXJ0IGh0dHAocykgdXBsb2Fkc1xuICogQHByb3BlcnR5IHs/c3RyaW5nfSBmaWxlRmllbGROYW1lIFtmaWxlXSAtIFRoZSBuYW1lIG9mIHRoZSBmb3JtIGZpZWxkLCB3aGVyZSB0aGUgZmlsZSBjb250ZW50IEJMT0Igc2hvdWxkIGJlIHN0b3JlZCBmb3JcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodHRwKHMpIHVwbG9hZHNcbiAqIEBwcm9wZXJ0eSB7P09iamVjdHxBcnJheTxQYWlyPn0gZm9ybUZpZWxkcyAtIEFkZGl0aW9uYWwgZm9ybSBmaWVsZHMgZm9yIG11bHRpcGFydCBodHRwKHMpIHVwbG9hZHNcbiAqL1xuXG5cbi8qKlxuICogRW5jb2RlcyB0aGUgZ2l2ZW4gbG9jYWwgZmlsZSB0byBiYXNlNjQgYW5kIHJldHVybnMgdGhlIHJlc3VsdGluZyBzdHJpbmdcbiAqIG9yIHVwbG9hZHMgaXQgdG8gYSByZW1vdGUgc2VydmVyIHVzaW5nIGh0dHAvaHR0cHMgb3IgZnRwIHByb3RvY29sc1xuICogaWYgYHJlbW90ZVBhdGhgIGlzIHNldFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBsb2NhbFBhdGggLSBUaGUgcGF0aCB0byBhbiBleGlzdGluZyBsb2NhbCBmaWxlXG4gKiBAcGFyYW0gez9zdHJpbmd9IHJlbW90ZVBhdGggLSBUaGUgcGF0aCB0byB0aGUgcmVtb3RlIGxvY2F0aW9uLCB3aGVyZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcyBmaWxlIHNob3VsZCBiZSB1cGxvYWRlZFxuICogQHBhcmFtIHs/VXBsb2FkT3B0aW9uc30gdXBsb2FkT3B0aW9ucyAtIFNldCBvZiB1cGxvYWQgb3B0aW9uc1xuICogQHJldHVybnMge3N0cmluZ30gRWl0aGVyIGFuIGVtcHR5IHN0cmluZyBpZiB0aGUgdXBsb2FkIHdhcyBzdWNjZXNzZnVsIG9yXG4gKiBiYXNlNjQtZW5jb2RlZCBmaWxlIHJlcHJlc2VudGF0aW9uIGlmIGByZW1vdGVQYXRoYCBpcyBmYWxzeVxuICovXG5hc3luYyBmdW5jdGlvbiBlbmNvZGVCYXNlNjRPclVwbG9hZCAobG9jYWxQYXRoLCByZW1vdGVQYXRoID0gbnVsbCwgdXBsb2FkT3B0aW9ucyA9IHt9KSB7XG4gIGlmICghYXdhaXQgZnMuZXhpc3RzKGxvY2FsUGF0aCkpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIGZpbGUgYXQgJyR7bG9jYWxQYXRofScgZG9lcyBub3QgZXhpc3Qgb3IgaXMgbm90IGFjY2Vzc2libGVgKTtcbiAgfVxuXG4gIGlmIChfLmlzRW1wdHkocmVtb3RlUGF0aCkpIHtcbiAgICBjb25zdCB7c2l6ZX0gPSBhd2FpdCBmcy5zdGF0KGxvY2FsUGF0aCk7XG4gICAgbG9nLmRlYnVnKGBUaGUgc2l6ZSBvZiB0aGUgZmlsZSBpcyAke3V0aWwudG9SZWFkYWJsZVNpemVTdHJpbmcoc2l6ZSl9YCk7XG4gICAgcmV0dXJuIChhd2FpdCB1dGlsLnRvSW5NZW1vcnlCYXNlNjQobG9jYWxQYXRoKSkudG9TdHJpbmcoKTtcbiAgfVxuXG4gIGNvbnN0IHt1c2VyLCBwYXNzLCBtZXRob2QsIGhlYWRlcnMsIGZpbGVGaWVsZE5hbWUsIGZvcm1GaWVsZHN9ID0gdXBsb2FkT3B0aW9ucztcbiAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICBtZXRob2Q6IG1ldGhvZCB8fCAnUFVUJyxcbiAgICBoZWFkZXJzLFxuICAgIGZpbGVGaWVsZE5hbWUsXG4gICAgZm9ybUZpZWxkcyxcbiAgfTtcbiAgaWYgKHVzZXIgJiYgcGFzcykge1xuICAgIG9wdGlvbnMuYXV0aCA9IHt1c2VyLCBwYXNzfTtcbiAgfVxuICBhd2FpdCBuZXQudXBsb2FkRmlsZShsb2NhbFBhdGgsIHJlbW90ZVBhdGgsIG9wdGlvbnMpO1xuICByZXR1cm4gJyc7XG59XG5cbi8qKlxuICogU3RvcHMgYW5kIHJlbW92ZXMgYWxsIHdlYiBzb2NrZXQgaGFuZGxlcnMgdGhhdCBhcmUgbGlzdGVuaW5nXG4gKiBpbiBzY29wZSBvZiB0aGUgY3VycmVjdCBzZXNzaW9uLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBzZXJ2ZXIgLSBUaGUgaW5zdGFuY2Ugb2YgTm9kZUpzIEhUVFAgc2VydmVyLFxuICogd2hpY2ggaG9zdHMgQXBwaXVtXG4gKiBAcGFyYW0ge3N0cmluZ30gc2Vzc2lvbklkIC0gVGhlIGlkIG9mIHRoZSBjdXJyZW50IHNlc3Npb25cbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3ZlQWxsU2Vzc2lvbldlYlNvY2tldEhhbmRsZXJzIChzZXJ2ZXIsIHNlc3Npb25JZCkge1xuICBpZiAoIXNlcnZlciB8fCAhXy5pc0Z1bmN0aW9uKHNlcnZlci5nZXRXZWJTb2NrZXRIYW5kbGVycykpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBhY3RpdmVIYW5kbGVycyA9IGF3YWl0IHNlcnZlci5nZXRXZWJTb2NrZXRIYW5kbGVycyhzZXNzaW9uSWQpO1xuICBmb3IgKGNvbnN0IHBhdGhuYW1lIG9mIF8ua2V5cyhhY3RpdmVIYW5kbGVycykpIHtcbiAgICBhd2FpdCBzZXJ2ZXIucmVtb3ZlV2ViU29ja2V0SGFuZGxlcihwYXRobmFtZSk7XG4gIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHVybFN0cmluZyBpcyBsb2NhbGhvc3RcbiAqIEBwYXJhbSB7P3N0cmluZ30gdXJsU3RyaW5nXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJuIHRydWUgaWYgdGhlIHVybFN0cmluZyBpcyBsb2NhbGhvc3RcbiAqL1xuZnVuY3Rpb24gaXNMb2NhbEhvc3QgKHVybFN0cmluZykge1xuICB0cnkge1xuICAgIGNvbnN0IHtob3N0bmFtZX0gPSB1cmwucGFyc2UodXJsU3RyaW5nKTtcbiAgICByZXR1cm4gWydsb2NhbGhvc3QnLCAnMTI3LjAuMC4xJywgJzo6MScsICc6OmZmZmY6MTI3LjAuMC4xJ10uaW5jbHVkZXMoaG9zdG5hbWUpO1xuICB9IGNhdGNoIChpZ24pIHtcbiAgICBsb2cud2FybihgJyR7dXJsU3RyaW5nfScgY2Fubm90IGJlIHBhcnNlZCBhcyBhIHZhbGlkIFVSTGApO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBOb3JtYWxpemVzIHBsYXRmb3JtVmVyc2lvbiB0byBhIHZhbGlkIGlPUyB2ZXJzaW9uIHN0cmluZ1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBvcmlnaW5hbFZlcnNpb24gLSBMb29zZSB2ZXJzaW9uIG51bWJlciwgdGhhdCBjYW4gYmUgcGFyc2VkIGJ5IHNlbXZlclxuICogQHJldHVybiB7c3RyaW5nfSBpT1MgdmVyc2lvbiBudW1iZXIgaW4gPG1ham9yPi48bWlub3I+IGZvcm1hdFxuICogQHRocm93cyB7RXJyb3J9IGlmIHRoZSB2ZXJzaW9uIG51bWJlciBjYW5ub3QgYmUgcGFyc2VkXG4gKi9cbmZ1bmN0aW9uIG5vcm1hbGl6ZVBsYXRmb3JtVmVyc2lvbiAob3JpZ2luYWxWZXJzaW9uKSB7XG4gIGNvbnN0IG5vcm1hbGl6ZWRWZXJzaW9uID0gc2VtdmVyLmNvZXJjZShvcmlnaW5hbFZlcnNpb24pO1xuICBpZiAoIW5vcm1hbGl6ZWRWZXJzaW9uKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcGxhdGZvcm0gdmVyc2lvbiAnJHtvcmlnaW5hbFZlcnNpb259JyBzaG91bGQgYmUgYSB2YWxpZCB2ZXJzaW9uIG51bWJlcmApO1xuICB9XG4gIHJldHVybiBgJHtub3JtYWxpemVkVmVyc2lvbi5tYWpvcn0uJHtub3JtYWxpemVkVmVyc2lvbi5taW5vcn1gO1xufVxuXG5cbmV4cG9ydCB7XG4gIGRldGVjdFVkaWQsIGdldEFuZENoZWNrWGNvZGVWZXJzaW9uLCBnZXRBbmRDaGVja0lvc1Nka1ZlcnNpb24sXG4gIGNoZWNrQXBwUHJlc2VudCwgZ2V0RHJpdmVySW5mbyxcbiAgY2xlYXJTeXN0ZW1GaWxlcywgdHJhbnNsYXRlRGV2aWNlTmFtZSwgbm9ybWFsaXplQ29tbWFuZFRpbWVvdXRzLFxuICBERUZBVUxUX1RJTUVPVVRfS0VZLCBtYXJrU3lzdGVtRmlsZXNGb3JDbGVhbnVwLCBwcmludFVzZXIsXG4gIGdldFBJRHNMaXN0ZW5pbmdPblBvcnQsIGVuY29kZUJhc2U2NE9yVXBsb2FkLCByZW1vdmVBbGxTZXNzaW9uV2ViU29ja2V0SGFuZGxlcnMsXG4gIGlzTG9jYWxIb3N0LCBub3JtYWxpemVQbGF0Zm9ybVZlcnNpb24sIGNsZWFyTG9ncyxcbn07XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUdBLE1BQU1BLG1CQUFtQixHQUFHLFNBQTVCOztBQUNBLE1BQU1DLHlCQUF5QixHQUFHLENBQ2hDLHdDQURnQyxFQUVoQyx3Q0FGZ0MsQ0FBbEM7QUFJQSxNQUFNQywrQkFBK0IsR0FBRyxxQkFBeEM7O0FBR0EsZUFBZUMsVUFBZixHQUE2QjtFQUMzQkMsZUFB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
