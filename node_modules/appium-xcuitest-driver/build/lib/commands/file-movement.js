"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;
exports.parseContainerPath = parseContainerPath;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _support = require("@appium/support");

var _path = _interopRequireDefault(require("path"));

var _logger = _interopRequireDefault(require("../logger"));

var _appiumIosDevice = require("appium-ios-device");

var _iosFsHelpers = require("../ios-fs-helpers");

var _baseDriver = require("@appium/base-driver");

const CONTAINER_PATH_MARKER = '@';
const CONTAINER_PATH_PATTERN = new RegExp(`^${CONTAINER_PATH_MARKER}([^/]+)/(.*)`);
const CONTAINER_TYPE_SEPARATOR = ':';
const CONTAINER_DOCUMENTS_PATH = 'Documents';
const OBJECT_NOT_FOUND_ERROR_MESSAGE = 'OBJECT_NOT_FOUND';
const commands = {};
exports.commands = commands;

function verifyIsSubPath(originalPath, root) {
  const normalizedRoot = _path.default.normalize(root);

  const normalizedPath = _path.default.normalize(_path.default.dirname(originalPath));

  if (normalizedRoot !== originalPath && !normalizedPath.startsWith(normalizedRoot)) {
    throw new Error(`'${normalizedPath}' is expected to be a subpath of '${normalizedRoot}'`);
  }
}

async function createAfcClient(udid, bundleId, containerType) {
  if (!bundleId) {
    return await _appiumIosDevice.services.startAfcService(udid);
  }

  const service = await _appiumIosDevice.services.startHouseArrestService(udid);
  return isDocumentsContainer(containerType) ? await service.vendDocuments(bundleId) : await service.vendContainer(bundleId);
}

function isDocumentsContainer(containerType) {
  return _lodash.default.toLower(containerType) === _lodash.default.toLower(CONTAINER_DOCUMENTS_PATH);
}

async function createService(udid, remotePath) {
  if (CONTAINER_PATH_PATTERN.test(remotePath)) {
    const {
      bundleId,
      pathInContainer,
      containerType
    } = await parseContainerPath(remotePath);
    const service = await createAfcClient(udid, bundleId, containerType);
    const relativePath = isDocumentsContainer(containerType) ? _path.default.join(CONTAINER_DOCUMENTS_PATH, pathInContainer) : pathInContainer;
    return {
      service,
      relativePath
    };
  } else {
    const service = await createAfcClient(udid);
    return {
      service,
      relativePath: remotePath
    };
  }
}

async function parseContainerPath(remotePath, containerRootSupplier) {
  const match = CONTAINER_PATH_PATTERN.exec(remotePath);

  if (!match) {
    throw new Error(`It is expected that package identifier ` + `starts with '${CONTAINER_PATH_MARKER}' and is separated from the ` + `relative path with a single slash. '${remotePath}' is given instead`);
  }

  let [, bundleId, relativePath] = match;
  let containerType = null;
  const typeSeparatorPos = bundleId.indexOf(CONTAINER_TYPE_SEPARATOR);

  if (typeSeparatorPos > 0 && typeSeparatorPos < bundleId.length - 1) {
    containerType = bundleId.substring(typeSeparatorPos + 1);

    _logger.default.debug(`Parsed container type: ${containerType}`);

    bundleId = bundleId.substring(0, typeSeparatorPos);
  }

  if (_lodash.default.isNil(containerRootSupplier)) {
    const pathInContainer = relativePath;
    return {
      bundleId,
      pathInContainer,
      containerType
    };
  }

  const containerRoot = _lodash.default.isFunction(containerRootSupplier) ? await containerRootSupplier(bundleId, containerType) : containerRootSupplier;

  const pathInContainer = _path.default.posix.resolve(containerRoot, relativePath);

  verifyIsSubPath(pathInContainer, containerRoot);
  return {
    bundleId,
    pathInContainer,
    containerType
  };
}

async function pushFileToSimulator(device, remotePath, base64Data) {
  const buffer = Buffer.from(base64Data, 'base64');

  if (CONTAINER_PATH_PATTERN.test(remotePath)) {
    const {
      bundleId,
      pathInContainer: dstPath
    } = await parseContainerPath(remotePath, async (appBundle, containerType) => await device.simctl.getAppContainer(appBundle, containerType));

    _logger.default.info(`Parsed bundle identifier '${bundleId}' from '${remotePath}'. ` + `Will put the data into '${dstPath}'`);

    if (!(await _support.fs.exists(_path.default.dirname(dstPath)))) {
      _logger.default.debug(`The destination folder '${_path.default.dirname(dstPath)}' does not exist. Creating...`);

      await (0, _support.mkdirp)(_path.default.dirname(dstPath));
    }

    await _support.fs.writeFile(dstPath, buffer);
    return;
  }

  const dstFolder = await _support.tempDir.openDir();

  const dstPath = _path.default.resolve(dstFolder, _path.default.basename(remotePath));

  try {
    await _support.fs.writeFile(dstPath, buffer);
    await device.simctl.addMedia(dstPath);
  } finally {
    await _support.fs.rimraf(dstFolder);
  }
}

async function pushFileToRealDevice(device, remotePath, base64Data) {
  const {
    service,
    relativePath
  } = await createService(device.udid, remotePath);

  try {
    await (0, _iosFsHelpers.pushFile)(service, relativePath, base64Data);
  } catch (e) {
    _logger.default.debug(e.stack);

    throw new Error(`Could not push the file to '${remotePath}'.  Original error: ${e.message}`);
  } finally {
    service.close();
  }
}

async function deleteFileOrFolder(device, remotePath, isSimulator) {
  return isSimulator ? await deleteFromSimulator(device, remotePath) : await deleteFromRealDevice(device, remotePath);
}

async function pullFromSimulator(device, remotePath, isFile) {
  let pathOnServer;

  if (CONTAINER_PATH_PATTERN.test(remotePath)) {
    const {
      bundleId,
      pathInContainer: dstPath
    } = await parseContainerPath(remotePath, async (appBundle, containerType) => await device.simctl.getAppContainer(appBundle, containerType));

    _logger.default.info(`Parsed bundle identifier '${bundleId}' from '${remotePath}'. ` + `Will get the data from '${dstPath}'`);

    pathOnServer = dstPath;
  } else {
    const simRoot = device.getDir();
    pathOnServer = _path.default.posix.join(simRoot, remotePath);
    verifyIsSubPath(pathOnServer, simRoot);

    _logger.default.info(`Got the full item path: ${pathOnServer}`);
  }

  if (!(await _support.fs.exists(pathOnServer))) {
    _logger.default.errorAndThrow(`The remote ${isFile ? 'file' : 'folder'} at '${pathOnServer}' does not exist`);
  }

  const buffer = isFile ? await _support.util.toInMemoryBase64(pathOnServer) : await _support.zip.toInMemoryZip(pathOnServer, {
    encodeToBase64: true
  });
  return buffer.toString();
}

async function pullFromRealDevice(device, remotePath, isFile) {
  const {
    service,
    relativePath
  } = await createService(device.udid, remotePath);

  try {
    const fileInfo = await service.getFileInfo(relativePath);

    if (isFile && fileInfo.isDirectory()) {
      throw new Error(`The requested path is not a file. Path: '${remotePath}'`);
    }

    if (!isFile && !fileInfo.isDirectory()) {
      throw new Error(`The requested path is not a folder. Path: '${remotePath}'`);
    }

    return fileInfo.isFile() ? (await (0, _iosFsHelpers.pullFile)(service, relativePath)).toString('base64') : (await (0, _iosFsHelpers.pullFolder)(service, relativePath)).toString();
  } finally {
    service.close();
  }
}

async function deleteFromSimulator(device, remotePath) {
  let pathOnServer;

  if (CONTAINER_PATH_PATTERN.test(remotePath)) {
    const {
      bundleId,
      pathInContainer: dstPath
    } = await parseContainerPath(remotePath, async (appBundle, containerType) => await device.simctl.getAppContainer(appBundle, containerType));

    _logger.default.info(`Parsed bundle identifier '${bundleId}' from '${remotePath}'. ` + `'${dstPath}' will be deleted`);

    pathOnServer = dstPath;
  } else {
    const simRoot = device.getDir();
    pathOnServer = _path.default.posix.join(simRoot, remotePath);
    verifyIsSubPath(pathOnServer, simRoot);

    _logger.default.info(`Got the full path: ${pathOnServer}`);
  }

  if (!(await _support.fs.exists(pathOnServer))) {
    throw new _baseDriver.errors.InvalidArgumentError(`The remote path at '${pathOnServer}' does not exist`);
  }

  await _support.fs.rimraf(pathOnServer);
}

async function deleteFromRealDevice(device, remotePath) {
  const {
    service,
    relativePath
  } = await createService(device.udid, remotePath);

  try {
    await service.deleteDirectory(relativePath);
  } catch (e) {
    if (e.message.includes(OBJECT_NOT_FOUND_ERROR_MESSAGE)) {
      throw new Error(`Path '${remotePath}' does not exist on the device`);
    }

    throw e;
  } finally {
    service.close();
  }
}

commands.pushFile = async function pushFile(remotePath, base64Data) {
  if (remotePath.endsWith('/')) {
    throw new _baseDriver.errors.InvalidArgumentError(`It is expected that remote path points to a file and not to a folder. ` + `'${remotePath}' is given instead`);
  }

  if (_lodash.default.isArray(base64Data)) {
    base64Data = Buffer.from(base64Data).toString('utf8');
  }

  return this.isSimulator() ? await pushFileToSimulator(this.opts.device, remotePath, base64Data) : await pushFileToRealDevice(this.opts.device, remotePath, base64Data);
};

commands.pullFile = async function pullFile(remotePath) {
  if (remotePath.endsWith('/')) {
    throw new _baseDriver.errors.InvalidArgumentError(`It is expected that remote path points to a file and not to a folder. ` + `'${remotePath}' is given instead`);
  }

  return this.isSimulator() ? await pullFromSimulator(this.opts.device, remotePath, true) : await pullFromRealDevice(this.opts.device, remotePath, true);
};

commands.mobileDeleteFolder = async function mobileDeleteFolder(opts = {}) {
  let {
    remotePath
  } = opts;

  if (!remotePath.endsWith('/')) {
    remotePath = `${remotePath}/`;
  }

  return await deleteFileOrFolder(this.opts.device, remotePath, this.isSimulator());
};

commands.mobileDeleteFile = async function mobileDeleteFile(opts = {}) {
  const {
    remotePath
  } = opts;

  if (remotePath.endsWith('/')) {
    throw new _baseDriver.errors.InvalidArgumentError(`It is expected that remote path points to a file and not to a folder. ` + `'${remotePath}' is given instead`);
  }

  return await deleteFileOrFolder(this.opts.device, remotePath, this.isSimulator());
};

commands.pullFolder = async function pullFolder(remotePath) {
  if (!remotePath.endsWith('/')) {
    remotePath = `${remotePath}/`;
  }

  return this.isSimulator() ? await pullFromSimulator(this.opts.device, remotePath, false) : await pullFromRealDevice(this.opts.device, remotePath, false);
};

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL2NvbW1hbmRzL2ZpbGUtbW92ZW1lbnQuanMiLCJuYW1lcyI6WyJDT05UQUlORVJfUEFUSF9NQVJLRVIiLCJDT05UQUlORVJfUEFUSF9QQVRURVJOIiwiUmVnRXhwIiwiQ09OVEFJTkVSX1RZUEVfU0VQQVJBVE9SIiwiQ09OVEFJTkVSX0RPQ1VNRU5UU19QQVRIIiwiT0JKRUNUX05PVF9GT1VORF9FUlJPUl9NRVNTQUdFIiwiY29tbWFuZHMiLCJ2ZXJpZnlJc1N1YlBhdGgiLCJvcmlnaW5hbFBhdGgiLCJyb290Iiwibm9ybWFsaXplZFJvb3QiLCJwYXRoIiwibm9ybWFsaXplIiwibm9ybWFsaXplZFBhdGgiLCJkaXJuYW1lIiwic3RhcnRzV2l0aCIsIkVycm9yIiwiY3JlYXRlQWZjQ2xpZW50IiwidWRpZCIsImJ1bmRsZUlkIiwiY29udGFpbmVyVHlwZSIsInNlcnZpY2VzIiwic3RhcnRBZmNTZXJ2aWNlIiwic2VydmljZSIsInN0YXJ0SG91c2VBcnJlc3RTZXJ2aWNlIiwiaXNEb2N1bWVudHNDb250YWluZXIiLCJ2ZW5kRG9jdW1lbnRzIiwidmVuZENvbnRhaW5lciIsIl8iLCJ0b0xvd2VyIiwiY3JlYXRlU2VydmljZSIsInJlbW90ZVBhdGgiLCJ0ZXN0IiwicGF0aEluQ29udGFpbmVyIiwicGFyc2VDb250YWluZXJQYXRoIiwicmVsYXRpdmVQYXRoIiwiam9pbiIsImNvbnRhaW5lclJvb3RTdXBwbGllciIsIm1hdGNoIiwiZXhlYyIsInR5cGVTZXBhcmF0b3JQb3MiLCJpbmRleE9mIiwibGVuZ3RoIiwic3Vic3RyaW5nIiwibG9nIiwiZGVidWciLCJpc05pbCIsImNvbnRhaW5lclJvb3QiLCJpc0Z1bmN0aW9uIiwicG9zaXgiLCJyZXNvbHZlIiwicHVzaEZpbGVUb1NpbXVsYXRvciIsImRldmljZSIsImJhc2U2NERhdGEiLCJidWZmZXIiLCJCdWZmZXIiLCJmcm9tIiwiZHN0UGF0aCIsImFwcEJ1bmRsZSIsInNpbWN0bCIsImdldEFwcENvbnRhaW5lciIsImluZm8iLCJmcyIsImV4aXN0cyIsIm1rZGlycCIsIndyaXRlRmlsZSIsImRzdEZvbGRlciIsInRlbXBEaXIiLCJvcGVuRGlyIiwiYmFzZW5hbWUiLCJhZGRNZWRpYSIsInJpbXJhZiIsInB1c2hGaWxlVG9SZWFsRGV2aWNlIiwicHVzaEZpbGUiLCJlIiwic3RhY2siLCJtZXNzYWdlIiwiY2xvc2UiLCJkZWxldGVGaWxlT3JGb2xkZXIiLCJpc1NpbXVsYXRvciIsImRlbGV0ZUZyb21TaW11bGF0b3IiLCJkZWxldGVGcm9tUmVhbERldmljZSIsInB1bGxGcm9tU2ltdWxhdG9yIiwiaXNGaWxlIiwicGF0aE9uU2VydmVyIiwic2ltUm9vdCIsImdldERpciIsImVycm9yQW5kVGhyb3ciLCJ1dGlsIiwidG9Jbk1lbW9yeUJhc2U2NCIsInppcCIsInRvSW5NZW1vcnlaaXAiLCJlbmNvZGVUb0Jhc2U2NCIsInRvU3RyaW5nIiwicHVsbEZyb21SZWFsRGV2aWNlIiwiZmlsZUluZm8iLCJnZXRGaWxlSW5mbyIsImlzRGlyZWN0b3J5IiwicHVsbEZpbGUiLCJwdWxsRm9sZGVyIiwiZXJyb3JzIiwiSW52YWxpZEFyZ3VtZW50RXJyb3IiLCJkZWxldGVEaXJlY3RvcnkiLCJpbmNsdWRlcyIsImVuZHNXaXRoIiwiaXNBcnJheSIsIm9wdHMiLCJtb2JpbGVEZWxldGVGb2xkZXIiLCJtb2JpbGVEZWxldGVGaWxlIl0sInNvdXJjZVJvb3QiOiIuLi8uLi8uLiIsInNvdXJjZXMiOlsibGliL2NvbW1hbmRzL2ZpbGUtbW92ZW1lbnQuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCB7IGZzLCB0ZW1wRGlyLCBta2RpcnAsIHppcCwgdXRpbCB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBsb2cgZnJvbSAnLi4vbG9nZ2VyJztcbmltcG9ydCB7IHNlcnZpY2VzIH0gZnJvbSAnYXBwaXVtLWlvcy1kZXZpY2UnO1xuaW1wb3J0IHsgcHVsbEZpbGUsIHB1bGxGb2xkZXIsIHB1c2hGaWxlIH0gZnJvbSAnLi4vaW9zLWZzLWhlbHBlcnMnO1xuaW1wb3J0IHsgZXJyb3JzIH0gZnJvbSAnQGFwcGl1bS9iYXNlLWRyaXZlcic7XG5cbmNvbnN0IENPTlRBSU5FUl9QQVRIX01BUktFUiA9ICdAJztcbi8vIGh0dHBzOi8vcmVnZXgxMDEuY29tL3IvUExkQjBHLzJcbmNvbnN0IENPTlRBSU5FUl9QQVRIX1BBVFRFUk4gPSBuZXcgUmVnRXhwKGBeJHtDT05UQUlORVJfUEFUSF9NQVJLRVJ9KFteL10rKS8oLiopYCk7XG5jb25zdCBDT05UQUlORVJfVFlQRV9TRVBBUkFUT1IgPSAnOic7XG5jb25zdCBDT05UQUlORVJfRE9DVU1FTlRTX1BBVEggPSAnRG9jdW1lbnRzJztcbmNvbnN0IE9CSkVDVF9OT1RfRk9VTkRfRVJST1JfTUVTU0FHRSA9ICdPQkpFQ1RfTk9UX0ZPVU5EJztcblxuY29uc3QgY29tbWFuZHMgPSB7fTtcblxuZnVuY3Rpb24gdmVyaWZ5SXNTdWJQYXRoIChvcmlnaW5hbFBhdGgsIHJvb3QpIHtcbiAgY29uc3Qgbm9ybWFsaXplZFJvb3QgPSBwYXRoLm5vcm1hbGl6ZShyb290KTtcbiAgY29uc3Qgbm9ybWFsaXplZFBhdGggPSBwYXRoLm5vcm1hbGl6ZShwYXRoLmRpcm5hbWUob3JpZ2luYWxQYXRoKSk7XG4gIC8vIElmIG9yaWdpbmFsUGF0aCBpcyByb290LCBgL2AsIG9yaWdpbmFsUGF0aCBzaG91bGQgZXF1YWwgdG8gbm9ybWFsaXplZFJvb3RcbiAgaWYgKG5vcm1hbGl6ZWRSb290ICE9PSBvcmlnaW5hbFBhdGggJiYgIW5vcm1hbGl6ZWRQYXRoLnN0YXJ0c1dpdGgobm9ybWFsaXplZFJvb3QpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAnJHtub3JtYWxpemVkUGF0aH0nIGlzIGV4cGVjdGVkIHRvIGJlIGEgc3VicGF0aCBvZiAnJHtub3JtYWxpemVkUm9vdH0nYCk7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlQWZjQ2xpZW50ICh1ZGlkLCBidW5kbGVJZCwgY29udGFpbmVyVHlwZSkge1xuICBpZiAoIWJ1bmRsZUlkKSB7XG4gICAgcmV0dXJuIGF3YWl0IHNlcnZpY2VzLnN0YXJ0QWZjU2VydmljZSh1ZGlkKTtcbiAgfVxuICBjb25zdCBzZXJ2aWNlID0gYXdhaXQgc2VydmljZXMuc3RhcnRIb3VzZUFycmVzdFNlcnZpY2UodWRpZCk7XG4gIHJldHVybiBpc0RvY3VtZW50c0NvbnRhaW5lcihjb250YWluZXJUeXBlKVxuICAgID8gYXdhaXQgc2VydmljZS52ZW5kRG9jdW1lbnRzKGJ1bmRsZUlkKVxuICAgIDogYXdhaXQgc2VydmljZS52ZW5kQ29udGFpbmVyKGJ1bmRsZUlkKTtcbn1cblxuZnVuY3Rpb24gaXNEb2N1bWVudHNDb250YWluZXIgKGNvbnRhaW5lclR5cGUpIHtcbiAgcmV0dXJuIF8udG9Mb3dlcihjb250YWluZXJUeXBlKSA9PT0gXy50b0xvd2VyKENPTlRBSU5FUl9ET0NVTUVOVFNfUEFUSCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVNlcnZpY2UgKHVkaWQsIHJlbW90ZVBhdGgpIHtcbiAgaWYgKENPTlRBSU5FUl9QQVRIX1BBVFRFUk4udGVzdChyZW1vdGVQYXRoKSkge1xuICAgIGNvbnN0IHtidW5kbGVJZCwgcGF0aEluQ29udGFpbmVyLCBjb250YWluZXJUeXBlfSA9IGF3YWl0IHBhcnNlQ29udGFpbmVyUGF0aChyZW1vdGVQYXRoKTtcbiAgICBjb25zdCBzZXJ2aWNlID0gYXdhaXQgY3JlYXRlQWZjQ2xpZW50KHVkaWQsIGJ1bmRsZUlkLCBjb250YWluZXJUeXBlKTtcbiAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBpc0RvY3VtZW50c0NvbnRhaW5lcihjb250YWluZXJUeXBlKVxuICAgICAgPyBwYXRoLmpvaW4oQ09OVEFJTkVSX0RPQ1VNRU5UU19QQVRILCBwYXRoSW5Db250YWluZXIpXG4gICAgICA6IHBhdGhJbkNvbnRhaW5lcjtcbiAgICByZXR1cm4ge3NlcnZpY2UsIHJlbGF0aXZlUGF0aH07XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgc2VydmljZSA9IGF3YWl0IGNyZWF0ZUFmY0NsaWVudCh1ZGlkKTtcbiAgICByZXR1cm4ge3NlcnZpY2UsIHJlbGF0aXZlUGF0aDogcmVtb3RlUGF0aH07XG4gIH1cbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBDb250YWluZXJPYmplY3RcbiAqXG4gKiBAcHJvcGVydHkge3N0cmluZ30gYnVuZGxlSWQgLSBUaGUgcGFyc2VkIGJ1bmRsZSBpZGVudGlmaWVyXG4gKiBAcHJvcGVydHkge3N0cmluZ30gcGF0aEluQ29udGFpbmVyIC0gVGhlIGFic29sdXRlIGZ1bGwgcGF0aCBvZiB0aGUgaXRlbSBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW1cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gY29udGFpbmVyVHlwZSAtIFRoZSBjb250YWluZXIgdHlwZVxuICovXG5cbi8qKlxuICogUGFyc2VzIHRoZSBhY3R1YWwgcGF0aCBhbmQgdGhlIGJ1bmRsZSBpZGVudGlmaWVyIGZyb20gdGhlIGdpdmVuIHBhdGggc3RyaW5nXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHJlbW90ZVBhdGggLSBUaGUgZ2l2ZW4gcGF0aCBzdHJpbmcuIFRoZSBzdHJpbmcgc2hvdWxkXG4gKiBtYXRjaCBgQ09OVEFJTkVSX1BBVEhfUEFUVEVSTmAgcmVnZXhwLCBvdGhlcndpc2UgYW4gZXJyb3IgaXMgZ29pbmdcbiAqIHRvIGJlIHRocm93bi4gQSB2YWxpZCBzdHJpbmcgZXhhbXBsZTogYEBidW5kbGUuaWRlbnRpZmllcjpjb250YWluZXJfdHlwZS9yZWxhdGl2ZV9wYXRoX2luX2NvbnRhaW5lcmBcbiAqIEBwYXJhbSB7RnVuY3Rpb258c3RyaW5nfSBjb250YWluZXJSb290U3VwcGxpZXIgLSBFaXRoZXIgYSBzdHJpbmcsIHRoYXQgY29udGFpbnNcbiAqIGZ1bGwgcGF0aCB0byB0aGUgbW91bnQgcm9vdCBmb3IgcmVhbCBkZXZpY2VzIG9yIGEgZnVuY3Rpb24sIHdoaWNoIGFjY2VwdHMgdHdvIHBhcmFtZXRlcnNcbiAqIChidW5kbGUgaWRlbnRpZmllciBhbmQgb3B0aW9uYWwgY29udGFpbmVyIHR5cGUpIGFuZCByZXR1cm5zIGZ1bGwgcGF0aCB0byBjb250YWluZXJcbiAqIHJvb3QgZm9sZGVyIG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbSwgZm9yIFNpbXVsYXRvclxuICogQHJldHVybnMge0NvbnRhaW5lck9iamVjdH1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gcGFyc2VDb250YWluZXJQYXRoIChyZW1vdGVQYXRoLCBjb250YWluZXJSb290U3VwcGxpZXIpIHtcbiAgY29uc3QgbWF0Y2ggPSBDT05UQUlORVJfUEFUSF9QQVRURVJOLmV4ZWMocmVtb3RlUGF0aCk7XG4gIGlmICghbWF0Y2gpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEl0IGlzIGV4cGVjdGVkIHRoYXQgcGFja2FnZSBpZGVudGlmaWVyIGAgK1xuICAgICAgYHN0YXJ0cyB3aXRoICcke0NPTlRBSU5FUl9QQVRIX01BUktFUn0nIGFuZCBpcyBzZXBhcmF0ZWQgZnJvbSB0aGUgYCArXG4gICAgICBgcmVsYXRpdmUgcGF0aCB3aXRoIGEgc2luZ2xlIHNsYXNoLiAnJHtyZW1vdGVQYXRofScgaXMgZ2l2ZW4gaW5zdGVhZGApO1xuICB9XG4gIGxldCBbLCBidW5kbGVJZCwgcmVsYXRpdmVQYXRoXSA9IG1hdGNoO1xuICBsZXQgY29udGFpbmVyVHlwZSA9IG51bGw7XG4gIGNvbnN0IHR5cGVTZXBhcmF0b3JQb3MgPSBidW5kbGVJZC5pbmRleE9mKENPTlRBSU5FUl9UWVBFX1NFUEFSQVRPUik7XG4gIC8vIFdlIG9ubHkgY29uc2lkZXIgY29udGFpbmVyIHR5cGUgZXhpc3RzIGlmIGl0cyBsZW5ndGggaXMgZ3JlYXRlciB0aGFuIHplcm9cbiAgLy8gbm90IGNvdW50aW5nIHRoZSBjb2xvblxuICBpZiAodHlwZVNlcGFyYXRvclBvcyA+IDAgJiYgdHlwZVNlcGFyYXRvclBvcyA8IGJ1bmRsZUlkLmxlbmd0aCAtIDEpIHtcbiAgICBjb250YWluZXJUeXBlID0gYnVuZGxlSWQuc3Vic3RyaW5nKHR5cGVTZXBhcmF0b3JQb3MgKyAxKTtcbiAgICBsb2cuZGVidWcoYFBhcnNlZCBjb250YWluZXIgdHlwZTogJHtjb250YWluZXJUeXBlfWApO1xuICAgIGJ1bmRsZUlkID0gYnVuZGxlSWQuc3Vic3RyaW5nKDAsIHR5cGVTZXBhcmF0b3JQb3MpO1xuICB9XG4gIGlmIChfLmlzTmlsKGNvbnRhaW5lclJvb3RTdXBwbGllcikpIHtcbiAgICBjb25zdCBwYXRoSW5Db250YWluZXIgPSByZWxhdGl2ZVBhdGg7XG4gICAgcmV0dXJuIHsgYnVuZGxlSWQsIHBhdGhJbkNvbnRhaW5lciwgY29udGFpbmVyVHlwZSB9O1xuICB9XG4gIGNvbnN0IGNvbnRhaW5lclJvb3QgPSBfLmlzRnVuY3Rpb24oY29udGFpbmVyUm9vdFN1cHBsaWVyKVxuICAgID8gYXdhaXQgY29udGFpbmVyUm9vdFN1cHBsaWVyKGJ1bmRsZUlkLCBjb250YWluZXJUeXBlKVxuICAgIDogY29udGFpbmVyUm9vdFN1cHBsaWVyO1xuICBjb25zdCBwYXRoSW5Db250YWluZXIgPSBwYXRoLnBvc2l4LnJlc29sdmUoY29udGFpbmVyUm9vdCwgcmVsYXRpdmVQYXRoKTtcbiAgdmVyaWZ5SXNTdWJQYXRoKHBhdGhJbkNvbnRhaW5lciwgY29udGFpbmVyUm9vdCk7XG4gIHJldHVybiB7YnVuZGxlSWQsIHBhdGhJbkNvbnRhaW5lciwgY29udGFpbmVyVHlwZX07XG59XG5cbi8qKlxuICogU2F2ZSB0aGUgZ2l2ZW4gYmFzZTY0IGRhdGEgY2h1bmsgYXMgYSBiaW5hcnkgZmlsZSBvbiB0aGUgU2ltdWxhdG9yIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGRldmljZSAtIFRoZSBkZXZpY2Ugb2JqZWN0LCB3aGljaCByZXByZXNlbnRzIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIG9iamVjdCBpcyBleHBlY3RlZCB0byBoYXZlIHRoZSBgdWRpZGAgcHJvcGVydHkgY29udGFpbmluZyB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCBkZXZpY2UgSUQuXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVtb3RlUGF0aCAtIFRoZSByZW1vdGUgcGF0aCBvbiB0aGUgZGV2aWNlLiBUaGlzIHZhcmlhYmxlIGNhbiBiZSBwcmVmaXhlZCB3aXRoXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1bmRsZSBpZCwgc28gdGhlbiB0aGUgZmlsZSB3aWxsIGJlIHVwbG9hZGVkIHRvIHRoZSBjb3JyZXNwb25kaW5nXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9uIGNvbnRhaW5lciBpbnN0ZWFkIG9mIHRoZSBkZWZhdWx0IG1lZGlhIGZvbGRlciwgZm9yIGV4YW1wbGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0Bjb20ubXlhcHAuYmxhOmRhdGEvUmVsYXRpdmVQYXRoSW5Db250YWluZXIvMTExLnBuZycuIFRoZSAnQCcgY2hhcmFjdGVyIGF0IHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWdpbm5pbmcgb2YgdGhlIGFyZ3VtZW50IGlzIG1hbmRhdG9yeSBpbiBzdWNoIGNhc2UuIFRoZSBjb2xvbiBhdCB0aGUgZW5kIG9mIGJ1bmRsZSBpZGVudGlmaWVyXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzIG9wdGlvbmFsIGFuZCBpcyB1c2VkIHRvIGRpc3Rpbmd1aXNoIHRoZSBjb250YWluZXIgdHlwZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zc2libGUgdmFsdWVzIHRoZXJlIGFyZSAnYXBwJywgJ2RhdGEnLCAnZ3JvdXBzJywgJzxBIHNwZWNpZmljIEFwcCBHcm91cCBjb250YWluZXI+Jy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhlIGRlZmF1bHQgdmFsdWUgaXMgJ2FwcCcuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSByZWxhdGl2ZSBmb2xkZXIgcGF0aCBpcyBpZ25vcmVkIGlmIHRoZSBmaWxlIGlzIGdvaW5nIHRvIGJlIHVwbG9hZGVkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIHRoZSBkZWZhdWx0IG1lZGlhIGZvbGRlciBhbmQgb25seSB0aGUgZmlsZSBuYW1lIGlzIGNvbnNpZGVyZWQgaW1wb3J0YW50LlxuICogQHBhcmFtIHtzdHJpbmd9IGJhc2U2NERhdGEgLSBCYXNlLTY0IGVuY29kZWQgY29udGVudCBvZiB0aGUgZmlsZSB0byBiZSB1cGxvYWRlZC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHVzaEZpbGVUb1NpbXVsYXRvciAoZGV2aWNlLCByZW1vdGVQYXRoLCBiYXNlNjREYXRhKSB7XG4gIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJhc2U2NERhdGEsICdiYXNlNjQnKTtcbiAgaWYgKENPTlRBSU5FUl9QQVRIX1BBVFRFUk4udGVzdChyZW1vdGVQYXRoKSkge1xuICAgIGNvbnN0IHtidW5kbGVJZCwgcGF0aEluQ29udGFpbmVyOiBkc3RQYXRofSA9IGF3YWl0IHBhcnNlQ29udGFpbmVyUGF0aChyZW1vdGVQYXRoLFxuICAgICAgYXN5bmMgKGFwcEJ1bmRsZSwgY29udGFpbmVyVHlwZSkgPT4gYXdhaXQgZGV2aWNlLnNpbWN0bC5nZXRBcHBDb250YWluZXIoYXBwQnVuZGxlLCBjb250YWluZXJUeXBlKSk7XG4gICAgbG9nLmluZm8oYFBhcnNlZCBidW5kbGUgaWRlbnRpZmllciAnJHtidW5kbGVJZH0nIGZyb20gJyR7cmVtb3RlUGF0aH0nLiBgICtcbiAgICAgIGBXaWxsIHB1dCB0aGUgZGF0YSBpbnRvICcke2RzdFBhdGh9J2ApO1xuICAgIGlmICghYXdhaXQgZnMuZXhpc3RzKHBhdGguZGlybmFtZShkc3RQYXRoKSkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhgVGhlIGRlc3RpbmF0aW9uIGZvbGRlciAnJHtwYXRoLmRpcm5hbWUoZHN0UGF0aCl9JyBkb2VzIG5vdCBleGlzdC4gQ3JlYXRpbmcuLi5gKTtcbiAgICAgIGF3YWl0IG1rZGlycChwYXRoLmRpcm5hbWUoZHN0UGF0aCkpO1xuICAgIH1cbiAgICBhd2FpdCBmcy53cml0ZUZpbGUoZHN0UGF0aCwgYnVmZmVyKTtcbiAgICByZXR1cm47XG4gIH1cbiAgY29uc3QgZHN0Rm9sZGVyID0gYXdhaXQgdGVtcERpci5vcGVuRGlyKCk7XG4gIGNvbnN0IGRzdFBhdGggPSBwYXRoLnJlc29sdmUoZHN0Rm9sZGVyLCBwYXRoLmJhc2VuYW1lKHJlbW90ZVBhdGgpKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUoZHN0UGF0aCwgYnVmZmVyKTtcbiAgICBhd2FpdCBkZXZpY2Uuc2ltY3RsLmFkZE1lZGlhKGRzdFBhdGgpO1xuICB9IGZpbmFsbHkge1xuICAgIGF3YWl0IGZzLnJpbXJhZihkc3RGb2xkZXIpO1xuICB9XG59XG5cbi8qKlxuICogU2F2ZSB0aGUgZ2l2ZW4gYmFzZTY0IGRhdGEgY2h1bmsgYXMgYSBiaW5hcnkgZmlsZSBvbiB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGRldmljZSAtIFRoZSBkZXZpY2Ugb2JqZWN0LCB3aGljaCByZXByZXNlbnRzIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIG9iamVjdCBpcyBleHBlY3RlZCB0byBoYXZlIHRoZSBgdWRpZGAgcHJvcGVydHkgY29udGFpbmluZyB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCBkZXZpY2UgSUQuXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVtb3RlUGF0aCAtIFRoZSByZW1vdGUgcGF0aCBvbiB0aGUgZGV2aWNlLiBUaGlzIHZhcmlhYmxlIGNhbiBiZSBwcmVmaXhlZCB3aXRoXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1bmRsZSBpZCwgc28gdGhlbiB0aGUgZmlsZSB3aWxsIGJlIHVwbG9hZGVkIHRvIHRoZSBjb3JyZXNwb25kaW5nXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGxpY2F0aW9uIGNvbnRhaW5lciBpbnN0ZWFkIG9mIHRoZSBkZWZhdWx0IG1lZGlhIGZvbGRlci4gVXNlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEA8YXBwX2J1bmRsZV9pZD46PG9wdGlvbmFsX2NvbnRhaW5lcl90eXBlPi88cGF0aF90b190aGVfZmlsZV9vcl9mb2xkZXJfaW5zaWRlX2NvbnRhaW5lcj5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0IHRvIHB1bGwgYSBmaWxlIG9yIGEgZm9sZGVyIGZyb20gYW4gYXBwbGljYXRpb24gY29udGFpbmVyIG9mIHRoZSBnaXZlbiB0eXBlLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaGUgb25seSBzdXBwb3J0ZWQgY29udGFpbmVyIHR5cGUgaXMgJ2RvY3VtZW50cycuIElmIHRoZSBjb250YWluZXIgdHlwZSBpcyBub3Qgc2V0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGxpY2l0bHkgZm9yIGEgYnVuZGxlIGlkLCB0aGVuIHRoZSBkZWZhdWx0IGFwcGxpY2F0aW9uIGNvbnRhaW5lciBpcyBnb2luZyB0byBiZSBtb3VudGVkXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChha2EgLS1jb250YWluZXIgaWZ1c2UgYXJndW1lbnQpXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuZy4gSWYgYEBjb20ubXlhcHAuYmxhOmRvY3VtZW50cy8xMTEucG5nYCBpcyBwcm92aWRlZCxcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgT24gTXkgaVBob25lLzxhcHAgbmFtZT5gIGluIEZpbGVzIGFwcCB3aWxsIGJlIG1vdW50ZWQgaW4gdGhlIGhvc3QgbWFjaGluZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCYXNlNjQgZW5jb2RlZCBgMTExLnBuZ2Agd2lsbCBiZSBwdXNoZWQgaW50byBgT24gTXkgaVBob25lLzxhcHAgbmFtZT4vMTExLnBuZ2BcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcyBiYXNlNjQgZGVjb2RlZCBkYXRhLlxuICogQHBhcmFtIHtzdHJpbmd9IGJhc2U2NERhdGEgLSBCYXNlLTY0IGVuY29kZWQgY29udGVudCBvZiB0aGUgZmlsZSB0byBiZSB1cGxvYWRlZC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHVzaEZpbGVUb1JlYWxEZXZpY2UgKGRldmljZSwgcmVtb3RlUGF0aCwgYmFzZTY0RGF0YSkge1xuICBjb25zdCB7c2VydmljZSwgcmVsYXRpdmVQYXRofSA9IGF3YWl0IGNyZWF0ZVNlcnZpY2UoZGV2aWNlLnVkaWQsIHJlbW90ZVBhdGgpO1xuICB0cnkge1xuICAgIGF3YWl0IHB1c2hGaWxlKHNlcnZpY2UsIHJlbGF0aXZlUGF0aCwgYmFzZTY0RGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2cuZGVidWcoZS5zdGFjayk7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgcHVzaCB0aGUgZmlsZSB0byAnJHtyZW1vdGVQYXRofScuICBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gIH0gZmluYWxseSB7XG4gICAgc2VydmljZS5jbG9zZSgpO1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUZpbGVPckZvbGRlciAoZGV2aWNlLCByZW1vdGVQYXRoLCBpc1NpbXVsYXRvcikge1xuICByZXR1cm4gaXNTaW11bGF0b3JcbiAgICA/IGF3YWl0IGRlbGV0ZUZyb21TaW11bGF0b3IoZGV2aWNlLCByZW1vdGVQYXRoKVxuICAgIDogYXdhaXQgZGVsZXRlRnJvbVJlYWxEZXZpY2UoZGV2aWNlLCByZW1vdGVQYXRoKTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGNvbnRlbnQgb2YgZ2l2ZW4gZmlsZSBvciBmb2xkZXIgZnJvbSBpT1MgU2ltdWxhdG9yIGFuZCByZXR1cm4gaXQgYXMgYmFzZS02NCBlbmNvZGVkIHN0cmluZy5cbiAqIEZvbGRlciBjb250ZW50IGlzIHJlY3Vyc2l2ZWx5IHBhY2tlZCBpbnRvIGEgemlwIGFyY2hpdmUuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGRldmljZSAtIFRoZSBkZXZpY2Ugb2JqZWN0LCB3aGljaCByZXByZXNlbnRzIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIG9iamVjdCBpcyBleHBlY3RlZCB0byBoYXZlIHRoZSBgdWRpZGAgcHJvcGVydHkgY29udGFpbmluZyB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCBkZXZpY2UgSUQuXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVtb3RlUGF0aCAtIFRoZSBwYXRoIHRvIGEgZmlsZSBvciBhIGZvbGRlciwgd2hpY2ggZXhpc3RzIGluIHRoZSBjb3JyZXNwb25kaW5nIGFwcGxpY2F0aW9uXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lciBvbiBTaW11bGF0b3IuIFVzZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAPGFwcF9idW5kbGVfaWQ+OjxvcHRpb25hbF9jb250YWluZXJfdHlwZT4vPHBhdGhfdG9fdGhlX2ZpbGVfb3JfZm9sZGVyX2luc2lkZV9jb250YWluZXI+XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdCB0byBwdWxsIGEgZmlsZSBvciBhIGZvbGRlciBmcm9tIGFuIGFwcGxpY2F0aW9uIGNvbnRhaW5lciBvZiB0aGUgZ2l2ZW4gdHlwZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zc2libGUgY29udGFpbmVyIHR5cGVzIGFyZSAnYXBwJywgJ2RhdGEnLCAnZ3JvdXBzJywgJzxBIHNwZWNpZmljIEFwcCBHcm91cCBjb250YWluZXI+Jy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhlIGRlZmF1bHQgdHlwZSBpcyAnYXBwJy5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNGaWxlIC0gV2hldGhlciB0aGUgZGVzdGluYXRpb24gaXRlbSBpcyBhIGZpbGUgb3IgYSBmb2xkZXJcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEJhc2UtNjQgZW5jb2RlZCBjb250ZW50IG9mIHRoZSBmaWxlLlxuICovXG5hc3luYyBmdW5jdGlvbiBwdWxsRnJvbVNpbXVsYXRvciAoZGV2aWNlLCByZW1vdGVQYXRoLCBpc0ZpbGUpIHtcbiAgbGV0IHBhdGhPblNlcnZlcjtcbiAgaWYgKENPTlRBSU5FUl9QQVRIX1BBVFRFUk4udGVzdChyZW1vdGVQYXRoKSkge1xuICAgIGNvbnN0IHtidW5kbGVJZCwgcGF0aEluQ29udGFpbmVyOiBkc3RQYXRofSA9IGF3YWl0IHBhcnNlQ29udGFpbmVyUGF0aChyZW1vdGVQYXRoLFxuICAgICAgYXN5bmMgKGFwcEJ1bmRsZSwgY29udGFpbmVyVHlwZSkgPT4gYXdhaXQgZGV2aWNlLnNpbWN0bC5nZXRBcHBDb250YWluZXIoYXBwQnVuZGxlLCBjb250YWluZXJUeXBlKSk7XG4gICAgbG9nLmluZm8oYFBhcnNlZCBidW5kbGUgaWRlbnRpZmllciAnJHtidW5kbGVJZH0nIGZyb20gJyR7cmVtb3RlUGF0aH0nLiBgICtcbiAgICAgIGBXaWxsIGdldCB0aGUgZGF0YSBmcm9tICcke2RzdFBhdGh9J2ApO1xuICAgIHBhdGhPblNlcnZlciA9IGRzdFBhdGg7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgc2ltUm9vdCA9IGRldmljZS5nZXREaXIoKTtcbiAgICBwYXRoT25TZXJ2ZXIgPSBwYXRoLnBvc2l4LmpvaW4oc2ltUm9vdCwgcmVtb3RlUGF0aCk7XG4gICAgdmVyaWZ5SXNTdWJQYXRoKHBhdGhPblNlcnZlciwgc2ltUm9vdCk7XG4gICAgbG9nLmluZm8oYEdvdCB0aGUgZnVsbCBpdGVtIHBhdGg6ICR7cGF0aE9uU2VydmVyfWApO1xuICB9XG4gIGlmICghYXdhaXQgZnMuZXhpc3RzKHBhdGhPblNlcnZlcikpIHtcbiAgICBsb2cuZXJyb3JBbmRUaHJvdyhgVGhlIHJlbW90ZSAke2lzRmlsZSA/ICdmaWxlJyA6ICdmb2xkZXInfSBhdCAnJHtwYXRoT25TZXJ2ZXJ9JyBkb2VzIG5vdCBleGlzdGApO1xuICB9XG4gIGNvbnN0IGJ1ZmZlciA9IGlzRmlsZVxuICAgID8gYXdhaXQgdXRpbC50b0luTWVtb3J5QmFzZTY0KHBhdGhPblNlcnZlcilcbiAgICA6IGF3YWl0IHppcC50b0luTWVtb3J5WmlwKHBhdGhPblNlcnZlciwge2VuY29kZVRvQmFzZTY0OiB0cnVlfSk7XG4gIHJldHVybiBidWZmZXIudG9TdHJpbmcoKTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGNvbnRlbnQgb2YgZ2l2ZW4gZmlsZSBvciBmb2xkZXIgZnJvbSB0aGUgcmVhbCBkZXZpY2UgdW5kZXIgdGVzdCBhbmQgcmV0dXJuIGl0IGFzIGJhc2UtNjQgZW5jb2RlZCBzdHJpbmcuXG4gKiBGb2xkZXIgY29udGVudCBpcyByZWN1cnNpdmVseSBwYWNrZWQgaW50byBhIHppcCBhcmNoaXZlLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBkZXZpY2UgLSBUaGUgZGV2aWNlIG9iamVjdCwgd2hpY2ggcmVwcmVzZW50cyB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgVGhpcyBvYmplY3QgaXMgZXhwZWN0ZWQgdG8gaGF2ZSB0aGUgYHVkaWRgIHByb3BlcnR5IGNvbnRhaW5pbmcgdGhlXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWQgZGV2aWNlIElELlxuICogQHBhcmFtIHtzdHJpbmd9IHJlbW90ZVBhdGggLSBUaGUgcGF0aCB0byBhbiBleGlzdGluZyByZW1vdGUgZmlsZSBvbiB0aGUgZGV2aWNlLiBUaGlzIHZhcmlhYmxlIGNhbiBiZSBwcmVmaXhlZCB3aXRoXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1bmRsZSBpZCwgc28gdGhlbiB0aGUgZmlsZSB3aWxsIGJlIGRvd25sb2FkZWQgZnJvbSB0aGUgY29ycmVzcG9uZGluZ1xuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBsaWNhdGlvbiBjb250YWluZXIgaW5zdGVhZCBvZiB0aGUgZGVmYXVsdCBtZWRpYSBmb2xkZXIuIFVzZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAPGFwcF9idW5kbGVfaWQ+OjxvcHRpb25hbF9jb250YWluZXJfdHlwZT4vPHBhdGhfdG9fdGhlX2ZpbGVfb3JfZm9sZGVyX2luc2lkZV9jb250YWluZXI+XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdCB0byBwdWxsIGEgZmlsZSBvciBhIGZvbGRlciBmcm9tIGFuIGFwcGxpY2F0aW9uIGNvbnRhaW5lciBvZiB0aGUgZ2l2ZW4gdHlwZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhlIG9ubHkgc3VwcG9ydGVkIGNvbnRhaW5lciB0eXBlIGlzICdkb2N1bWVudHMnLiBJZiB0aGUgY29udGFpbmVyIHR5cGUgaXMgbm90IHNldFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBsaWNpdGx5IGZvciBhIGJ1bmRsZSBpZCwgdGhlbiB0aGUgZGVmYXVsdCBhcHBsaWNhdGlvbiBjb250YWluZXIgaXMgZ29pbmcgdG8gYmUgbW91bnRlZFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYWthIC0tY29udGFpbmVyIGlmdXNlIGFyZ3VtZW50KVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmcuIElmIGBAY29tLm15YXBwLmJsYTpkb2N1bWVudHMvMTExLnBuZ2AgaXMgcHJvdmlkZWQsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYE9uIE15IGlQaG9uZS88YXBwIG5hbWU+YCBpbiBGaWxlcyBhcHAgd2lsbCBiZSBtb3VudGVkIGluIHRoZSBob3N0IG1hY2hpbmUuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYE9uIE15IGlQaG9uZS88YXBwIG5hbWU+LzExMS5wbmdgIHdpbCBiZSBwdWxsZWQgaW50byB0aGUgbW91bnRlZCBob3N0IG1hY2hpbmVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmQgQXBwaXVtIHJldHVybnMgdGhlIGRhdGEgYXMgYmFzZTY0LWVuY29kZWQgc3RyaW5nIHRvIGNsaWVudC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgQGNvbS5teWFwcC5ibGE6ZG9jdW1lbnRzL2AgbWVhbnMgYE9uIE15IGlQaG9uZS88YXBwIG5hbWU+YC5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gaXNGaWxlIC0gV2hldGhlciB0aGUgZGVzdGluYXRpb24gaXRlbSBpcyBhIGZpbGUgb3IgYSBmb2xkZXJcbiAqIEByZXR1cm4ge3N0cmluZ30gQmFzZS02NCBlbmNvZGVkIGNvbnRlbnQgb2YgdGhlIHJlbW90ZSBmaWxlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHB1bGxGcm9tUmVhbERldmljZSAoZGV2aWNlLCByZW1vdGVQYXRoLCBpc0ZpbGUpIHtcbiAgY29uc3Qge3NlcnZpY2UsIHJlbGF0aXZlUGF0aH0gPSBhd2FpdCBjcmVhdGVTZXJ2aWNlKGRldmljZS51ZGlkLCByZW1vdGVQYXRoKTtcbiAgdHJ5IHtcbiAgICBjb25zdCBmaWxlSW5mbyA9IGF3YWl0IHNlcnZpY2UuZ2V0RmlsZUluZm8ocmVsYXRpdmVQYXRoKTtcbiAgICBpZiAoaXNGaWxlICYmIGZpbGVJbmZvLmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHJlcXVlc3RlZCBwYXRoIGlzIG5vdCBhIGZpbGUuIFBhdGg6ICcke3JlbW90ZVBhdGh9J2ApO1xuICAgIH1cbiAgICBpZiAoIWlzRmlsZSAmJiAhZmlsZUluZm8uaXNEaXJlY3RvcnkoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgcmVxdWVzdGVkIHBhdGggaXMgbm90IGEgZm9sZGVyLiBQYXRoOiAnJHtyZW1vdGVQYXRofSdgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmlsZUluZm8uaXNGaWxlKClcbiAgICAgID8gKGF3YWl0IHB1bGxGaWxlKHNlcnZpY2UsIHJlbGF0aXZlUGF0aCkpLnRvU3RyaW5nKCdiYXNlNjQnKVxuICAgICAgOiAoYXdhaXQgcHVsbEZvbGRlcihzZXJ2aWNlLCByZWxhdGl2ZVBhdGgpKS50b1N0cmluZygpO1xuICB9IGZpbmFsbHkge1xuICAgIHNlcnZpY2UuY2xvc2UoKTtcbiAgfVxufVxuXG4vKipcbiAqIFJlbW92ZSB0aGUgZmlsZSBvciBmb2xkZXIgZnJvbSB0aGUgZGV2aWNlXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGRldmljZSAtIFRoZSBkZXZpY2Ugb2JqZWN0LCB3aGljaCByZXByZXNlbnRzIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIG9iamVjdCBpcyBleHBlY3RlZCB0byBoYXZlIHRoZSBgdWRpZGAgcHJvcGVydHkgY29udGFpbmluZyB0aGVcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB2YWxpZCBkZXZpY2UgSUQuXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVtb3RlUGF0aCAtIFRoZSBwYXRoIHRvIGEgZmlsZSBvciBhIGZvbGRlciwgd2hpY2ggZXhpc3RzIGluIHRoZSBjb3JyZXNwb25kaW5nIGFwcGxpY2F0aW9uXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lciBvbiBTaW11bGF0b3IuIFVzZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAPGFwcF9idW5kbGVfaWQ+OjxvcHRpb25hbF9jb250YWluZXJfdHlwZT4vPHBhdGhfdG9fdGhlX2ZpbGVfb3JfZm9sZGVyX2luc2lkZV9jb250YWluZXI+XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdCB0byBwdWxsIGEgZmlsZSBvciBhIGZvbGRlciBmcm9tIGFuIGFwcGxpY2F0aW9uIGNvbnRhaW5lciBvZiB0aGUgZ2l2ZW4gdHlwZS5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zc2libGUgY29udGFpbmVyIHR5cGVzIGFyZSAnYXBwJywgJ2RhdGEnLCAnZ3JvdXBzJywgJzxBIHNwZWNpZmljIEFwcCBHcm91cCBjb250YWluZXI+Jy5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhlIGRlZmF1bHQgdHlwZSBpcyAnYXBwJy5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZGVsZXRlRnJvbVNpbXVsYXRvciAoZGV2aWNlLCByZW1vdGVQYXRoKSB7XG4gIGxldCBwYXRoT25TZXJ2ZXI7XG4gIGlmIChDT05UQUlORVJfUEFUSF9QQVRURVJOLnRlc3QocmVtb3RlUGF0aCkpIHtcbiAgICBjb25zdCB7YnVuZGxlSWQsIHBhdGhJbkNvbnRhaW5lcjogZHN0UGF0aH0gPSBhd2FpdCBwYXJzZUNvbnRhaW5lclBhdGgocmVtb3RlUGF0aCxcbiAgICAgIGFzeW5jIChhcHBCdW5kbGUsIGNvbnRhaW5lclR5cGUpID0+IGF3YWl0IGRldmljZS5zaW1jdGwuZ2V0QXBwQ29udGFpbmVyKGFwcEJ1bmRsZSwgY29udGFpbmVyVHlwZSkpO1xuICAgIGxvZy5pbmZvKGBQYXJzZWQgYnVuZGxlIGlkZW50aWZpZXIgJyR7YnVuZGxlSWR9JyBmcm9tICcke3JlbW90ZVBhdGh9Jy4gYCArXG4gICAgICBgJyR7ZHN0UGF0aH0nIHdpbGwgYmUgZGVsZXRlZGApO1xuICAgIHBhdGhPblNlcnZlciA9IGRzdFBhdGg7XG4gIH0gZWxzZSB7XG4gICAgY29uc3Qgc2ltUm9vdCA9IGRldmljZS5nZXREaXIoKTtcbiAgICBwYXRoT25TZXJ2ZXIgPSBwYXRoLnBvc2l4LmpvaW4oc2ltUm9vdCwgcmVtb3RlUGF0aCk7XG4gICAgdmVyaWZ5SXNTdWJQYXRoKHBhdGhPblNlcnZlciwgc2ltUm9vdCk7XG4gICAgbG9nLmluZm8oYEdvdCB0aGUgZnVsbCBwYXRoOiAke3BhdGhPblNlcnZlcn1gKTtcbiAgfVxuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhwYXRoT25TZXJ2ZXIpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5JbnZhbGlkQXJndW1lbnRFcnJvcihgVGhlIHJlbW90ZSBwYXRoIGF0ICcke3BhdGhPblNlcnZlcn0nIGRvZXMgbm90IGV4aXN0YCk7XG4gIH1cbiAgYXdhaXQgZnMucmltcmFmKHBhdGhPblNlcnZlcik7XG59XG5cbi8qKlxuICogUmVtb3ZlIHRoZSBmaWxlIG9yIGZvbGRlciBmcm9tIHRoZSBkZXZpY2VcbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gZGV2aWNlIC0gVGhlIGRldmljZSBvYmplY3QsIHdoaWNoIHJlcHJlc2VudHMgdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICogICAgICAgICAgICAgICAgICAgICAgICAgIFRoaXMgb2JqZWN0IGlzIGV4cGVjdGVkIHRvIGhhdmUgdGhlIGB1ZGlkYCBwcm9wZXJ0eSBjb250YWluaW5nIHRoZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkIGRldmljZSBJRC5cbiAqIEBwYXJhbSB7c3RyaW5nfSByZW1vdGVQYXRoIC0gVGhlIHBhdGggdG8gYW4gZXhpc3RpbmcgcmVtb3RlIGZpbGUgb24gdGhlIGRldmljZS4gVGhpcyB2YXJpYWJsZSBjYW4gYmUgcHJlZml4ZWQgd2l0aFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidW5kbGUgaWQsIHNvIHRoZW4gdGhlIGZpbGUgd2lsbCBiZSBkb3dubG9hZGVkIGZyb20gdGhlIGNvcnJlc3BvbmRpbmdcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwbGljYXRpb24gY29udGFpbmVyIGluc3RlYWQgb2YgdGhlIGRlZmF1bHQgbWVkaWEgZm9sZGVyLiBVc2VcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQDxhcHBfYnVuZGxlX2lkPjo8b3B0aW9uYWxfY29udGFpbmVyX3R5cGU+LzxwYXRoX3RvX3RoZV9maWxlX29yX2ZvbGRlcl9pbnNpZGVfY29udGFpbmVyPlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQgdG8gcHVsbCBhIGZpbGUgb3IgYSBmb2xkZXIgZnJvbSBhbiBhcHBsaWNhdGlvbiBjb250YWluZXIgb2YgdGhlIGdpdmVuIHR5cGUuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBvbmx5IHN1cHBvcnRlZCBjb250YWluZXIgdHlwZSBpcyAnZG9jdW1lbnRzJy4gSWYgdGhlIGNvbnRhaW5lciB0eXBlIGlzIG5vdCBzZXRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwbGljaXRseSBmb3IgYSBidW5kbGUgaWQsIHRoZW4gdGhlIGRlZmF1bHQgYXBwbGljYXRpb24gY29udGFpbmVyIGlzIGdvaW5nIHRvIGJlIG1vdW50ZWRcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFrYSAtLWNvbnRhaW5lciBpZnVzZSBhcmd1bWVudClcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5nLiBJZiBgQGNvbS5teWFwcC5ibGE6ZG9jdW1lbnRzLzExMS5wbmdgIGlzIHByb3ZpZGVkLFxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBPbiBNeSBpUGhvbmUvPGFwcCBuYW1lPmAgaW4gRmlsZXMgYXBwIHdpbGwgYmUgbW91bnRlZCBpbiB0aGUgaG9zdCBtYWNoaW5lLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBPbiBNeSBpUGhvbmUvPGFwcCBuYW1lPi8xMTEucG5nYCB3aWwgYmUgcHVsbGVkIGludG8gdGhlIG1vdW50ZWQgaG9zdCBtYWNoaW5lXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5kIEFwcGl1bSByZXR1cm5zIHRoZSBkYXRhIGFzIGJhc2U2NC1lbmNvZGVkIHN0cmluZyB0byBjbGllbnQuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYEBjb20ubXlhcHAuYmxhOmRvY3VtZW50cy9gIG1lYW5zIGBPbiBNeSBpUGhvbmUvPGFwcCBuYW1lPmAuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUZyb21SZWFsRGV2aWNlIChkZXZpY2UsIHJlbW90ZVBhdGgpIHtcbiAgY29uc3QgeyBzZXJ2aWNlLCByZWxhdGl2ZVBhdGggfSA9IGF3YWl0IGNyZWF0ZVNlcnZpY2UoZGV2aWNlLnVkaWQsIHJlbW90ZVBhdGgpO1xuICB0cnkge1xuICAgIGF3YWl0IHNlcnZpY2UuZGVsZXRlRGlyZWN0b3J5KHJlbGF0aXZlUGF0aCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZS5tZXNzYWdlLmluY2x1ZGVzKE9CSkVDVF9OT1RfRk9VTkRfRVJST1JfTUVTU0FHRSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgUGF0aCAnJHtyZW1vdGVQYXRofScgZG9lcyBub3QgZXhpc3Qgb24gdGhlIGRldmljZWApO1xuICAgIH1cbiAgICB0aHJvdyBlO1xuICB9IGZpbmFsbHkge1xuICAgIHNlcnZpY2UuY2xvc2UoKTtcbiAgfVxufVxuXG5jb21tYW5kcy5wdXNoRmlsZSA9IGFzeW5jIGZ1bmN0aW9uIHB1c2hGaWxlIChyZW1vdGVQYXRoLCBiYXNlNjREYXRhKSB7XG4gIGlmIChyZW1vdGVQYXRoLmVuZHNXaXRoKCcvJykpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKGBJdCBpcyBleHBlY3RlZCB0aGF0IHJlbW90ZSBwYXRoIHBvaW50cyB0byBhIGZpbGUgYW5kIG5vdCB0byBhIGZvbGRlci4gYCArXG4gICAgICBgJyR7cmVtb3RlUGF0aH0nIGlzIGdpdmVuIGluc3RlYWRgKTtcbiAgfVxuICBpZiAoXy5pc0FycmF5KGJhc2U2NERhdGEpKSB7XG4gICAgLy8gc29tZSBjbGllbnRzIChhaGVtKSBqYXZhLCBzZW5kIGEgYnl0ZSBhcnJheSBlbmNvZGluZyB1dGY4IGNoYXJhY3RlcnNcbiAgICAvLyBpbnN0ZWFkIG9mIGEgc3RyaW5nLCB3aGljaCB3b3VsZCBiZSBpbmZpbml0ZWx5IGJldHRlciFcbiAgICBiYXNlNjREYXRhID0gQnVmZmVyLmZyb20oYmFzZTY0RGF0YSkudG9TdHJpbmcoJ3V0ZjgnKTtcbiAgfVxuICByZXR1cm4gdGhpcy5pc1NpbXVsYXRvcigpXG4gICAgPyBhd2FpdCBwdXNoRmlsZVRvU2ltdWxhdG9yKHRoaXMub3B0cy5kZXZpY2UsIHJlbW90ZVBhdGgsIGJhc2U2NERhdGEpXG4gICAgOiBhd2FpdCBwdXNoRmlsZVRvUmVhbERldmljZSh0aGlzLm9wdHMuZGV2aWNlLCByZW1vdGVQYXRoLCBiYXNlNjREYXRhKTtcbn07XG5cbmNvbW1hbmRzLnB1bGxGaWxlID0gYXN5bmMgZnVuY3Rpb24gcHVsbEZpbGUgKHJlbW90ZVBhdGgpIHtcbiAgaWYgKHJlbW90ZVBhdGguZW5kc1dpdGgoJy8nKSkge1xuICAgIHRocm93IG5ldyBlcnJvcnMuSW52YWxpZEFyZ3VtZW50RXJyb3IoYEl0IGlzIGV4cGVjdGVkIHRoYXQgcmVtb3RlIHBhdGggcG9pbnRzIHRvIGEgZmlsZSBhbmQgbm90IHRvIGEgZm9sZGVyLiBgICtcbiAgICAgIGAnJHtyZW1vdGVQYXRofScgaXMgZ2l2ZW4gaW5zdGVhZGApO1xuICB9XG4gIHJldHVybiB0aGlzLmlzU2ltdWxhdG9yKClcbiAgICA/IGF3YWl0IHB1bGxGcm9tU2ltdWxhdG9yKHRoaXMub3B0cy5kZXZpY2UsIHJlbW90ZVBhdGgsIHRydWUpXG4gICAgOiBhd2FpdCBwdWxsRnJvbVJlYWxEZXZpY2UodGhpcy5vcHRzLmRldmljZSwgcmVtb3RlUGF0aCwgdHJ1ZSk7XG59O1xuXG5jb21tYW5kcy5tb2JpbGVEZWxldGVGb2xkZXIgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVEZWxldGVGb2xkZXIgKG9wdHMgPSB7fSkge1xuICBsZXQge3JlbW90ZVBhdGh9ID0gb3B0cztcbiAgaWYgKCFyZW1vdGVQYXRoLmVuZHNXaXRoKCcvJykpIHtcbiAgICByZW1vdGVQYXRoID0gYCR7cmVtb3RlUGF0aH0vYDtcbiAgfVxuICByZXR1cm4gYXdhaXQgZGVsZXRlRmlsZU9yRm9sZGVyKHRoaXMub3B0cy5kZXZpY2UsIHJlbW90ZVBhdGgsIHRoaXMuaXNTaW11bGF0b3IoKSk7XG59O1xuXG5jb21tYW5kcy5tb2JpbGVEZWxldGVGaWxlID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlRGVsZXRlRmlsZSAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHtyZW1vdGVQYXRofSA9IG9wdHM7XG4gIGlmIChyZW1vdGVQYXRoLmVuZHNXaXRoKCcvJykpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKGBJdCBpcyBleHBlY3RlZCB0aGF0IHJlbW90ZSBwYXRoIHBvaW50cyB0byBhIGZpbGUgYW5kIG5vdCB0byBhIGZvbGRlci4gYCArXG4gICAgICBgJyR7cmVtb3RlUGF0aH0nIGlzIGdpdmVuIGluc3RlYWRgKTtcbiAgfVxuICByZXR1cm4gYXdhaXQgZGVsZXRlRmlsZU9yRm9sZGVyKHRoaXMub3B0cy5kZXZpY2UsIHJlbW90ZVBhdGgsIHRoaXMuaXNTaW11bGF0b3IoKSk7XG59O1xuXG5jb21tYW5kcy5wdWxsRm9sZGVyID0gYXN5bmMgZnVuY3Rpb24gcHVsbEZvbGRlciAocmVtb3RlUGF0aCkge1xuICBpZiAoIXJlbW90ZVBhdGguZW5kc1dpdGgoJy8nKSkge1xuICAgIHJlbW90ZVBhdGggPSBgJHtyZW1vdGVQYXRofS9gO1xuICB9XG4gIHJldHVybiB0aGlzLmlzU2ltdWxhdG9yKClcbiAgICA/IGF3YWl0IHB1bGxGcm9tU2ltdWxhdG9yKHRoaXMub3B0cy5kZXZpY2UsIHJlbW90ZVBhdGgsIGZhbHNlKVxuICAgIDogYXdhaXQgcHVsbEZyb21SZWFsRGV2aWNlKHRoaXMub3B0cy5kZXZpY2UsIHJlbW90ZVBhdGgsIGZhbHNlKTtcbn07XG5cbmV4cG9ydCB7IGNvbW1hbmRzLCAvKiBmb3IgdGVzdGluZyAqLyBwYXJzZUNvbnRhaW5lclBhdGggfTtcbmV4cG9ydCBkZWZhdWx0IGNvbW1hbmRzO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxxQkFBcUIsR0FBRyxHQUE5QjtBQUVBLE1BQU1DLHNCQUFzQixHQUFHLElBQUlDLE1BQUosQ0FBWSxJQUFHRixxQkFBc0IsY0FBckMsQ0FBL0I7QUFDQSxNQUFNRyx3QkFBd0IsR0FBRyxHQUFqQztBQUNBLE1BQU1DLHdCQUF3QixHQUFHLFdBQWpDO0FBQ0EsTUFBTUMsOEJBQThCLEdBQUcsa0JBQXZDO0FBRUEsTUFBTUMsUUFBUSxHQUFHLEVBQWpCOzs7QUFFQSxTQUFTQyxlQUFULENBQTBCQyxZQUExQixFQUF3Q0MsSUFBeEMsRUFBOEM7RUFDNUMsTUFBTUMsY0FBYyxHQUFHQyxhQUFBLENBQUtDLFNBQUwsQ0FBZUgsSUFBZixDQUF2Qjs7RUFDQSxNQUFNSSxjQUFjLEdBQUdGLGFBQUEsQ0FBS0MsU0FBTCxDQUFlRCxhQUFBLENBQUtHLE9BQUwsQ0FBYU4sWUFBYixDQUFmLENBQXZCOztFQUVBLElBQUlFLGNBQWMsS0FBS0YsWUFBbkIsSUFBbUMsQ0FBQ0ssY0FBYyxDQUFDRSxVQUFmLENBQTBCTCxjQUExQixDQUF4QyxFQUFtRjtJQUNqRixNQUFNLElBQUlNLEtBQUosQ0FBVyxJQUFHSCxjQUFlLHFDQUFvQ0gsY0FBZSxHQUFoRixDQUFOO0VBQ0Q7QUFDRjs7QUFFRCxlQUFlTyxlQUFmLENBQWdDQyxJQUFoQyxFQUFzQ0MsUUFBdEMsRUFBZ0RDLGFBQWhELEVBQStEO0VBQzdELElBQUksQ0FBQ0QsUUFBTCxFQUFlO0lBQ2IsT0FBTyxNQUFNRSx5QkFBQSxDQUFTQyxlQUFULENBQXlCSixJQUF6QixDQUFiO0VBQ0Q7O0VBQ0QsTUFBTUssT0FBTyxHQUFHLE1BQU1GLHlCQUFBLENBQVNHLHVCQUFULENBQWlDTixJQUFqQyxDQUF0QjtFQUNBLE9BQU9PLG9CQUFvQixDQUFDTCxhQUFELENBQXBCLEdBQ0gsTUFBTUcsT0FBTyxDQUFDRyxhQUFSLENBQXNCUCxRQUF0QixDQURILEdBRUgsTUFBTUksT0FBTyxDQUFDSSxhQUFSLENBQXNCUixRQUF0QixDQUZWO0FBR0Q7O0FBRUQsU0FBU00sb0JBQVQsQ0FBK0JMLGFBQS9CLEVBQThDO0VBQzVDLE9BQU9RLGVBQUEsQ0FBRUMsT0FBRixDQUFVVCxhQUFWLE1BQTZCUSxlQUFBLENBQUVDLE9BQUYsQ0FBVXpCLHdCQUFWLENBQXBDO0FBQ0Q7O0FBRUQsZUFBZTBCLGFBQWYsQ0FBOEJaLElBQTlCLEVBQW9DYSxVQUFwQyxFQUFnRDtFQUM5QyxJQUFJOUIsc0JBQXNCLENBQUMrQixJQUF2QixDQUE0QkQsVUFBNUIsQ0FBSixFQUE2QztJQUMzQyxNQUFNO01BQUNaLFFBQUQ7TUFBV2MsZUFBWDtNQUE0QmI7SUFBNUIsSUFBNkMsTUFBTWMsa0JBQWtCLENBQUNILFVBQUQsQ0FBM0U7SUFDQSxNQUFNUixPQUFPLEdBQUcsTUFBTU4sZUFBZSxDQUFDQyxJQUFELEVBQU9DLFFBQVAsRUFBaUJDLGFBQWpCLENBQXJDO0lBQ0EsTUFBTWUsWUFBWSxHQUFHVixvQkFBb0IsQ0FBQ0wsYUFBRCxDQUFwQixHQUNqQlQsYUFBQSxDQUFLeUIsSUFBTCxDQUFVaEMsd0JBQVYsRUFBb0M2QixlQUFwQyxDQURpQixHQUVqQkEsZUFGSjtJQUdBLE9BQU87TUFBQ1YsT0FBRDtNQUFVWTtJQUFWLENBQVA7RUFDRCxDQVBELE1BT087SUFDTCxNQUFNWixPQUFPLEdBQUcsTUFBTU4sZUFBZSxDQUFDQyxJQUFELENBQXJDO0lBQ0EsT0FBTztNQUFDSyxPQUFEO01BQVVZLFlBQVksRUFBRUo7SUFBeEIsQ0FBUDtFQUNEO0FBQ0Y7O0FBc0JELGVBQWVHLGtCQUFmLENBQW1DSCxVQUFuQyxFQUErQ00scUJBQS9DLEVBQXNFO0VBQ3BFLE1BQU1DLEtBQUssR0FBR3JDLHNCQUFzQixDQUFDc0MsSUFBdkIsQ0FBNEJSLFVBQTVCLENBQWQ7O0VBQ0EsSUFBSSxDQUFDTyxLQUFMLEVBQVk7SUFDVixNQUFNLElBQUl0QixLQUFKLENBQVcseUNBQUQsR0FDYixnQkFBZWhCLHFCQUFzQiw4QkFEeEIsR0FFYix1Q0FBc0MrQixVQUFXLG9CQUY5QyxDQUFOO0VBR0Q7O0VBQ0QsSUFBSSxHQUFHWixRQUFILEVBQWFnQixZQUFiLElBQTZCRyxLQUFqQztFQUNBLElBQUlsQixhQUFhLEdBQUcsSUFBcEI7RUFDQSxNQUFNb0IsZ0JBQWdCLEdBQUdyQixRQUFRLENBQUNzQixPQUFULENBQWlCdEMsd0JBQWpCLENBQXpCOztFQUdBLElBQUlxQyxnQkFBZ0IsR0FBRyxDQUFuQixJQUF3QkEsZ0JBQWdCLEdBQUdyQixRQUFRLENBQUN1QixNQUFULEdBQWtCLENBQWpFLEVBQW9FO0lBQ2xFdEIsYUFBYSxHQUFHRCxRQUFRLENBQUN3QixTQUFULENBQW1CSCxnQkFBZ0IsR0FBRyxDQUF0QyxDQUFoQjs7SUFDQUksZUFBQSxDQUFJQyxLQUFKLENBQVcsMEJBQXlCekIsYUFBYyxFQUFsRDs7SUFDQUQsUUFBUSxHQUFHQSxRQUFRLENBQUN3QixTQUFULENBQW1CLENBQW5CLEVBQXNCSCxnQkFBdEIsQ0FBWDtFQUNEOztFQUNELElBQUlaLGVBQUEsQ0FBRWtCLEtBQUYsQ0FBUVQscUJBQVIsQ0FBSixFQUFvQztJQUNsQyxNQUFNSixlQUFlLEdBQUdFLFlBQXhCO0lBQ0EsT0FBTztNQUFFaEIsUUFBRjtNQUFZYyxlQUFaO01BQTZCYjtJQUE3QixDQUFQO0VBQ0Q7O0VBQ0QsTUFBTTJCLGFBQWEsR0FBR25CLGVBQUEsQ0FBRW9CLFVBQUYsQ0FBYVgscUJBQWIsSUFDbEIsTUFBTUEscUJBQXFCLENBQUNsQixRQUFELEVBQVdDLGFBQVgsQ0FEVCxHQUVsQmlCLHFCQUZKOztFQUdBLE1BQU1KLGVBQWUsR0FBR3RCLGFBQUEsQ0FBS3NDLEtBQUwsQ0FBV0MsT0FBWCxDQUFtQkgsYUFBbkIsRUFBa0NaLFlBQWxDLENBQXhCOztFQUNBNUIsZUFBZSxDQUFDMEIsZUFBRCxFQUFrQmMsYUFBbEIsQ0FBZjtFQUNBLE9BQU87SUFBQzVCLFFBQUQ7SUFBV2MsZUFBWDtJQUE0QmI7RUFBNUIsQ0FBUDtBQUNEOztBQW9CRCxlQUFlK0IsbUJBQWYsQ0FBb0NDLE1BQXBDLEVBQTRDckIsVUFBNUMsRUFBd0RzQixVQUF4RCxFQUFvRTtFQUNsRSxNQUFNQyxNQUFNLEdBQUdDLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZSCxVQUFaLEVBQXdCLFFBQXhCLENBQWY7O0VBQ0EsSUFBSXBELHNCQUFzQixDQUFDK0IsSUFBdkIsQ0FBNEJELFVBQTVCLENBQUosRUFBNkM7SUFDM0MsTUFBTTtNQUFDWixRQUFEO01BQVdjLGVBQWUsRUFBRXdCO0lBQTVCLElBQXVDLE1BQU12QixrQkFBa0IsQ0FBQ0gsVUFBRCxFQUNuRSxPQUFPMkIsU0FBUCxFQUFrQnRDLGFBQWxCLEtBQW9DLE1BQU1nQyxNQUFNLENBQUNPLE1BQVAsQ0FBY0MsZUFBZCxDQUE4QkYsU0FBOUIsRUFBeUN0QyxhQUF6QyxDQUR5QixDQUFyRTs7SUFFQXdCLGVBQUEsQ0FBSWlCLElBQUosQ0FBVSw2QkFBNEIxQyxRQUFTLFdBQVVZLFVBQVcsS0FBM0QsR0FDTiwyQkFBMEIwQixPQUFRLEdBRHJDOztJQUVBLElBQUksRUFBQyxNQUFNSyxXQUFBLENBQUdDLE1BQUgsQ0FBVXBELGFBQUEsQ0FBS0csT0FBTCxDQUFhMkMsT0FBYixDQUFWLENBQVAsQ0FBSixFQUE2QztNQUMzQ2IsZUFBQSxDQUFJQyxLQUFKLENBQVcsMkJBQTBCbEMsYUFBQSxDQUFLRyxPQUFMLENBQWEyQyxPQUFiLENBQXNCLCtCQUEzRDs7TUFDQSxNQUFNLElBQUFPLGVBQUEsRUFBT3JELGFBQUEsQ0FBS0csT0FBTCxDQUFhMkMsT0FBYixDQUFQLENBQU47SUFDRDs7SUFDRCxNQUFNSyxXQUFBLENBQUdHLFNBQUgsQ0FBYVIsT0FBYixFQUFzQkgsTUFBdEIsQ0FBTjtJQUNBO0VBQ0Q7O0VBQ0QsTUFBTVksU0FBUyxHQUFHLE1BQU1DLGdCQUFBLENBQVFDLE9BQVIsRUFBeEI7O0VBQ0EsTUFBTVgsT0FBTyxHQUFHOUMsYUFBQSxDQUFLdUMsT0FBTCxDQUFhZ0IsU0FBYixFQUF3QnZELGFBQUEsQ0FBSzBELFFBQUwsQ0FBY3RDLFVBQWQsQ0FBeEIsQ0FBaEI7O0VBQ0EsSUFBSTtJQUNGLE1BQU0rQixXQUFBLENBQUdHLFNBQUgsQ0FBYVIsT0FBYixFQUFzQkgsTUFBdEIsQ0FBTjtJQUNBLE1BQU1GLE1BQU0sQ0FBQ08sTUFBUCxDQUFjVyxRQUFkLENBQXVCYixPQUF2QixDQUFOO0VBQ0QsQ0FIRCxTQUdVO0lBQ1IsTUFBTUssV0FBQSxDQUFHUyxNQUFILENBQVVMLFNBQVYsQ0FBTjtFQUNEO0FBQ0Y7O0FBc0JELGVBQWVNLG9CQUFmLENBQXFDcEIsTUFBckMsRUFBNkNyQixVQUE3QyxFQUF5RHNCLFVBQXpELEVBQXFFO0VBQ25FLE1BQU07SUFBQzlCLE9BQUQ7SUFBVVk7RUFBVixJQUEwQixNQUFNTCxhQUFhLENBQUNzQixNQUFNLENBQUNsQyxJQUFSLEVBQWNhLFVBQWQsQ0FBbkQ7O0VBQ0EsSUFBSTtJQUNGLE1BQU0sSUFBQTBDLHNCQUFBLEVBQVNsRCxPQUFULEVBQWtCWSxZQUFsQixFQUFnQ2tCLFVBQWhDLENBQU47RUFDRCxDQUZELENBRUUsT0FBT3FCLENBQVAsRUFBVTtJQUNWOUIsZUFBQSxDQUFJQyxLQUFKLENBQVU2QixDQUFDLENBQUNDLEtBQVo7O0lBQ0EsTUFBTSxJQUFJM0QsS0FBSixDQUFXLCtCQUE4QmUsVUFBVyx1QkFBc0IyQyxDQUFDLENBQUNFLE9BQVEsRUFBcEYsQ0FBTjtFQUNELENBTEQsU0FLVTtJQUNSckQsT0FBTyxDQUFDc0QsS0FBUjtFQUNEO0FBQ0Y7O0FBRUQsZUFBZUMsa0JBQWYsQ0FBbUMxQixNQUFuQyxFQUEyQ3JCLFVBQTNDLEVBQXVEZ0QsV0FBdkQsRUFBb0U7RUFDbEUsT0FBT0EsV0FBVyxHQUNkLE1BQU1DLG1CQUFtQixDQUFDNUIsTUFBRCxFQUFTckIsVUFBVCxDQURYLEdBRWQsTUFBTWtELG9CQUFvQixDQUFDN0IsTUFBRCxFQUFTckIsVUFBVCxDQUY5QjtBQUdEOztBQWtCRCxlQUFlbUQsaUJBQWYsQ0FBa0M5QixNQUFsQyxFQUEwQ3JCLFVBQTFDLEVBQXNEb0QsTUFBdEQsRUFBOEQ7RUFDNUQsSUFBSUMsWUFBSjs7RUFDQSxJQUFJbkYsc0JBQXNCLENBQUMrQixJQUF2QixDQUE0QkQsVUFBNUIsQ0FBSixFQUE2QztJQUMzQyxNQUFNO01BQUNaLFFBQUQ7TUFBV2MsZUFBZSxFQUFFd0I7SUFBNUIsSUFBdUMsTUFBTXZCLGtCQUFrQixDQUFDSCxVQUFELEVBQ25FLE9BQU8yQixTQUFQLEVBQWtCdEMsYUFBbEIsS0FBb0MsTUFBTWdDLE1BQU0sQ0FBQ08sTUFBUCxDQUFjQyxlQUFkLENBQThCRixTQUE5QixFQUF5Q3RDLGFBQXpDLENBRHlCLENBQXJFOztJQUVBd0IsZUFBQSxDQUFJaUIsSUFBSixDQUFVLDZCQUE0QjFDLFFBQVMsV0FBVVksVUFBVyxLQUEzRCxHQUNOLDJCQUEwQjBCLE9BQVEsR0FEckM7O0lBRUEyQixZQUFZLEdBQUczQixPQUFmO0VBQ0QsQ0FORCxNQU1PO0lBQ0wsTUFBTTRCLE9BQU8sR0FBR2pDLE1BQU0sQ0FBQ2tDLE1BQVAsRUFBaEI7SUFDQUYsWUFBWSxHQUFHekUsYUFBQSxDQUFLc0MsS0FBTCxDQUFXYixJQUFYLENBQWdCaUQsT0FBaEIsRUFBeUJ0RCxVQUF6QixDQUFmO0lBQ0F4QixlQUFlLENBQUM2RSxZQUFELEVBQWVDLE9BQWYsQ0FBZjs7SUFDQXpDLGVBQUEsQ0FBSWlCLElBQUosQ0FBVSwyQkFBMEJ1QixZQUFhLEVBQWpEO0VBQ0Q7O0VBQ0QsSUFBSSxFQUFDLE1BQU10QixXQUFBLENBQUdDLE1BQUgsQ0FBVXFCLFlBQVYsQ0FBUCxDQUFKLEVBQW9DO0lBQ2xDeEMsZUFBQSxDQUFJMkMsYUFBSixDQUFtQixjQUFhSixNQUFNLEdBQUcsTUFBSCxHQUFZLFFBQVMsUUFBT0MsWUFBYSxrQkFBL0U7RUFDRDs7RUFDRCxNQUFNOUIsTUFBTSxHQUFHNkIsTUFBTSxHQUNqQixNQUFNSyxhQUFBLENBQUtDLGdCQUFMLENBQXNCTCxZQUF0QixDQURXLEdBRWpCLE1BQU1NLFlBQUEsQ0FBSUMsYUFBSixDQUFrQlAsWUFBbEIsRUFBZ0M7SUFBQ1EsY0FBYyxFQUFFO0VBQWpCLENBQWhDLENBRlY7RUFHQSxPQUFPdEMsTUFBTSxDQUFDdUMsUUFBUCxFQUFQO0FBQ0Q7O0FBeUJELGVBQWVDLGtCQUFmLENBQW1DMUMsTUFBbkMsRUFBMkNyQixVQUEzQyxFQUF1RG9ELE1BQXZELEVBQStEO0VBQzdELE1BQU07SUFBQzVELE9BQUQ7SUFBVVk7RUFBVixJQUEwQixNQUFNTCxhQUFhLENBQUNzQixNQUFNLENBQUNsQyxJQUFSLEVBQWNhLFVBQWQsQ0FBbkQ7O0VBQ0EsSUFBSTtJQUNGLE1BQU1nRSxRQUFRLEdBQUcsTUFBTXhFLE9BQU8sQ0FBQ3lFLFdBQVIsQ0FBb0I3RCxZQUFwQixDQUF2Qjs7SUFDQSxJQUFJZ0QsTUFBTSxJQUFJWSxRQUFRLENBQUNFLFdBQVQsRUFBZCxFQUFzQztNQUNwQyxNQUFNLElBQUlqRixLQUFKLENBQVcsNENBQTJDZSxVQUFXLEdBQWpFLENBQU47SUFDRDs7SUFDRCxJQUFJLENBQUNvRCxNQUFELElBQVcsQ0FBQ1ksUUFBUSxDQUFDRSxXQUFULEVBQWhCLEVBQXdDO01BQ3RDLE1BQU0sSUFBSWpGLEtBQUosQ0FBVyw4Q0FBNkNlLFVBQVcsR0FBbkUsQ0FBTjtJQUNEOztJQUVELE9BQU9nRSxRQUFRLENBQUNaLE1BQVQsS0FDSCxDQUFDLE1BQU0sSUFBQWUsc0JBQUEsRUFBUzNFLE9BQVQsRUFBa0JZLFlBQWxCLENBQVAsRUFBd0MwRCxRQUF4QyxDQUFpRCxRQUFqRCxDQURHLEdBRUgsQ0FBQyxNQUFNLElBQUFNLHdCQUFBLEVBQVc1RSxPQUFYLEVBQW9CWSxZQUFwQixDQUFQLEVBQTBDMEQsUUFBMUMsRUFGSjtFQUdELENBWkQsU0FZVTtJQUNSdEUsT0FBTyxDQUFDc0QsS0FBUjtFQUNEO0FBQ0Y7O0FBZUQsZUFBZUcsbUJBQWYsQ0FBb0M1QixNQUFwQyxFQUE0Q3JCLFVBQTVDLEVBQXdEO0VBQ3RELElBQUlxRCxZQUFKOztFQUNBLElBQUluRixzQkFBc0IsQ0FBQytCLElBQXZCLENBQTRCRCxVQUE1QixDQUFKLEVBQTZDO0lBQzNDLE1BQU07TUFBQ1osUUFBRDtNQUFXYyxlQUFlLEVBQUV3QjtJQUE1QixJQUF1QyxNQUFNdkIsa0JBQWtCLENBQUNILFVBQUQsRUFDbkUsT0FBTzJCLFNBQVAsRUFBa0J0QyxhQUFsQixLQUFvQyxNQUFNZ0MsTUFBTSxDQUFDTyxNQUFQLENBQWNDLGVBQWQsQ0FBOEJGLFNBQTlCLEVBQXlDdEMsYUFBekMsQ0FEeUIsQ0FBckU7O0lBRUF3QixlQUFBLENBQUlpQixJQUFKLENBQVUsNkJBQTRCMUMsUUFBUyxXQUFVWSxVQUFXLEtBQTNELEdBQ04sSUFBRzBCLE9BQVEsbUJBRGQ7O0lBRUEyQixZQUFZLEdBQUczQixPQUFmO0VBQ0QsQ0FORCxNQU1PO0lBQ0wsTUFBTTRCLE9BQU8sR0FBR2pDLE1BQU0sQ0FBQ2tDLE1BQVAsRUFBaEI7SUFDQUYsWUFBWSxHQUFHekUsYUFBQSxDQUFLc0MsS0FBTCxDQUFXYixJQUFYLENBQWdCaUQsT0FBaEIsRUFBeUJ0RCxVQUF6QixDQUFmO0lBQ0F4QixlQUFlLENBQUM2RSxZQUFELEVBQWVDLE9BQWYsQ0FBZjs7SUFDQXpDLGVBQUEsQ0FBSWlCLElBQUosQ0FBVSxzQkFBcUJ1QixZQUFhLEVBQTVDO0VBQ0Q7O0VBQ0QsSUFBSSxFQUFDLE1BQU10QixXQUFBLENBQUdDLE1BQUgsQ0FBVXFCLFlBQVYsQ0FBUCxDQUFKLEVBQW9DO0lBQ2xDLE1BQU0sSUFBSWdCLGtCQUFBLENBQU9DLG9CQUFYLENBQWlDLHVCQUFzQmpCLFlBQWEsa0JBQXBFLENBQU47RUFDRDs7RUFDRCxNQUFNdEIsV0FBQSxDQUFHUyxNQUFILENBQVVhLFlBQVYsQ0FBTjtBQUNEOztBQXNCRCxlQUFlSCxvQkFBZixDQUFxQzdCLE1BQXJDLEVBQTZDckIsVUFBN0MsRUFBeUQ7RUFDdkQsTUFBTTtJQUFFUixPQUFGO0lBQVdZO0VBQVgsSUFBNEIsTUFBTUwsYUFBYSxDQUFDc0IsTUFBTSxDQUFDbEMsSUFBUixFQUFjYSxVQUFkLENBQXJEOztFQUNBLElBQUk7SUFDRixNQUFNUixPQUFPLENBQUMrRSxlQUFSLENBQXdCbkUsWUFBeEIsQ0FBTjtFQUNELENBRkQsQ0FFRSxPQUFPdUMsQ0FBUCxFQUFVO0lBQ1YsSUFBSUEsQ0FBQyxDQUFDRSxPQUFGLENBQVUyQixRQUFWLENBQW1CbEcsOEJBQW5CLENBQUosRUFBd0Q7TUFDdEQsTUFBTSxJQUFJVyxLQUFKLENBQVcsU0FBUWUsVUFBVyxnQ0FBOUIsQ0FBTjtJQUNEOztJQUNELE1BQU0yQyxDQUFOO0VBQ0QsQ0FQRCxTQU9VO0lBQ1JuRCxPQUFPLENBQUNzRCxLQUFSO0VBQ0Q7QUFDRjs7QUFFRHZFLFFBQVEsQ0FBQ21FLFFBQVQsR0FBb0IsZUFBZUEsUUFBZixDQUF5QjFDLFVBQXpCLEVBQXFDc0IsVUFBckMsRUFBaUQ7RUFDbkUsSUFBSXRCLFVBQVUsQ0FBQ3lFLFFBQVgsQ0FBb0IsR0FBcEIsQ0FBSixFQUE4QjtJQUM1QixNQUFNLElBQUlKLGtCQUFBLENBQU9DLG9CQUFYLENBQWlDLHdFQUFELEdBQ25DLElBQUd0RSxVQUFXLG9CQURYLENBQU47RUFFRDs7RUFDRCxJQUFJSCxlQUFBLENBQUU2RSxPQUFGLENBQVVwRCxVQUFWLENBQUosRUFBMkI7SUFHekJBLFVBQVUsR0FBR0UsTUFBTSxDQUFDQyxJQUFQLENBQVlILFVBQVosRUFBd0J3QyxRQUF4QixDQUFpQyxNQUFqQyxDQUFiO0VBQ0Q7O0VBQ0QsT0FBTyxLQUFLZCxXQUFMLEtBQ0gsTUFBTTVCLG1CQUFtQixDQUFDLEtBQUt1RCxJQUFMLENBQVV0RCxNQUFYLEVBQW1CckIsVUFBbkIsRUFBK0JzQixVQUEvQixDQUR0QixHQUVILE1BQU1tQixvQkFBb0IsQ0FBQyxLQUFLa0MsSUFBTCxDQUFVdEQsTUFBWCxFQUFtQnJCLFVBQW5CLEVBQStCc0IsVUFBL0IsQ0FGOUI7QUFHRCxDQWJEOztBQWVBL0MsUUFBUSxDQUFDNEYsUUFBVCxHQUFvQixlQUFlQSxRQUFmLENBQXlCbkUsVUFBekIsRUFBcUM7RUFDdkQsSUFBSUEsVUFBVSxDQUFDeUUsUUFBWCxDQUFvQixHQUFwQixDQUFKLEVBQThCO0lBQzVCLE1BQU0sSUFBSUosa0JBQUEsQ0FBT0Msb0JBQVgsQ0FBaUMsd0VBQUQsR0FDbkMsSUFBR3RFLFVBQVcsb0JBRFgsQ0FBTjtFQUVEOztFQUNELE9BQU8sS0FBS2dELFdBQUwsS0FDSCxNQUFNRyxpQkFBaUIsQ0FBQyxLQUFLd0IsSUFBTCxDQUFVdEQsTUFBWCxFQUFtQnJCLFVBQW5CLEVBQStCLElBQS9CLENBRHBCLEdBRUgsTUFBTStELGtCQUFrQixDQUFDLEtBQUtZLElBQUwsQ0FBVXRELE1BQVgsRUFBbUJyQixVQUFuQixFQUErQixJQUEvQixDQUY1QjtBQUdELENBUkQ7O0FBVUF6QixRQUFRLENBQUNxRyxrQkFBVCxHQUE4QixlQUFlQSxrQkFBZixDQUFtQ0QsSUFBSSxHQUFHLEVBQTFDLEVBQThDO0VBQzFFLElBQUk7SUFBQzNFO0VBQUQsSUFBZTJFLElBQW5COztFQUNBLElBQUksQ0FBQzNFLFVBQVUsQ0FBQ3lFLFFBQVgsQ0FBb0IsR0FBcEIsQ0FBTCxFQUErQjtJQUM3QnpFLFVBQVUsR0FBSSxHQUFFQSxVQUFXLEdBQTNCO0VBQ0Q7O0VBQ0QsT0FBTyxNQUFNK0Msa0JBQWtCLENBQUMsS0FBSzRCLElBQUwsQ0FBVXRELE1BQVgsRUFBbUJyQixVQUFuQixFQUErQixLQUFLZ0QsV0FBTCxFQUEvQixDQUEvQjtBQUNELENBTkQ7O0FBUUF6RSxRQUFRLENBQUNzRyxnQkFBVCxHQUE0QixlQUFlQSxnQkFBZixDQUFpQ0YsSUFBSSxHQUFHLEVBQXhDLEVBQTRDO0VBQ3RFLE1BQU07SUFBQzNFO0VBQUQsSUFBZTJFLElBQXJCOztFQUNBLElBQUkzRSxVQUFVLENBQUN5RSxRQUFYLENBQW9CLEdBQXBCLENBQUosRUFBOEI7SUFDNUIsTUFBTSxJQUFJSixrQkFBQSxDQUFPQyxvQkFBWCxDQUFpQyx3RUFBRCxHQUNuQyxJQUFHdEUsVUFBVyxvQkFEWCxDQUFOO0VBRUQ7O0VBQ0QsT0FBTyxNQUFNK0Msa0JBQWtCLENBQUMsS0FBSzRCLElBQUwsQ0FBVXRELE1BQVgsRUFBbUJyQixVQUFuQixFQUErQixLQUFLZ0QsV0FBTCxFQUEvQixDQUEvQjtBQUNELENBUEQ7O0FBU0F6RSxRQUFRLENBQUM2RixVQUFULEdBQXNCLGVBQWVBLFVBQWYsQ0FBMkJwRSxVQUEzQixFQUF1QztFQUMzRCxJQUFJLENBQUNBLFVBQVUsQ0FBQ3lFLFFBQVgsQ0FBb0IsR0FBcEIsQ0FBTCxFQUErQjtJQUM3QnpFLFVBQVUsR0FBSSxHQUFFQSxVQUFXLEdBQTNCO0VBQ0Q7O0VBQ0QsT0FBTyxLQUFLZ0QsV0FBTCxLQUNILE1BQU1HLGlCQUFpQixDQUFDLEtBQUt3QixJQUFMLENBQVV0RCxNQUFYLEVBQW1CckIsVUFBbkIsRUFBK0IsS0FBL0IsQ0FEcEIsR0FFSCxNQUFNK0Qsa0JBQWtCLENBQUMsS0FBS1ksSUFBTCxDQUFVdEQsTUFBWCxFQUFtQnJCLFVBQW5CLEVBQStCLEtBQS9CLENBRjVCO0FBR0QsQ0FQRDs7ZUFVZXpCLFEifQ==
