"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _path = _interopRequireDefault(require("path"));

var _support = require("@appium/support");

var _teen_process = require("teen_process");

var _utils = require("../utils");

var _asyncbox = require("asyncbox");

var _bluebird = _interopRequireDefault(require("bluebird"));

const commands = {};
exports.commands = commands;
const PERF_RECORD_FEAT_NAME = 'perf_record';
const PERF_RECORD_SECURITY_MESSAGE = 'Performance measurement requires relaxing security for simulator. ' + `Please set '--relaxed-security' or '--allow-insecure' with '${PERF_RECORD_FEAT_NAME}' ` + 'referencing https://github.com/appium/appium/blob/master/docs/en/writing-running-appium/security.md for more details.';
const DEFAULT_TIMEOUT_MS = 5 * 60 * 1000;
const STOP_TIMEOUT_MS = 3 * 60 * 1000;
const STARTUP_TIMEOUT_MS = 60 * 1000;
const DEFAULT_PROFILE_NAME = 'Activity Monitor';
const DEFAULT_EXT = '.trace';
const DEFAULT_PID = 'current';
const INSTRUMENTS = 'instruments';
const XCRUN = 'xcrun';
const XCTRACE = 'xctrace';

async function requireXctrace() {
  let xcrunPath;

  try {
    xcrunPath = await _support.fs.which(XCRUN);
  } catch (e) {
    throw new Error(`${XCRUN} has not been found in PATH. ` + `Please make sure XCode development tools are installed`);
  }

  try {
    await (0, _teen_process.exec)(xcrunPath, [XCTRACE, 'help']);
  } catch (e) {
    throw new Error(`${XCTRACE} is not available for the active Xcode version. ` + `Please make sure XCode is up to date. Original error: ${e.stderr || e.message}`);
  }

  return xcrunPath;
}

async function requireInstruments() {
  try {
    return await _support.fs.which(INSTRUMENTS);
  } catch (e) {
    throw new Error(`${INSTRUMENTS} has not been found in PATH. ` + `Please make sure XCode development tools are installed`);
  }
}

class PerfRecorder {
  constructor(reportRoot, udid, opts = {}) {
    this._process = null;
    this._zippedReportPath = '';
    this._timeout = opts.timeout && opts.timeout > 0 ? opts.timeout : DEFAULT_TIMEOUT_MS;
    this._profileName = opts.profileName || DEFAULT_PROFILE_NAME;
    this._reportPath = _path.default.resolve(reportRoot, `appium_perf__${this._profileName.replace(/\W/g, '_')}__${Date.now()}${DEFAULT_EXT}`);
    this._pid = opts.pid;
    this._udid = udid;
    this._logger = _support.logger.getLogger(`${_lodash.default.truncate(this._profileName, {
      length: 10
    })}@${this._udid.substring(0, 8)}`);
    this._archivePromise = null;
  }

  get profileName() {
    return this._profileName;
  }

  async getOriginalReportPath() {
    return (await _support.fs.exists(this._reportPath)) ? this._reportPath : '';
  }

  async getZippedReportPath() {
    if (!this._archivePromise) {
      this._archivePromise = (async () => {
        const originalReportPath = await this.getOriginalReportPath();

        if (!originalReportPath) {
          return '';
        }

        const zippedReportPath = await _support.tempDir.path({
          prefix: _path.default.parse(originalReportPath).name,
          suffix: '.zip'
        });
        await _support.zip.toArchive(zippedReportPath, {
          cwd: _path.default.dirname(this._reportPath)
        });
        await _support.fs.rimraf(_path.default.dirname(this._reportPath));
        this._zippedReportPath = zippedReportPath;
        return this._zippedReportPath;
      })();
    }

    return await this._archivePromise;
  }

  isRunning() {
    var _this$_process;

    return !!((_this$_process = this._process) !== null && _this$_process !== void 0 && _this$_process.isRunning);
  }

  async _enforceTermination() {
    if (this._process && this.isRunning()) {
      this._logger.debug('Force-stopping the currently running perf recording');

      try {
        await this._process.stop('SIGKILL');
      } catch (ign) {}
    }

    this._process = null;

    const performCleanup = async () => {
      try {
        await _bluebird.default.all([this._zippedReportPath, _path.default.dirname(this._reportPath)].filter(Boolean).map(x => _support.fs.rimraf(x)));
      } catch (e) {
        this._logger.warn(e.message);
      }
    };

    if (this._archivePromise) {
      this._archivePromise.finally(async () => {
        await performCleanup();
        this._archivePromise = null;
      }).catch(() => {});
    }

    await performCleanup();
    return '';
  }

  async start() {
    let binaryPath;

    try {
      binaryPath = await requireXctrace();
    } catch (e) {
      this._logger.debug(e.message);

      this._logger.warn(`Defaulting to ${INSTRUMENTS} usage`);

      binaryPath = await requireInstruments();
    }

    const args = [];
    const toolName = _path.default.basename(binaryPath) === XCRUN ? XCTRACE : INSTRUMENTS;

    if (toolName === XCTRACE) {
      args.push(XCTRACE, 'record', '--device', this._udid, '--template', this._profileName, '--output', this._reportPath, '--time-limit', `${this._timeout}ms`);

      if (this._pid) {
        args.push('--attach', `${this._pid}`);
      } else {
        args.push('--all-processes');
      }
    } else {
      args.push('-w', this._udid, '-t', this._profileName, '-D', this._reportPath, '-l', `${this._timeout}`);

      if (this._pid) {
        args.push('-p', `${this._pid}`);
      }
    }

    const fullCmd = [binaryPath, ...args];
    this._process = new _teen_process.SubProcess(fullCmd[0], fullCmd.slice(1));
    this._archivePromise = null;

    this._logger.debug(`Starting performance recording: ${_support.util.quote(fullCmd)}`);

    this._process.on('output', (stdout, stderr) => {
      if (_lodash.default.trim(stdout || stderr)) {
        this._logger.debug(`[${toolName}] ${stdout || stderr}`);
      }
    });

    this._process.once('exit', async (code, signal) => {
      this._process = null;

      if (code === 0) {
        this._logger.debug('Performance recording exited without errors');

        try {
          await this.getZippedReportPath();
        } catch (e) {
          this._logger.warn(e);
        }
      } else {
        await this._enforceTermination();

        this._logger.warn(`Performance recording exited with error code ${code}, signal ${signal}`);
      }
    });

    await this._process.start(0);

    try {
      await (0, _asyncbox.waitForCondition)(async () => {
        if (await this.getOriginalReportPath()) {
          return true;
        }

        if (!this._process) {
          throw new Error(`${toolName} process died unexpectedly`);
        }

        return false;
      }, {
        waitMs: STARTUP_TIMEOUT_MS,
        intervalMs: 500
      });
    } catch (e) {
      await this._enforceTermination();
      const listProfilesCommand = toolName === XCTRACE ? `${XCRUN} ${XCTRACE} list templates` : `${INSTRUMENTS} -s`;

      this._logger.errorAndThrow(`There is no ${DEFAULT_EXT} file found for performance profile ` + `'${this._profileName}'. Make sure the profile is supported on this device. ` + `You could use '${listProfilesCommand}' command to see the list of all available profiles. ` + `Check the server log for more details`);
    }

    this._logger.info(`The performance recording has started. Will timeout in ${this._timeout}ms`);
  }

  async stop(force = false) {
    if (force) {
      return await this._enforceTermination();
    }

    if (!this.isRunning()) {
      this._logger.debug('Performance recording is not running. Returning the recent result');

      return await this.getZippedReportPath();
    }

    try {
      await this._process.stop('SIGINT', STOP_TIMEOUT_MS);
    } catch (e) {
      this._logger.errorAndThrow(`Performance recording has failed to exit after ${STOP_TIMEOUT_MS}ms`);
    }

    return await this.getZippedReportPath();
  }

}

commands.mobileStartPerfRecord = async function mobileStartPerfRecord(opts = {}) {
  if (!this.isFeatureEnabled(PERF_RECORD_FEAT_NAME) && !this.isRealDevice()) {
    this.log.errorAndThrow(PERF_RECORD_SECURITY_MESSAGE);
  }

  const {
    timeout = DEFAULT_TIMEOUT_MS,
    profileName = DEFAULT_PROFILE_NAME,
    pid
  } = opts;

  if (!_lodash.default.isEmpty(this._perfRecorders)) {
    for (const recorder of this._perfRecorders.filter(x => x.profileName === profileName)) {
      if (recorder.isRunning()) {
        this.log.debug(`Performance recorder for '${profileName}' on device '${this.opts.device.udid}' ` + ` is already running. Doing nothing`);
        return;
      }

      _lodash.default.pull(this._perfRecorders, recorder);

      await recorder.stop(true);
    }
  }

  let realPid;

  if (pid) {
    if (_lodash.default.toLower(pid) === DEFAULT_PID) {
      const appInfo = await this.proxyCommand('/wda/activeAppInfo', 'GET');
      realPid = appInfo.pid;
    } else {
      realPid = pid;
    }
  }

  const recorder = new PerfRecorder(await _support.tempDir.openDir(), this.opts.device.udid, {
    timeout: parseInt(timeout, 10),
    profileName,
    pid: parseInt(realPid, 10)
  });
  await recorder.start();
  this._perfRecorders = [...(this._perfRecorders || []), recorder];
};

commands.mobileStopPerfRecord = async function mobileStopPerfRecord(opts = {}) {
  if (!this.isFeatureEnabled(PERF_RECORD_FEAT_NAME) && !this.isRealDevice()) {
    this.log.errorAndThrow(PERF_RECORD_SECURITY_MESSAGE);
  }

  if (_lodash.default.isEmpty(this._perfRecorders)) {
    this.log.info('No performance recorders have been started. Doing nothing');
    return '';
  }

  const {
    profileName = DEFAULT_PROFILE_NAME,
    remotePath
  } = opts;

  const recorders = this._perfRecorders.filter(x => x.profileName === profileName);

  if (_lodash.default.isEmpty(recorders)) {
    this.log.errorAndThrow(`There are no records for performance profile '${profileName}' ` + `and device ${this.opts.device.udid}. Have you started the profiling before?`);
  }

  const recorder = _lodash.default.first(recorders);

  const resultPath = await recorder.stop();

  if (!(await _support.fs.exists(resultPath))) {
    this.log.errorAndThrow(`There is no ${DEFAULT_EXT} file found for performance profile '${profileName}' ` + `and device ${this.opts.device.udid}. Make sure the selected profile is supported on this device`);
  }

  const result = await (0, _utils.encodeBase64OrUpload)(resultPath, remotePath, opts);

  _lodash.default.pull(this._perfRecorders, recorder);

  await _support.fs.rimraf(resultPath);
  return result;
};

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL2NvbW1hbmRzL3BlcmZvcm1hbmNlLmpzIiwibmFtZXMiOlsiY29tbWFuZHMiLCJQRVJGX1JFQ09SRF9GRUFUX05BTUUiLCJQRVJGX1JFQ09SRF9TRUNVUklUWV9NRVNTQUdFIiwiREVGQVVMVF9USU1FT1VUX01TIiwiU1RPUF9USU1FT1VUX01TIiwiU1RBUlRVUF9USU1FT1VUX01TIiwiREVGQVVMVF9QUk9GSUxFX05BTUUiLCJERUZBVUxUX0VYVCIsIkRFRkFVTFRfUElEIiwiSU5TVFJVTUVOVFMiLCJYQ1JVTiIsIlhDVFJBQ0UiLCJyZXF1aXJlWGN0cmFjZSIsInhjcnVuUGF0aCIsImZzIiwid2hpY2giLCJlIiwiRXJyb3IiLCJleGVjIiwic3RkZXJyIiwibWVzc2FnZSIsInJlcXVpcmVJbnN0cnVtZW50cyIsIlBlcmZSZWNvcmRlciIsImNvbnN0cnVjdG9yIiwicmVwb3J0Um9vdCIsInVkaWQiLCJvcHRzIiwiX3Byb2Nlc3MiLCJfemlwcGVkUmVwb3J0UGF0aCIsIl90aW1lb3V0IiwidGltZW91dCIsIl9wcm9maWxlTmFtZSIsInByb2ZpbGVOYW1lIiwiX3JlcG9ydFBhdGgiLCJwYXRoIiwicmVzb2x2ZSIsInJlcGxhY2UiLCJEYXRlIiwibm93IiwiX3BpZCIsInBpZCIsIl91ZGlkIiwiX2xvZ2dlciIsImxvZ2dlciIsImdldExvZ2dlciIsIl8iLCJ0cnVuY2F0ZSIsImxlbmd0aCIsInN1YnN0cmluZyIsIl9hcmNoaXZlUHJvbWlzZSIsImdldE9yaWdpbmFsUmVwb3J0UGF0aCIsImV4aXN0cyIsImdldFppcHBlZFJlcG9ydFBhdGgiLCJvcmlnaW5hbFJlcG9ydFBhdGgiLCJ6aXBwZWRSZXBvcnRQYXRoIiwidGVtcERpciIsInByZWZpeCIsInBhcnNlIiwibmFtZSIsInN1ZmZpeCIsInppcCIsInRvQXJjaGl2ZSIsImN3ZCIsImRpcm5hbWUiLCJyaW1yYWYiLCJpc1J1bm5pbmciLCJfZW5mb3JjZVRlcm1pbmF0aW9uIiwiZGVidWciLCJzdG9wIiwiaWduIiwicGVyZm9ybUNsZWFudXAiLCJCIiwiYWxsIiwiZmlsdGVyIiwiQm9vbGVhbiIsIm1hcCIsIngiLCJ3YXJuIiwiZmluYWxseSIsImNhdGNoIiwic3RhcnQiLCJiaW5hcnlQYXRoIiwiYXJncyIsInRvb2xOYW1lIiwiYmFzZW5hbWUiLCJwdXNoIiwiZnVsbENtZCIsIlN1YlByb2Nlc3MiLCJzbGljZSIsInV0aWwiLCJxdW90ZSIsIm9uIiwic3Rkb3V0IiwidHJpbSIsIm9uY2UiLCJjb2RlIiwic2lnbmFsIiwid2FpdEZvckNvbmRpdGlvbiIsIndhaXRNcyIsImludGVydmFsTXMiLCJsaXN0UHJvZmlsZXNDb21tYW5kIiwiZXJyb3JBbmRUaHJvdyIsImluZm8iLCJmb3JjZSIsIm1vYmlsZVN0YXJ0UGVyZlJlY29yZCIsImlzRmVhdHVyZUVuYWJsZWQiLCJpc1JlYWxEZXZpY2UiLCJsb2ciLCJpc0VtcHR5IiwiX3BlcmZSZWNvcmRlcnMiLCJyZWNvcmRlciIsImRldmljZSIsInB1bGwiLCJyZWFsUGlkIiwidG9Mb3dlciIsImFwcEluZm8iLCJwcm94eUNvbW1hbmQiLCJvcGVuRGlyIiwicGFyc2VJbnQiLCJtb2JpbGVTdG9wUGVyZlJlY29yZCIsInJlbW90ZVBhdGgiLCJyZWNvcmRlcnMiLCJmaXJzdCIsInJlc3VsdFBhdGgiLCJyZXN1bHQiLCJlbmNvZGVCYXNlNjRPclVwbG9hZCJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4iLCJzb3VyY2VzIjpbImxpYi9jb21tYW5kcy9wZXJmb3JtYW5jZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBmcywgemlwLCBsb2dnZXIsIHV0aWwsIHRlbXBEaXIgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHsgU3ViUHJvY2VzcywgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyBlbmNvZGVCYXNlNjRPclVwbG9hZCB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCB7IHdhaXRGb3JDb25kaXRpb24gfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5cbmNvbnN0IGNvbW1hbmRzID0ge307XG5cbmNvbnN0IFBFUkZfUkVDT1JEX0ZFQVRfTkFNRSA9ICdwZXJmX3JlY29yZCc7XG5jb25zdCBQRVJGX1JFQ09SRF9TRUNVUklUWV9NRVNTQUdFID0gJ1BlcmZvcm1hbmNlIG1lYXN1cmVtZW50IHJlcXVpcmVzIHJlbGF4aW5nIHNlY3VyaXR5IGZvciBzaW11bGF0b3IuICcgK1xuICBgUGxlYXNlIHNldCAnLS1yZWxheGVkLXNlY3VyaXR5JyBvciAnLS1hbGxvdy1pbnNlY3VyZScgd2l0aCAnJHtQRVJGX1JFQ09SRF9GRUFUX05BTUV9JyBgICtcbiAgJ3JlZmVyZW5jaW5nIGh0dHBzOi8vZ2l0aHViLmNvbS9hcHBpdW0vYXBwaXVtL2Jsb2IvbWFzdGVyL2RvY3MvZW4vd3JpdGluZy1ydW5uaW5nLWFwcGl1bS9zZWN1cml0eS5tZCBmb3IgbW9yZSBkZXRhaWxzLic7XG5jb25zdCBERUZBVUxUX1RJTUVPVVRfTVMgPSA1ICogNjAgKiAxMDAwO1xuY29uc3QgU1RPUF9USU1FT1VUX01TID0gMyAqIDYwICogMTAwMDtcbmNvbnN0IFNUQVJUVVBfVElNRU9VVF9NUyA9IDYwICogMTAwMDtcbmNvbnN0IERFRkFVTFRfUFJPRklMRV9OQU1FID0gJ0FjdGl2aXR5IE1vbml0b3InO1xuY29uc3QgREVGQVVMVF9FWFQgPSAnLnRyYWNlJztcbmNvbnN0IERFRkFVTFRfUElEID0gJ2N1cnJlbnQnO1xuY29uc3QgSU5TVFJVTUVOVFMgPSAnaW5zdHJ1bWVudHMnO1xuY29uc3QgWENSVU4gPSAneGNydW4nO1xuY29uc3QgWENUUkFDRSA9ICd4Y3RyYWNlJztcblxuXG5hc3luYyBmdW5jdGlvbiByZXF1aXJlWGN0cmFjZSAoKSB7XG4gIGxldCB4Y3J1blBhdGg7XG4gIHRyeSB7XG4gICAgeGNydW5QYXRoID0gYXdhaXQgZnMud2hpY2goWENSVU4pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke1hDUlVOfSBoYXMgbm90IGJlZW4gZm91bmQgaW4gUEFUSC4gYCArXG4gICAgICBgUGxlYXNlIG1ha2Ugc3VyZSBYQ29kZSBkZXZlbG9wbWVudCB0b29scyBhcmUgaW5zdGFsbGVkYCk7XG4gIH1cbiAgdHJ5IHtcbiAgICBhd2FpdCBleGVjKHhjcnVuUGF0aCwgW1hDVFJBQ0UsICdoZWxwJ10pO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke1hDVFJBQ0V9IGlzIG5vdCBhdmFpbGFibGUgZm9yIHRoZSBhY3RpdmUgWGNvZGUgdmVyc2lvbi4gYCArXG4gICAgICBgUGxlYXNlIG1ha2Ugc3VyZSBYQ29kZSBpcyB1cCB0byBkYXRlLiBPcmlnaW5hbCBlcnJvcjogJHtlLnN0ZGVyciB8fCBlLm1lc3NhZ2V9YCk7XG4gIH1cbiAgcmV0dXJuIHhjcnVuUGF0aDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gcmVxdWlyZUluc3RydW1lbnRzICgpIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgZnMud2hpY2goSU5TVFJVTUVOVFMpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke0lOU1RSVU1FTlRTfSBoYXMgbm90IGJlZW4gZm91bmQgaW4gUEFUSC4gYCArXG4gICAgICBgUGxlYXNlIG1ha2Ugc3VyZSBYQ29kZSBkZXZlbG9wbWVudCB0b29scyBhcmUgaW5zdGFsbGVkYCk7XG4gIH1cbn1cblxuXG5jbGFzcyBQZXJmUmVjb3JkZXIge1xuICBjb25zdHJ1Y3RvciAocmVwb3J0Um9vdCwgdWRpZCwgb3B0cyA9IHt9KSB7XG4gICAgdGhpcy5fcHJvY2VzcyA9IG51bGw7XG4gICAgdGhpcy5femlwcGVkUmVwb3J0UGF0aCA9ICcnO1xuICAgIHRoaXMuX3RpbWVvdXQgPSAob3B0cy50aW1lb3V0ICYmIG9wdHMudGltZW91dCA+IDApID8gb3B0cy50aW1lb3V0IDogREVGQVVMVF9USU1FT1VUX01TO1xuICAgIHRoaXMuX3Byb2ZpbGVOYW1lID0gb3B0cy5wcm9maWxlTmFtZSB8fCBERUZBVUxUX1BST0ZJTEVfTkFNRTtcbiAgICB0aGlzLl9yZXBvcnRQYXRoID0gcGF0aC5yZXNvbHZlKHJlcG9ydFJvb3QsXG4gICAgICBgYXBwaXVtX3BlcmZfXyR7dGhpcy5fcHJvZmlsZU5hbWUucmVwbGFjZSgvXFxXL2csICdfJyl9X18ke0RhdGUubm93KCl9JHtERUZBVUxUX0VYVH1gKTtcbiAgICB0aGlzLl9waWQgPSBvcHRzLnBpZDtcbiAgICB0aGlzLl91ZGlkID0gdWRpZDtcbiAgICB0aGlzLl9sb2dnZXIgPSBsb2dnZXIuZ2V0TG9nZ2VyKFxuICAgICAgYCR7Xy50cnVuY2F0ZSh0aGlzLl9wcm9maWxlTmFtZSwge2xlbmd0aDogMTB9KX1AJHt0aGlzLl91ZGlkLnN1YnN0cmluZygwLCA4KX1gKTtcbiAgICB0aGlzLl9hcmNoaXZlUHJvbWlzZSA9IG51bGw7XG4gIH1cblxuICBnZXQgcHJvZmlsZU5hbWUgKCkge1xuICAgIHJldHVybiB0aGlzLl9wcm9maWxlTmFtZTtcbiAgfVxuXG4gIGFzeW5jIGdldE9yaWdpbmFsUmVwb3J0UGF0aCAoKSB7XG4gICAgcmV0dXJuIChhd2FpdCBmcy5leGlzdHModGhpcy5fcmVwb3J0UGF0aCkpID8gdGhpcy5fcmVwb3J0UGF0aCA6ICcnO1xuICB9XG5cbiAgYXN5bmMgZ2V0WmlwcGVkUmVwb3J0UGF0aCAoKSB7XG4gICAgLy8gVGhpcyBpcyB0byBwcmV2ZW50IHBvc3NpYmxlIHJhY2UgY29uZGl0aW9ucywgYmVjYXVzZSB0aGUgYXJjaGl2ZSBvcGVyYXRpb25cbiAgICAvLyBjb3VsZCBiZSBwcmV0dHkgdGltZS1pbnRlbnNpdmVcbiAgICBpZiAoIXRoaXMuX2FyY2hpdmVQcm9taXNlKSB7XG4gICAgICB0aGlzLl9hcmNoaXZlUHJvbWlzZSA9IChhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IG9yaWdpbmFsUmVwb3J0UGF0aCA9IGF3YWl0IHRoaXMuZ2V0T3JpZ2luYWxSZXBvcnRQYXRoKCk7XG4gICAgICAgIGlmICghb3JpZ2luYWxSZXBvcnRQYXRoKSB7XG4gICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHppcHBlZFJlcG9ydFBhdGggPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe1xuICAgICAgICAgIHByZWZpeDogcGF0aC5wYXJzZShvcmlnaW5hbFJlcG9ydFBhdGgpLm5hbWUsXG4gICAgICAgICAgc3VmZml4OiAnLnppcCdcbiAgICAgICAgfSk7XG4gICAgICAgIGF3YWl0IHppcC50b0FyY2hpdmUoemlwcGVkUmVwb3J0UGF0aCwge1xuICAgICAgICAgIGN3ZDogcGF0aC5kaXJuYW1lKHRoaXMuX3JlcG9ydFBhdGgpLFxuICAgICAgICB9KTtcbiAgICAgICAgYXdhaXQgZnMucmltcmFmKHBhdGguZGlybmFtZSh0aGlzLl9yZXBvcnRQYXRoKSk7XG4gICAgICAgIHRoaXMuX3ppcHBlZFJlcG9ydFBhdGggPSB6aXBwZWRSZXBvcnRQYXRoO1xuICAgICAgICByZXR1cm4gdGhpcy5femlwcGVkUmVwb3J0UGF0aDtcbiAgICAgIH0pKCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLl9hcmNoaXZlUHJvbWlzZTtcbiAgfVxuXG4gIGlzUnVubmluZyAoKSB7XG4gICAgcmV0dXJuICEhKHRoaXMuX3Byb2Nlc3M/LmlzUnVubmluZyk7XG4gIH1cblxuICBhc3luYyBfZW5mb3JjZVRlcm1pbmF0aW9uICgpIHtcbiAgICBpZiAodGhpcy5fcHJvY2VzcyAmJiB0aGlzLmlzUnVubmluZygpKSB7XG4gICAgICB0aGlzLl9sb2dnZXIuZGVidWcoJ0ZvcmNlLXN0b3BwaW5nIHRoZSBjdXJyZW50bHkgcnVubmluZyBwZXJmIHJlY29yZGluZycpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5fcHJvY2Vzcy5zdG9wKCdTSUdLSUxMJyk7XG4gICAgICB9IGNhdGNoIChpZ24pIHt9XG4gICAgfVxuICAgIHRoaXMuX3Byb2Nlc3MgPSBudWxsO1xuICAgIGNvbnN0IHBlcmZvcm1DbGVhbnVwID0gYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgQi5hbGwoW3RoaXMuX3ppcHBlZFJlcG9ydFBhdGgsIHBhdGguZGlybmFtZSh0aGlzLl9yZXBvcnRQYXRoKV1cbiAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pLm1hcCgoeCkgPT4gZnMucmltcmFmKHgpKSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRoaXMuX2xvZ2dlci53YXJuKGUubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAodGhpcy5fYXJjaGl2ZVByb21pc2UpIHtcbiAgICAgIHRoaXMuX2FyY2hpdmVQcm9taXNlXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by10aGVuXG4gICAgICAgIC5maW5hbGx5KGFzeW5jICgpID0+IHtcbiAgICAgICAgICBhd2FpdCBwZXJmb3JtQ2xlYW51cCgpO1xuICAgICAgICAgIHRoaXMuX2FyY2hpdmVQcm9taXNlID0gbnVsbDtcbiAgICAgICAgfSlcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLXRoZW5cbiAgICAgICAgLmNhdGNoKCgpID0+IHt9KTtcbiAgICB9XG4gICAgYXdhaXQgcGVyZm9ybUNsZWFudXAoKTtcbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICBhc3luYyBzdGFydCAoKSB7XG4gICAgbGV0IGJpbmFyeVBhdGg7XG4gICAgdHJ5IHtcbiAgICAgIGJpbmFyeVBhdGggPSBhd2FpdCByZXF1aXJlWGN0cmFjZSgpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZyhlLm1lc3NhZ2UpO1xuICAgICAgdGhpcy5fbG9nZ2VyLndhcm4oYERlZmF1bHRpbmcgdG8gJHtJTlNUUlVNRU5UU30gdXNhZ2VgKTtcbiAgICAgIGJpbmFyeVBhdGggPSBhd2FpdCByZXF1aXJlSW5zdHJ1bWVudHMoKTtcbiAgICB9XG5cbiAgICBjb25zdCBhcmdzID0gW107XG4gICAgY29uc3QgdG9vbE5hbWUgPSBwYXRoLmJhc2VuYW1lKGJpbmFyeVBhdGgpID09PSBYQ1JVTiA/IFhDVFJBQ0UgOiBJTlNUUlVNRU5UUztcbiAgICBpZiAodG9vbE5hbWUgPT09IFhDVFJBQ0UpIHtcbiAgICAgIGFyZ3MucHVzaChcbiAgICAgICAgWENUUkFDRSwgJ3JlY29yZCcsXG4gICAgICAgICctLWRldmljZScsIHRoaXMuX3VkaWQsXG4gICAgICAgICctLXRlbXBsYXRlJywgdGhpcy5fcHJvZmlsZU5hbWUsXG4gICAgICAgICctLW91dHB1dCcsIHRoaXMuX3JlcG9ydFBhdGgsXG4gICAgICAgICctLXRpbWUtbGltaXQnLCBgJHt0aGlzLl90aW1lb3V0fW1zYCxcbiAgICAgICk7XG4gICAgICBpZiAodGhpcy5fcGlkKSB7XG4gICAgICAgIGFyZ3MucHVzaCgnLS1hdHRhY2gnLCBgJHt0aGlzLl9waWR9YCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcmdzLnB1c2goJy0tYWxsLXByb2Nlc3NlcycpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBodHRwczovL2hlbHAuYXBwbGUuY29tL2luc3RydW1lbnRzL21hYy9jdXJyZW50LyMvZGV2YjE0ZmZhYTVcbiAgICAgIGFyZ3MucHVzaChcbiAgICAgICAgJy13JywgdGhpcy5fdWRpZCxcbiAgICAgICAgJy10JywgdGhpcy5fcHJvZmlsZU5hbWUsXG4gICAgICAgICctRCcsIHRoaXMuX3JlcG9ydFBhdGgsXG4gICAgICAgICctbCcsIGAke3RoaXMuX3RpbWVvdXR9YCxcbiAgICAgICk7XG4gICAgICBpZiAodGhpcy5fcGlkKSB7XG4gICAgICAgIGFyZ3MucHVzaCgnLXAnLCBgJHt0aGlzLl9waWR9YCk7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IGZ1bGxDbWQgPSBbYmluYXJ5UGF0aCwgLi4uYXJnc107XG4gICAgdGhpcy5fcHJvY2VzcyA9IG5ldyBTdWJQcm9jZXNzKGZ1bGxDbWRbMF0sIGZ1bGxDbWQuc2xpY2UoMSkpO1xuICAgIHRoaXMuX2FyY2hpdmVQcm9taXNlID0gbnVsbDtcbiAgICB0aGlzLl9sb2dnZXIuZGVidWcoYFN0YXJ0aW5nIHBlcmZvcm1hbmNlIHJlY29yZGluZzogJHt1dGlsLnF1b3RlKGZ1bGxDbWQpfWApO1xuICAgIHRoaXMuX3Byb2Nlc3Mub24oJ291dHB1dCcsIChzdGRvdXQsIHN0ZGVycikgPT4ge1xuICAgICAgaWYgKF8udHJpbShzdGRvdXQgfHwgc3RkZXJyKSkge1xuICAgICAgICB0aGlzLl9sb2dnZXIuZGVidWcoYFske3Rvb2xOYW1lfV0gJHtzdGRvdXQgfHwgc3RkZXJyfWApO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuX3Byb2Nlc3Mub25jZSgnZXhpdCcsIGFzeW5jIChjb2RlLCBzaWduYWwpID0+IHtcbiAgICAgIHRoaXMuX3Byb2Nlc3MgPSBudWxsO1xuICAgICAgaWYgKGNvZGUgPT09IDApIHtcbiAgICAgICAgdGhpcy5fbG9nZ2VyLmRlYnVnKCdQZXJmb3JtYW5jZSByZWNvcmRpbmcgZXhpdGVkIHdpdGhvdXQgZXJyb3JzJyk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gY2FjaGUgemlwcGVkIHJlcG9ydFxuICAgICAgICAgIGF3YWl0IHRoaXMuZ2V0WmlwcGVkUmVwb3J0UGF0aCgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgdGhpcy5fbG9nZ2VyLndhcm4oZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF3YWl0IHRoaXMuX2VuZm9yY2VUZXJtaW5hdGlvbigpO1xuICAgICAgICB0aGlzLl9sb2dnZXIud2FybihgUGVyZm9ybWFuY2UgcmVjb3JkaW5nIGV4aXRlZCB3aXRoIGVycm9yIGNvZGUgJHtjb2RlfSwgc2lnbmFsICR7c2lnbmFsfWApO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGF3YWl0IHRoaXMuX3Byb2Nlc3Muc3RhcnQoMCk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHdhaXRGb3JDb25kaXRpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICBpZiAoYXdhaXQgdGhpcy5nZXRPcmlnaW5hbFJlcG9ydFBhdGgoKSkge1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5fcHJvY2Vzcykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJHt0b29sTmFtZX0gcHJvY2VzcyBkaWVkIHVuZXhwZWN0ZWRseWApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0sIHtcbiAgICAgICAgd2FpdE1zOiBTVEFSVFVQX1RJTUVPVVRfTVMsXG4gICAgICAgIGludGVydmFsTXM6IDUwMCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGF3YWl0IHRoaXMuX2VuZm9yY2VUZXJtaW5hdGlvbigpO1xuICAgICAgY29uc3QgbGlzdFByb2ZpbGVzQ29tbWFuZCA9IHRvb2xOYW1lID09PSBYQ1RSQUNFXG4gICAgICAgID8gYCR7WENSVU59ICR7WENUUkFDRX0gbGlzdCB0ZW1wbGF0ZXNgXG4gICAgICAgIDogYCR7SU5TVFJVTUVOVFN9IC1zYDtcbiAgICAgIHRoaXMuX2xvZ2dlci5lcnJvckFuZFRocm93KGBUaGVyZSBpcyBubyAke0RFRkFVTFRfRVhUfSBmaWxlIGZvdW5kIGZvciBwZXJmb3JtYW5jZSBwcm9maWxlIGAgK1xuICAgICAgICBgJyR7dGhpcy5fcHJvZmlsZU5hbWV9Jy4gTWFrZSBzdXJlIHRoZSBwcm9maWxlIGlzIHN1cHBvcnRlZCBvbiB0aGlzIGRldmljZS4gYCArXG4gICAgICAgIGBZb3UgY291bGQgdXNlICcke2xpc3RQcm9maWxlc0NvbW1hbmR9JyBjb21tYW5kIHRvIHNlZSB0aGUgbGlzdCBvZiBhbGwgYXZhaWxhYmxlIHByb2ZpbGVzLiBgICtcbiAgICAgICAgYENoZWNrIHRoZSBzZXJ2ZXIgbG9nIGZvciBtb3JlIGRldGFpbHNgKTtcbiAgICB9XG4gICAgdGhpcy5fbG9nZ2VyLmluZm8oYFRoZSBwZXJmb3JtYW5jZSByZWNvcmRpbmcgaGFzIHN0YXJ0ZWQuIFdpbGwgdGltZW91dCBpbiAke3RoaXMuX3RpbWVvdXR9bXNgKTtcbiAgfVxuXG4gIGFzeW5jIHN0b3AgKGZvcmNlID0gZmFsc2UpIHtcbiAgICBpZiAoZm9yY2UpIHtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLl9lbmZvcmNlVGVybWluYXRpb24oKTtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuaXNSdW5uaW5nKCkpIHtcbiAgICAgIHRoaXMuX2xvZ2dlci5kZWJ1ZygnUGVyZm9ybWFuY2UgcmVjb3JkaW5nIGlzIG5vdCBydW5uaW5nLiBSZXR1cm5pbmcgdGhlIHJlY2VudCByZXN1bHQnKTtcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFppcHBlZFJlcG9ydFBhdGgoKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgdGhpcy5fcHJvY2Vzcy5zdG9wKCdTSUdJTlQnLCBTVE9QX1RJTUVPVVRfTVMpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRoaXMuX2xvZ2dlci5lcnJvckFuZFRocm93KGBQZXJmb3JtYW5jZSByZWNvcmRpbmcgaGFzIGZhaWxlZCB0byBleGl0IGFmdGVyICR7U1RPUF9USU1FT1VUX01TfW1zYCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFppcHBlZFJlcG9ydFBhdGgoKTtcbiAgfVxufVxuXG5cbi8qKlxuICogQHR5cGVkZWYge09iamVjdH0gU3RhcnRQZXJmUmVjb3JkT3B0aW9uc1xuICpcbiAqIEBwcm9wZXJ0eSB7P251bWJlcnxzdHJpbmd9IHRpbWVvdXQgWzMwMDAwMF0gLSBUaGUgbWF4aW11bSBjb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gcmVjb3JkIHRoZSBwcm9maWxpbmcgaW5mb3JtYXRpb24uXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHByb2ZpbGVOYW1lIFtBY3Rpdml0eSBNb25pdG9yXSAtIFRoZSBuYW1lIG9mIGV4aXN0aW5nIHBlcmZvcm1hbmNlIHByb2ZpbGUgdG8gYXBwbHkuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhbiBhbHNvIGNvbnRhaW4gdGhlIGZ1bGwgcGF0aCB0byB0aGUgY2hvc2VuIHRlbXBsYXRlIG9uIHRoZSBzZXJ2ZXIgZmlsZSBzeXN0ZW0uXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE5vdGUsIHRoYXQgbm90IGFsbCBwcm9maWxlcyBhcmUgc3VwcG9ydGVkIG9uIG1vYmlsZSBkZXZpY2VzLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfG51bWJlcn0gcGlkIC0gVGhlIElEIG9mIHRoZSBwcm9jZXNzIHRvIG1lYXN1cmUgdGhlIHBlcmZvcm1hbmNlIGZvci5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNldCBpdCB0byBgY3VycmVudGAgaW4gb3JkZXIgdG8gbWVhc3VyZSB0aGUgcGVyZm9ybWFuY2Ugb2ZcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZSBwcm9jZXNzLCB3aGljaCBiZWxvbmdzIHRvIHRoZSBjdXJyZW50bHkgYWN0aXZlIGFwcGxpY2F0aW9uLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQWxsIHByb2Nlc3NlcyBydW5uaW5nIG9uIHRoZSBkZXZpY2UgYXJlIG1lYXN1cmVkIGlmXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaWQgaXMgdW5zZXQgKHRoZSBkZWZhdWx0IHNldHRpbmcpLlxuICovXG5cbi8qKlxuICogU3RhcnRzIHBlcmZvcm1hbmNlIHByb2ZpbGluZyBmb3IgdGhlIGRldmljZSB1bmRlciB0ZXN0LlxuICogUmVsYXhpbmcgc2VjdXJpdHkgaXMgbWFuZGF0b3J5IGZvciBzaW11bGF0b3JzLiBJdCBjYW4gYWx3YXlzIHdvcmsgZm9yIHJlYWwgZGV2aWNlcy5cbiAqXG4gKiBTaW5jZSBYQ29kZSAxNCB0aGUgbWV0aG9kIHRyaWVzIHRvIHVzZSBgeGN0cmFjZWAgdG9vbCB0byByZWNvcmQgcGVyZm9ybWFuY2Ugc3RhdHMuXG4gKiBUaGUgYGluc3RydW1lbnRzYCBkZXZlbG9wZXIgdXRpbGl0eSBpcyB1c2VkIGFzIGEgZmFsbGJhY2sgZm9yIHRoaXMgcHVycG9zZSBpZiBgeGN0cmFjZWBcbiAqIGlzIG5vdCBhdmFpbGFibGUuXG4gKiBJdCBpcyBwb3NzaWJsZSB0byByZWNvcmQgbXVsdGlwbGUgcHJvZmlsZXMgYXQgdGhlIHNhbWUgdGltZS5cbiAqIFJlYWQgaHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2xpYnJhcnkvY29udGVudC9kb2N1bWVudGF0aW9uL0RldmVsb3BlclRvb2xzL0NvbmNlcHR1YWwvSW5zdHJ1bWVudHNVc2VyR3VpZGUvUmVjb3JkaW5nLFBhdXNpbmcsYW5kU3RvcHBpbmdUcmFjZXMuaHRtbFxuICogZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBAcGFyYW0gez9TdGFydFBlcmZSZWNvcmRPcHRpb25zfSBvcHRzIC0gVGhlIHNldCBvZiBwb3NzaWJsZSBzdGFydCByZWNvcmQgb3B0aW9uc1xuICovXG5jb21tYW5kcy5tb2JpbGVTdGFydFBlcmZSZWNvcmQgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTdGFydFBlcmZSZWNvcmQgKG9wdHMgPSB7fSkge1xuICBpZiAoIXRoaXMuaXNGZWF0dXJlRW5hYmxlZChQRVJGX1JFQ09SRF9GRUFUX05BTUUpICYmICF0aGlzLmlzUmVhbERldmljZSgpKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdyhQRVJGX1JFQ09SRF9TRUNVUklUWV9NRVNTQUdFKTtcbiAgfVxuXG4gIGNvbnN0IHtcbiAgICB0aW1lb3V0ID0gREVGQVVMVF9USU1FT1VUX01TLFxuICAgIHByb2ZpbGVOYW1lID0gREVGQVVMVF9QUk9GSUxFX05BTUUsXG4gICAgcGlkLFxuICB9ID0gb3B0cztcblxuICBpZiAoIV8uaXNFbXB0eSh0aGlzLl9wZXJmUmVjb3JkZXJzKSkge1xuICAgIGZvciAoY29uc3QgcmVjb3JkZXIgb2YgdGhpcy5fcGVyZlJlY29yZGVycy5maWx0ZXIoKHgpID0+IHgucHJvZmlsZU5hbWUgPT09IHByb2ZpbGVOYW1lKSkge1xuICAgICAgaWYgKHJlY29yZGVyLmlzUnVubmluZygpKSB7XG4gICAgICAgIHRoaXMubG9nLmRlYnVnKGBQZXJmb3JtYW5jZSByZWNvcmRlciBmb3IgJyR7cHJvZmlsZU5hbWV9JyBvbiBkZXZpY2UgJyR7dGhpcy5vcHRzLmRldmljZS51ZGlkfScgYCArXG4gICAgICAgICAgYCBpcyBhbHJlYWR5IHJ1bm5pbmcuIERvaW5nIG5vdGhpbmdgKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgXy5wdWxsKHRoaXMuX3BlcmZSZWNvcmRlcnMsIHJlY29yZGVyKTtcbiAgICAgIGF3YWl0IHJlY29yZGVyLnN0b3AodHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgbGV0IHJlYWxQaWQ7XG4gIGlmIChwaWQpIHtcbiAgICBpZiAoXy50b0xvd2VyKHBpZCkgPT09IERFRkFVTFRfUElEKSB7XG4gICAgICBjb25zdCBhcHBJbmZvID0gYXdhaXQgdGhpcy5wcm94eUNvbW1hbmQoJy93ZGEvYWN0aXZlQXBwSW5mbycsICdHRVQnKTtcbiAgICAgIHJlYWxQaWQgPSBhcHBJbmZvLnBpZDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVhbFBpZCA9IHBpZDtcbiAgICB9XG4gIH1cbiAgY29uc3QgcmVjb3JkZXIgPSBuZXcgUGVyZlJlY29yZGVyKGF3YWl0IHRlbXBEaXIub3BlbkRpcigpLCB0aGlzLm9wdHMuZGV2aWNlLnVkaWQsIHtcbiAgICB0aW1lb3V0OiBwYXJzZUludCh0aW1lb3V0LCAxMCksXG4gICAgcHJvZmlsZU5hbWUsXG4gICAgcGlkOiBwYXJzZUludChyZWFsUGlkLCAxMCksXG4gIH0pO1xuICBhd2FpdCByZWNvcmRlci5zdGFydCgpO1xuICB0aGlzLl9wZXJmUmVjb3JkZXJzID0gWy4uLih0aGlzLl9wZXJmUmVjb3JkZXJzIHx8IFtdKSwgcmVjb3JkZXJdO1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTdG9wUmVjb3JkaW5nT3B0aW9uc1xuICpcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gcmVtb3RlUGF0aCAtIFRoZSBwYXRoIHRvIHRoZSByZW1vdGUgbG9jYXRpb24sIHdoZXJlIHRoZSByZXN1bHRpbmcgemlwcGVkIC50cmFjZSBmaWxlIHNob3VsZCBiZSB1cGxvYWRlZC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBmb2xsb3dpbmcgcHJvdG9jb2xzIGFyZSBzdXBwb3J0ZWQ6IGh0dHAvaHR0cHMsIGZ0cC5cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE51bGwgb3IgZW1wdHkgc3RyaW5nIHZhbHVlICh0aGUgZGVmYXVsdCBzZXR0aW5nKSBtZWFucyB0aGUgY29udGVudCBvZiByZXN1bHRpbmdcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUgc2hvdWxkIGJlIHppcHBlZCwgZW5jb2RlZCBhcyBCYXNlNjQgYW5kIHBhc3NlZCBhcyB0aGUgZW5kcG9pbnQgcmVzcG9uc2UgdmFsdWUuXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBBbiBleGNlcHRpb24gd2lsbCBiZSB0aHJvd24gaWYgdGhlIGdlbmVyYXRlZCBmaWxlIGlzIHRvbyBiaWcgdG9cbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpdCBpbnRvIHRoZSBhdmFpbGFibGUgcHJvY2VzcyBtZW1vcnkuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHVzZXIgLSBUaGUgbmFtZSBvZiB0aGUgdXNlciBmb3IgdGhlIHJlbW90ZSBhdXRoZW50aWNhdGlvbi4gT25seSB3b3JrcyBpZiBgcmVtb3RlUGF0aGAgaXMgcHJvdmlkZWQuXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHBhc3MgLSBUaGUgcGFzc3dvcmQgZm9yIHRoZSByZW1vdGUgYXV0aGVudGljYXRpb24uIE9ubHkgd29ya3MgaWYgYHJlbW90ZVBhdGhgIGlzIHByb3ZpZGVkLlxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBtZXRob2QgW1BVVF0gLSBUaGUgaHR0cCBtdWx0aXBhcnQgdXBsb2FkIG1ldGhvZCBuYW1lLiBPbmx5IHdvcmtzIGlmIGByZW1vdGVQYXRoYCBpcyBwcm92aWRlZC5cbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gcHJvZmlsZU5hbWUgW0FjdGl2aXR5IE1vbml0b3JdIC0gVGhlIG5hbWUgb2YgYW4gZXhpc3RpbmcgcGVyZm9ybWFuY2UgcHJvZmlsZSBmb3Igd2hpY2ggdGhlIHJlY29yZGluZyBoYXMgYmVlbiBtYWRlLlxuICogQHByb3BlcnR5IHs/T2JqZWN0fSBoZWFkZXJzIC0gQWRkaXRpb25hbCBoZWFkZXJzIG1hcHBpbmcgZm9yIG11bHRpcGFydCBodHRwKHMpIHVwbG9hZHNcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gZmlsZUZpZWxkTmFtZSBbZmlsZV0gLSBUaGUgbmFtZSBvZiB0aGUgZm9ybSBmaWVsZCwgd2hlcmUgdGhlIGZpbGUgY29udGVudCBCTE9CIHNob3VsZCBiZSBzdG9yZWQgZm9yXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaHR0cChzKSB1cGxvYWRzXG4gKiBAcHJvcGVydHkgez9PYmplY3R8QXJyYXk8UGFpcj59IGZvcm1GaWVsZHMgLSBBZGRpdGlvbmFsIGZvcm0gZmllbGRzIGZvciBtdWx0aXBhcnQgaHR0cChzKSB1cGxvYWRzXG4gKi9cblxuLyoqXG4gKiBTdG9wcyBwZXJmb3JtYW5jZSBwcm9maWxpbmcgZm9yIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqIFRoZSByZXN1bHRpbmcgZmlsZSBpbiAudHJhY2UgZm9ybWF0IGNhbiBiZSBlaXRoZXIgcmV0dXJuZWRcbiAqIGRpcmVjdGx5IGFzIGJhc2U2NC1lbmNvZGVkIHppcCBhcmNoaXZlIG9yIHVwbG9hZGVkIHRvIGEgcmVtb3RlIGxvY2F0aW9uXG4gKiAoc3VjaCBmaWxlcyBjYW4gYmUgcHJldHR5IGxhcmdlKS4gQWZ0ZXJ3YXJkcyBpdCBpcyBwb3NzaWJsZSB0byB1bmFyY2hpdmUgYW5kXG4gKiBvcGVuIHN1Y2ggZmlsZSB3aXRoIFhjb2RlIERldiBUb29scy5cbiAqXG4gKiBAcGFyYW0gez9TdG9wUmVjb3JkaW5nT3B0aW9uc30gb3B0cyAtIFRoZSBzZXQgb2YgcG9zc2libGUgc3RvcCByZWNvcmQgb3B0aW9uc1xuICogQHJldHVybiB7c3RyaW5nfSBFaXRoZXIgYW4gZW1wdHkgc3RyaW5nIGlmIHRoZSB1cGxvYWQgd2FzIHN1Y2Nlc3NmdWwgb3IgYmFzZS02NCBlbmNvZGVkXG4gKiBjb250ZW50IG9mIHppcHBlZCAudHJhY2UgZmlsZS5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBubyBwZXJmb3JtYW5jZSByZWNvcmRpbmcgd2l0aCBnaXZlbiBwcm9maWxlIG5hbWUvZGV2aWNlIHVkaWQgY29tYmluYXRpb25cbiAqIGhhcyBiZWVuIHN0YXJ0ZWQgYmVmb3JlIG9yIHRoZSByZXN1bHRpbmcgLnRyYWNlIGZpbGUgaGFzIG5vdCBiZWVuIGdlbmVyYXRlZCBwcm9wZXJseS5cbiAqL1xuY29tbWFuZHMubW9iaWxlU3RvcFBlcmZSZWNvcmQgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTdG9wUGVyZlJlY29yZCAob3B0cyA9IHt9KSB7XG4gIGlmICghdGhpcy5pc0ZlYXR1cmVFbmFibGVkKFBFUkZfUkVDT1JEX0ZFQVRfTkFNRSkgJiYgIXRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICB0aGlzLmxvZy5lcnJvckFuZFRocm93KFBFUkZfUkVDT1JEX1NFQ1VSSVRZX01FU1NBR0UpO1xuICB9XG5cbiAgaWYgKF8uaXNFbXB0eSh0aGlzLl9wZXJmUmVjb3JkZXJzKSkge1xuICAgIHRoaXMubG9nLmluZm8oJ05vIHBlcmZvcm1hbmNlIHJlY29yZGVycyBoYXZlIGJlZW4gc3RhcnRlZC4gRG9pbmcgbm90aGluZycpO1xuICAgIHJldHVybiAnJztcbiAgfVxuXG4gIGNvbnN0IHtcbiAgICBwcm9maWxlTmFtZSA9IERFRkFVTFRfUFJPRklMRV9OQU1FLFxuICAgIHJlbW90ZVBhdGgsXG4gIH0gPSBvcHRzO1xuXG4gIGNvbnN0IHJlY29yZGVycyA9IHRoaXMuX3BlcmZSZWNvcmRlcnMuZmlsdGVyKCh4KSA9PiB4LnByb2ZpbGVOYW1lID09PSBwcm9maWxlTmFtZSk7XG4gIGlmIChfLmlzRW1wdHkocmVjb3JkZXJzKSkge1xuICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coYFRoZXJlIGFyZSBubyByZWNvcmRzIGZvciBwZXJmb3JtYW5jZSBwcm9maWxlICcke3Byb2ZpbGVOYW1lfScgYCArXG4gICAgICBgYW5kIGRldmljZSAke3RoaXMub3B0cy5kZXZpY2UudWRpZH0uIEhhdmUgeW91IHN0YXJ0ZWQgdGhlIHByb2ZpbGluZyBiZWZvcmU/YCk7XG4gIH1cblxuICBjb25zdCByZWNvcmRlciA9IF8uZmlyc3QocmVjb3JkZXJzKTtcbiAgY29uc3QgcmVzdWx0UGF0aCA9IGF3YWl0IHJlY29yZGVyLnN0b3AoKTtcbiAgaWYgKCFhd2FpdCBmcy5leGlzdHMocmVzdWx0UGF0aCkpIHtcbiAgICB0aGlzLmxvZy5lcnJvckFuZFRocm93KGBUaGVyZSBpcyBubyAke0RFRkFVTFRfRVhUfSBmaWxlIGZvdW5kIGZvciBwZXJmb3JtYW5jZSBwcm9maWxlICcke3Byb2ZpbGVOYW1lfScgYCArXG4gICAgICBgYW5kIGRldmljZSAke3RoaXMub3B0cy5kZXZpY2UudWRpZH0uIE1ha2Ugc3VyZSB0aGUgc2VsZWN0ZWQgcHJvZmlsZSBpcyBzdXBwb3J0ZWQgb24gdGhpcyBkZXZpY2VgKTtcbiAgfVxuXG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGVuY29kZUJhc2U2NE9yVXBsb2FkKHJlc3VsdFBhdGgsIHJlbW90ZVBhdGgsIG9wdHMpO1xuICBfLnB1bGwodGhpcy5fcGVyZlJlY29yZGVycywgcmVjb3JkZXIpO1xuICBhd2FpdCBmcy5yaW1yYWYocmVzdWx0UGF0aCk7XG4gIHJldHVybiByZXN1bHQ7XG59O1xuXG5cbmV4cG9ydCB7IGNvbW1hbmRzIH07XG5leHBvcnQgZGVmYXVsdCBjb21tYW5kcztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxRQUFRLEdBQUcsRUFBakI7O0FBRUEsTUFBTUMscUJBQXFCLEdBQUcsYUFBOUI7QUFDQSxNQUFNQyw0QkFBNEIsR0FBRyx1RUFDbEMsK0RBQThERCxxQkFBc0IsSUFEbEQsR0FFbkMsdUhBRkY7QUFHQSxNQUFNRSxrQkFBa0IsR0FBRyxJQUFJLEVBQUosR0FBUyxJQUFwQztBQUNBLE1BQU1DLGVBQWUsR0FBRyxJQUFJLEVBQUosR0FBUyxJQUFqQztBQUNBLE1BQU1DLGtCQUFrQixHQUFHLEtBQUssSUFBaEM7QUFDQSxNQUFNQyxvQkFBb0IsR0FBRyxrQkFBN0I7QUFDQSxNQUFNQyxXQUFXLEdBQUcsUUFBcEI7QUFDQSxNQUFNQyxXQUFXLEdBQUcsU0FBcEI7QUFDQSxNQUFNQyxXQUFXLEdBQUcsYUFBcEI7QUFDQSxNQUFNQyxLQUFLLEdBQUcsT0FBZDtBQUNBLE1BQU1DLE9BQU8sR0FBRyxTQUFoQjs7QUFHQSxlQUFlQyxjQUFmLEdBQWlDO0VBQy9CLElBQUlDLFNBQUo7O0VBQ0EsSUFBSTtJQUNGQSxTQUFTLEdBQUcsTUFBTUMsV0FBQSxDQUFHQyxLQUFILENBQVNMLEtBQVQsQ0FBbEI7RUFDRCxDQUZELENBRUUsT0FBT00sQ0FBUCxFQUFVO0lBQ1YsTUFBTSxJQUFJQyxLQUFKLENBQVcsR0FBRVAsS0FBTSwrQkFBVCxHQUNiLHdEQURHLENBQU47RUFFRDs7RUFDRCxJQUFJO0lBQ0YsTUFBTSxJQUFBUSxrQkFBQSxFQUFLTCxTQUFMLEVBQWdCLENBQUNGLE9BQUQsRUFBVSxNQUFWLENBQWhC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
