"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;

require("source-map-support/register");

var _pyIosDeviceClient = _interopRequireDefault(require("../py-ios-device-client"));

var _support = require("@appium/support");

var _utils = require("../utils");

var _baseDriver = require("@appium/base-driver");

const MAX_CAPTURE_TIME_SEC = 60 * 60 * 12;
const DEFAULT_CAPTURE_TIME_SEC = 60 * 5;
const DEFAULT_EXT = '.pcap';

const pcapLogger = _support.logger.getLogger('pcapd');

const commands = {};
exports.commands = commands;

class TrafficCapture {
  constructor(udid, log, resultPath) {
    this.udid = udid;
    this.log = log;
    this.resultPath = resultPath;
    this.mainProcess = null;
  }

  async start(timeoutSeconds) {
    this.mainProcess = await new _pyIosDeviceClient.default(this.udid).collectPcap(this.resultPath);
    this.mainProcess.on('output', (stdout, stderr) => {
      if (stderr) {
        pcapLogger.info(`${stderr}`);
      }
    });
    this.log.info(`Starting network traffic capture session on the device '${this.udid}'. ` + `Will timeout in ${timeoutSeconds}s`);
    setTimeout(async () => await this.interrupt(), timeoutSeconds * 1000);
    this.mainProcess.once('exit', (code, signal) => {
      this.log.debug(`The traffic capture session on the device '${this.udid}' has exited ` + `with code ${code}, signal ${signal}`);
    });
  }

  isCapturing() {
    var _this$mainProcess;

    return !!((_this$mainProcess = this.mainProcess) !== null && _this$mainProcess !== void 0 && _this$mainProcess.isRunning);
  }

  async interrupt(force = false) {
    if (this.isCapturing()) {
      const interruptPromise = this.mainProcess.stop(force ? 'SIGTERM' : 'SIGINT');
      this.mainProcess = null;

      try {
        await interruptPromise;
      } catch (e) {
        this.log.warn(`Cannot ${force ? 'terminate' : 'interrupt'} the traffic capture session. ` + `Original error: ${e.message}`);
        return false;
      }
    }

    return true;
  }

  async finish() {
    await this.interrupt();
    return this.resultPath;
  }

  async cleanup() {
    if (await _support.fs.exists(this.resultPath)) {
      await _support.fs.rimraf(this.resultPath);
    }
  }

}

commands.mobileStartPcap = async function mobileStartPcap(options = {}) {
  var _this$_trafficCapture;

  if (this.isSimulator()) {
    this.log.errorAndThrow('Network traffic capture only works on real devices');
  }

  const {
    timeLimitSec = DEFAULT_CAPTURE_TIME_SEC,
    forceRestart
  } = options;

  if ((_this$_trafficCapture = this._trafficCapture) !== null && _this$_trafficCapture !== void 0 && _this$_trafficCapture.isCapturing()) {
    this.log.info(`There is an active traffic capture process`);

    if (forceRestart) {
      this.log.info(`Stopping it because 'forceRestart' option is set to true`);
      await this._trafficCapture.interrupt(true);
    } else {
      this.log.info(`Doing nothing. ` + `Set 'forceRestart' option to true if you'd like to start a new traffic capture session`);
      return;
    }
  }

  if (this._trafficCapture) {
    await this._trafficCapture.cleanup();
    this._trafficCapture = null;
  }

  const resultPath = await _support.tempDir.path({
    prefix: `appium_${_support.util.uuidV4().substring(0, 8)}`,
    suffix: DEFAULT_EXT
  });
  const trafficCollector = new TrafficCapture(this.opts.device.udid, this.log, resultPath);
  const timeoutSeconds = parseInt(timeLimitSec, 10);

  if (isNaN(timeoutSeconds) || timeoutSeconds > MAX_CAPTURE_TIME_SEC || timeoutSeconds <= 0) {
    throw new _baseDriver.errors.InvalidArgumentError(`The timeLimitSec value must be in range [1, ${MAX_CAPTURE_TIME_SEC}] seconds. ` + `The value of '${timeLimitSec}' has been passed instead.`);
  }

  try {
    await trafficCollector.start(timeoutSeconds);
  } catch (e) {
    await trafficCollector.interrupt(true);
    await trafficCollector.cleanup();
    throw e;
  }

  this._trafficCapture = trafficCollector;
};

commands.mobileStopPcap = async function mobileStopPcap() {
  if (!this._trafficCapture) {
    this.log.info('Network traffic collector has not been started. There is nothing to stop');
    return '';
  }

  let resultPath;

  try {
    resultPath = await this._trafficCapture.finish();

    if (!(await _support.fs.exists(resultPath))) {
      this.log.errorAndThrow(`The network traffic capture utility has failed ` + `to store the actual traffic capture at '${resultPath}'`);
    }
  } catch (e) {
    await this._trafficCapture.interrupt(true);
    await this._trafficCapture.cleanup();
    this._trafficCapture = null;
    throw e;
  }

  return await (0, _utils.encodeBase64OrUpload)(resultPath);
};

var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL2NvbW1hbmRzL3BjYXAuanMiLCJuYW1lcyI6WyJNQVhfQ0FQVFVSRV9USU1FX1NFQyIsIkRFRkFVTFRfQ0FQVFVSRV9USU1FX1NFQyIsIkRFRkFVTFRfRVhUIiwicGNhcExvZ2dlciIsImxvZ2dlciIsImdldExvZ2dlciIsImNvbW1hbmRzIiwiVHJhZmZpY0NhcHR1cmUiLCJjb25zdHJ1Y3RvciIsInVkaWQiLCJsb2ciLCJyZXN1bHRQYXRoIiwibWFpblByb2Nlc3MiLCJzdGFydCIsInRpbWVvdXRTZWNvbmRzIiwiUHlpZGV2aWNlIiwiY29sbGVjdFBjYXAiLCJvbiIsInN0ZG91dCIsInN0ZGVyciIsImluZm8iLCJzZXRUaW1lb3V0IiwiaW50ZXJydXB0Iiwib25jZSIsImNvZGUiLCJzaWduYWwiLCJkZWJ1ZyIsImlzQ2FwdHVyaW5nIiwiaXNSdW5uaW5nIiwiZm9yY2UiLCJpbnRlcnJ1cHRQcm9taXNlIiwic3RvcCIsImUiLCJ3YXJuIiwibWVzc2FnZSIsImZpbmlzaCIsImNsZWFudXAiLCJmcyIsImV4aXN0cyIsInJpbXJhZiIsIm1vYmlsZVN0YXJ0UGNhcCIsIm9wdGlvbnMiLCJpc1NpbXVsYXRvciIsImVycm9yQW5kVGhyb3ciLCJ0aW1lTGltaXRTZWMiLCJmb3JjZVJlc3RhcnQiLCJfdHJhZmZpY0NhcHR1cmUiLCJ0ZW1wRGlyIiwicGF0aCIsInByZWZpeCIsInV0aWwiLCJ1dWlkVjQiLCJzdWJzdHJpbmciLCJzdWZmaXgiLCJ0cmFmZmljQ29sbGVjdG9yIiwib3B0cyIsImRldmljZSIsInBhcnNlSW50IiwiaXNOYU4iLCJlcnJvcnMiLCJJbnZhbGlkQXJndW1lbnRFcnJvciIsIm1vYmlsZVN0b3BQY2FwIiwiZW5jb2RlQmFzZTY0T3JVcGxvYWQiXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIiwic291cmNlcyI6WyJsaWIvY29tbWFuZHMvcGNhcC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUHlpZGV2aWNlIGZyb20gJy4uL3B5LWlvcy1kZXZpY2UtY2xpZW50JztcbmltcG9ydCB7IGZzLCB0ZW1wRGlyLCBsb2dnZXIsIHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHsgZW5jb2RlQmFzZTY0T3JVcGxvYWQgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgeyBlcnJvcnMgfSBmcm9tICdAYXBwaXVtL2Jhc2UtZHJpdmVyJztcblxuXG5jb25zdCBNQVhfQ0FQVFVSRV9USU1FX1NFQyA9IDYwICogNjAgKiAxMjtcbmNvbnN0IERFRkFVTFRfQ0FQVFVSRV9USU1FX1NFQyA9IDYwICogNTtcbmNvbnN0IERFRkFVTFRfRVhUID0gJy5wY2FwJztcbmNvbnN0IHBjYXBMb2dnZXIgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdwY2FwZCcpO1xuXG5jb25zdCBjb21tYW5kcyA9IHt9O1xuXG5cbmNsYXNzIFRyYWZmaWNDYXB0dXJlIHtcbiAgY29uc3RydWN0b3IgKHVkaWQsIGxvZywgcmVzdWx0UGF0aCkge1xuICAgIHRoaXMudWRpZCA9IHVkaWQ7XG4gICAgdGhpcy5sb2cgPSBsb2c7XG4gICAgdGhpcy5yZXN1bHRQYXRoID0gcmVzdWx0UGF0aDtcbiAgICB0aGlzLm1haW5Qcm9jZXNzID0gbnVsbDtcbiAgfVxuXG4gIGFzeW5jIHN0YXJ0ICh0aW1lb3V0U2Vjb25kcykge1xuICAgIHRoaXMubWFpblByb2Nlc3MgPSBhd2FpdCBuZXcgUHlpZGV2aWNlKHRoaXMudWRpZCkuY29sbGVjdFBjYXAodGhpcy5yZXN1bHRQYXRoKTtcbiAgICB0aGlzLm1haW5Qcm9jZXNzLm9uKCdvdXRwdXQnLCAoc3Rkb3V0LCBzdGRlcnIpID0+IHtcbiAgICAgIGlmIChzdGRlcnIpIHtcbiAgICAgICAgcGNhcExvZ2dlci5pbmZvKGAke3N0ZGVycn1gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLmxvZy5pbmZvKGBTdGFydGluZyBuZXR3b3JrIHRyYWZmaWMgY2FwdHVyZSBzZXNzaW9uIG9uIHRoZSBkZXZpY2UgJyR7dGhpcy51ZGlkfScuIGAgK1xuICAgICAgYFdpbGwgdGltZW91dCBpbiAke3RpbWVvdXRTZWNvbmRzfXNgKTtcbiAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IGF3YWl0IHRoaXMuaW50ZXJydXB0KCksIHRpbWVvdXRTZWNvbmRzICogMTAwMCk7XG4gICAgdGhpcy5tYWluUHJvY2Vzcy5vbmNlKCdleGl0JywgKGNvZGUsIHNpZ25hbCkgPT4ge1xuICAgICAgdGhpcy5sb2cuZGVidWcoYFRoZSB0cmFmZmljIGNhcHR1cmUgc2Vzc2lvbiBvbiB0aGUgZGV2aWNlICcke3RoaXMudWRpZH0nIGhhcyBleGl0ZWQgYCArXG4gICAgICAgIGB3aXRoIGNvZGUgJHtjb2RlfSwgc2lnbmFsICR7c2lnbmFsfWApO1xuICAgIH0pO1xuICB9XG5cbiAgaXNDYXB0dXJpbmcgKCkge1xuICAgIHJldHVybiAhISh0aGlzLm1haW5Qcm9jZXNzPy5pc1J1bm5pbmcpO1xuICB9XG5cbiAgYXN5bmMgaW50ZXJydXB0IChmb3JjZSA9IGZhbHNlKSB7XG4gICAgaWYgKHRoaXMuaXNDYXB0dXJpbmcoKSkge1xuICAgICAgY29uc3QgaW50ZXJydXB0UHJvbWlzZSA9IHRoaXMubWFpblByb2Nlc3Muc3RvcChmb3JjZSA/ICdTSUdURVJNJyA6ICdTSUdJTlQnKTtcbiAgICAgIHRoaXMubWFpblByb2Nlc3MgPSBudWxsO1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgaW50ZXJydXB0UHJvbWlzZTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdGhpcy5sb2cud2FybihgQ2Fubm90ICR7Zm9yY2UgPyAndGVybWluYXRlJyA6ICdpbnRlcnJ1cHQnfSB0aGUgdHJhZmZpYyBjYXB0dXJlIHNlc3Npb24uIGAgK1xuICAgICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGFzeW5jIGZpbmlzaCAoKSB7XG4gICAgYXdhaXQgdGhpcy5pbnRlcnJ1cHQoKTtcbiAgICByZXR1cm4gdGhpcy5yZXN1bHRQYXRoO1xuICB9XG5cbiAgYXN5bmMgY2xlYW51cCAoKSB7XG4gICAgaWYgKGF3YWl0IGZzLmV4aXN0cyh0aGlzLnJlc3VsdFBhdGgpKSB7XG4gICAgICBhd2FpdCBmcy5yaW1yYWYodGhpcy5yZXN1bHRQYXRoKTtcbiAgICB9XG4gIH1cbn1cblxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFN0YXJ0Q2FwdHVyZU9wdGlvbnNcbiAqXG4gKiBAcHJvcGVydHkgez9zdHJpbmd8bnVtYmVyfSB0aW1lTGltaXRTZWMgWzE4MF0gLSBUaGUgbWF4aW11bSB0cmFmZmljIGNhcHR1cmUgdGltZSwgaW4gc2Vjb25kcy5cbiAqIFRoZSBkZWZhdWx0IHZhbHVlIGlzIDE4MCwgdGhlIG1heGltdW0gdmFsdWUgaXMgNDMyMDAgKDEyIGhvdXJzKS5cbiAqIEBwcm9wZXJ0eSB7P2Jvb2xlYW59IGZvcmNlUmVzdGFydCBbZmFsc2VdIC0gV2hldGhlciB0byByZXN0YXJ0IGF1ZGlvIGNhcHR1cmUgcHJvY2VzcyBmb3JjZWZ1bGx5IHdoZW5cbiAqIHN0YXJ0UGNhcCBpcyBjYWxsZWQgKGB0cnVlYCkgb3IgaWdub3JlIHRoZSBjYWxsIHVudGlsIHRoZSBjdXJyZW50IG5ldHdvcmsgdHJhZmZpYyBjYXB0dXJlIGlzIGNvbXBsZXRlZC5cbiAqL1xuXG4vKipcbiAqIFJlY29yZHMgdGhlIGdpdmVuIG5ldHdvcmsgdHJhZmZpYyBjYXB0dXJlIGludG8gYSAucGNhcCBmaWxlLlxuICpcbiAqIEBwYXJhbSB7P1N0YXJ0Q2FwdHVyZU9wdGlvbnN9IG9wdGlvbnMgLSBUaGUgYXZhaWxhYmxlIG9wdGlvbnMuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgbmV0d29yayB0cmFmZmljIGNhcHR1cmUgaGFzIGZhaWxlZCB0byBzdGFydC5cbiAqL1xuY29tbWFuZHMubW9iaWxlU3RhcnRQY2FwID0gYXN5bmMgZnVuY3Rpb24gbW9iaWxlU3RhcnRQY2FwIChvcHRpb25zID0ge30pIHtcbiAgaWYgKHRoaXMuaXNTaW11bGF0b3IoKSkge1xuICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coJ05ldHdvcmsgdHJhZmZpYyBjYXB0dXJlIG9ubHkgd29ya3Mgb24gcmVhbCBkZXZpY2VzJyk7XG4gIH1cblxuICBjb25zdCB7XG4gICAgdGltZUxpbWl0U2VjID0gREVGQVVMVF9DQVBUVVJFX1RJTUVfU0VDLFxuICAgIGZvcmNlUmVzdGFydCxcbiAgfSA9IG9wdGlvbnM7XG5cbiAgaWYgKHRoaXMuX3RyYWZmaWNDYXB0dXJlPy5pc0NhcHR1cmluZygpKSB7XG4gICAgdGhpcy5sb2cuaW5mbyhgVGhlcmUgaXMgYW4gYWN0aXZlIHRyYWZmaWMgY2FwdHVyZSBwcm9jZXNzYCk7XG4gICAgaWYgKGZvcmNlUmVzdGFydCkge1xuICAgICAgdGhpcy5sb2cuaW5mbyhgU3RvcHBpbmcgaXQgYmVjYXVzZSAnZm9yY2VSZXN0YXJ0JyBvcHRpb24gaXMgc2V0IHRvIHRydWVgKTtcbiAgICAgIGF3YWl0IHRoaXMuX3RyYWZmaWNDYXB0dXJlLmludGVycnVwdCh0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5sb2cuaW5mbyhgRG9pbmcgbm90aGluZy4gYCArXG4gICAgICAgIGBTZXQgJ2ZvcmNlUmVzdGFydCcgb3B0aW9uIHRvIHRydWUgaWYgeW91J2QgbGlrZSB0byBzdGFydCBhIG5ldyB0cmFmZmljIGNhcHR1cmUgc2Vzc2lvbmApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBpZiAodGhpcy5fdHJhZmZpY0NhcHR1cmUpIHtcbiAgICBhd2FpdCB0aGlzLl90cmFmZmljQ2FwdHVyZS5jbGVhbnVwKCk7XG4gICAgdGhpcy5fdHJhZmZpY0NhcHR1cmUgPSBudWxsO1xuICB9XG5cbiAgY29uc3QgcmVzdWx0UGF0aCA9IGF3YWl0IHRlbXBEaXIucGF0aCh7XG4gICAgcHJlZml4OiBgYXBwaXVtXyR7dXRpbC51dWlkVjQoKS5zdWJzdHJpbmcoMCwgOCl9YCxcbiAgICBzdWZmaXg6IERFRkFVTFRfRVhULFxuICB9KTtcblxuICBjb25zdCB0cmFmZmljQ29sbGVjdG9yID0gbmV3IFRyYWZmaWNDYXB0dXJlKHRoaXMub3B0cy5kZXZpY2UudWRpZCwgdGhpcy5sb2csIHJlc3VsdFBhdGgpO1xuXG4gIGNvbnN0IHRpbWVvdXRTZWNvbmRzID0gcGFyc2VJbnQodGltZUxpbWl0U2VjLCAxMCk7XG4gIGlmIChpc05hTih0aW1lb3V0U2Vjb25kcykgfHwgdGltZW91dFNlY29uZHMgPiBNQVhfQ0FQVFVSRV9USU1FX1NFQyB8fCB0aW1lb3V0U2Vjb25kcyA8PSAwKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5JbnZhbGlkQXJndW1lbnRFcnJvcihgVGhlIHRpbWVMaW1pdFNlYyB2YWx1ZSBtdXN0IGJlIGluIHJhbmdlIFsxLCAke01BWF9DQVBUVVJFX1RJTUVfU0VDfV0gc2Vjb25kcy4gYCArXG4gICAgICBgVGhlIHZhbHVlIG9mICcke3RpbWVMaW1pdFNlY30nIGhhcyBiZWVuIHBhc3NlZCBpbnN0ZWFkLmApO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBhd2FpdCB0cmFmZmljQ29sbGVjdG9yLnN0YXJ0KHRpbWVvdXRTZWNvbmRzKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGF3YWl0IHRyYWZmaWNDb2xsZWN0b3IuaW50ZXJydXB0KHRydWUpO1xuICAgIGF3YWl0IHRyYWZmaWNDb2xsZWN0b3IuY2xlYW51cCgpO1xuICAgIHRocm93IGU7XG4gIH1cbiAgdGhpcy5fdHJhZmZpY0NhcHR1cmUgPSB0cmFmZmljQ29sbGVjdG9yO1xufTtcblxuLyoqXG4gKiBTdG9wIGNhcHR1cmUgb2YgdGhlIGRldmljZSBuZXR3b3JrIHRyYWZmaWMuIElmIG5vIHRyYWZmaWMgY2FwdHVyZSBwcm9jZXNzIGlzIHJ1bm5pbmcgdGhlblxuICogdGhlIGVuZHBvaW50IHdpbGwgdHJ5IHRvIGdldCB0aGUgcmVjZW50bHkgcmVjb3JkZWQgZmlsZS5cbiAqIElmIG5vIHByZXZpb3VzbHkgcmVjb3JkZWQgZmlsZSBpcyBmb3VuZCBhbmQgbm8gYWN0aXZlIHRyYWZmaWMgY2FwdHVyZVxuICogcHJvY2Vzc2VzIGFyZSBydW5uaW5nIHRoZW4gdGhlIG1ldGhvZCByZXR1cm5zIGFuIGVtcHR5IHN0cmluZy5cbiAqXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBCYXNlNjQtZW5jb2RlZCBjb250ZW50IG9mIHRoZSByZWNvcmRlZCBwY2FwIGZpbGUgb3IgYW5cbiAqIGVtcHR5IHN0cmluZyBpZiBubyB0cmFmZmljIGNhcHR1cmUgaGFzIGJlZW4gc3RhcnRlZCBiZWZvcmUuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGdldHRpbmcgdGhlIGNhcHR1cmUgZmlsZS5cbiAqL1xuY29tbWFuZHMubW9iaWxlU3RvcFBjYXAgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVTdG9wUGNhcCAoKSB7XG4gIGlmICghdGhpcy5fdHJhZmZpY0NhcHR1cmUpIHtcbiAgICB0aGlzLmxvZy5pbmZvKCdOZXR3b3JrIHRyYWZmaWMgY29sbGVjdG9yIGhhcyBub3QgYmVlbiBzdGFydGVkLiBUaGVyZSBpcyBub3RoaW5nIHRvIHN0b3AnKTtcbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICBsZXQgcmVzdWx0UGF0aDtcbiAgdHJ5IHtcbiAgICByZXN1bHRQYXRoID0gYXdhaXQgdGhpcy5fdHJhZmZpY0NhcHR1cmUuZmluaXNoKCk7XG4gICAgaWYgKCFhd2FpdCBmcy5leGlzdHMocmVzdWx0UGF0aCkpIHtcbiAgICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coYFRoZSBuZXR3b3JrIHRyYWZmaWMgY2FwdHVyZSB1dGlsaXR5IGhhcyBmYWlsZWQgYCArXG4gICAgICAgIGB0byBzdG9yZSB0aGUgYWN0dWFsIHRyYWZmaWMgY2FwdHVyZSBhdCAnJHtyZXN1bHRQYXRofSdgKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBhd2FpdCB0aGlzLl90cmFmZmljQ2FwdHVyZS5pbnRlcnJ1cHQodHJ1ZSk7XG4gICAgYXdhaXQgdGhpcy5fdHJhZmZpY0NhcHR1cmUuY2xlYW51cCgpO1xuICAgIHRoaXMuX3RyYWZmaWNDYXB0dXJlID0gbnVsbDtcbiAgICB0aHJvdyBlO1xuICB9XG4gIHJldHVybiBhd2FpdCBlbmNvZGVCYXNlNjRPclVwbG9hZChyZXN1bHRQYXRoKTtcbn07XG5cbmV4cG9ydCB7IGNvbW1hbmRzIH07XG5leHBvcnQgZGVmYXVsdCBjb21tYW5kcztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFHQSxNQUFNQSxvQkFBb0IsR0FBRyxLQUFLLEVBQUwsR0FBVSxFQUF2QztBQUNBLE1BQU1DLHdCQUF3QixHQUFHLEtBQUssQ0FBdEM7QUFDQSxNQUFNQyxXQUFXLEdBQUcsT0FBcEI7O0FBQ0EsTUFBTUMsVUFBVSxHQUFHQyxlQUFBLENBQU9DLFNBQVAsQ0FBaUIsT0FBakIsQ0FBbkI7O0FBRUEsTUFBTUMsUUFBUSxHQUFHLEVBQWpCOzs7QUFHQSxNQUFNQyxjQUFOLENBQXFCO0VBQ25CQyxXQUFXLENBQUVDLElBQUYsRUFBUUMsR0FBUixFQUFhQyxVQUFiLEVBQXlCO0lBQ2xDLEtBQUtGLElBQUwsR0FBWUEsSUFBWjtJQUNBLEtBQUtDLEdBQUwsR0FBV0EsR0FBWDtJQUNBLEtBQUtDLFVBQUwsR0FBa0JBLFVBQWxCO0lBQ0EsS0FBS0MsV0FBTCxHQUFtQixJQUFuQjtFQUNEOztFQUVVLE1BQUxDLEtBQUssQ0FBRUMsY0FBRixFQUFrQjtJQUMzQixLQUFLRixXQUFMLEdBQW1CLE1BQU0sSUFBSUcsMEJBQUosQ0FBYyxLQUFLTixJQUFuQixFQUF5Qk8sV0FBekIsQ0FBcUMsS0FBS0wsVUFBMUMsQ0FBekI7SUFDQSxLQUFLQyxXQUFMLENBQWlCSyxFQUFqQixDQUFvQixRQUFwQixFQUE4QixDQUFDQyxNQUFELEVBQVNDLE1BQVQsS0FBb0I7TUFDaEQsSUFBSUEsTUFBSixFQUFZO1FBQ1ZoQixVQUFVLENBQUNpQixJQUFYLENBQWlCLEdBQUVELE1BQU8sRUFBMUI7TUFDRDtJQUNG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
