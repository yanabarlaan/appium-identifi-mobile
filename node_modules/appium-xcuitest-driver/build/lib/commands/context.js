"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _appiumRemoteDebugger = require("appium-remote-debugger");

var _baseDriver = require("@appium/base-driver");

var _support = require("@appium/support");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _iosPerformanceLog = _interopRequireDefault(require("../device-log/ios-performance-log"));

var _lodash = _interopRequireDefault(require("lodash"));

const NATIVE_WIN = 'NATIVE_APP';
const WEBVIEW_WIN = 'WEBVIEW';
const WEBVIEW_BASE = `${WEBVIEW_WIN}_`;
const RECENT_WEBVIEW_DETECTION_TIMEOUT_MS = 90000;
const commands = {},
      helpers = {},
      extensions = {};

commands.getCurrentContext = async function getCurrentContext() {
  if (this.curContext && this.curContext !== NATIVE_WIN) {
    return `${WEBVIEW_BASE}${this.curContext}`;
  }

  return NATIVE_WIN;
};

extensions.getContextsAndViews = async function getContextsAndViews(useUrl = true) {
  this.log.debug('Retrieving contexts and views');
  let webviews = await this.listWebFrames(useUrl);
  let ctxs = [{
    id: NATIVE_WIN,
    view: {}
  }];
  this.contexts = [NATIVE_WIN];

  for (let view of webviews) {
    ctxs.push({
      id: `${WEBVIEW_BASE}${view.id}`,
      view
    });
    this.contexts.push(view.id.toString());
  }

  return ctxs;
};

extensions.useNewSafari = function useNewSafari() {
  return !this.isRealDevice() && this.opts.safari;
};

extensions.activateRecentWebview = async function activateRecentWebview() {
  this.log.debug('Activating a recent webview');
  const timer = new _support.timing.Timer().start();
  const spinTimeMs = 500;

  const spinHandles = async () => {
    let contextId;

    try {
      contextId = await this.getRecentWebviewContextId(/.*/, /.*/);
    } catch (err) {
      if (!err.message.includes('Could not connect to a valid app after')) {
        const error = new Error(`Could not navigate to webview! Err: ${err.message}`);
        error.stack += `\nCaused by: ${err.stack}`;
        throw error;
      }

      this.log.debug('Could not navigate to webview. Retrying if possible.');
    }

    if (contextId) {
      this.log.debug(`Picking webview '${contextId}'`);
      await this.setContext(contextId);
      await this.remote.cancelPageLoad();
      return;
    }

    if (timer.getDuration().asMilliSeconds >= RECENT_WEBVIEW_DETECTION_TIMEOUT_MS) {
      throw new Error('Could not navigate to webview; there are none!');
    }

    this.log.warn('Could not find any webviews yet, refreshing/retrying');

    if (this.isRealDevice() || !this.opts.safari) {
      await _bluebird.default.delay(spinTimeMs);
      return await spinHandles();
    }

    let element;

    try {
      this.log.debug('Finding and tapping reload button');
      element = await this.findUIElementOrElements('accessibility id', 'ReloadButton', '', false);
      await this.nativeClick(element);
    } catch (err) {
      this.log.warn(`Error finding and tapping reload button: ${err.message}`);
      this.log.warn('Retrying.');
      await _bluebird.default.delay(spinTimeMs);
    }

    return await spinHandles();
  };

  await spinHandles();
};

helpers.stopRemote = async function stopRemote(closeWindowBeforeDisconnecting = false) {
  if (!this.remote) {
    this.log.errorAndThrow('Tried to leave a web frame but were not in one');
  }

  if (closeWindowBeforeDisconnecting) {
    await this.closeWindow();
  }

  await this.remote.disconnect();
  this.curContext = null;
  this.curWebFrames = [];
  this.curWebCoords = null;
  this.remote = null;
};

helpers.setCurrentUrl = function setCurrentUrl(url) {
  this._currentUrl = url;
};

helpers.getCurrentUrl = function getCurrentUrl() {
  return this._currentUrl;
};

extensions.getRecentWebviewContextId = async function getRecentWebviewContextId(titleRegExp, urlRegExp) {
  var _contexts$find;

  if (!_lodash.default.isRegExp(titleRegExp) && !_lodash.default.isRegExp(urlRegExp)) {
    throw new _baseDriver.errors.InvalidArgumentError('A regular expression for either web view title or url must be provided');
  }

  const currentUrl = this.getCurrentUrl();

  const contexts = _lodash.default.filter(await this.getContextsAndViews(false), 'view');

  if (currentUrl) {
    const ctx = contexts.find(({
      view
    }) => (view.url || '') === currentUrl);

    if (ctx) {
      return ctx.id;
    }
  }

  return (_contexts$find = contexts.find(({
    view
  }) => view.title && (titleRegExp === null || titleRegExp === void 0 ? void 0 : titleRegExp.test(view.title)) || view.url && (urlRegExp === null || urlRegExp === void 0 ? void 0 : urlRegExp.test(view.url)))) === null || _contexts$find === void 0 ? void 0 : _contexts$find.id;
};

extensions.isWebContext = function isWebContext() {
  return !!this.curContext && this.curContext !== NATIVE_WIN;
};

extensions.isWebview = function isWebview() {
  return this.isWebContext();
};

extensions.getNewRemoteDebugger = async function getNewRemoteDebugger() {
  let socketPath;

  if (!this.isRealDevice()) {
    socketPath = await this.opts.device.getWebInspectorSocket();
  }

  return (0, _appiumRemoteDebugger.createRemoteDebugger)({
    bundleId: this.opts.bundleId,
    additionalBundleIds: this.opts.additionalWebviewBundleIds,
    isSafari: this.isSafari(),
    includeSafari: this.opts.includeSafariInWebviews,
    useNewSafari: this.useNewSafari(),
    pageLoadMs: this.pageLoadMs,
    platformVersion: this.opts.platformVersion,
    socketPath,
    remoteDebugProxy: this.opts.remoteDebugProxy,
    garbageCollectOnExecute: _support.util.hasValue(this.opts.safariGarbageCollect) ? !!this.opts.safariGarbageCollect : false,
    udid: this.opts.udid,
    logAllCommunication: this.opts.safariLogAllCommunication,
    logAllCommunicationHexDump: this.opts.safariLogAllCommunicationHexDump,
    socketChunkSize: this.opts.safariSocketChunkSize,
    webInspectorMaxFrameLength: this.opts.safariWebInspectorMaxFrameLength
  }, this.isRealDevice());
};

commands.setContext = async function setContext(name, callback, skipReadyCheck) {
  function alreadyInContext(desired, current) {
    return desired === current || desired === null && current === NATIVE_WIN || desired === NATIVE_WIN && current === null;
  }

  function isNativeContext(context) {
    return context === NATIVE_WIN || context === null;
  }

  if (name && name.id) {
    name = name.id;
  }

  this.log.debug(`Attempting to set context to '${name || NATIVE_WIN}' from '${this.curContext ? this.curContext : NATIVE_WIN}'`);

  if (alreadyInContext(name, this.curContext) || alreadyInContext(_lodash.default.replace(name, WEBVIEW_BASE, ''), this.curContext)) {
    this.log.debug(`Already in '${name || NATIVE_WIN}' context. Doing nothing.`);
    return;
  }

  if (isNativeContext(name)) {
    this.curContext = null;
    return;
  }

  if (_lodash.default.isUndefined(this.contexts)) {
    await this.getContexts();
  }

  let contextId = _lodash.default.replace(name, WEBVIEW_BASE, '');

  if (contextId === '') {
    contextId = this.contexts[1];
  }

  if (!_lodash.default.includes(this.contexts, contextId)) {
    throw new _baseDriver.errors.NoSuchContextError();
  }

  const oldContext = this.curContext;
  this.curContext = this.curWindowHandle = contextId;

  const [appIdKey, pageIdKey] = _lodash.default.map(contextId.split('.'), id => parseInt(id, 10));

  try {
    this.selectingNewPage = true;
    await this.remote.selectPage(appIdKey, pageIdKey, skipReadyCheck);
  } catch (err) {
    this.curContext = this.curWindowHandle = oldContext;
    throw err;
  } finally {
    this.selectingNewPage = false;
  }

  if (this.opts.enablePerformanceLogging && this.remote) {
    this.log.debug(`Starting performance log on '${this.curContext}'`);
    this.logs.performance = new _iosPerformanceLog.default(this.remote);
    await this.logs.performance.startCapture();
  }

  if (name && name !== NATIVE_WIN && this.logs) {
    if (this.logs.safariConsole) {
      await this.remote.startConsole(this.logs.safariConsole.addLogLine.bind(this.logs.safariConsole));
    }

    if (this.logs.safariNetwork) {
      await this.remote.startNetwork(this.logs.safariNetwork.addLogLine.bind(this.logs.safariNetwork));
    }
  }
};

extensions.connectToRemoteDebugger = async function connectToRemoteDebugger() {
  this.remote = await this.getNewRemoteDebugger();
  this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_PAGE_CHANGE, this.onPageChange.bind(this));
  this.remote.on(_appiumRemoteDebugger.RemoteDebugger.EVENT_FRAMES_DETACHED, () => {
    if (!_lodash.default.isEmpty(this.curWebFrames)) {
      this.log.debug(`Clearing ${_support.util.pluralize('frame', this.curWebFrames.length, true)}: ${this.curWebFrames.join(', ')}`);
    }

    this.curWebFrames = [];
  });
  await this.remote.connect(this.opts.webviewConnectTimeout);
};

extensions.listWebFrames = async function listWebFrames(useUrl = true) {
  useUrl = useUrl && !this.isRealDevice() && !!this.getCurrentUrl();
  this.log.debug(`Selecting by url: ${useUrl}${useUrl ? ` (expected url: '${this.getCurrentUrl()}')` : ''}`);

  if (!this.remote) {
    await this.connectToRemoteDebugger();

    if (!this.remote.appIdKey) {
      await this.remote.setConnectionKey();
    }
  }

  const getWebviewPages = async () => {
    try {
      return await this.remote.selectApp(useUrl ? this.getCurrentUrl() : undefined, this.opts.webviewConnectRetries, this.opts.ignoreAboutBlankUrl);
    } catch (err) {
      this.log.debug(`No available web pages: ${err.message}`);
      return [];
    }
  };

  const pageArray = await getWebviewPages();

  if (_lodash.default.isEmpty(pageArray)) {
    this.log.debug('No web frames found.');
  }

  return pageArray;
};

commands.getContexts = async function getContexts() {
  this.log.debug('Getting list of available contexts');
  const contexts = await this.getContextsAndViews(false);
  const mapFn = this.opts.fullContextList ? function (context) {
    return {
      id: context.id.toString(),
      title: context.view.title,
      url: context.view.url,
      bundleId: context.view.bundleId
    };
  } : context => context.id.toString();
  return contexts.map(mapFn);
};

extensions.mobileGetContexts = async function mobileGetContexts(opts = {}) {
  let {
    waitForWebviewMs = 0
  } = opts;

  if (!_lodash.default.isNumber(waitForWebviewMs)) {
    waitForWebviewMs = parseInt(waitForWebviewMs, 10);

    if (isNaN(waitForWebviewMs)) {
      waitForWebviewMs = 0;
    }
  }

  const curOpt = this.opts.fullContextList;
  this.opts.fullContextList = true;
  const timer = new _support.timing.Timer().start();

  try {
    let contexts;

    do {
      contexts = await this.getContexts();

      if (contexts.length >= 2) {
        this.log.debug(`Found webview context after ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
        return contexts;
      }

      this.log.debug(`No webviews found in ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
    } while (timer.getDuration().asMilliSeconds < waitForWebviewMs);

    return contexts;
  } finally {
    this.opts.fullContextList = curOpt;
  }
};

commands.setWindow = async function setWindow(name, skipReadyCheck) {
  try {
    await this.setContext(name, _lodash.default.noop, skipReadyCheck);
  } catch (err) {
    throw (0, _baseDriver.isErrorType)(err, _baseDriver.errors.NoSuchContextError) ? new _baseDriver.errors.NoSuchWindowError() : err;
  }
};

commands.getWindowHandle = async function getWindowHandle() {
  if (!this.isWebContext()) {
    throw new _baseDriver.errors.NotImplementedError();
  }

  this.log.debug(`Getting current window handle`);
  return this.curContext;
};

commands.getWindowHandles = async function getWindowHandles() {
  if (!this.isWebContext()) {
    throw new _baseDriver.errors.NotImplementedError();
  }

  this.log.debug('Getting list of available window handles');
  const contexts = await this.getContextsAndViews(false);
  return contexts.filter(context => context.id !== NATIVE_WIN).map(context => context.view.id.toString());
};

extensions.onPageChange = async function onPageChange(pageChangeNotification) {
  this.log.debug(`Remote debugger notified us of a new page listing: ${JSON.stringify(pageChangeNotification)}`);

  if (this.selectingNewPage) {
    this.log.debug('We are in the middle of selecting a page, ignoring');
    return;
  }

  if (!this.remote || !this.remote.isConnected) {
    this.log.debug('We have not yet connected, ignoring');
    return;
  }

  const {
    appIdKey,
    pageArray
  } = pageChangeNotification;
  let newIds = [];
  let newPages = [];
  let keyId = null;

  function isUrlIgnored(url, safariIgnoreWebHostnames) {
    const ignoredHosts = (safariIgnoreWebHostnames || '').split(',').map(b => b.trim()).filter(b => !_lodash.default.isEmpty(b));

    for (const ignoredHost of ignoredHosts) {
      if (ignoredHost === 'about:blank' && url === 'about:blank') {
        return true;
      } else {
        try {
          const hostname = new URL(url).hostname;

          if (hostname === ignoredHost) {
            return true;
          }
        } catch (ign) {}
      }
    }

    return false;
  }

  for (const page of pageArray) {
    const id = page.id.toString();
    newIds.push(id);

    if (page.isKey) {
      keyId = id;
    }

    const contextId = `${appIdKey}.${id}`;

    if (!_lodash.default.includes(this.contexts, contextId)) {
      if (isUrlIgnored(page.url, this.opts.safariIgnoreWebHostnames)) {
        this.log.info(`Not tracking '${page.url}' page because it is blacklisted. ` + `'safariIgnoreWebHostnames'=${this.opts.safariIgnoreWebHostnames}`);
      } else {
        newPages.push(id);
        this.contexts.push(contextId);
      }
    }
  }

  if (!keyId) {
    this.log.debug('No key id found. Choosing first id from page array');
    keyId = newIds[0] || null;
  }

  if (!_support.util.hasValue(this.curContext)) {
    this.log.debug('We do not appear to have window set yet, ignoring');
    return;
  }

  const [curAppIdKey, curPageIdKey] = this.curContext.split('.');

  if (curAppIdKey !== appIdKey) {
    this.log.debug('Page change not referring to currently selected app, ignoring.');
    return;
  }

  let newPage = null;

  if (newPages.length) {
    newPage = _lodash.default.last(newPages);
    this.log.debug(`We have new pages, selecting page '${newPage}'`);
  } else if (!_lodash.default.includes(newIds, curPageIdKey)) {
    this.log.debug('New page listing from remote debugger does not contain ' + 'current window; assuming it is closed');

    if (!_support.util.hasValue(keyId)) {
      this.log.error('Do not have our current window anymore, and there ' + 'are not any more to load! Doing nothing...');
      this.setCurrentUrl(undefined);
      return;
    }

    this.log.debug(`Debugger already selected page '${keyId}', ` + `confirming that choice.`);
    this.curContext = `${appIdKey}.${keyId}`;
    newPage = keyId;
  } else {
    this.log.debug('Checking if page needs to load');

    const needsPageLoad = (() => {
      const contextArray = _lodash.default.map(pageArray, page => `${appIdKey}.${page.id}`);

      return !_lodash.default.isEqual(_lodash.default.find(this.contexts, this.curContext), _lodash.default.find(contextArray, this.curContext));
    })();

    if (needsPageLoad) {
      this.log.debug('Page load needed. Loading...');
      await this.remote.pageLoad();
    }

    this.log.debug('New page listing is same as old, doing nothing');
  }

  if (_support.util.hasValue(this.curContext)) {
    let currentPageId = parseInt(_lodash.default.last(this.curContext.split('.')), 10);

    let page = _lodash.default.find(pageArray, p => parseInt(p.id, 10) === currentPageId);

    if (page && page.url !== this.getCurrentUrl()) {
      this.log.debug(`Redirected from '${this.getCurrentUrl()}' to '${page.url}'`);
      this.setCurrentUrl(page.url);
    }
  }

  if (_support.util.hasValue(newPage)) {
    this.selectingNewPage = true;
    const oldContext = this.curContext;
    this.curContext = `${appIdKey}.${newPage}`;
    this.remote.selectPage(appIdKey, parseInt(newPage, 10)).catch(err => {
      this.log.warn(`Failed to select page: ${err.message}`);
      this.curContext = oldContext;
    });
    this.selectingNewPage = false;
  }

  this.windowHandleCache = pageArray;
};

Object.assign(commands, extensions, helpers);
var _default = commands;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL2NvbW1hbmRzL2NvbnRleHQuanMiLCJuYW1lcyI6WyJOQVRJVkVfV0lOIiwiV0VCVklFV19XSU4iLCJXRUJWSUVXX0JBU0UiLCJSRUNFTlRfV0VCVklFV19ERVRFQ1RJT05fVElNRU9VVF9NUyIsImNvbW1hbmRzIiwiaGVscGVycyIsImV4dGVuc2lvbnMiLCJnZXRDdXJyZW50Q29udGV4dCIsImN1ckNvbnRleHQiLCJnZXRDb250ZXh0c0FuZFZpZXdzIiwidXNlVXJsIiwibG9nIiwiZGVidWciLCJ3ZWJ2aWV3cyIsImxpc3RXZWJGcmFtZXMiLCJjdHhzIiwiaWQiLCJ2aWV3IiwiY29udGV4dHMiLCJwdXNoIiwidG9TdHJpbmciLCJ1c2VOZXdTYWZhcmkiLCJpc1JlYWxEZXZpY2UiLCJvcHRzIiwic2FmYXJpIiwiYWN0aXZhdGVSZWNlbnRXZWJ2aWV3IiwidGltZXIiLCJ0aW1pbmciLCJUaW1lciIsInN0YXJ0Iiwic3BpblRpbWVNcyIsInNwaW5IYW5kbGVzIiwiY29udGV4dElkIiwiZ2V0UmVjZW50V2Vidmlld0NvbnRleHRJZCIsImVyciIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsImVycm9yIiwiRXJyb3IiLCJzdGFjayIsInNldENvbnRleHQiLCJyZW1vdGUiLCJjYW5jZWxQYWdlTG9hZCIsImdldER1cmF0aW9uIiwiYXNNaWxsaVNlY29uZHMiLCJ3YXJuIiwiQiIsImRlbGF5IiwiZWxlbWVudCIsImZpbmRVSUVsZW1lbnRPckVsZW1lbnRzIiwibmF0aXZlQ2xpY2siLCJzdG9wUmVtb3RlIiwiY2xvc2VXaW5kb3dCZWZvcmVEaXNjb25uZWN0aW5nIiwiZXJyb3JBbmRUaHJvdyIsImNsb3NlV2luZG93IiwiZGlzY29ubmVjdCIsImN1cldlYkZyYW1lcyIsImN1cldlYkNvb3JkcyIsInNldEN1cnJlbnRVcmwiLCJ1cmwiLCJfY3VycmVudFVybCIsImdldEN1cnJlbnRVcmwiLCJ0aXRsZVJlZ0V4cCIsInVybFJlZ0V4cCIsIl8iLCJpc1JlZ0V4cCIsImVycm9ycyIsIkludmFsaWRBcmd1bWVudEVycm9yIiwiY3VycmVudFVybCIsImZpbHRlciIsImN0eCIsImZpbmQiLCJ0aXRsZSIsInRlc3QiLCJpc1dlYkNvbnRleHQiLCJpc1dlYnZpZXciLCJnZXROZXdSZW1vdGVEZWJ1Z2dlciIsInNvY2tldFBhdGgiLCJkZXZpY2UiLCJnZXRXZWJJbnNwZWN0b3JTb2NrZXQiLCJjcmVhdGVSZW1vdGVEZWJ1Z2dlciIsImJ1bmRsZUlkIiwiYWRkaXRpb25hbEJ1bmRsZUlkcyIsImFkZGl0aW9uYWxXZWJ2aWV3QnVuZGxlSWRzIiwiaXNTYWZhcmkiLCJpbmNsdWRlU2FmYXJpIiwiaW5jbHVkZVNhZmFyaUluV2Vidmlld3MiLCJwYWdlTG9hZE1zIiwicGxhdGZvcm1WZXJzaW9uIiwicmVtb3RlRGVidWdQcm94eSIsImdhcmJhZ2VDb2xsZWN0T25FeGVjdXRlIiwidXRpbCIsImhhc1ZhbHVlIiwic2FmYXJpR2FyYmFnZUNvbGxlY3QiLCJ1ZGlkIiwibG9nQWxsQ29tbXVuaWNhdGlvbiIsInNhZmFyaUxvZ0FsbENvbW11bmljYXRpb24iLCJsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcCIsInNhZmFyaUxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wIiwic29ja2V0Q2h1bmtTaXplIiwic2FmYXJpU29ja2V0Q2h1bmtTaXplIiwid2ViSW5zcGVjdG9yTWF4RnJhbWVMZW5ndGgiLCJzYWZhcmlXZWJJbnNwZWN0b3JNYXhGcmFtZUxlbmd0aCIsIm5hbWUiLCJjYWxsYmFjayIsInNraXBSZWFkeUNoZWNrIiwiYWxyZWFkeUluQ29udGV4dCIsImRlc2lyZWQiLCJjdXJyZW50IiwiaXNOYXRpdmVDb250ZXh0IiwiY29udGV4dCIsInJlcGxhY2UiLCJpc1VuZGVmaW5lZCIsImdldENvbnRleHRzIiwiTm9TdWNoQ29udGV4dEVycm9yIiwib2xkQ29udGV4dCIsImN1cldpbmRvd0hhbmRsZSIsImFwcElkS2V5IiwicGFnZUlkS2V5IiwibWFwIiwic3BsaXQiLCJwYXJzZUludCIsInNlbGVjdGluZ05ld1BhZ2UiLCJzZWxlY3RQYWdlIiwiZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nIiwibG9ncyIsInBlcmZvcm1hbmNlIiwiSU9TUGVyZm9ybWFuY2VMb2ciLCJzdGFydENhcHR1cmUiLCJzYWZhcmlDb25zb2xlIiwic3RhcnRDb25zb2xlIiwiYWRkTG9nTGluZSIsImJpbmQiLCJzYWZhcmlOZXR3b3JrIiwic3RhcnROZXR3b3JrIiwiY29ubmVjdFRvUmVtb3RlRGVidWdnZXIiLCJvbiIsIlJlbW90ZURlYnVnZ2VyIiwiRVZFTlRfUEFHRV9DSEFOR0UiLCJvblBhZ2VDaGFuZ2UiLCJFVkVOVF9GUkFNRVNfREVUQUNIRUQiLCJpc0VtcHR5IiwicGx1cmFsaXplIiwibGVuZ3RoIiwiam9pbiIsImNvbm5lY3QiLCJ3ZWJ2aWV3Q29ubmVjdFRpbWVvdXQiLCJzZXRDb25uZWN0aW9uS2V5IiwiZ2V0V2Vidmlld1BhZ2VzIiwic2VsZWN0QXBwIiwidW5kZWZpbmVkIiwid2Vidmlld0Nvbm5lY3RSZXRyaWVzIiwiaWdub3JlQWJvdXRCbGFua1VybCIsInBhZ2VBcnJheSIsIm1hcEZuIiwiZnVsbENvbnRleHRMaXN0IiwibW9iaWxlR2V0Q29udGV4dHMiLCJ3YWl0Rm9yV2Vidmlld01zIiwiaXNOdW1iZXIiLCJpc05hTiIsImN1ck9wdCIsInRvRml4ZWQiLCJzZXRXaW5kb3ciLCJub29wIiwiaXNFcnJvclR5cGUiLCJOb1N1Y2hXaW5kb3dFcnJvciIsImdldFdpbmRvd0hhbmRsZSIsIk5vdEltcGxlbWVudGVkRXJyb3IiLCJnZXRXaW5kb3dIYW5kbGVzIiwicGFnZUNoYW5nZU5vdGlmaWNhdGlvbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJpc0Nvbm5lY3RlZCIsIm5ld0lkcyIsIm5ld1BhZ2VzIiwia2V5SWQiLCJpc1VybElnbm9yZWQiLCJzYWZhcmlJZ25vcmVXZWJIb3N0bmFtZXMiLCJpZ25vcmVkSG9zdHMiLCJiIiwidHJpbSIsImlnbm9yZWRIb3N0IiwiaG9zdG5hbWUiLCJVUkwiLCJpZ24iLCJwYWdlIiwiaXNLZXkiLCJpbmZvIiwiY3VyQXBwSWRLZXkiLCJjdXJQYWdlSWRLZXkiLCJuZXdQYWdlIiwibGFzdCIsIm5lZWRzUGFnZUxvYWQiLCJjb250ZXh0QXJyYXkiLCJpc0VxdWFsIiwicGFnZUxvYWQiLCJjdXJyZW50UGFnZUlkIiwicCIsImNhdGNoIiwid2luZG93SGFuZGxlQ2FjaGUiLCJPYmplY3QiLCJhc3NpZ24iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIiwic291cmNlcyI6WyJsaWIvY29tbWFuZHMvY29udGV4dC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVSZW1vdGVEZWJ1Z2dlciwgUmVtb3RlRGVidWdnZXIgfSBmcm9tICdhcHBpdW0tcmVtb3RlLWRlYnVnZ2VyJztcbmltcG9ydCB7IGVycm9ycywgaXNFcnJvclR5cGUgfSBmcm9tICdAYXBwaXVtL2Jhc2UtZHJpdmVyJztcbmltcG9ydCB7IHV0aWwsIHRpbWluZyB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgQiBmcm9tICdibHVlYmlyZCc7XG5pbXBvcnQgSU9TUGVyZm9ybWFuY2VMb2cgZnJvbSAnLi4vZGV2aWNlLWxvZy9pb3MtcGVyZm9ybWFuY2UtbG9nJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmNvbnN0IE5BVElWRV9XSU4gPSAnTkFUSVZFX0FQUCc7XG5jb25zdCBXRUJWSUVXX1dJTiA9ICdXRUJWSUVXJztcbmNvbnN0IFdFQlZJRVdfQkFTRSA9IGAke1dFQlZJRVdfV0lOfV9gO1xuY29uc3QgUkVDRU5UX1dFQlZJRVdfREVURUNUSU9OX1RJTUVPVVRfTVMgPSA5MDAwMDtcblxuY29uc3QgY29tbWFuZHMgPSB7fSwgaGVscGVycyA9IHt9LCBleHRlbnNpb25zID0ge307XG5cblxuY29tbWFuZHMuZ2V0Q3VycmVudENvbnRleHQgPSBhc3luYyBmdW5jdGlvbiBnZXRDdXJyZW50Q29udGV4dCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICBpZiAodGhpcy5jdXJDb250ZXh0ICYmIHRoaXMuY3VyQ29udGV4dCAhPT0gTkFUSVZFX1dJTikge1xuICAgIHJldHVybiBgJHtXRUJWSUVXX0JBU0V9JHt0aGlzLmN1ckNvbnRleHR9YDtcbiAgfVxuICByZXR1cm4gTkFUSVZFX1dJTjtcbn07XG5cbmV4dGVuc2lvbnMuZ2V0Q29udGV4dHNBbmRWaWV3cyA9IGFzeW5jIGZ1bmN0aW9uIGdldENvbnRleHRzQW5kVmlld3MgKHVzZVVybCA9IHRydWUpIHtcbiAgdGhpcy5sb2cuZGVidWcoJ1JldHJpZXZpbmcgY29udGV4dHMgYW5kIHZpZXdzJyk7XG4gIGxldCB3ZWJ2aWV3cyA9IGF3YWl0IHRoaXMubGlzdFdlYkZyYW1lcyh1c2VVcmwpO1xuXG4gIGxldCBjdHhzID0gW3tpZDogTkFUSVZFX1dJTiwgdmlldzoge319XTtcbiAgdGhpcy5jb250ZXh0cyA9IFtOQVRJVkVfV0lOXTtcbiAgZm9yIChsZXQgdmlldyBvZiB3ZWJ2aWV3cykge1xuICAgIGN0eHMucHVzaCh7aWQ6IGAke1dFQlZJRVdfQkFTRX0ke3ZpZXcuaWR9YCwgdmlld30pO1xuICAgIHRoaXMuY29udGV4dHMucHVzaCh2aWV3LmlkLnRvU3RyaW5nKCkpO1xuICB9XG4gIHJldHVybiBjdHhzO1xufTtcblxuLy8gUmlnaHQgbm93IHdlIGRvbid0IG5lY2Vzc2FyaWx5IHdhaXQgZm9yIHdlYnZpZXdcbi8vIGFuZCBmcmFtZSB0byBsb2FkLCB3aGljaCBsZWFkcyB0byByYWNlIGNvbmRpdGlvbnMgYW5kIGZsYWtpbmVzcyxcbi8vIGxldCdzIHNlZSBpZiB3ZSBjYW4gdHJhbnNpdGlvbiB0byBzb21ldGhpbmcgYmV0dGVyXG5leHRlbnNpb25zLnVzZU5ld1NhZmFyaSA9IGZ1bmN0aW9uIHVzZU5ld1NhZmFyaSAoKSB7XG4gIHJldHVybiAhdGhpcy5pc1JlYWxEZXZpY2UoKSAmJiB0aGlzLm9wdHMuc2FmYXJpO1xufTtcblxuZXh0ZW5zaW9ucy5hY3RpdmF0ZVJlY2VudFdlYnZpZXcgPSBhc3luYyBmdW5jdGlvbiBhY3RpdmF0ZVJlY2VudFdlYnZpZXcgKCkge1xuICB0aGlzLmxvZy5kZWJ1ZygnQWN0aXZhdGluZyBhIHJlY2VudCB3ZWJ2aWV3Jyk7XG4gIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gIGNvbnN0IHNwaW5UaW1lTXMgPSA1MDA7XG4gIGNvbnN0IHNwaW5IYW5kbGVzID0gYXN5bmMgKCkgPT4ge1xuICAgIGxldCBjb250ZXh0SWQ7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnRleHRJZCA9IGF3YWl0IHRoaXMuZ2V0UmVjZW50V2Vidmlld0NvbnRleHRJZCgvLiovLCAvLiovKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGlmICghZXJyLm1lc3NhZ2UuaW5jbHVkZXMoJ0NvdWxkIG5vdCBjb25uZWN0IHRvIGEgdmFsaWQgYXBwIGFmdGVyJykpIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoYENvdWxkIG5vdCBuYXZpZ2F0ZSB0byB3ZWJ2aWV3ISBFcnI6ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICAgIGVycm9yLnN0YWNrICs9IGBcXG5DYXVzZWQgYnk6ICR7ZXJyLnN0YWNrfWA7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgICAgdGhpcy5sb2cuZGVidWcoJ0NvdWxkIG5vdCBuYXZpZ2F0ZSB0byB3ZWJ2aWV3LiBSZXRyeWluZyBpZiBwb3NzaWJsZS4nKTtcbiAgICB9XG4gICAgaWYgKGNvbnRleHRJZCkge1xuICAgICAgdGhpcy5sb2cuZGVidWcoYFBpY2tpbmcgd2VidmlldyAnJHtjb250ZXh0SWR9J2ApO1xuICAgICAgYXdhaXQgdGhpcy5zZXRDb250ZXh0KGNvbnRleHRJZCk7XG4gICAgICBhd2FpdCB0aGlzLnJlbW90ZS5jYW5jZWxQYWdlTG9hZCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIG5vIHdlYnZpZXcgd2FzIGZvdW5kXG4gICAgaWYgKHRpbWVyLmdldER1cmF0aW9uKCkuYXNNaWxsaVNlY29uZHMgPj0gUkVDRU5UX1dFQlZJRVdfREVURUNUSU9OX1RJTUVPVVRfTVMpIHtcbiAgICAgIC8vIHRvbyBzbG93LCBnZXQgb3V0XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBuYXZpZ2F0ZSB0byB3ZWJ2aWV3OyB0aGVyZSBhcmUgbm9uZSEnKTtcbiAgICB9XG5cbiAgICB0aGlzLmxvZy53YXJuKCdDb3VsZCBub3QgZmluZCBhbnkgd2Vidmlld3MgeWV0LCByZWZyZXNoaW5nL3JldHJ5aW5nJyk7XG4gICAgaWYgKHRoaXMuaXNSZWFsRGV2aWNlKCkgfHwgIXRoaXMub3B0cy5zYWZhcmkpIHtcbiAgICAgIC8vIG9uIGEgcmVhbCBkZXZpY2UsIHdoZW4gbm90IHVzaW5nIFNhZmFyaSwgd2UganVzdCB3YW50IHRvIHRyeSBhZ2FpblxuICAgICAgYXdhaXQgQi5kZWxheShzcGluVGltZU1zKTtcbiAgICAgIHJldHVybiBhd2FpdCBzcGluSGFuZGxlcygpO1xuICAgIH1cblxuICAgIC8vIGZpbmQgdGhlIHJlbG9hZCBidXR0b24gYW5kIHRhcCBpdCwgaWYgcG9zc2libGVcbiAgICBsZXQgZWxlbWVudDtcbiAgICB0cnkge1xuICAgICAgdGhpcy5sb2cuZGVidWcoJ0ZpbmRpbmcgYW5kIHRhcHBpbmcgcmVsb2FkIGJ1dHRvbicpO1xuICAgICAgZWxlbWVudCA9IGF3YWl0IHRoaXMuZmluZFVJRWxlbWVudE9yRWxlbWVudHMoJ2FjY2Vzc2liaWxpdHkgaWQnLCAnUmVsb2FkQnV0dG9uJywgJycsIGZhbHNlKTtcbiAgICAgIGF3YWl0IHRoaXMubmF0aXZlQ2xpY2soZWxlbWVudCk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICB0aGlzLmxvZy53YXJuKGBFcnJvciBmaW5kaW5nIGFuZCB0YXBwaW5nIHJlbG9hZCBidXR0b246ICR7ZXJyLm1lc3NhZ2V9YCk7XG4gICAgICB0aGlzLmxvZy53YXJuKCdSZXRyeWluZy4nKTtcbiAgICAgIGF3YWl0IEIuZGVsYXkoc3BpblRpbWVNcyk7XG4gICAgfVxuXG4gICAgLy8gdHJ5IGl0IGFsbCBhZ2FpblxuICAgIHJldHVybiBhd2FpdCBzcGluSGFuZGxlcygpO1xuICB9O1xuICBhd2FpdCBzcGluSGFuZGxlcygpO1xufTtcblxuaGVscGVycy5zdG9wUmVtb3RlID0gYXN5bmMgZnVuY3Rpb24gc3RvcFJlbW90ZSAoY2xvc2VXaW5kb3dCZWZvcmVEaXNjb25uZWN0aW5nID0gZmFsc2UpIHtcbiAgaWYgKCF0aGlzLnJlbW90ZSkge1xuICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coJ1RyaWVkIHRvIGxlYXZlIGEgd2ViIGZyYW1lIGJ1dCB3ZXJlIG5vdCBpbiBvbmUnKTtcbiAgfVxuXG4gIGlmIChjbG9zZVdpbmRvd0JlZm9yZURpc2Nvbm5lY3RpbmcpIHtcbiAgICBhd2FpdCB0aGlzLmNsb3NlV2luZG93KCk7XG4gIH1cbiAgYXdhaXQgdGhpcy5yZW1vdGUuZGlzY29ubmVjdCgpO1xuICB0aGlzLmN1ckNvbnRleHQgPSBudWxsO1xuICB0aGlzLmN1cldlYkZyYW1lcyA9IFtdO1xuICB0aGlzLmN1cldlYkNvb3JkcyA9IG51bGw7XG4gIHRoaXMucmVtb3RlID0gbnVsbDtcbn07XG5cbmhlbHBlcnMuc2V0Q3VycmVudFVybCA9IGZ1bmN0aW9uIHNldEN1cnJlbnRVcmwgKHVybCkge1xuICB0aGlzLl9jdXJyZW50VXJsID0gdXJsO1xufTtcblxuaGVscGVycy5nZXRDdXJyZW50VXJsID0gZnVuY3Rpb24gZ2V0Q3VycmVudFVybCAoKSB7XG4gIHJldHVybiB0aGlzLl9jdXJyZW50VXJsO1xufTtcblxuZXh0ZW5zaW9ucy5nZXRSZWNlbnRXZWJ2aWV3Q29udGV4dElkID0gYXN5bmMgZnVuY3Rpb24gZ2V0UmVjZW50V2Vidmlld0NvbnRleHRJZCAodGl0bGVSZWdFeHAsIHVybFJlZ0V4cCkge1xuICBpZiAoIV8uaXNSZWdFeHAodGl0bGVSZWdFeHApICYmICFfLmlzUmVnRXhwKHVybFJlZ0V4cCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKFxuICAgICAgJ0EgcmVndWxhciBleHByZXNzaW9uIGZvciBlaXRoZXIgd2ViIHZpZXcgdGl0bGUgb3IgdXJsIG11c3QgYmUgcHJvdmlkZWQnXG4gICAgKTtcbiAgfVxuXG4gIGNvbnN0IGN1cnJlbnRVcmwgPSB0aGlzLmdldEN1cnJlbnRVcmwoKTtcbiAgY29uc3QgY29udGV4dHMgPSBfLmZpbHRlcihhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoZmFsc2UpLCAndmlldycpO1xuICAvLyBmaXJzdCB0cnkgdG8gbWF0Y2ggYnkgY3VycmVudCB1cmxcbiAgaWYgKGN1cnJlbnRVcmwpIHtcbiAgICBjb25zdCBjdHggPSBjb250ZXh0cy5maW5kKCh7dmlld30pID0+ICh2aWV3LnVybCB8fCAnJykgPT09IGN1cnJlbnRVcmwpO1xuICAgIGlmIChjdHgpIHtcbiAgICAgIHJldHVybiBjdHguaWQ7XG4gICAgfVxuICB9XG4gIC8vIGlmIG5vdCwgdHJ5IHRvIG1hdGNoIGJ5IHJlZ3VsYXIgZXhwcmVzc2lvblxuICByZXR1cm4gKGNvbnRleHRzLmZpbmQoKHt2aWV3fSkgPT5cbiAgICB2aWV3LnRpdGxlICYmIHRpdGxlUmVnRXhwPy50ZXN0KHZpZXcudGl0bGUpIHx8IHZpZXcudXJsICYmIHVybFJlZ0V4cD8udGVzdCh2aWV3LnVybClcbiAgKSk/LmlkO1xufTtcblxuZXh0ZW5zaW9ucy5pc1dlYkNvbnRleHQgPSBmdW5jdGlvbiBpc1dlYkNvbnRleHQgKCkge1xuICByZXR1cm4gISF0aGlzLmN1ckNvbnRleHQgJiYgdGhpcy5jdXJDb250ZXh0ICE9PSBOQVRJVkVfV0lOO1xufTtcblxuZXh0ZW5zaW9ucy5pc1dlYnZpZXcgPSBmdW5jdGlvbiBpc1dlYnZpZXcgKCkge1xuICByZXR1cm4gdGhpcy5pc1dlYkNvbnRleHQoKTtcbn07XG5cbmV4dGVuc2lvbnMuZ2V0TmV3UmVtb3RlRGVidWdnZXIgPSBhc3luYyBmdW5jdGlvbiBnZXROZXdSZW1vdGVEZWJ1Z2dlciAoKSB7XG4gIGxldCBzb2NrZXRQYXRoO1xuICBpZiAoIXRoaXMuaXNSZWFsRGV2aWNlKCkpIHtcbiAgICBzb2NrZXRQYXRoID0gYXdhaXQgdGhpcy5vcHRzLmRldmljZS5nZXRXZWJJbnNwZWN0b3JTb2NrZXQoKTtcbiAgfVxuICByZXR1cm4gY3JlYXRlUmVtb3RlRGVidWdnZXIoe1xuICAgIGJ1bmRsZUlkOiB0aGlzLm9wdHMuYnVuZGxlSWQsXG4gICAgYWRkaXRpb25hbEJ1bmRsZUlkczogdGhpcy5vcHRzLmFkZGl0aW9uYWxXZWJ2aWV3QnVuZGxlSWRzLFxuICAgIGlzU2FmYXJpOiB0aGlzLmlzU2FmYXJpKCksXG4gICAgaW5jbHVkZVNhZmFyaTogdGhpcy5vcHRzLmluY2x1ZGVTYWZhcmlJbldlYnZpZXdzLFxuICAgIHVzZU5ld1NhZmFyaTogdGhpcy51c2VOZXdTYWZhcmkoKSxcbiAgICBwYWdlTG9hZE1zOiB0aGlzLnBhZ2VMb2FkTXMsXG4gICAgcGxhdGZvcm1WZXJzaW9uOiB0aGlzLm9wdHMucGxhdGZvcm1WZXJzaW9uLFxuICAgIHNvY2tldFBhdGgsXG4gICAgcmVtb3RlRGVidWdQcm94eTogdGhpcy5vcHRzLnJlbW90ZURlYnVnUHJveHksXG4gICAgZ2FyYmFnZUNvbGxlY3RPbkV4ZWN1dGU6IHV0aWwuaGFzVmFsdWUodGhpcy5vcHRzLnNhZmFyaUdhcmJhZ2VDb2xsZWN0KVxuICAgICAgPyAhIXRoaXMub3B0cy5zYWZhcmlHYXJiYWdlQ29sbGVjdFxuICAgICAgOiBmYWxzZSxcbiAgICB1ZGlkOiB0aGlzLm9wdHMudWRpZCxcbiAgICBsb2dBbGxDb21tdW5pY2F0aW9uOiB0aGlzLm9wdHMuc2FmYXJpTG9nQWxsQ29tbXVuaWNhdGlvbixcbiAgICBsb2dBbGxDb21tdW5pY2F0aW9uSGV4RHVtcDogdGhpcy5vcHRzLnNhZmFyaUxvZ0FsbENvbW11bmljYXRpb25IZXhEdW1wLFxuICAgIHNvY2tldENodW5rU2l6ZTogdGhpcy5vcHRzLnNhZmFyaVNvY2tldENodW5rU2l6ZSxcbiAgICB3ZWJJbnNwZWN0b3JNYXhGcmFtZUxlbmd0aDogdGhpcy5vcHRzLnNhZmFyaVdlYkluc3BlY3Rvck1heEZyYW1lTGVuZ3RoXG4gIH0sIHRoaXMuaXNSZWFsRGV2aWNlKCkpO1xufTtcblxuLyoqXG4gKiBTZXQgY29udGV4dFxuICpcbiAqIEBwYXJhbSB7P3N0cmluZ30gbmFtZSAtIFRoZSBuYW1lIG9mIGNvbnRleHQgdG8gc2V0LiBJdCBjb3VsZCBiZSAnbnVsbCcgYXMgTkFUSVZFX1dJTi5cbiAqIEBwYXJhbSB7Y2FsbGJhY2t9IGNhbGxiYWNrIFRoZSBjYWxsYmFjay4gKEl0IGlzIG5vdCBjYWxsZWQgaW4gdGhpcyBtZXRob2QpXG4gKiBAcGFyYW0ge2Jvb2xlYW59IHNraXBSZWFkeUNoZWNrIC0gV2hldGhlciBpdCB3YWl0cyBmb3IgdGhlIG5ldyBjb250ZXh0IGlzIHJlYWR5XG4gKi9cbmNvbW1hbmRzLnNldENvbnRleHQgPSBhc3luYyBmdW5jdGlvbiBzZXRDb250ZXh0IChuYW1lLCBjYWxsYmFjaywgc2tpcFJlYWR5Q2hlY2spIHtcbiAgZnVuY3Rpb24gYWxyZWFkeUluQ29udGV4dCAoZGVzaXJlZCwgY3VycmVudCkge1xuICAgIHJldHVybiAoZGVzaXJlZCA9PT0gY3VycmVudCB8fFxuICAgICAgKGRlc2lyZWQgPT09IG51bGwgJiYgY3VycmVudCA9PT0gTkFUSVZFX1dJTikgfHxcbiAgICAgIChkZXNpcmVkID09PSBOQVRJVkVfV0lOICYmIGN1cnJlbnQgPT09IG51bGwpKTtcbiAgfVxuICBmdW5jdGlvbiBpc05hdGl2ZUNvbnRleHQgKGNvbnRleHQpIHtcbiAgICByZXR1cm4gY29udGV4dCA9PT0gTkFUSVZFX1dJTiB8fCBjb250ZXh0ID09PSBudWxsO1xuICB9XG5cbiAgLy8gYWxsb3cgdGhlIGZ1bGwgY29udGV4dCBsaXN0IHRvIGJlIHBhc3NlZCBpblxuICBpZiAobmFtZSAmJiBuYW1lLmlkKSB7XG4gICAgbmFtZSA9IG5hbWUuaWQ7XG4gIH1cblxuICB0aGlzLmxvZy5kZWJ1ZyhgQXR0ZW1wdGluZyB0byBzZXQgY29udGV4dCB0byAnJHtuYW1lIHx8IE5BVElWRV9XSU59JyBmcm9tICcke3RoaXMuY3VyQ29udGV4dCA/IHRoaXMuY3VyQ29udGV4dCA6IE5BVElWRV9XSU59J2ApO1xuXG4gIGlmIChhbHJlYWR5SW5Db250ZXh0KG5hbWUsIHRoaXMuY3VyQ29udGV4dCkgfHwgYWxyZWFkeUluQ29udGV4dChfLnJlcGxhY2UobmFtZSwgV0VCVklFV19CQVNFLCAnJyksIHRoaXMuY3VyQ29udGV4dCkpIHtcbiAgICAvLyBhbHJlYWR5IGluIHRoZSBuYW1lZCBjb250ZXh0LCBubyBuZWVkIHRvIGRvIGFueXRoaW5nXG4gICAgdGhpcy5sb2cuZGVidWcoYEFscmVhZHkgaW4gJyR7bmFtZSB8fCBOQVRJVkVfV0lOfScgY29udGV4dC4gRG9pbmcgbm90aGluZy5gKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGlzTmF0aXZlQ29udGV4dChuYW1lKSkge1xuICAgIC8vIHN3aXRjaGluZyBpbnRvIHRoZSBuYXRpdmUgY29udGV4dFxuICAgIHRoaXMuY3VyQ29udGV4dCA9IG51bGw7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gc3dpdGNoaW5nIGludG8gYSB3ZWJ2aWV3IGNvbnRleHRcblxuICAvLyBpZiBjb250ZXh0cyBoYXZlIG5vdCBhbHJlYWR5IGJlZW4gcmV0cmlldmVkLCBnZXQgdGhlbVxuICBpZiAoXy5pc1VuZGVmaW5lZCh0aGlzLmNvbnRleHRzKSkge1xuICAgIGF3YWl0IHRoaXMuZ2V0Q29udGV4dHMoKTtcbiAgfVxuXG4gIGxldCBjb250ZXh0SWQgPSBfLnJlcGxhY2UobmFtZSwgV0VCVklFV19CQVNFLCAnJyk7XG4gIGlmIChjb250ZXh0SWQgPT09ICcnKSB7XG4gICAgLy8gYWxsb3cgdXNlciB0byBwYXNzIGluIFwiV0VCVklFV1wiIHdpdGhvdXQgYW4gaW5kZXhcbiAgICAvLyB0aGUgc2Vjb25kIGNvbnRleHQgd2lsbCBiZSB0aGUgZmlyc3Qgd2VidmlldyBhc1xuICAgIC8vIHRoZSBmaXJzdCBpcyBhbHdheXMgTkFUSVZFX0FQUFxuICAgIGNvbnRleHRJZCA9IHRoaXMuY29udGV4dHNbMV07XG4gIH1cbiAgaWYgKCFfLmluY2x1ZGVzKHRoaXMuY29udGV4dHMsIGNvbnRleHRJZCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vU3VjaENvbnRleHRFcnJvcigpO1xuICB9XG5cbiAgY29uc3Qgb2xkQ29udGV4dCA9IHRoaXMuY3VyQ29udGV4dDtcbiAgdGhpcy5jdXJDb250ZXh0ID0gdGhpcy5jdXJXaW5kb3dIYW5kbGUgPSBjb250ZXh0SWQ7XG5cbiAgLy8gYGNvbnRleHRJZGAgd2lsbCBiZSBpbiB0aGUgZm9ybSBvZiBgYXBwSWQucGFnZUlkYCBpbiB0aGlzIGNhc2VcbiAgY29uc3QgW2FwcElkS2V5LCBwYWdlSWRLZXldID0gXy5tYXAoY29udGV4dElkLnNwbGl0KCcuJyksIChpZCkgPT4gcGFyc2VJbnQoaWQsIDEwKSk7XG4gIHRyeSB7XG4gICAgdGhpcy5zZWxlY3RpbmdOZXdQYWdlID0gdHJ1ZTtcbiAgICBhd2FpdCB0aGlzLnJlbW90ZS5zZWxlY3RQYWdlKGFwcElkS2V5LCBwYWdlSWRLZXksIHNraXBSZWFkeUNoZWNrKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gdGhpcy5jdXJXaW5kb3dIYW5kbGUgPSBvbGRDb250ZXh0O1xuICAgIHRocm93IGVycjtcbiAgfSBmaW5hbGx5IHtcbiAgICB0aGlzLnNlbGVjdGluZ05ld1BhZ2UgPSBmYWxzZTtcbiAgfVxuXG4gIC8vIGF0dGVtcHQgdG8gc3RhcnQgcGVyZm9ybWFuY2UgbG9nZ2luZywgaWYgcmVxdWVzdGVkXG4gIGlmICh0aGlzLm9wdHMuZW5hYmxlUGVyZm9ybWFuY2VMb2dnaW5nICYmIHRoaXMucmVtb3RlKSB7XG4gICAgdGhpcy5sb2cuZGVidWcoYFN0YXJ0aW5nIHBlcmZvcm1hbmNlIGxvZyBvbiAnJHt0aGlzLmN1ckNvbnRleHR9J2ApO1xuICAgIHRoaXMubG9ncy5wZXJmb3JtYW5jZSA9IG5ldyBJT1NQZXJmb3JtYW5jZUxvZyh0aGlzLnJlbW90ZSk7XG4gICAgYXdhaXQgdGhpcy5sb2dzLnBlcmZvcm1hbmNlLnN0YXJ0Q2FwdHVyZSgpO1xuICB9XG5cbiAgLy8gc3RhcnQgc2FmYXJpIGxvZ2dpbmcgaWYgdGhlIGxvZ3MgaGFuZGxlcnMgYXJlIGFjdGl2ZVxuICBpZiAobmFtZSAmJiBuYW1lICE9PSBOQVRJVkVfV0lOICYmIHRoaXMubG9ncykge1xuICAgIGlmICh0aGlzLmxvZ3Muc2FmYXJpQ29uc29sZSkge1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUuc3RhcnRDb25zb2xlKHRoaXMubG9ncy5zYWZhcmlDb25zb2xlLmFkZExvZ0xpbmUuYmluZCh0aGlzLmxvZ3Muc2FmYXJpQ29uc29sZSkpO1xuICAgIH1cbiAgICBpZiAodGhpcy5sb2dzLnNhZmFyaU5ldHdvcmspIHtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLnN0YXJ0TmV0d29yayh0aGlzLmxvZ3Muc2FmYXJpTmV0d29yay5hZGRMb2dMaW5lLmJpbmQodGhpcy5sb2dzLnNhZmFyaU5ldHdvcmspKTtcbiAgICB9XG4gIH1cbn07XG5cbmV4dGVuc2lvbnMuY29ubmVjdFRvUmVtb3RlRGVidWdnZXIgPSBhc3luYyBmdW5jdGlvbiBjb25uZWN0VG9SZW1vdGVEZWJ1Z2dlciAoKSB7XG4gIHRoaXMucmVtb3RlID0gYXdhaXQgdGhpcy5nZXROZXdSZW1vdGVEZWJ1Z2dlcigpO1xuXG4gIHRoaXMucmVtb3RlLm9uKFJlbW90ZURlYnVnZ2VyLkVWRU5UX1BBR0VfQ0hBTkdFLCB0aGlzLm9uUGFnZUNoYW5nZS5iaW5kKHRoaXMpKTtcbiAgdGhpcy5yZW1vdGUub24oUmVtb3RlRGVidWdnZXIuRVZFTlRfRlJBTUVTX0RFVEFDSEVELCAoKSA9PiB7XG4gICAgaWYgKCFfLmlzRW1wdHkodGhpcy5jdXJXZWJGcmFtZXMpKSB7XG4gICAgICB0aGlzLmxvZy5kZWJ1ZyhgQ2xlYXJpbmcgJHt1dGlsLnBsdXJhbGl6ZSgnZnJhbWUnLCB0aGlzLmN1cldlYkZyYW1lcy5sZW5ndGgsIHRydWUpfTogJHt0aGlzLmN1cldlYkZyYW1lcy5qb2luKCcsICcpfWApO1xuICAgIH1cbiAgICB0aGlzLmN1cldlYkZyYW1lcyA9IFtdO1xuICB9KTtcblxuICBhd2FpdCB0aGlzLnJlbW90ZS5jb25uZWN0KHRoaXMub3B0cy53ZWJ2aWV3Q29ubmVjdFRpbWVvdXQpO1xufTtcblxuZXh0ZW5zaW9ucy5saXN0V2ViRnJhbWVzID0gYXN5bmMgZnVuY3Rpb24gbGlzdFdlYkZyYW1lcyAodXNlVXJsID0gdHJ1ZSkge1xuICB1c2VVcmwgPSB1c2VVcmwgJiYgIXRoaXMuaXNSZWFsRGV2aWNlKCkgJiYgISF0aGlzLmdldEN1cnJlbnRVcmwoKTtcbiAgdGhpcy5sb2cuZGVidWcoYFNlbGVjdGluZyBieSB1cmw6ICR7dXNlVXJsfSR7dXNlVXJsID8gYCAoZXhwZWN0ZWQgdXJsOiAnJHt0aGlzLmdldEN1cnJlbnRVcmwoKX0nKWAgOiAnJ31gKTtcblxuICBpZiAoIXRoaXMucmVtb3RlKSB7XG4gICAgYXdhaXQgdGhpcy5jb25uZWN0VG9SZW1vdGVEZWJ1Z2dlcigpO1xuICAgIGlmICghdGhpcy5yZW1vdGUuYXBwSWRLZXkpIHtcbiAgICAgIGF3YWl0IHRoaXMucmVtb3RlLnNldENvbm5lY3Rpb25LZXkoKTtcbiAgICB9XG4gIH1cbiAgY29uc3QgZ2V0V2Vidmlld1BhZ2VzID0gYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5yZW1vdGUuc2VsZWN0QXBwKFxuICAgICAgICB1c2VVcmwgPyB0aGlzLmdldEN1cnJlbnRVcmwoKSA6IHVuZGVmaW5lZCxcbiAgICAgICAgdGhpcy5vcHRzLndlYnZpZXdDb25uZWN0UmV0cmllcyxcbiAgICAgICAgdGhpcy5vcHRzLmlnbm9yZUFib3V0QmxhbmtVcmxcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICB0aGlzLmxvZy5kZWJ1ZyhgTm8gYXZhaWxhYmxlIHdlYiBwYWdlczogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHBhZ2VBcnJheSA9IGF3YWl0IGdldFdlYnZpZXdQYWdlcygpO1xuICBpZiAoXy5pc0VtcHR5KHBhZ2VBcnJheSkpIHtcbiAgICAvLyB3ZSBoYXZlIG5vIHdlYiBmcmFtZXMsIGJ1dCBjb250aW51ZSBhbnl3YXlcbiAgICB0aGlzLmxvZy5kZWJ1ZygnTm8gd2ViIGZyYW1lcyBmb3VuZC4nKTtcbiAgfVxuICByZXR1cm4gcGFnZUFycmF5O1xufTtcblxuY29tbWFuZHMuZ2V0Q29udGV4dHMgPSBhc3luYyBmdW5jdGlvbiBnZXRDb250ZXh0cyAoKSB7XG4gIHRoaXMubG9nLmRlYnVnKCdHZXR0aW5nIGxpc3Qgb2YgYXZhaWxhYmxlIGNvbnRleHRzJyk7XG4gIGNvbnN0IGNvbnRleHRzID0gYXdhaXQgdGhpcy5nZXRDb250ZXh0c0FuZFZpZXdzKGZhbHNlKTtcblxuICBjb25zdCBtYXBGbiA9IHRoaXMub3B0cy5mdWxsQ29udGV4dExpc3RcbiAgICA/IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogY29udGV4dC5pZC50b1N0cmluZygpLFxuICAgICAgICB0aXRsZTogY29udGV4dC52aWV3LnRpdGxlLFxuICAgICAgICB1cmw6IGNvbnRleHQudmlldy51cmwsXG4gICAgICAgIGJ1bmRsZUlkOiBjb250ZXh0LnZpZXcuYnVuZGxlSWQsXG4gICAgICB9O1xuICAgIH1cbiAgICA6IChjb250ZXh0KSA9PiBjb250ZXh0LmlkLnRvU3RyaW5nKCk7XG4gIHJldHVybiBjb250ZXh0cy5tYXAobWFwRm4pO1xufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBDb250ZXh0XG4gKlxuICogQHByb3BlcnR5IHtzdHJpbmd9IGlkIC0gVGhlIGlkZW50aWZpZXIgb2YgdGhlIGNvbnRleHQuIFRoZSBuYXRpdmUgY29udGV4dFxuICogICAgICAgICAgICAgICAgICAgICAgICAgIHdpbGwgYmUgJ05BVElWRV9BUFAnIGFuZCB0aGUgd2Vidmlld3Mgd2lsbCBiZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgICdXRUJWSUVXX3h4eCdcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gdGl0bGUgLSBUaGUgdGl0bGUgYXNzb2NpYXRlZCB3aXRoIHRoZSB3ZWJ2aWV3IGNvbnRlbnRcbiAqIEBwcm9wZXJ0eSB7P3N0cmluZ30gdXJsIC0gVGhlIHVybCBhc3NvY2lhdGVkIHdpdGggdGhlIHdlYnZpZXcgY29udGVudFxuICovXG5cbi8qKlxuICogR2V0IHRoZSBjb250ZXh0cyBhdmFpbGFibGUsIHdpdGggaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVybCBhbmQgdGl0bGUgb2YgZWFjaFxuICogd2Vidmlld1xuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIC0gT3B0aW9ucyBzZXQsIHdoaWNoIGNhbiBpbmNsdWRlIGB3YWl0Rm9yV2Vidmlld01zYCB0b1xuICogICAgICAgICAgICAgICAgICAgICAgICBzcGVjaWZ5IHRoZSBwZXJpb2QgdG8gcG9sbCBmb3IgYXZhaWxhYmxlIHdlYnZpZXdzXG4gKiBAcmV0dXJucyB7QXJyYXl9IExpc3Qgb2YgQ29udGV4dCBvYmplY3RzXG4gKi9cbmV4dGVuc2lvbnMubW9iaWxlR2V0Q29udGV4dHMgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVHZXRDb250ZXh0cyAob3B0cyA9IHt9KSB7XG4gIGxldCB7XG4gICAgd2FpdEZvcldlYnZpZXdNcyA9IDAsXG4gIH0gPSBvcHRzO1xuXG4gIC8vIG1ha2Ugc3VyZSBpdCBpcyBhIG51bWJlciwgc28gdGhlIGR1cmF0aW9uIGNoZWNrIHdvcmtzIHByb3Blcmx5XG4gIGlmICghXy5pc051bWJlcih3YWl0Rm9yV2Vidmlld01zKSkge1xuICAgIHdhaXRGb3JXZWJ2aWV3TXMgPSBwYXJzZUludCh3YWl0Rm9yV2Vidmlld01zLCAxMCk7XG4gICAgaWYgKGlzTmFOKHdhaXRGb3JXZWJ2aWV3TXMpKSB7XG4gICAgICB3YWl0Rm9yV2Vidmlld01zID0gMDtcbiAgICB9XG4gIH1cblxuICBjb25zdCBjdXJPcHQgPSB0aGlzLm9wdHMuZnVsbENvbnRleHRMaXN0O1xuICB0aGlzLm9wdHMuZnVsbENvbnRleHRMaXN0ID0gdHJ1ZTtcblxuICBjb25zdCB0aW1lciA9IG5ldyB0aW1pbmcuVGltZXIoKS5zdGFydCgpO1xuICB0cnkge1xuICAgIGxldCBjb250ZXh0cztcbiAgICBkbyB7XG4gICAgICBjb250ZXh0cyA9IGF3YWl0IHRoaXMuZ2V0Q29udGV4dHMoKTtcblxuICAgICAgaWYgKGNvbnRleHRzLmxlbmd0aCA+PSAyKSB7XG4gICAgICAgIHRoaXMubG9nLmRlYnVnKGBGb3VuZCB3ZWJ2aWV3IGNvbnRleHQgYWZ0ZXIgJHt0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzLnRvRml4ZWQoMCl9bXNgKTtcbiAgICAgICAgcmV0dXJuIGNvbnRleHRzO1xuICAgICAgfVxuICAgICAgdGhpcy5sb2cuZGVidWcoYE5vIHdlYnZpZXdzIGZvdW5kIGluICR7dGltZXIuZ2V0RHVyYXRpb24oKS5hc01pbGxpU2Vjb25kcy50b0ZpeGVkKDApfW1zYCk7XG4gICAgfSB3aGlsZSAodGltZXIuZ2V0RHVyYXRpb24oKS5hc01pbGxpU2Vjb25kcyA8IHdhaXRGb3JXZWJ2aWV3TXMpO1xuICAgIHJldHVybiBjb250ZXh0cztcbiAgfSBmaW5hbGx5IHtcbiAgICAvLyByZXNldCB0aGUgb3B0aW9uIHNvIHRoZXJlIGFyZSBubyBzaWRlIGVmZmVjdHNcbiAgICB0aGlzLm9wdHMuZnVsbENvbnRleHRMaXN0ID0gY3VyT3B0O1xuICB9XG59O1xuXG5jb21tYW5kcy5zZXRXaW5kb3cgPSBhc3luYyBmdW5jdGlvbiBzZXRXaW5kb3cgKG5hbWUsIHNraXBSZWFkeUNoZWNrKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5zZXRDb250ZXh0KG5hbWUsIF8ubm9vcCwgc2tpcFJlYWR5Q2hlY2spO1xuICB9IGNhdGNoIChlcnIpIHtcbiAgICAvLyB0cmFuc2xhdGUgdGhlIGVycm9yIGluIHRlcm1zIG9mIHdpbmRvd3NcbiAgICB0aHJvdyBpc0Vycm9yVHlwZShlcnIsIGVycm9ycy5Ob1N1Y2hDb250ZXh0RXJyb3IpXG4gICAgICA/IG5ldyBlcnJvcnMuTm9TdWNoV2luZG93RXJyb3IoKVxuICAgICAgOiBlcnI7XG4gIH1cbn07XG5cbmNvbW1hbmRzLmdldFdpbmRvd0hhbmRsZSA9IGFzeW5jIGZ1bmN0aW9uIGdldFdpbmRvd0hhbmRsZSAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICBpZiAoIXRoaXMuaXNXZWJDb250ZXh0KCkpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLk5vdEltcGxlbWVudGVkRXJyb3IoKTtcbiAgfVxuICB0aGlzLmxvZy5kZWJ1ZyhgR2V0dGluZyBjdXJyZW50IHdpbmRvdyBoYW5kbGVgKTtcbiAgcmV0dXJuIHRoaXMuY3VyQ29udGV4dDtcbn07XG5cbmNvbW1hbmRzLmdldFdpbmRvd0hhbmRsZXMgPSBhc3luYyBmdW5jdGlvbiBnZXRXaW5kb3dIYW5kbGVzICgpIHtcbiAgaWYgKCF0aGlzLmlzV2ViQ29udGV4dCgpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5Ob3RJbXBsZW1lbnRlZEVycm9yKCk7XG4gIH1cbiAgdGhpcy5sb2cuZGVidWcoJ0dldHRpbmcgbGlzdCBvZiBhdmFpbGFibGUgd2luZG93IGhhbmRsZXMnKTtcbiAgY29uc3QgY29udGV4dHMgPSBhd2FpdCB0aGlzLmdldENvbnRleHRzQW5kVmlld3MoZmFsc2UpO1xuICByZXR1cm4gY29udGV4dHNcbiAgICAvLyBnZXQgcmlkIG9mIHRoZSBuYXRpdmUgYXBwIGNvbnRleHRcbiAgICAuZmlsdGVyKChjb250ZXh0KSA9PiBjb250ZXh0LmlkICE9PSBOQVRJVkVfV0lOKVxuICAgIC8vIGdldCB0aGUgYGFwcC5pZGAgZm9ybWF0IGV4cGVjdGVkXG4gICAgLm1hcCgoY29udGV4dCkgPT4gY29udGV4dC52aWV3LmlkLnRvU3RyaW5nKCkpO1xufTtcblxuZXh0ZW5zaW9ucy5vblBhZ2VDaGFuZ2UgPSBhc3luYyBmdW5jdGlvbiBvblBhZ2VDaGFuZ2UgKHBhZ2VDaGFuZ2VOb3RpZmljYXRpb24pIHtcbiAgdGhpcy5sb2cuZGVidWcoYFJlbW90ZSBkZWJ1Z2dlciBub3RpZmllZCB1cyBvZiBhIG5ldyBwYWdlIGxpc3Rpbmc6ICR7SlNPTi5zdHJpbmdpZnkocGFnZUNoYW5nZU5vdGlmaWNhdGlvbil9YCk7XG4gIGlmICh0aGlzLnNlbGVjdGluZ05ld1BhZ2UpIHtcbiAgICB0aGlzLmxvZy5kZWJ1ZygnV2UgYXJlIGluIHRoZSBtaWRkbGUgb2Ygc2VsZWN0aW5nIGEgcGFnZSwgaWdub3JpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKCF0aGlzLnJlbW90ZSB8fCAhdGhpcy5yZW1vdGUuaXNDb25uZWN0ZWQpIHtcbiAgICB0aGlzLmxvZy5kZWJ1ZygnV2UgaGF2ZSBub3QgeWV0IGNvbm5lY3RlZCwgaWdub3JpbmcnKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCB7YXBwSWRLZXksIHBhZ2VBcnJheX0gPSBwYWdlQ2hhbmdlTm90aWZpY2F0aW9uO1xuXG4gIGxldCBuZXdJZHMgPSBbXTtcbiAgbGV0IG5ld1BhZ2VzID0gW107XG4gIGxldCBrZXlJZCA9IG51bGw7XG5cbiAgLy8gQ2hlY2tzIGlmIGEgVVJMIGlzIGJsYWNrbGlzdGVkIGluIHRoZSAnc2FmYXJpSWdub3JlV2ViSG9zdG5hbWVzJyBjYXBhYmlsaXR5XG4gIGZ1bmN0aW9uIGlzVXJsSWdub3JlZCAodXJsLCBzYWZhcmlJZ25vcmVXZWJIb3N0bmFtZXMpIHtcbiAgICBjb25zdCBpZ25vcmVkSG9zdHMgPSAoc2FmYXJpSWdub3JlV2ViSG9zdG5hbWVzIHx8ICcnKVxuICAgICAgLnNwbGl0KCcsJylcbiAgICAgIC5tYXAoKGIpID0+IGIudHJpbSgpKVxuICAgICAgLmZpbHRlcigoYikgPT4gIV8uaXNFbXB0eShiKSk7XG4gICAgZm9yIChjb25zdCBpZ25vcmVkSG9zdCBvZiBpZ25vcmVkSG9zdHMpIHtcbiAgICAgIGlmIChpZ25vcmVkSG9zdCA9PT0gJ2Fib3V0OmJsYW5rJyAmJiB1cmwgPT09ICdhYm91dDpibGFuaycpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGhvc3RuYW1lID0gbmV3IFVSTCh1cmwpLmhvc3RuYW1lO1xuICAgICAgICAgIGlmIChob3N0bmFtZSA9PT0gaWdub3JlZEhvc3QpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoaWduKSB7XG4gICAgICAgICAgLy8gZG8gbm90aGluZyBpZiBpbnZhbGlkIFVSTFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGZvciAoY29uc3QgcGFnZSBvZiBwYWdlQXJyYXkpIHtcbiAgICBjb25zdCBpZCA9IHBhZ2UuaWQudG9TdHJpbmcoKTtcbiAgICBuZXdJZHMucHVzaChpZCk7XG4gICAgaWYgKHBhZ2UuaXNLZXkpIHtcbiAgICAgIGtleUlkID0gaWQ7XG4gICAgfVxuICAgIGNvbnN0IGNvbnRleHRJZCA9IGAke2FwcElkS2V5fS4ke2lkfWA7XG5cbiAgICAvLyBhZGQgaWYgdGhpcyBpcyBhIG5ldyBwYWdlXG4gICAgaWYgKCFfLmluY2x1ZGVzKHRoaXMuY29udGV4dHMsIGNvbnRleHRJZCkpIHtcbiAgICAgIGlmIChpc1VybElnbm9yZWQocGFnZS51cmwsIHRoaXMub3B0cy5zYWZhcmlJZ25vcmVXZWJIb3N0bmFtZXMpKSB7XG4gICAgICAgIHRoaXMubG9nLmluZm8oYE5vdCB0cmFja2luZyAnJHtwYWdlLnVybH0nIHBhZ2UgYmVjYXVzZSBpdCBpcyBibGFja2xpc3RlZC4gYCArXG4gICAgICAgICAgYCdzYWZhcmlJZ25vcmVXZWJIb3N0bmFtZXMnPSR7dGhpcy5vcHRzLnNhZmFyaUlnbm9yZVdlYkhvc3RuYW1lc31gKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld1BhZ2VzLnB1c2goaWQpO1xuICAgICAgICB0aGlzLmNvbnRleHRzLnB1c2goY29udGV4dElkKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoIWtleUlkKSB7XG4gICAgLy8gaWYgdGhlcmUgaXMgbm8ga2V5IGlkLCBwdWxsIHRoZSBmaXJzdCBpZCBmcm9tIHRoZSBwYWdlIGFycmF5IGFuZCB1c2UgdGhhdFxuICAgIC8vIGFzIGEgc3RhbmQgaW5cbiAgICB0aGlzLmxvZy5kZWJ1ZygnTm8ga2V5IGlkIGZvdW5kLiBDaG9vc2luZyBmaXJzdCBpZCBmcm9tIHBhZ2UgYXJyYXknKTtcbiAgICBrZXlJZCA9IG5ld0lkc1swXSB8fCBudWxsO1xuICB9XG5cbiAgaWYgKCF1dGlsLmhhc1ZhbHVlKHRoaXMuY3VyQ29udGV4dCkpIHtcbiAgICB0aGlzLmxvZy5kZWJ1ZygnV2UgZG8gbm90IGFwcGVhciB0byBoYXZlIHdpbmRvdyBzZXQgeWV0LCBpZ25vcmluZycpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IFtjdXJBcHBJZEtleSwgY3VyUGFnZUlkS2V5XSA9IHRoaXMuY3VyQ29udGV4dC5zcGxpdCgnLicpO1xuXG4gIGlmIChjdXJBcHBJZEtleSAhPT0gYXBwSWRLZXkpIHtcbiAgICB0aGlzLmxvZy5kZWJ1ZygnUGFnZSBjaGFuZ2Ugbm90IHJlZmVycmluZyB0byBjdXJyZW50bHkgc2VsZWN0ZWQgYXBwLCBpZ25vcmluZy4nKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBsZXQgbmV3UGFnZSA9IG51bGw7XG4gIGlmIChuZXdQYWdlcy5sZW5ndGgpIHtcbiAgICBuZXdQYWdlID0gXy5sYXN0KG5ld1BhZ2VzKTtcbiAgICB0aGlzLmxvZy5kZWJ1ZyhgV2UgaGF2ZSBuZXcgcGFnZXMsIHNlbGVjdGluZyBwYWdlICcke25ld1BhZ2V9J2ApO1xuICB9IGVsc2UgaWYgKCFfLmluY2x1ZGVzKG5ld0lkcywgY3VyUGFnZUlkS2V5KSkge1xuICAgIHRoaXMubG9nLmRlYnVnKCdOZXcgcGFnZSBsaXN0aW5nIGZyb20gcmVtb3RlIGRlYnVnZ2VyIGRvZXMgbm90IGNvbnRhaW4gJyArXG4gICAgICAgICAgICAgICAgICdjdXJyZW50IHdpbmRvdzsgYXNzdW1pbmcgaXQgaXMgY2xvc2VkJyk7XG4gICAgaWYgKCF1dGlsLmhhc1ZhbHVlKGtleUlkKSkge1xuICAgICAgdGhpcy5sb2cuZXJyb3IoJ0RvIG5vdCBoYXZlIG91ciBjdXJyZW50IHdpbmRvdyBhbnltb3JlLCBhbmQgdGhlcmUgJyArXG4gICAgICAgICAgICAgICAgICAgJ2FyZSBub3QgYW55IG1vcmUgdG8gbG9hZCEgRG9pbmcgbm90aGluZy4uLicpO1xuICAgICAgdGhpcy5zZXRDdXJyZW50VXJsKHVuZGVmaW5lZCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5sb2cuZGVidWcoYERlYnVnZ2VyIGFscmVhZHkgc2VsZWN0ZWQgcGFnZSAnJHtrZXlJZH0nLCBgICtcbiAgICAgICAgICAgICAgICAgYGNvbmZpcm1pbmcgdGhhdCBjaG9pY2UuYCk7XG4gICAgdGhpcy5jdXJDb250ZXh0ID0gYCR7YXBwSWRLZXl9LiR7a2V5SWR9YDtcbiAgICBuZXdQYWdlID0ga2V5SWQ7XG4gIH0gZWxzZSB7XG4gICAgLy8gYXQgdGhpcyBwb2ludCwgdGhlcmUgYXJlIG5vIG5ldyBwYWdlcywgYW5kIHRoZSBjdXJyZW50IHBhZ2Ugc3RpbGwgZXhpc3RzXG4gICAgdGhpcy5sb2cuZGVidWcoJ0NoZWNraW5nIGlmIHBhZ2UgbmVlZHMgdG8gbG9hZCcpO1xuICAgIC8vIElmIGEgd2luZG93IG5hdmlnYXRlcyB0byBhbiBhbmNob3IgaXQgZG9lc24ndCBhbHdheXMgZmlyZSBhIHBhZ2VcbiAgICAvLyBjYWxsYmFjayBldmVudC4gTGV0J3MgY2hlY2sgaWYgd2Ugd291bmQgdXAgaW4gc3VjaCBhIHNpdHVhdGlvbi5cbiAgICBjb25zdCBuZWVkc1BhZ2VMb2FkID0gKCgpID0+IHtcbiAgICAgIC8vIG5lZWQgdG8gbWFwIHRoZSBwYWdlIGlkcyB0byBjb250ZXh0IGlkc1xuICAgICAgY29uc3QgY29udGV4dEFycmF5ID0gXy5tYXAocGFnZUFycmF5LCAocGFnZSkgPT4gYCR7YXBwSWRLZXl9LiR7cGFnZS5pZH1gKTtcbiAgICAgIC8vIGNoZWNrIGlmIHRoZSBjdXJyZW50IGNvbnRleHQgZXhpc3RzIGluIGJvdGggb3VyIHJlY29yZGVkIGNvbnRleHRzLFxuICAgICAgLy8gYW5kIHRoZSBwYWdlIGFycmF5XG4gICAgICByZXR1cm4gIV8uaXNFcXVhbChfLmZpbmQodGhpcy5jb250ZXh0cywgdGhpcy5jdXJDb250ZXh0KSwgXy5maW5kKGNvbnRleHRBcnJheSwgdGhpcy5jdXJDb250ZXh0KSk7XG4gICAgfSkoKTtcblxuICAgIGlmIChuZWVkc1BhZ2VMb2FkKSB7XG4gICAgICB0aGlzLmxvZy5kZWJ1ZygnUGFnZSBsb2FkIG5lZWRlZC4gTG9hZGluZy4uLicpO1xuICAgICAgYXdhaXQgdGhpcy5yZW1vdGUucGFnZUxvYWQoKTtcbiAgICB9XG5cbiAgICB0aGlzLmxvZy5kZWJ1ZygnTmV3IHBhZ2UgbGlzdGluZyBpcyBzYW1lIGFzIG9sZCwgZG9pbmcgbm90aGluZycpO1xuICB9XG5cbiAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIHBhZ2UgbGlzdGluZyBpc24ndCBpbmRpY2F0aW5nIGEgcmVkaXJlY3RcbiAgaWYgKHV0aWwuaGFzVmFsdWUodGhpcy5jdXJDb250ZXh0KSkge1xuICAgIGxldCBjdXJyZW50UGFnZUlkID0gcGFyc2VJbnQoXy5sYXN0KHRoaXMuY3VyQ29udGV4dC5zcGxpdCgnLicpKSwgMTApO1xuICAgIGxldCBwYWdlID0gXy5maW5kKHBhZ2VBcnJheSwgKHApID0+IHBhcnNlSW50KHAuaWQsIDEwKSA9PT0gY3VycmVudFBhZ2VJZCk7XG4gICAgaWYgKHBhZ2UgJiYgcGFnZS51cmwgIT09IHRoaXMuZ2V0Q3VycmVudFVybCgpKSB7XG4gICAgICB0aGlzLmxvZy5kZWJ1ZyhgUmVkaXJlY3RlZCBmcm9tICcke3RoaXMuZ2V0Q3VycmVudFVybCgpfScgdG8gJyR7cGFnZS51cmx9J2ApO1xuICAgICAgdGhpcy5zZXRDdXJyZW50VXJsKHBhZ2UudXJsKTtcbiAgICB9XG4gIH1cblxuICBpZiAodXRpbC5oYXNWYWx1ZShuZXdQYWdlKSkge1xuICAgIHRoaXMuc2VsZWN0aW5nTmV3UGFnZSA9IHRydWU7XG4gICAgY29uc3Qgb2xkQ29udGV4dCA9IHRoaXMuY3VyQ29udGV4dDtcbiAgICB0aGlzLmN1ckNvbnRleHQgPSBgJHthcHBJZEtleX0uJHtuZXdQYWdlfWA7XG4gICAgLy8gZG8gbm90IHdhaXQsIGFzIHRoaXMgY2FuIHRha2UgYSBsb25nIHRpbWUsIGFuZCB0aGUgcmVzcG9uc2UgaXMgbm90IG5lY2Vzc2FyeVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBwcm9taXNlL3ByZWZlci1hd2FpdC10by1jYWxsYmFja3MsIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLXRoZW5cbiAgICB0aGlzLnJlbW90ZS5zZWxlY3RQYWdlKGFwcElkS2V5LCBwYXJzZUludChuZXdQYWdlLCAxMCkpLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIHRoaXMubG9nLndhcm4oYEZhaWxlZCB0byBzZWxlY3QgcGFnZTogJHtlcnIubWVzc2FnZX1gKTtcbiAgICAgIHRoaXMuY3VyQ29udGV4dCA9IG9sZENvbnRleHQ7XG4gICAgfSk7XG4gICAgdGhpcy5zZWxlY3RpbmdOZXdQYWdlID0gZmFsc2U7XG4gIH1cbiAgdGhpcy53aW5kb3dIYW5kbGVDYWNoZSA9IHBhZ2VBcnJheTtcbn07XG5cblxuT2JqZWN0LmFzc2lnbihjb21tYW5kcywgZXh0ZW5zaW9ucywgaGVscGVycyk7XG5leHBvcnQgZGVmYXVsdCBjb21tYW5kcztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxVQUFVLEdBQUcsWUFBbkI7QUFDQSxNQUFNQyxXQUFXLEdB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
