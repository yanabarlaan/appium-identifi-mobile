"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.pullFile = pullFile;
exports.pullFolder = pullFolder;
exports.pushFile = pushFile;
exports.pushFolder = pushFolder;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _bluebird = _interopRequireDefault(require("bluebird"));

var _support = require("@appium/support");

var _path = _interopRequireDefault(require("path"));

var _logger = _interopRequireDefault(require("./logger"));

const IO_TIMEOUT_MS = 4 * 60 * 1000;
const MAX_IO_CHUNK_SIZE = 8;

async function pullFile(afcService, remotePath) {
  const stream = await afcService.createReadStream(remotePath, {
    autoDestroy: true
  });
  const pullPromise = new _bluebird.default((resolve, reject) => {
    stream.on('close', resolve);
    stream.on('error', reject);
  }).timeout(IO_TIMEOUT_MS);
  const buffers = [];
  stream.on('data', data => buffers.push(data));
  await pullPromise;
  return Buffer.concat(buffers);
}

async function folderExists(folderPath) {
  try {
    return (await _support.fs.stat(folderPath)).isDirectory();
  } catch (e) {
    return false;
  }
}

async function pullFolder(afcService, remoteRootPath) {
  const tmpFolder = await _support.tempDir.openDir();

  try {
    let localTopItem = null;
    let countFilesSuccess = 0;
    let countFilesFail = 0;
    let countFolders = 0;
    const pullPromises = [];
    await afcService.walkDir(remoteRootPath, true, async (remotePath, isDir) => {
      const localPath = _path.default.join(tmpFolder, remotePath);

      const dirname = isDir ? localPath : _path.default.dirname(localPath);

      if (!(await folderExists(dirname))) {
        await (0, _support.mkdirp)(dirname);
      }

      if (!localTopItem || localPath.split(_path.default.sep).length < localTopItem.split(_path.default.sep).length) {
        localTopItem = localPath;
      }

      if (isDir) {
        ++countFolders;
        return;
      }

      const readStream = await afcService.createReadStream(remotePath, {
        autoDestroy: true
      });

      const writeStream = _support.fs.createWriteStream(localPath, {
        autoClose: true
      });

      pullPromises.push(new _bluebird.default(resolve => {
        writeStream.on('close', () => {
          ++countFilesSuccess;
          resolve();
        });

        const onStreamingError = e => {
          readStream.unpipe(writeStream);

          _logger.default.warn(`Cannot pull '${remotePath}' to '${localPath}'. ` + `The file will be skipped. Original error: ${e.message}`);

          ++countFilesFail;
          resolve();
        };

        writeStream.on('error', onStreamingError);
        readStream.on('error', onStreamingError);
      }).timeout(IO_TIMEOUT_MS));
      readStream.pipe(writeStream);

      if (pullPromises.length >= MAX_IO_CHUNK_SIZE) {
        await _bluebird.default.any(pullPromises);
      }

      _lodash.default.remove(pullPromises, p => p.isFulfilled());
    });

    if (!_lodash.default.isEmpty(pullPromises)) {
      await _bluebird.default.all(pullPromises);
    }

    _logger.default.info(`Pulled ${_support.util.pluralize('file', countFilesSuccess, true)} out of ` + `${countFilesSuccess + countFilesFail} and ${_support.util.pluralize('folder', countFolders, true)} ` + `from '${remoteRootPath}'`);

    return await _support.zip.toInMemoryZip(localTopItem ? _path.default.dirname(localTopItem) : tmpFolder, {
      encodeToBase64: true
    });
  } finally {
    await _support.fs.rimraf(tmpFolder);
  }
}

async function remoteMkdirp(afcService, remoteRoot) {
  if (remoteRoot === '.' || remoteRoot === '/') {
    return;
  }

  try {
    await afcService.listDirectory(remoteRoot);
    return;
  } catch (e) {
    await remoteMkdirp(afcService, _path.default.dirname(remoteRoot));
  }

  await afcService.createDirectory(remoteRoot);
}

async function pushFile(afcService, remotePath, base64Data) {
  await remoteMkdirp(afcService, _path.default.dirname(remotePath));
  const stream = await afcService.createWriteStream(remotePath, {
    autoDestroy: true
  });
  let pushError = null;
  const pushPromise = new _bluebird.default((resolve, reject) => {
    stream.on('error', e => {
      pushError = e;
    });
    stream.on('close', () => {
      if (pushError) {
        reject(pushError);
      } else {
        resolve();
      }
    });
  }).timeout(IO_TIMEOUT_MS);
  stream.write(Buffer.from(base64Data, 'base64'));
  stream.end();
  await pushPromise;
}

async function pushFolder(afcService, srcRootPath, dstRootPath, opts = {}) {
  const {
    timeoutMs = IO_TIMEOUT_MS,
    enableParallelPush = false
  } = opts;
  const timer = new _support.timing.Timer().start();
  const itemsToPush = await _support.fs.glob('**', {
    cwd: srcRootPath,
    nosort: true,
    mark: true
  });

  _logger.default.debug(`Successfully scanned the tree structure of '${srcRootPath}'`);

  const [foldersToPush, filesToPush] = itemsToPush.reduce((acc, x) => {
    acc[_lodash.default.endsWith(x, _path.default.sep) ? 0 : 1].push(x);
    return acc;
  }, [[], []]);

  _logger.default.debug(`Got ${_support.util.pluralize('folder', foldersToPush.length, true)} and ` + `${_support.util.pluralize('file', filesToPush.length, true)} to push`);

  try {
    await afcService.deleteDirectory(dstRootPath);
  } catch (ign) {}

  await afcService.createDirectory(dstRootPath);
  const foldersToPushByHierarchy = foldersToPush.sort((a, b) => a.split(_path.default.sep).length - b.split(_path.default.sep).length);

  for (const relativeFolderPath of foldersToPushByHierarchy) {
    const absoluteFolderPath = _lodash.default.trimEnd(_path.default.join(dstRootPath, relativeFolderPath), _path.default.sep);

    if (absoluteFolderPath) {
      await afcService.createDirectory(absoluteFolderPath);
    }
  }

  _logger.default.debug(`Successfully created the remote folder structure ` + `(${_support.util.pluralize('item', foldersToPush.length + 1, true)})`);

  const pushFile = async relativePath => {
    const absoluteSourcePath = _path.default.join(srcRootPath, relativePath);

    const readStream = _support.fs.createReadStream(absoluteSourcePath, {
      autoClose: true
    });

    const absoluteDestinationPath = _path.default.join(dstRootPath, relativePath);

    const writeStream = await afcService.createWriteStream(absoluteDestinationPath, {
      autoDestroy: true
    });
    writeStream.on('finish', writeStream.destroy);
    let pushError = null;
    const filePushPromise = new _bluebird.default((resolve, reject) => {
      writeStream.on('close', () => {
        if (pushError) {
          reject(pushError);
        } else {
          resolve();
        }
      });

      const onStreamError = e => {
        readStream.unpipe(writeStream);

        _logger.default.debug(e);

        pushError = e;
      };

      writeStream.on('error', onStreamError);
      readStream.on('error', onStreamError);
    });
    readStream.pipe(writeStream);
    await filePushPromise.timeout(timeoutMs);
  };

  if (enableParallelPush) {
    _logger.default.debug(`Proceeding to parallel files push (max ${MAX_IO_CHUNK_SIZE} writers)`);

    const pushPromises = [];

    for (const relativeFilePath of _lodash.default.shuffle(filesToPush)) {
      pushPromises.push(_bluebird.default.resolve(pushFile(relativeFilePath)));

      if (pushPromises.length >= MAX_IO_CHUNK_SIZE) {
        await _bluebird.default.any(pushPromises);
      }

      _lodash.default.remove(pushPromises, p => p.isFulfilled());
    }

    if (!_lodash.default.isEmpty(pushPromises)) {
      await _bluebird.default.all(pushPromises);
    }
  } else {
    _logger.default.debug(`Proceeding to serial files push`);

    for (const relativeFilePath of filesToPush) {
      await pushFile(relativeFilePath);
    }
  }

  _logger.default.debug(`Successfully pushed ${_support.util.pluralize('folder', foldersToPush.length, true)} ` + `and ${_support.util.pluralize('file', filesToPush.length, true)} ` + `within ${timer.getDuration().asMilliSeconds.toFixed(0)}ms`);
}require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGliL2lvcy1mcy1oZWxwZXJzLmpzIiwibmFtZXMiOlsiSU9fVElNRU9VVF9NUyIsIk1BWF9JT19DSFVOS19TSVpFIiwicHVsbEZpbGUiLCJhZmNTZXJ2aWNlIiwicmVtb3RlUGF0aCIsInN0cmVhbSIsImNyZWF0ZVJlYWRTdHJlYW0iLCJhdXRvRGVzdHJveSIsInB1bGxQcm9taXNlIiwiQiIsInJlc29sdmUiLCJyZWplY3QiLCJvbiIsInRpbWVvdXQiLCJidWZmZXJzIiwiZGF0YSIsInB1c2giLCJCdWZmZXIiLCJjb25jYXQiLCJmb2xkZXJFeGlzdHMiLCJmb2xkZXJQYXRoIiwiZnMiLCJzdGF0IiwiaXNEaXJlY3RvcnkiLCJlIiwicHVsbEZvbGRlciIsInJlbW90ZVJvb3RQYXRoIiwidG1wRm9sZGVyIiwidGVtcERpciIsIm9wZW5EaXIiLCJsb2NhbFRvcEl0ZW0iLCJjb3VudEZpbGVzU3VjY2VzcyIsImNvdW50RmlsZXNGYWlsIiwiY291bnRGb2xkZXJzIiwicHVsbFByb21pc2VzIiwid2Fsa0RpciIsImlzRGlyIiwibG9jYWxQYXRoIiwicGF0aCIsImpvaW4iLCJkaXJuYW1lIiwibWtkaXJwIiwic3BsaXQiLCJzZXAiLCJsZW5ndGgiLCJyZWFkU3RyZWFtIiwid3JpdGVTdHJlYW0iLCJjcmVhdGVXcml0ZVN0cmVhbSIsImF1dG9DbG9zZSIsIm9uU3RyZWFtaW5nRXJyb3IiLCJ1bnBpcGUiLCJsb2ciLCJ3YXJuIiwibWVzc2FnZSIsInBpcGUiLCJhbnkiLCJfIiwicmVtb3ZlIiwicCIsImlzRnVsZmlsbGVkIiwiaXNFbXB0eSIsImFsbCIsImluZm8iLCJ1dGlsIiwicGx1cmFsaXplIiwiemlwIiwidG9Jbk1lbW9yeVppcCIsImVuY29kZVRvQmFzZTY0IiwicmltcmFmIiwicmVtb3RlTWtkaXJwIiwicmVtb3RlUm9vdCIsImxpc3REaXJlY3RvcnkiLCJjcmVhdGVEaXJlY3RvcnkiLCJwdXNoRmlsZSIsImJhc2U2NERhdGEiLCJwdXNoRXJyb3IiLCJwdXNoUHJvbWlzZSIsIndyaXRlIiwiZnJvbSIsImVuZCIsInB1c2hGb2xkZXIiLCJzcmNSb290UGF0aCIsImRzdFJvb3RQYXRoIiwib3B0cyIsInRpbWVvdXRNcyIsImVuYWJsZVBhcmFsbGVsUHVzaCIsInRpbWVyIiwidGltaW5nIiwiVGltZXIiLCJzdGFydCIsIml0ZW1zVG9QdXNoIiwiZ2xvYiIsImN3ZCIsIm5vc29ydCIsIm1hcmsiLCJkZWJ1ZyIsImZvbGRlcnNUb1B1c2giLCJmaWxlc1RvUHVzaCIsInJlZHVjZSIsImFjYyIsIngiLCJlbmRzV2l0aCIsImRlbGV0ZURpcmVjdG9yeSIsImlnbiIsImZvbGRlcnNUb1B1c2hCeUhpZXJhcmNoeSIsInNvcnQiLCJhIiwiYiIsInJlbGF0aXZlRm9sZGVyUGF0aCIsImFic29sdXRlRm9sZGVyUGF0aCIsInRyaW1FbmQiLCJyZWxhdGl2ZVBhdGgiLCJhYnNvbHV0ZVNvdXJjZVBhdGgiLCJhYnNvbHV0ZURlc3RpbmF0aW9uUGF0aCIsImRlc3Ryb3kiLCJmaWxlUHVzaFByb21pc2UiLCJvblN0cmVhbUVycm9yIiwicHVzaFByb21pc2VzIiwicmVsYXRpdmVGaWxlUGF0aCIsInNodWZmbGUiLCJnZXREdXJhdGlvbiIsImFzTWlsbGlTZWNvbmRzIiwidG9GaXhlZCJdLCJzb3VyY2VSb290IjoiLi4vLi4iLCJzb3VyY2VzIjpbImxpYi9pb3MtZnMtaGVscGVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IEIgZnJvbSAnYmx1ZWJpcmQnO1xuaW1wb3J0IHsgZnMsIHRlbXBEaXIsIG1rZGlycCwgemlwLCB1dGlsLCB0aW1pbmcgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcblxuY29uc3QgSU9fVElNRU9VVF9NUyA9IDQgKiA2MCAqIDEwMDA7XG4vLyBNb2JpbGUgZGV2aWNlcyB1c2UgTkFORCBtZW1vcnkgbW9kdWxlcyBmb3IgdGhlIHN0b3JhZ2UsXG4vLyBhbmQgdGhlIHBhcmFsbGVsaXNtIHRoZXJlIGlzIG5vdCBhcyBwZXJmb3JtYW50IGFzIG9uIHJlZ3VsYXIgU1NEc1xuY29uc3QgTUFYX0lPX0NIVU5LX1NJWkUgPSA4O1xuXG4vKipcbiAqIFJldHJpZXZlIGEgZmlsZSBmcm9tIGEgcmVhbCBkZXZpY2VcbiAqXG4gKiBAcGFyYW0ge0FmY1NlcnZpY2V9IGFmY1NlcnZpY2UgQXBwbGUgRmlsZSBDbGllbnQgc2VydmljZSBpbnN0YW5jZSBmcm9tXG4gKiAnYXBwaXVtLWlvcy1kZXZpY2UnIG1vZHVsZVxuICogQHBhcmFtIHtzdHJpbmd9IHJlbW90ZVBhdGggUmVsYXRpdmUgcGF0aCB0byB0aGUgZmlsZSBvbiB0aGUgZGV2aWNlXG4gKiBAcmV0dXJucyB7QnVmZmVyfSBUaGUgZmlsZSBjb250ZW50IGFzIGEgYnVmZmVyXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHB1bGxGaWxlIChhZmNTZXJ2aWNlLCByZW1vdGVQYXRoKSB7XG4gIGNvbnN0IHN0cmVhbSA9IGF3YWl0IGFmY1NlcnZpY2UuY3JlYXRlUmVhZFN0cmVhbShyZW1vdGVQYXRoLCB7IGF1dG9EZXN0cm95OiB0cnVlIH0pO1xuICBjb25zdCBwdWxsUHJvbWlzZSA9IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBzdHJlYW0ub24oJ2Nsb3NlJywgcmVzb2x2ZSk7XG4gICAgc3RyZWFtLm9uKCdlcnJvcicsIHJlamVjdCk7XG4gIH0pLnRpbWVvdXQoSU9fVElNRU9VVF9NUyk7XG4gIGNvbnN0IGJ1ZmZlcnMgPSBbXTtcbiAgc3RyZWFtLm9uKCdkYXRhJywgKGRhdGEpID0+IGJ1ZmZlcnMucHVzaChkYXRhKSk7XG4gIGF3YWl0IHB1bGxQcm9taXNlO1xuICByZXR1cm4gQnVmZmVyLmNvbmNhdChidWZmZXJzKTtcbn1cblxuLyoqXG4gKiBDaGVja3MgYSBwcmVzZW5jZSBvZiBhIGxvY2FsIGZvbGRlci5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZm9sZGVyUGF0aCBGdWxsIHBhdGggdG8gdGhlIGxvY2FsIGZvbGRlclxuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIGZvbGRlciBleGlzdHMgYW5kIGlzIGFjdHVhbGx5IGEgZm9sZGVyXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGZvbGRlckV4aXN0cyAoZm9sZGVyUGF0aCkge1xuICB0cnkge1xuICAgIHJldHVybiAoYXdhaXQgZnMuc3RhdChmb2xkZXJQYXRoKSkuaXNEaXJlY3RvcnkoKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIFJldHJpZXZlIGEgZm9sZGVyIGZyb20gYSByZWFsIGRldmljZVxuICpcbiAqIEBwYXJhbSB7QWZjU2VydmljZX0gYWZjU2VydmljZSBBcHBsZSBGaWxlIENsaWVudCBzZXJ2aWNlIGluc3RhbmNlIGZyb21cbiAqICdhcHBpdW0taW9zLWRldmljZScgbW9kdWxlXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVtb3RlUm9vdFBhdGggUmVsYXRpdmUgcGF0aCB0byB0aGUgZm9sZGVyIG9uIHRoZSBkZXZpY2VcbiAqIEByZXR1cm5zIHtCdWZmZXJ9IFRoZSBmb2xkZXIgY29udGVudCBhcyBhIHppcHBlZCBiYXNlNjQtZW5jb2RlZCBidWZmZXJcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHVsbEZvbGRlciAoYWZjU2VydmljZSwgcmVtb3RlUm9vdFBhdGgpIHtcbiAgY29uc3QgdG1wRm9sZGVyID0gYXdhaXQgdGVtcERpci5vcGVuRGlyKCk7XG4gIHRyeSB7XG4gICAgbGV0IGxvY2FsVG9wSXRlbSA9IG51bGw7XG4gICAgbGV0IGNvdW50RmlsZXNTdWNjZXNzID0gMDtcbiAgICBsZXQgY291bnRGaWxlc0ZhaWwgPSAwO1xuICAgIGxldCBjb3VudEZvbGRlcnMgPSAwO1xuICAgIGNvbnN0IHB1bGxQcm9taXNlcyA9IFtdO1xuICAgIGF3YWl0IGFmY1NlcnZpY2Uud2Fsa0RpcihyZW1vdGVSb290UGF0aCwgdHJ1ZSwgYXN5bmMgKHJlbW90ZVBhdGgsIGlzRGlyKSA9PiB7XG4gICAgICBjb25zdCBsb2NhbFBhdGggPSBwYXRoLmpvaW4odG1wRm9sZGVyLCByZW1vdGVQYXRoKTtcbiAgICAgIGNvbnN0IGRpcm5hbWUgPSBpc0RpciA/IGxvY2FsUGF0aCA6IHBhdGguZGlybmFtZShsb2NhbFBhdGgpO1xuICAgICAgaWYgKCFhd2FpdCBmb2xkZXJFeGlzdHMoZGlybmFtZSkpIHtcbiAgICAgICAgYXdhaXQgbWtkaXJwKGRpcm5hbWUpO1xuICAgICAgfVxuICAgICAgaWYgKCFsb2NhbFRvcEl0ZW1cbiAgICAgICAgICB8fCBsb2NhbFBhdGguc3BsaXQocGF0aC5zZXApLmxlbmd0aCA8IGxvY2FsVG9wSXRlbS5zcGxpdChwYXRoLnNlcCkubGVuZ3RoKSB7XG4gICAgICAgIGxvY2FsVG9wSXRlbSA9IGxvY2FsUGF0aDtcbiAgICAgIH1cbiAgICAgIGlmIChpc0Rpcikge1xuICAgICAgICArK2NvdW50Rm9sZGVycztcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZWFkU3RyZWFtID0gYXdhaXQgYWZjU2VydmljZS5jcmVhdGVSZWFkU3RyZWFtKHJlbW90ZVBhdGgsIHthdXRvRGVzdHJveTogdHJ1ZX0pO1xuICAgICAgY29uc3Qgd3JpdGVTdHJlYW0gPSBmcy5jcmVhdGVXcml0ZVN0cmVhbShsb2NhbFBhdGgsIHthdXRvQ2xvc2U6IHRydWV9KTtcbiAgICAgIHB1bGxQcm9taXNlcy5wdXNoKFxuICAgICAgICBuZXcgQigocmVzb2x2ZSkgPT4ge1xuICAgICAgICAgIHdyaXRlU3RyZWFtLm9uKCdjbG9zZScsICgpID0+IHtcbiAgICAgICAgICAgICsrY291bnRGaWxlc1N1Y2Nlc3M7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgY29uc3Qgb25TdHJlYW1pbmdFcnJvciA9IChlKSA9PiB7XG4gICAgICAgICAgICByZWFkU3RyZWFtLnVucGlwZSh3cml0ZVN0cmVhbSk7XG4gICAgICAgICAgICBsb2cud2FybihgQ2Fubm90IHB1bGwgJyR7cmVtb3RlUGF0aH0nIHRvICcke2xvY2FsUGF0aH0nLiBgICtcbiAgICAgICAgICAgICAgYFRoZSBmaWxlIHdpbGwgYmUgc2tpcHBlZC4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgICAgICAgKytjb3VudEZpbGVzRmFpbDtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICB9O1xuICAgICAgICAgIHdyaXRlU3RyZWFtLm9uKCdlcnJvcicsIG9uU3RyZWFtaW5nRXJyb3IpO1xuICAgICAgICAgIHJlYWRTdHJlYW0ub24oJ2Vycm9yJywgb25TdHJlYW1pbmdFcnJvcik7XG4gICAgICAgIH0pLnRpbWVvdXQoSU9fVElNRU9VVF9NUylcbiAgICAgICk7XG4gICAgICByZWFkU3RyZWFtLnBpcGUod3JpdGVTdHJlYW0pO1xuICAgICAgaWYgKHB1bGxQcm9taXNlcy5sZW5ndGggPj0gTUFYX0lPX0NIVU5LX1NJWkUpIHtcbiAgICAgICAgYXdhaXQgQi5hbnkocHVsbFByb21pc2VzKTtcbiAgICAgIH1cbiAgICAgIF8ucmVtb3ZlKHB1bGxQcm9taXNlcywgKHApID0+IHAuaXNGdWxmaWxsZWQoKSk7XG4gICAgfSk7XG4gICAgLy8gV2FpdCBmb3IgdGhlIHJlc3Qgb2YgZmlsZXMgdG8gYmUgcHVsbGVkXG4gICAgaWYgKCFfLmlzRW1wdHkocHVsbFByb21pc2VzKSkge1xuICAgICAgYXdhaXQgQi5hbGwocHVsbFByb21pc2VzKTtcbiAgICB9XG4gICAgbG9nLmluZm8oYFB1bGxlZCAke3V0aWwucGx1cmFsaXplKCdmaWxlJywgY291bnRGaWxlc1N1Y2Nlc3MsIHRydWUpfSBvdXQgb2YgYCArXG4gICAgICBgJHtjb3VudEZpbGVzU3VjY2VzcyArIGNvdW50RmlsZXNGYWlsfSBhbmQgJHt1dGlsLnBsdXJhbGl6ZSgnZm9sZGVyJywgY291bnRGb2xkZXJzLCB0cnVlKX0gYCArXG4gICAgICBgZnJvbSAnJHtyZW1vdGVSb290UGF0aH0nYCk7XG4gICAgcmV0dXJuIGF3YWl0IHppcC50b0luTWVtb3J5WmlwKGxvY2FsVG9wSXRlbSA/IHBhdGguZGlybmFtZShsb2NhbFRvcEl0ZW0pIDogdG1wRm9sZGVyLCB7XG4gICAgICBlbmNvZGVUb0Jhc2U2NDogdHJ1ZSxcbiAgICB9KTtcbiAgfSBmaW5hbGx5IHtcbiAgICBhd2FpdCBmcy5yaW1yYWYodG1wRm9sZGVyKTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgcmVtb3RlIGZvbGRlciBwYXRoIHJlY3Vyc2l2ZWx5LiBOb29wIGlmIHRoZSBnaXZlbiBwYXRoXG4gKiBhbHJlYWR5IGV4aXN0c1xuICpcbiAqIEBwYXJhbSB7QWZjU2VydmljZX0gYWZjU2VydmljZSBBcHBsZSBGaWxlIENsaWVudCBzZXJ2aWNlIGluc3RhbmNlIGZyb21cbiAqICdhcHBpdW0taW9zLWRldmljZScgbW9kdWxlXG4gKiBAcGFyYW0ge3N0cmluZ30gcmVtb3RlUm9vdCBUaGUgcmVsYXRpdmUgcGF0aCB0byB0aGUgcmVtb3RlIGZvbGRlciBzdHJ1Y3R1cmVcbiAqIHRvIGJlIGNyZWF0ZWRcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVtb3RlTWtkaXJwIChhZmNTZXJ2aWNlLCByZW1vdGVSb290KSB7XG4gIGlmIChyZW1vdGVSb290ID09PSAnLicgfHwgcmVtb3RlUm9vdCA9PT0gJy8nKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHRyeSB7XG4gICAgYXdhaXQgYWZjU2VydmljZS5saXN0RGlyZWN0b3J5KHJlbW90ZVJvb3QpO1xuICAgIHJldHVybjtcbiAgfSBjYXRjaCAoZSkge1xuICAgIC8vIFRoaXMgbWVhbnMgdGhhdCB0aGUgZGlyZWN0b3J5IGlzIG1pc3NpbmcgYW5kIHdlIGdvdCBhbiBvYmplY3Qgbm90IGZvdW5kIGVycm9yLlxuICAgIC8vIFRoZXJlZm9yZSwgd2UgYXJlIGdvaW5nIHRvIHRoZSBwYXJlbnRcbiAgICBhd2FpdCByZW1vdGVNa2RpcnAoYWZjU2VydmljZSwgcGF0aC5kaXJuYW1lKHJlbW90ZVJvb3QpKTtcbiAgfVxuICBhd2FpdCBhZmNTZXJ2aWNlLmNyZWF0ZURpcmVjdG9yeShyZW1vdGVSb290KTtcbn1cblxuLyoqXG4gKiBQdXNoZXMgYSBmaWxlIHRvIGEgcmVhbCBkZXZpY2VcbiAqXG4gKiBAcGFyYW0ge0FmY1NlcnZpY2V9IGFmY1NlcnZpY2UgQXBwbGUgRmlsZSBDbGllbnQgc2VydmljZSBpbnN0YW5jZSBmcm9tXG4gKiAnYXBwaXVtLWlvcy1kZXZpY2UnIG1vZHVsZVxuICogQHBhcmFtIHtzdHJpbmd9IHJlbW90ZVBhdGggUmVsYXRpdmUgcGF0aCB0byB0aGUgZmlsZSBvbiB0aGUgZGV2aWNlLiBUaGUgcmVtb3RlXG4gKiBmb2xkZXIgc3RydWN0dXJlIGlzIGNyZWF0ZWQgYXV0b21hdGljYWxseSBpZiBuZWNlc3NhcnkuXG4gKiBAcGFyYW0ge3N0cmluZ30gYmFzZTY0RGF0YSBCYXNlNjQtZW5jb2RlZCBjb250ZW50IG9mIHRoZSBmaWxlIHRvIGJlIHdyaXR0ZW5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHVzaEZpbGUgKGFmY1NlcnZpY2UsIHJlbW90ZVBhdGgsIGJhc2U2NERhdGEpIHtcbiAgYXdhaXQgcmVtb3RlTWtkaXJwKGFmY1NlcnZpY2UsIHBhdGguZGlybmFtZShyZW1vdGVQYXRoKSk7XG4gIGNvbnN0IHN0cmVhbSA9IGF3YWl0IGFmY1NlcnZpY2UuY3JlYXRlV3JpdGVTdHJlYW0ocmVtb3RlUGF0aCwge2F1dG9EZXN0cm95OiB0cnVlfSk7XG4gIGxldCBwdXNoRXJyb3IgPSBudWxsO1xuICBjb25zdCBwdXNoUHJvbWlzZSA9IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBzdHJlYW0ub24oJ2Vycm9yJywgKGUpID0+IHtcbiAgICAgIHB1c2hFcnJvciA9IGU7XG4gICAgfSk7XG4gICAgc3RyZWFtLm9uKCdjbG9zZScsICgpID0+IHtcbiAgICAgIGlmIChwdXNoRXJyb3IpIHtcbiAgICAgICAgcmVqZWN0KHB1c2hFcnJvcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pLnRpbWVvdXQoSU9fVElNRU9VVF9NUyk7XG4gIHN0cmVhbS53cml0ZShCdWZmZXIuZnJvbShiYXNlNjREYXRhLCAnYmFzZTY0JykpO1xuICBzdHJlYW0uZW5kKCk7XG4gIGF3YWl0IHB1c2hQcm9taXNlO1xufVxuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFB1c2hGb2xkZXJPcHRpb25zXG4gKlxuICogQHByb3BlcnR5IHtudW1iZXJ9IHRpbWVvdXRNcyBbMjQwMDAwXSBUaGUgbWF4aW11bSB0aW1lb3V0IHRvIHdhaXQgdW50aWwgYVxuICogc2luZ2xlIGZpbGUgaXMgY29waWVkXG4gKiBAcGFyYW0ge2Jvb2xlYW59IGVuYWJsZVBhcmFsbGVsUHVzaCBbZmFsc2VdIFdoZXRoZXIgdG8gcHVzaCBmaWxlcyBpbiBwYXJhbGxlbC5cbiAqIFRoaXMgdXN1YWxseSBnaXZlcyBiZXR0ZXIgcGVyZm9ybWFuY2UsIGJ1dCBtaWdodCBzb21ldGltZXMgYmUgbGVzcyBzdGFibGUuXG4gKi9cblxuLyoqXG4gKiBQdXNoZXMgYSBmb2xkZXIgdG8gYSByZWFsIGRldmljZVxuICpcbiAqIEBwYXJhbSB7QWZjU2VydmljZX0gYWZjU2VydmljZSBBcHBsZSBGaWxlIENsaWVudCBzZXJ2aWNlIGluc3RhbmNlIGZyb21cbiAqICdhcHBpdW0taW9zLWRldmljZScgbW9kdWxlXG4gKiBAcGFyYW0ge3N0cmluZ30gc3JjUm9vdFBhdGggVGhlIGZ1bGwgcGF0aCB0byB0aGUgc291cmNlIGZvbGRlclxuICogQHBhcmFtIHtzdHJpbmd9IGRzdFJvb3RQYXRoIFRoZSByZWxhdGl2ZSBwYXRoIHRvIHRoZSBkZXN0aW5hdGlvbiBmb2xkZXIuIFRoZSBmb2xkZXJcbiAqIHdpbGwgYmUgZGVsZXRlZCBpZiBhbHJlYWR5IGV4aXN0cy5cbiAqIEBwYXJhbSB7UHVzaEZvbGRlck9wdGlvbnN9IG9wdHNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcHVzaEZvbGRlciAoYWZjU2VydmljZSwgc3JjUm9vdFBhdGgsIGRzdFJvb3RQYXRoLCBvcHRzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIHRpbWVvdXRNcyA9IElPX1RJTUVPVVRfTVMsXG4gICAgZW5hYmxlUGFyYWxsZWxQdXNoID0gZmFsc2UsXG4gIH0gPSBvcHRzO1xuXG4gIGNvbnN0IHRpbWVyID0gbmV3IHRpbWluZy5UaW1lcigpLnN0YXJ0KCk7XG4gIGNvbnN0IGl0ZW1zVG9QdXNoID0gYXdhaXQgZnMuZ2xvYignKionLCB7XG4gICAgY3dkOiBzcmNSb290UGF0aCxcbiAgICBub3NvcnQ6IHRydWUsXG4gICAgbWFyazogdHJ1ZSxcbiAgfSk7XG4gIGxvZy5kZWJ1ZyhgU3VjY2Vzc2Z1bGx5IHNjYW5uZWQgdGhlIHRyZWUgc3RydWN0dXJlIG9mICcke3NyY1Jvb3RQYXRofSdgKTtcbiAgY29uc3QgW2ZvbGRlcnNUb1B1c2gsIGZpbGVzVG9QdXNoXSA9IGl0ZW1zVG9QdXNoLnJlZHVjZSgoYWNjLCB4KSA9PiB7XG4gICAgYWNjW18uZW5kc1dpdGgoeCwgcGF0aC5zZXApID8gMCA6IDFdLnB1c2goeCk7XG4gICAgcmV0dXJuIGFjYztcbiAgfSwgW1tdLCBbXV0pO1xuICBsb2cuZGVidWcoYEdvdCAke3V0aWwucGx1cmFsaXplKCdmb2xkZXInLCBmb2xkZXJzVG9QdXNoLmxlbmd0aCwgdHJ1ZSl9IGFuZCBgICtcbiAgICBgJHt1dGlsLnBsdXJhbGl6ZSgnZmlsZScsIGZpbGVzVG9QdXNoLmxlbmd0aCwgdHJ1ZSl9IHRvIHB1c2hgKTtcbiAgLy8gY3JlYXRlIHRoZSBmb2xkZXIgc3RydWN0dXJlIGZpcnN0XG4gIHRyeSB7XG4gICAgYXdhaXQgYWZjU2VydmljZS5kZWxldGVEaXJlY3RvcnkoZHN0Um9vdFBhdGgpO1xuICB9IGNhdGNoIChpZ24pIHt9XG4gIGF3YWl0IGFmY1NlcnZpY2UuY3JlYXRlRGlyZWN0b3J5KGRzdFJvb3RQYXRoKTtcbiAgLy8gdG9wLWxldmVsIGZvbGRlcnMgbXVzdCBnbyBmaXJzdFxuICBjb25zdCBmb2xkZXJzVG9QdXNoQnlIaWVyYXJjaHkgPSBmb2xkZXJzVG9QdXNoXG4gICAgLnNvcnQoKGEsIGIpID0+IGEuc3BsaXQocGF0aC5zZXApLmxlbmd0aCAtIGIuc3BsaXQocGF0aC5zZXApLmxlbmd0aCk7XG4gIGZvciAoY29uc3QgcmVsYXRpdmVGb2xkZXJQYXRoIG9mIGZvbGRlcnNUb1B1c2hCeUhpZXJhcmNoeSkge1xuICAgIC8vIGNyZWF0ZURpcmVjdG9yeSBkb2VzIG5vdCBhY2NlcHQgZm9sZGVyIG5hbWVzIGVuZGluZyB3aXRoIGEgcGF0aCBzZXBhcmF0b3JcbiAgICBjb25zdCBhYnNvbHV0ZUZvbGRlclBhdGggPSBfLnRyaW1FbmQoXG4gICAgICBwYXRoLmpvaW4oZHN0Um9vdFBhdGgsIHJlbGF0aXZlRm9sZGVyUGF0aCksIHBhdGguc2VwXG4gICAgKTtcbiAgICBpZiAoYWJzb2x1dGVGb2xkZXJQYXRoKSB7XG4gICAgICBhd2FpdCBhZmNTZXJ2aWNlLmNyZWF0ZURpcmVjdG9yeShhYnNvbHV0ZUZvbGRlclBhdGgpO1xuICAgIH1cbiAgfVxuICAvLyBkbyBub3QgZm9yZ2V0IGFib3V0IHRoZSByb290IGZvbGRlclxuICBsb2cuZGVidWcoYFN1Y2Nlc3NmdWxseSBjcmVhdGVkIHRoZSByZW1vdGUgZm9sZGVyIHN0cnVjdHVyZSBgICtcbiAgICBgKCR7dXRpbC5wbHVyYWxpemUoJ2l0ZW0nLCBmb2xkZXJzVG9QdXNoLmxlbmd0aCArIDEsIHRydWUpfSlgKTtcblxuICBjb25zdCBwdXNoRmlsZSA9IGFzeW5jIChyZWxhdGl2ZVBhdGgpID0+IHtcbiAgICBjb25zdCBhYnNvbHV0ZVNvdXJjZVBhdGggPSBwYXRoLmpvaW4oc3JjUm9vdFBhdGgsIHJlbGF0aXZlUGF0aCk7XG4gICAgY29uc3QgcmVhZFN0cmVhbSA9IGZzLmNyZWF0ZVJlYWRTdHJlYW0oYWJzb2x1dGVTb3VyY2VQYXRoLCB7YXV0b0Nsb3NlOiB0cnVlfSk7XG4gICAgY29uc3QgYWJzb2x1dGVEZXN0aW5hdGlvblBhdGggPSBwYXRoLmpvaW4oZHN0Um9vdFBhdGgsIHJlbGF0aXZlUGF0aCk7XG4gICAgY29uc3Qgd3JpdGVTdHJlYW0gPSBhd2FpdCBhZmNTZXJ2aWNlLmNyZWF0ZVdyaXRlU3RyZWFtKGFic29sdXRlRGVzdGluYXRpb25QYXRoLCB7XG4gICAgICBhdXRvRGVzdHJveTogdHJ1ZVxuICAgIH0pO1xuICAgIHdyaXRlU3RyZWFtLm9uKCdmaW5pc2gnLCB3cml0ZVN0cmVhbS5kZXN0cm95KTtcbiAgICBsZXQgcHVzaEVycm9yID0gbnVsbDtcbiAgICBjb25zdCBmaWxlUHVzaFByb21pc2UgPSBuZXcgQigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB3cml0ZVN0cmVhbS5vbignY2xvc2UnLCAoKSA9PiB7XG4gICAgICAgIGlmIChwdXNoRXJyb3IpIHtcbiAgICAgICAgICByZWplY3QocHVzaEVycm9yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgY29uc3Qgb25TdHJlYW1FcnJvciA9IChlKSA9PiB7XG4gICAgICAgIHJlYWRTdHJlYW0udW5waXBlKHdyaXRlU3RyZWFtKTtcbiAgICAgICAgbG9nLmRlYnVnKGUpO1xuICAgICAgICBwdXNoRXJyb3IgPSBlO1xuICAgICAgfTtcbiAgICAgIHdyaXRlU3RyZWFtLm9uKCdlcnJvcicsIG9uU3RyZWFtRXJyb3IpO1xuICAgICAgcmVhZFN0cmVhbS5vbignZXJyb3InLCBvblN0cmVhbUVycm9yKTtcbiAgICB9KTtcbiAgICByZWFkU3RyZWFtLnBpcGUod3JpdGVTdHJlYW0pO1xuICAgIGF3YWl0IGZpbGVQdXNoUHJvbWlzZS50aW1lb3V0KHRpbWVvdXRNcyk7XG4gIH07XG5cbiAgaWYgKGVuYWJsZVBhcmFsbGVsUHVzaCkge1xuICAgIGxvZy5kZWJ1ZyhgUHJvY2VlZGluZyB0byBwYXJhbGxlbCBmaWxlcyBwdXNoIChtYXggJHtNQVhfSU9fQ0hVTktfU0laRX0gd3JpdGVycylgKTtcbiAgICBjb25zdCBwdXNoUHJvbWlzZXMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IHJlbGF0aXZlRmlsZVBhdGggb2YgXy5zaHVmZmxlKGZpbGVzVG9QdXNoKSkge1xuICAgICAgcHVzaFByb21pc2VzLnB1c2goQi5yZXNvbHZlKHB1c2hGaWxlKHJlbGF0aXZlRmlsZVBhdGgpKSk7XG4gICAgICAvLyBrZWVwIHRoZSBwdXNoIHF1ZXVlIGZpbGxlZFxuICAgICAgaWYgKHB1c2hQcm9taXNlcy5sZW5ndGggPj0gTUFYX0lPX0NIVU5LX1NJWkUpIHtcbiAgICAgICAgYXdhaXQgQi5hbnkocHVzaFByb21pc2VzKTtcbiAgICAgIH1cbiAgICAgIF8ucmVtb3ZlKHB1c2hQcm9taXNlcywgKHApID0+IHAuaXNGdWxmaWxsZWQoKSk7XG4gICAgfVxuICAgIGlmICghXy5pc0VtcHR5KHB1c2hQcm9taXNlcykpIHtcbiAgICAgIC8vIGhhbmRsZSB0aGUgcmVzdCBvZiBwdXNoIHByb21pc2VzXG4gICAgICBhd2FpdCBCLmFsbChwdXNoUHJvbWlzZXMpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsb2cuZGVidWcoYFByb2NlZWRpbmcgdG8gc2VyaWFsIGZpbGVzIHB1c2hgKTtcbiAgICBmb3IgKGNvbnN0IHJlbGF0aXZlRmlsZVBhdGggb2YgZmlsZXNUb1B1c2gpIHtcbiAgICAgIGF3YWl0IHB1c2hGaWxlKHJlbGF0aXZlRmlsZVBhdGgpO1xuICAgIH1cbiAgfVxuXG4gIGxvZy5kZWJ1ZyhgU3VjY2Vzc2Z1bGx5IHB1c2hlZCAke3V0aWwucGx1cmFsaXplKCdmb2xkZXInLCBmb2xkZXJzVG9QdXNoLmxlbmd0aCwgdHJ1ZSl9IGAgK1xuICAgIGBhbmQgJHt1dGlsLnBsdXJhbGl6ZSgnZmlsZScsIGZpbGVzVG9QdXNoLmxlbmd0aCwgdHJ1ZSl9IGAgK1xuICAgIGB3aXRoaW4gJHt0aW1lci5nZXREdXJhdGlvbigpLmFzTWlsbGlTZWNvbmRzLnRvRml4ZWQoMCl9bXNgKTtcbn1cblxuXG5leHBvcnQgeyBw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
